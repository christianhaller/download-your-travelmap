(function(){this.MooTools={version:"1.3.1dev",build:"%build%"};var n=this.typeOf=function(i){if(i==null){return"null"}if(i.$family){return i.$family()}if(i.nodeName){if(i.nodeType==1){return"element"}if(i.nodeType==3){return(/\S/).test(i.nodeValue)?"textnode":"whitespace"}}else{if(typeof i.length=="number"){if(i.callee){return"arguments"}if("item" in i){return"collection"}}}return typeof i};var h=this.instanceOf=function(s,i){if(s==null){return false}var r=s.$constructor||s.constructor;while(r){if(r===i){return true}r=r.parent}return s instanceof i};var f=this.Function;var o=true;for(var j in {toString:1}){o=null}if(o){o=["hasOwnProperty","valueOf","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","constructor"]}f.prototype.overloadSetter=function(r){var i=this;return function(t,s){if(t==null){return this}if(r||typeof t!="string"){for(var u in t){i.call(this,u,t[u])}if(o){for(var v=o.length;v--;){u=o[v];if(t.hasOwnProperty(u)){i.call(this,u,t[u])}}}}else{i.call(this,t,s)}return this}};f.prototype.overloadGetter=function(r){var i=this;return function(t){var u,s;if(r||typeof t!="string"){u=t}else{if(arguments.length>1){u=arguments}}if(u){s={};for(var v=0;v<u.length;v++){s[u[v]]=i.call(this,u[v])}}else{s=i.call(this,t)}return s}};f.prototype.extend=function(i,r){this[i]=r}.overloadSetter();f.prototype.implement=function(i,r){this.prototype[i]=r}.overloadSetter();var m=Array.prototype.slice;f.from=function(i){return(n(i)=="function")?i:function(){return i}};Array.from=function(i){if(i==null){return[]}return(a.isEnumerable(i)&&typeof i!="string")?(n(i)=="array")?i:m.call(i):[i]};Number.from=function(r){var i=parseFloat(r);return isFinite(i)?i:null};String.from=function(i){return i+""};f.implement({hide:function(){this.$hidden=true;return this},protect:function(){this.$protected=true;return this}});var a=this.Type=function(t,s){if(t){var r=t.toLowerCase();var i=function(u){return(n(u)==r)};a["is"+t]=i;if(s!=null){s.prototype.$family=(function(){return r}).hide()}}if(s==null){return null}s.extend(this);s.$constructor=a;s.prototype.$constructor=s;return s};var e=Object.prototype.toString;a.isEnumerable=function(i){return(i!=null&&typeof i.length=="number"&&e.call(i)!="[object Function]")};var p={};var q=function(i){var r=n(i.prototype);return p[r]||(p[r]=[])};var b=function(s,w){if(w&&w.$hidden){return this}var r=q(this);for(var t=0;t<r.length;t++){var v=r[t];if(n(v)=="type"){b.call(v,s,w)}else{v.call(this,s,w)}}var u=this.prototype[s];if(u==null||!u.$protected){this.prototype[s]=w}if(this[s]==null&&n(w)=="function"){l.call(this,s,function(i){return w.apply(i,m.call(arguments,1))})}return this};var l=function(i,s){if(s&&s.$hidden){return this}var r=this[i];if(r==null||!r.$protected){this[i]=s}return this};a.implement({implement:b.overloadSetter(),extend:l.overloadSetter(),alias:function(i,r){b.call(this,i,this.prototype[r])}.overloadSetter(),mirror:function(i){q(this).push(i);return this}});new a("Type",a);var d=function(r,v,t){var s=(v!=Object),z=v.prototype;if(s){v=new a(r,v)}for(var w=0,u=t.length;w<u;w++){var A=t[w],y=v[A],x=z[A];if(y){y.protect()}if(s&&x){delete z[A];z[A]=x.protect()}}if(s){v.implement(z)}return d};d("String",String,["charAt","charCodeAt","concat","indexOf","lastIndexOf","match","quote","replace","search","slice","split","substr","substring","toLowerCase","toUpperCase"])("Array",Array,["pop","push","reverse","shift","sort","splice","unshift","concat","join","slice","indexOf","lastIndexOf","filter","forEach","every","map","some","reduce","reduceRight"])("Number",Number,["toExponential","toFixed","toLocaleString","toPrecision"])("Function",f,["apply","call","bind"])("RegExp",RegExp,["exec","test"])("Object",Object,["create","defineProperty","defineProperties","keys","getPrototypeOf","getOwnPropertyDescriptor","getOwnPropertyNames","preventExtensions","isExtensible","seal","isSealed","freeze","isFrozen"])("Date",Date,["now"]);Object.extend=l.overloadSetter();Date.extend("now",function(){return +(new Date)});new a("Boolean",Boolean);Number.prototype.$family=function(){return isFinite(this)?"number":"null"}.hide();Number.extend("random",function(r,i){return Math.floor(Math.random()*(i-r+1)+r)});Object.extend("forEach",function(i,s,t){for(var r in i){if(i.hasOwnProperty(r)){s.call(t,i[r],r,i)}}});Object.each=Object.forEach;Array.implement({forEach:function(t,u){for(var s=0,r=this.length;s<r;s++){if(s in this){t.call(u,this[s],s,this)}}},each:function(i,r){Array.forEach(this,i,r);return this}});var k=function(i){switch(n(i)){case"array":return i.clone();case"object":return Object.clone(i);default:return i}};Array.implement("clone",function(){var r=this.length,s=new Array(r);while(r--){s[r]=k(this[r])}return s});var g=function(r,i,s){switch(n(s)){case"object":if(n(r[i])=="object"){Object.merge(r[i],s)}else{r[i]=Object.clone(s)}break;case"array":r[i]=s.clone();break;default:r[i]=s}return r};Object.extend({merge:function(y,t,s){if(n(t)=="string"){return g(y,t,s)}for(var x=1,r=arguments.length;x<r;x++){var u=arguments[x];for(var w in u){g(y,w,u[w])}}return y},clone:function(i){var s={};for(var r in i){s[r]=k(i[r])}return s},append:function(v){for(var u=1,s=arguments.length;u<s;u++){var r=arguments[u]||{};for(var t in r){v[t]=r[t]}}return v}});["Object","WhiteSpace","TextNode","Collection","Arguments"].each(function(i){new a(i)});var c=Date.now();String.extend("uniqueID",function(){return(c++).toString(36)})})();Array.implement({invoke:function(a){var b=Array.slice(arguments,1);return this.map(function(c){return c[a].apply(c,b)})},every:function(c,d){for(var b=0,a=this.length;b<a;b++){if((b in this)&&!c.call(d,this[b],b,this)){return false}}return true},filter:function(d,e){var c=[];for(var b=0,a=this.length;b<a;b++){if((b in this)&&d.call(e,this[b],b,this)){c.push(this[b])}}return c},clean:function(){return this.filter(function(a){return a!=null})},indexOf:function(c,d){var a=this.length;for(var b=(d<0)?Math.max(0,a+d):d||0;b<a;b++){if(this[b]===c){return b}}return -1},map:function(d,e){var c=[];for(var b=0,a=this.length;b<a;b++){if(b in this){c[b]=d.call(e,this[b],b,this)}}return c},some:function(c,d){for(var b=0,a=this.length;b<a;b++){if((b in this)&&c.call(d,this[b],b,this)){return true}}return false},associate:function(c){var d={},b=Math.min(this.length,c.length);for(var a=0;a<b;a++){d[c[a]]=this[a]}return d},link:function(c){var a={};for(var e=0,b=this.length;e<b;e++){for(var d in c){if(c[d](this[e])){a[d]=this[e];delete c[d];break}}}return a},contains:function(a,b){return this.indexOf(a,b)!=-1},append:function(a){this.push.apply(this,a);return this},getLast:function(){return(this.length)?this[this.length-1]:null},getRandom:function(){return(this.length)?this[Number.random(0,this.length-1)]:null},include:function(a){if(!this.contains(a)){this.push(a)}return this},combine:function(c){for(var b=0,a=c.length;b<a;b++){this.include(c[b])}return this},erase:function(b){for(var a=this.length;a--;){if(this[a]===b){this.splice(a,1)}}return this},empty:function(){this.length=0;return this},flatten:function(){var d=[];for(var b=0,a=this.length;b<a;b++){var c=typeOf(this[b]);if(c=="null"){continue}d=d.concat((c=="array"||c=="collection"||c=="arguments"||instanceOf(this[b],Array))?Array.flatten(this[b]):this[b])}return d},pick:function(){for(var b=0,a=this.length;b<a;b++){if(this[b]!=null){return this[b]}}return null},hexToRgb:function(b){if(this.length!=3){return null}var a=this.map(function(c){if(c.length==1){c+=c}return c.toInt(16)});return(b)?a:"rgb("+a+")"},rgbToHex:function(d){if(this.length<3){return null}if(this.length==4&&this[3]==0&&!d){return"transparent"}var b=[];for(var a=0;a<3;a++){var c=(this[a]-0).toString(16);b.push((c.length==1)?"0"+c:c)}return(d)?b:"#"+b.join("")}});var Event=new Type("Event",function(a,i){if(!i){i=window}var o=i.document;a=a||i.event;if(a.$extended){return a}this.$extended=true;var n=a.type,k=a.target||a.srcElement,m={},c={};while(k&&k.nodeType==3){k=k.parentNode}if(n.indexOf("key")!=-1){var b=a.which||a.keyCode;var q=Object.keyOf(Event.Keys,b);if(n=="keydown"){var d=b-111;if(d>0&&d<13){q="f"+d}}if(!q){q=String.fromCharCode(b).toLowerCase()}}else{if((/click|mouse|menu/i).test(n)){o=(!o.compatMode||o.compatMode=="CSS1Compat")?o.html:o.body;m={x:(a.pageX!=null)?a.pageX:a.clientX+o.scrollLeft,y:(a.pageY!=null)?a.pageY:a.clientY+o.scrollTop};c={x:(a.pageX!=null)?a.pageX-i.pageXOffset:a.clientX,y:(a.pageY!=null)?a.pageY-i.pageYOffset:a.clientY};if((/DOMMouseScroll|mousewheel/).test(n)){var l=(a.wheelDelta)?a.wheelDelta/120:-(a.detail||0)/3}var h=(a.which==3)||(a.button==2),p=null;if((/over|out/).test(n)){p=a.relatedTarget||a[(n=="mouseover"?"from":"to")+"Element"];var j=function(){while(p&&p.nodeType==3){p=p.parentNode}return true};var g=(Browser.firefox2)?j.attempt():j();p=(g)?p:null}}else{if((/gesture|touch/i).test(n)){this.rotation=a.rotation;this.scale=a.scale;this.targetTouches=a.targetTouches;this.changedTouches=a.changedTouches;var f=this.touches=a.touches;if(f&&f[0]){var e=f[0];m={x:e.pageX,y:e.pageY};c={x:e.clientX,y:e.clientY}}}else{if((/drag(enter|leave|over)|drop/i).test(n)){this.dataTransfer=a.dataTransfer}}}}return Object.append(this,{event:a,type:n,page:m,client:c,rightClick:h,wheel:l,relatedTarget:document.id(p),target:document.id(k),code:b,key:q,keyCode:a.keyCode,clientX:a.clientX,clientY:a.clientY,shift:a.shiftKey,control:a.ctrlKey,alt:a.altKey,meta:a.metaKey})});Event.Keys={enter:13,up:38,down:40,left:37,right:39,esc:27,space:32,backspace:8,tab:9,"delete":46};Event.implement({stop:function(){return this.stopPropagation().preventDefault()},stopPropagation:function(){if(this.event.stopPropagation){this.event.stopPropagation()}else{this.event.cancelBubble=true}return this},preventDefault:function(){if(this.event.preventDefault){this.event.preventDefault()}else{this.event.returnValue=false}return this}});Function.extend({attempt:function(){for(var b=0,a=arguments.length;b<a;b++){try{return arguments[b]()}catch(c){}}return null}});Function.implement({attempt:function(a,c){try{return this.apply(c,Array.from(a))}catch(b){}return null},bind:function(c){var a=this,b=(arguments.length>1)?Array.slice(arguments,1):null;return function(){if(!b&&!arguments.length){return a.call(c)}if(b&&arguments.length){return a.apply(c,b.concat(Array.from(arguments)))}return a.apply(c,b||arguments)}},pass:function(b,c){var a=this;if(b!=null){b=Array.from(b)}return function(){return a.apply(c,b||arguments)}},delay:function(b,c,a){return setTimeout(this.pass((a==null?[]:a),c),b)},periodical:function(c,b,a){return setInterval(this.pass((a==null?[]:a),b),c)}});Number.implement({limit:function(b,a){return Math.min(a,Math.max(b,this))},round:function(a){a=Math.pow(10,a||0).toFixed(a<0?-a:0);return Math.round(this*a)/a},times:function(b,c){for(var a=0;a<this;a++){b.call(c,a,this)}},toFloat:function(){return parseFloat(this)},toInt:function(a){return parseInt(this,a||10)}});Number.alias("each","times");(function(b){var a={};b.each(function(c){if(!Number[c]){a[c]=function(){return Math[c].apply(null,[this].concat(Array.from(arguments)))}}});Number.implement(a)})(["abs","acos","asin","atan","atan2","ceil","cos","exp","floor","log","max","min","pow","sin","sqrt","tan"]);Object.extend({subset:function(c,f){var e={};for(var d=0,a=f.length;d<a;d++){var b=f[d];e[b]=c[b]}return e},map:function(a,d,e){var c={};for(var b in a){if(a.hasOwnProperty(b)){c[b]=d.call(e,a[b],b,a)}}return c},filter:function(a,c,d){var b={};Object.each(a,function(f,e){if(c.call(d,f,e,a)){b[e]=f}});return b},every:function(a,c,d){for(var b in a){if(a.hasOwnProperty(b)&&!c.call(d,a[b],b)){return false}}return true},some:function(a,c,d){for(var b in a){if(a.hasOwnProperty(b)&&c.call(d,a[b],b)){return true}}return false},keys:function(a){var c=[];for(var b in a){if(a.hasOwnProperty(b)){c.push(b)}}return c},values:function(b){var a=[];for(var c in b){if(b.hasOwnProperty(c)){a.push(b[c])}}return a},getLength:function(a){return Object.keys(a).length},keyOf:function(a,c){for(var b in a){if(a.hasOwnProperty(b)&&a[b]===c){return b}}return null},contains:function(a,b){return Object.keyOf(a,b)!=null},toQueryString:function(a,b){var c=[];Object.each(a,function(g,f){if(b){f=b+"["+f+"]"}var e;switch(typeOf(g)){case"object":e=Object.toQueryString(g,f);break;case"array":var d={};g.each(function(j,h){d[h]=j});e=Object.toQueryString(d,f);break;default:e=f+"="+encodeURIComponent(g)}if(g!=null){c.push(e)}});return c.join("&")}});String.implement({test:function(a,b){return((typeOf(a)=="regexp")?a:new RegExp(""+a,b)).test(this)},contains:function(a,b){return(b)?(b+this+b).indexOf(b+a+b)>-1:this.indexOf(a)>-1},trim:function(){return this.replace(/^\s+|\s+$/g,"")},clean:function(){return this.replace(/\s+/g," ").trim()},camelCase:function(){return this.replace(/-\D/g,function(a){return a.charAt(1).toUpperCase()})},hyphenate:function(){return this.replace(/[A-Z]/g,function(a){return("-"+a.charAt(0).toLowerCase())})},capitalize:function(){return this.replace(/\b[a-z]/g,function(a){return a.toUpperCase()})},escapeRegExp:function(){return this.replace(/([-.*+?^${}()|[\]\/\\])/g,"\\$1")},toInt:function(a){return parseInt(this,a||10)},toFloat:function(){return parseFloat(this)},hexToRgb:function(b){var a=this.match(/^#?(\w{1,2})(\w{1,2})(\w{1,2})$/);return(a)?a.slice(1).hexToRgb(b):null},rgbToHex:function(b){var a=this.match(/\d{1,3}/g);return(a)?a.rgbToHex(b):null},substitute:function(a,b){return this.replace(b||(/\\?\{([^{}]+)\}/g),function(d,c){if(d.charAt(0)=="\\"){return d.slice(1)}return(a[c]!=null)?a[c]:""})}});(function(){var k,n,l,g,a={},c={},m=/\\/g;var e=function(q,p){if(q==null){return null}if(q.Slick===true){return q}q=(""+q).replace(/^\s+|\s+$/g,"");g=!!p;var o=(g)?c:a;if(o[q]){return o[q]}k={Slick:true,expressions:[],raw:q,reverse:function(){return e(this.raw,true)}};n=-1;while(q!=(q=q.replace(j,b))){}k.length=k.expressions.length;return o[q]=(g)?h(k):k};var i=function(o){if(o==="!"){return" "}else{if(o===" "){return"!"}else{if((/^!/).test(o)){return o.replace(/^!/,"")}else{return"!"+o}}}};var h=function(u){var r=u.expressions;for(var p=0;p<r.length;p++){var t=r[p];var q={parts:[],tag:"*",combinator:i(t[0].combinator)};for(var o=0;o<t.length;o++){var s=t[o];if(!s.reverseCombinator){s.reverseCombinator=" "}s.combinator=s.reverseCombinator;delete s.reverseCombinator}t.reverse().push(q)}return u};var f=function(o){return o.replace(/[-[\]{}()*+?.\\^$|,#\s]/g,"\\$&")};var j=new RegExp("^(?:\\s*(,)\\s*|\\s*(<combinator>+)\\s*|(\\s+)|(<unicode>+|\\*)|\\#(<unicode>+)|\\.(<unicode>+)|\\[\\s*(<unicode1>+)(?:\\s*([*^$!~|]?=)(?:\\s*(?:([\"']?)(.*?)\\9)))?\\s*\\](?!\\])|:+(<unicode>+)(?:\\((?:(?:([\"'])([^\\12]*)\\12)|((?:\\([^)]+\\)|[^()]*)+))\\))?)".replace(/<combinator>/,"["+f(">+~`!@$%^&={}\\;</")+"]").replace(/<unicode>/g,"(?:[\\w\\u00a1-\\uFFFF-]|\\\\[^\\s0-9a-f])").replace(/<unicode1>/g,"(?:[:\\w\\u00a1-\\uFFFF-]|\\\\[^\\s0-9a-f])"));function b(x,s,D,z,r,C,q,B,A,y,u,F,v,p,w){if(s||n===-1){k.expressions[++n]=[];l=-1;if(s){return""}}if(D||z||l===-1){D=D||" ";var t=k.expressions[n];if(g&&t[l]){t[l].reverseCombinator=i(D)}t[++l]={combinator:D,tag:"*"}}var o=k.expressions[n][l];if(r){o.tag=r.replace(m,"")}else{if(C){o.id=C.replace(m,"")}else{if(q){q=q.replace(m,"");if(!o.classList){o.classList=[]}if(!o.classes){o.classes=[]}o.classList.push(q);o.classes.push({value:q,regexp:new RegExp("(^|\\s)"+f(q)+"(\\s|$)")})}else{if(F){w=w||p;w=w?w.replace(m,""):null;if(!o.pseudos){o.pseudos=[]}o.pseudos.push({key:F.replace(m,""),value:w})}else{if(B){B=B.replace(m,"");u=(u||"").replace(m,"");var E,G;switch(A){case"^=":G=new RegExp("^"+f(u));break;case"$=":G=new RegExp(f(u)+"$");break;case"~=":G=new RegExp("(^|\\s)"+f(u)+"(\\s|$)");break;case"|=":G=new RegExp("^"+f(u)+"(-|$)");break;case"=":E=function(H){return u==H};break;case"*=":E=function(H){return H&&H.indexOf(u)>-1};break;case"!=":E=function(H){return u!=H};break;default:E=function(H){return !!H}}if(u==""&&(/^[*$^]=$/).test(A)){E=function(){return false}}if(!E){E=function(H){return H&&G.test(H)}}if(!o.attributes){o.attributes=[]}o.attributes.push({key:B,operator:A,value:u,test:E})}}}}}return""}var d=(this.Slick||{});d.parse=function(o){return e(o)};d.escapeRegExp=f;if(!this.Slick){this.Slick=d}}).apply((typeof exports!="undefined")?exports:this);(function(){var b={};b.isNativeCode=function(c){return(/\{\s*\[native code\]\s*\}/).test(""+c)};b.isXML=function(c){return(!!c.xmlVersion)||(!!c.xml)||(Object.prototype.toString.call(c)==="[object XMLDocument]")||(c.nodeType===9&&c.documentElement.nodeName!=="HTML")};b.setDocument=function(n){if(n.nodeType===9){}else{if(n.ownerDocument){n=n.ownerDocument}else{if(n.navigator){n=n.document}else{return}}}if(this.document===n){return}this.document=n;var o=this.root=n.documentElement;this.isXMLDocument=this.isXML(n);this.brokenStarGEBTN=this.starSelectsClosedQSA=this.idGetsName=this.brokenMixedCaseQSA=this.brokenGEBCN=this.brokenCheckedQSA=this.brokenEmptyAttributeQSA=this.isHTMLDocument=false;var i,j,p,k;var l,c;var q=n.createElement("div");o.appendChild(q);try{c="slick_getbyid_test";q.innerHTML='<a id="'+c+'"></a>';this.isHTMLDocument=!!n.getElementById(c)}catch(m){}if(this.isHTMLDocument){q.style.display="none";q.appendChild(n.createComment(""));j=(q.getElementsByTagName("*").length>0);try{q.innerHTML="foo</foo>";l=q.getElementsByTagName("*");i=(l&&l.length&&l[0].nodeName.charAt(0)=="/")}catch(m){}this.brokenStarGEBTN=j||i;if(q.querySelectorAll){try{q.innerHTML="foo</foo>";l=q.querySelectorAll("*");this.starSelectsClosedQSA=(l&&l.length&&l[0].nodeName.charAt(0)=="/")}catch(m){}}try{c="slick_id_gets_name";q.innerHTML='<a name="'+c+'"></a><b id="'+c+'"></b>';this.idGetsName=n.getElementById(c)===q.firstChild}catch(m){}try{q.innerHTML='<a class="MiXedCaSe"></a>';this.brokenMixedCaseQSA=!q.querySelectorAll(".MiXedCaSe").length}catch(m){}try{q.innerHTML='<a class="f"></a><a class="b"></a>';q.getElementsByClassName("b").length;q.firstChild.className="b";k=(q.getElementsByClassName("b").length!=2)}catch(m){}try{q.innerHTML='<a class="a"></a><a class="f b a"></a>';p=(q.getElementsByClassName("a").length!=2)}catch(m){}this.brokenGEBCN=k||p;try{q.innerHTML='<select><option selected="selected">a</option></select>';this.brokenCheckedQSA=(q.querySelectorAll(":checked").length==0)}catch(m){}try{q.innerHTML='<a class=""></a>';this.brokenEmptyAttributeQSA=(q.querySelectorAll('[class*=""]').length!=0)}catch(m){}}o.removeChild(q);q=null;this.hasAttribute=(o&&this.isNativeCode(o.hasAttribute))?function(s,r){return s.hasAttribute(r)}:function(s,r){s=s.getAttributeNode(r);return !!(s&&(s.specified||s.nodeValue))};this.contains=(o&&this.isNativeCode(o.contains))?function(r,s){return r.contains(s)}:(o&&o.compareDocumentPosition)?function(r,s){return r===s||!!(r.compareDocumentPosition(s)&16)}:function(r,s){if(s){do{if(s===r){return true}}while((s=s.parentNode))}return false};this.documentSorter=(o.compareDocumentPosition)?function(s,r){if(!s.compareDocumentPosition||!r.compareDocumentPosition){return 0}return s.compareDocumentPosition(r)&4?-1:s===r?0:1}:("sourceIndex" in o)?function(s,r){if(!s.sourceIndex||!r.sourceIndex){return 0}return s.sourceIndex-r.sourceIndex}:(n.createRange)?function(u,s){if(!u.ownerDocument||!s.ownerDocument){return 0}var t=u.ownerDocument.createRange(),r=s.ownerDocument.createRange();t.setStart(u,0);t.setEnd(u,0);r.setStart(s,0);r.setEnd(s,0);return t.compareBoundaryPoints(Range.START_TO_END,r)}:null;this.getUID=(this.isHTMLDocument)?this.getUIDHTML:this.getUIDXML};b.search=function(k,x,F,q){var w=this.found=(q)?null:(F||[]);if(!k){return w}if(k.navigator){k=k.document}else{if(!k.nodeType){return w}}var t,E;var o=this.uniques={};if(this.document!==(k.ownerDocument||k)){this.setDocument(k)}var y=!!(F&&F.length);if(y){for(E=w.length;E--;){this.uniques[this.getUID(w[E])]=true}}if(typeof x=="string"){for(E=this.overrides.length;E--;){var u=this.overrides[E];if(u.regexp.test(x)){var v=u.method.call(k,x,w,q);if(v===false){continue}if(v===true){return w}return v}}t=this.Slick.parse(x);if(!t.length){return w}}else{if(x==null){return w}else{if(x.Slick){t=x}else{if(this.contains(k.documentElement||k,x)){(w)?w.push(x):w=x;return w}else{return w}}}}this.posNTH={};this.posNTHLast={};this.posNTHType={};this.posNTHTypeLast={};this.push=(!y&&(q||(t.length==1&&t.expressions[0].length==1)))?this.pushArray:this.pushUID;if(w==null){w=[]}var D,B,A;var C,K,z,J,G,s,p;var r,l,c,H,I=t.expressions;search:for(E=0;(l=I[E]);E++){for(D=0;(c=l[D]);D++){C="combinator:"+c.combinator;if(!this[C]){continue search}K=(this.isXMLDocument)?c.tag:c.tag.toUpperCase();z=c.id;J=c.classList;G=c.classes;s=c.attributes;p=c.pseudos;H=(D===(l.length-1));this.bitUniques={};if(H){this.uniques=o;this.found=w}else{this.uniques={};this.found=[]}if(D===0){this[C](k,K,z,G,s,p,J);if(q&&H&&w.length){break search}}else{if(q&&H){for(B=0,A=r.length;B<A;B++){this[C](r[B],K,z,G,s,p,J);if(w.length){break search}}}else{for(B=0,A=r.length;B<A;B++){this[C](r[B],K,z,G,s,p,J)}}}r=this.found}}if(y||(t.expressions.length>1)){this.sort(w)}return(q)?(w[0]||null):w};b.uidx=1;b.uidk="slick:uniqueid";b.getUIDXML=function(i){var c=i.getAttribute(this.uidk);if(!c){c=this.uidx++;i.setAttribute(this.uidk,c)}return c};b.getUIDHTML=function(c){return c.uniqueNumber||(c.uniqueNumber=this.uidx++)};b.sort=function(c){if(!this.documentSorter){return c}c.sort(this.documentSorter);return c};b.cacheNTH={};b.matchNTH=/^([+-]?\d*)?([a-z]+)?([+-]\d+)?$/;b.parseNTHArgument=function(l){var j=l.match(this.matchNTH);if(!j){return false}var k=j[2]||false;var i=j[1]||1;if(i=="-"){i=-1}var c=+j[3]||0;j=(k=="n")?{a:i,b:c}:(k=="odd")?{a:2,b:1}:(k=="even")?{a:2,b:0}:{a:0,b:i};return(this.cacheNTH[l]=j)};b.createNTHPseudo=function(k,i,c,j){return function(n,l){var p=this.getUID(n);if(!this[c][p]){var v=n.parentNode;if(!v){return false}var m=v[k],o=1;if(j){var u=n.nodeName;do{if(m.nodeName!==u){continue}this[c][this.getUID(m)]=o++}while((m=m[i]))}else{do{if(m.nodeType!==1){continue}this[c][this.getUID(m)]=o++}while((m=m[i]))}}l=l||"n";var q=this.cacheNTH[l]||this.parseNTHArgument(l);if(!q){return false}var t=q.a,s=q.b,r=this[c][p];if(t==0){return s==r}if(t>0){if(r<s){return false}}else{if(s<r){return false}}return((r-s)%t)==0}};b.pushArray=function(k,c,m,j,i,l){if(this.matchSelector(k,c,m,j,i,l)){this.found.push(k)}};b.pushUID=function(l,c,n,k,i,m){var j=this.getUID(l);if(!this.uniques[j]&&this.matchSelector(l,c,n,k,i,m)){this.uniques[j]=true;this.found.push(l)}};b.matchNode=function(n,c){var k=this.Slick.parse(c);if(!k){return true}if(k.length==1&&k.expressions[0].length==1){var o=k.expressions[0][0];return this.matchSelector(n,(this.isXMLDocument)?o.tag:o.tag.toUpperCase(),o.id,o.classes,o.attributes,o.pseudos)}var j=this.search(this.document,k);for(var l=0,m;m=j[l++];){if(m===n){return true}}return false};b.matchPseudo=function(l,c,k){var i="pseudo:"+c;if(this[i]){return this[i](l,k)}var j=this.getAttribute(l,c);return(k)?k==j:!!j};b.matchSelector=function(k,q,c,l,m,o){if(q){if(q=="*"){if(k.nodeName<"@"){return false}}else{if(k.nodeName!=q){return false}}}if(c&&k.getAttribute("id")!=c){return false}var n,j,p;if(l){for(n=l.length;n--;){p=("className" in k)?k.className:k.getAttribute("class");if(!(p&&l[n].regexp.test(p))){return false}}}if(m){for(n=m.length;n--;){j=m[n];if(j.operator?!j.test(this.getAttribute(k,j.key)):!this.hasAttribute(k,j.key)){return false}}}if(o){for(n=o.length;n--;){j=o[n];if(!this.matchPseudo(k,j.key,j.value)){return false}}}return true};var a={" ":function(l,r,c,m,n,p,k){var o,q,j;if(this.isHTMLDocument){getById:if(c){q=this.document.getElementById(c);if((!q&&l.all)||(this.idGetsName&&q&&q.getAttributeNode("id").nodeValue!=c)){j=l.all[c];if(!j){return}if(!j[0]){j=[j]}for(o=0;q=j[o++];){if(q.getAttributeNode("id").nodeValue==c){this.push(q,r,null,m,n,p);break}}return}if(!q){if(this.contains(this.document.documentElement,l)){return}else{break getById}}else{if(this.document!==l&&!this.contains(l,q)){return}}this.push(q,r,null,m,n,p);return}getByClass:if(m&&l.getElementsByClassName&&!this.brokenGEBCN){j=l.getElementsByClassName(k.join(" "));if(!(j&&j.length)){break getByClass}for(o=0;q=j[o++];){this.push(q,r,c,null,n,p)}return}}getByTag:{j=l.getElementsByTagName(r);if(!(j&&j.length)){break getByTag}if(!this.brokenStarGEBTN){r=null}for(o=0;q=j[o++];){this.push(q,r,c,m,n,p)}}},">":function(k,c,m,j,i,l){if((k=k.firstChild)){do{if(k.nodeType===1){this.push(k,c,m,j,i,l)}}while((k=k.nextSibling))}},"+":function(k,c,m,j,i,l){while((k=k.nextSibling)){if(k.nodeType===1){this.push(k,c,m,j,i,l);break}}},"^":function(k,c,m,j,i,l){k=k.firstChild;if(k){if(k.nodeType===1){this.push(k,c,m,j,i,l)}else{this["combinator:+"](k,c,m,j,i,l)}}},"~":function(l,c,n,k,i,m){while((l=l.nextSibling)){if(l.nodeType!==1){continue}var j=this.getUID(l);if(this.bitUniques[j]){break}this.bitUniques[j]=true;this.push(l,c,n,k,i,m)}},"++":function(k,c,m,j,i,l){this["combinator:+"](k,c,m,j,i,l);this["combinator:!+"](k,c,m,j,i,l)},"~~":function(k,c,m,j,i,l){this["combinator:~"](k,c,m,j,i,l);this["combinator:!~"](k,c,m,j,i,l)},"!":function(k,c,m,j,i,l){while((k=k.parentNode)){if(k!==this.document){this.push(k,c,m,j,i,l)}}},"!>":function(k,c,m,j,i,l){k=k.parentNode;if(k!==this.document){this.push(k,c,m,j,i,l)}},"!+":function(k,c,m,j,i,l){while((k=k.previousSibling)){if(k.nodeType===1){this.push(k,c,m,j,i,l);break}}},"!^":function(k,c,m,j,i,l){k=k.lastChild;if(k){if(k.nodeType===1){this.push(k,c,m,j,i,l)}else{this["combinator:!+"](k,c,m,j,i,l)}}},"!~":function(l,c,n,k,i,m){while((l=l.previousSibling)){if(l.nodeType!==1){continue}var j=this.getUID(l);if(this.bitUniques[j]){break}this.bitUniques[j]=true;this.push(l,c,n,k,i,m)}}};for(var h in a){b["combinator:"+h]=a[h]}var g={empty:function(c){var i=c.firstChild;return !(i&&i.nodeType==1)&&!(c.innerText||c.textContent||"").length},not:function(c,i){return !this.matchNode(c,i)},contains:function(c,i){return(c.innerText||c.textContent||"").indexOf(i)>-1},"first-child":function(c){while((c=c.previousSibling)){if(c.nodeType===1){return false}}return true},"last-child":function(c){while((c=c.nextSibling)){if(c.nodeType===1){return false}}return true},"only-child":function(j){var i=j;while((i=i.previousSibling)){if(i.nodeType===1){return false}}var c=j;while((c=c.nextSibling)){if(c.nodeType===1){return false}}return true},"nth-child":b.createNTHPseudo("firstChild","nextSibling","posNTH"),"nth-last-child":b.createNTHPseudo("lastChild","previousSibling","posNTHLast"),"nth-of-type":b.createNTHPseudo("firstChild","nextSibling","posNTHType",true),"nth-last-of-type":b.createNTHPseudo("lastChild","previousSibling","posNTHTypeLast",true),index:function(i,c){return this["pseudo:nth-child"](i,""+c+1)},even:function(i,c){return this["pseudo:nth-child"](i,"2n")},odd:function(i,c){return this["pseudo:nth-child"](i,"2n+1")},"first-of-type":function(c){var i=c.nodeName;while((c=c.previousSibling)){if(c.nodeName===i){return false}}return true},"last-of-type":function(c){var i=c.nodeName;while((c=c.nextSibling)){if(c.nodeName===i){return false}}return true},"only-of-type":function(j){var i=j,k=j.nodeName;while((i=i.previousSibling)){if(i.nodeName===k){return false}}var c=j;while((c=c.nextSibling)){if(c.nodeName===k){return false}}return true},enabled:function(c){return(c.disabled===false)},disabled:function(c){return(c.disabled===true)},checked:function(c){return c.checked||c.selected},focus:function(c){return this.isHTMLDocument&&this.document.activeElement===c&&(c.href||c.type||this.hasAttribute(c,"tabindex"))},root:function(c){return(c===this.root)},selected:function(c){return c.selected}};for(var d in g){b["pseudo:"+d]=g[d]}b.attributeGetters={"class":function(){return("className" in this)?this.className:this.getAttribute("class")},"for":function(){return("htmlFor" in this)?this.htmlFor:this.getAttribute("for")},href:function(){return("href" in this)?this.getAttribute("href",2):this.getAttribute("href")},style:function(){return(this.style)?this.style.cssText:this.getAttribute("style")}};b.getAttribute=function(j,c){var k=this.attributeGetters[c];if(k){return k.call(j)}var i=j.getAttributeNode(c);return i?i.nodeValue:null};b.overrides=[];b.override=function(c,i){this.overrides.push({regexp:c,method:i})};var f=/\[.*[*$^]=(?:["']{2})?\]/;b.override(/./,function(p,n,o){if(!this.querySelectorAll||this.nodeType!=9||!b.isHTMLDocument||b.brokenMixedCaseQSA||(b.brokenCheckedQSA&&p.indexOf(":checked")>-1)||(b.brokenEmptyAttributeQSA&&f.test(p))||e.disableQSA){return false}var j,m;try{if(o){return this.querySelector(p)||null}else{j=this.querySelectorAll(p)}}catch(k){return false}var l,c=!!(n.length);if(b.starSelectsClosedQSA){for(l=0;m=j[l++];){if(m.nodeName>"@"&&(!c||!b.uniques[b.getUIDHTML(m)])){n.push(m)}}}else{for(l=0;m=j[l++];){if(!c||!b.uniques[b.getUIDHTML(m)]){n.push(m)}}}if(c){b.sort(n)}return true});b.override(/^[\w-]+$|^\*$/,function(p,n,o){var j=p;if(j=="*"&&b.brokenStarGEBTN){return false}var k=this.getElementsByTagName(j);if(o){return k[0]||null}var l,m,c=!!(n.length);for(l=0;m=k[l++];){if(!c||!b.uniques[b.getUID(m)]){n.push(m)}}if(c){b.sort(n)}return true});b.override(/^\.[\w-]+$/,function(o,q,m){if(!b.isHTMLDocument||(!this.getElementsByClassName&&this.querySelectorAll)){return false}var c,k,l,j=!!(q&&q.length),p=o.substring(1);if(this.getElementsByClassName&&!b.brokenGEBCN){c=this.getElementsByClassName(p);if(m){return c[0]||null}for(l=0;k=c[l++];){if(!j||!b.uniques[b.getUIDHTML(k)]){q.push(k)}}}else{var n=new RegExp("(^|\\s)"+e.escapeRegExp(p)+"(\\s|$)");c=this.getElementsByTagName("*");for(l=0;k=c[l++];){p=k.className;if(!p||!n.test(p)){continue}if(m){return k}if(!j||!b.uniques[b.getUIDHTML(k)]){q.push(k)}}}if(j){b.sort(q)}return(m)?null:true});b.override(/^#[\w-]+$/,function(l,j,k){if(!b.isHTMLDocument||this.nodeType!=9){return false}var m=l.substring(1),i=this.getElementById(m);if(!i){return j}if(b.idGetsName&&i.getAttributeNode("id").nodeValue!=m){return false}if(k){return i||null}var c=!!(j.length);if(!c||!b.uniques[b.getUIDHTML(i)]){j.push(i)}if(c){b.sort(j)}return true});if(typeof document!="undefined"){b.setDocument(document)}var e=b.Slick=(this.Slick||{});e.version="0.9dev";e.search=function(i,j,c){return b.search(i,j,c)};e.find=function(c,i){return b.search(c,i,null,true)};e.contains=function(c,i){b.setDocument(c);return b.contains(c,i)};e.getAttribute=function(i,c){return b.getAttribute(i,c)};e.match=function(i,c){if(!(i&&c)){return false}if(!c||c===i){return true}if(typeof c!="string"){return false}b.setDocument(i);return b.matchNode(i,c)};e.defineAttributeGetter=function(c,i){b.attributeGetters[c]=i;return this};e.lookupAttributeGetter=function(c){return b.attributeGetters[c]};e.definePseudo=function(c,i){b["pseudo:"+c]=function(k,j){return i.call(k,j)};return this};e.lookupPseudo=function(c){var i=b["pseudo:"+c];if(i){return function(j){return i.call(this,j)}}return null};e.override=function(i,c){b.override(i,c);return this};e.isXML=b.isXML;e.uidOf=function(c){return b.getUIDHTML(c)};if(!this.Slick){this.Slick=e}}).apply((typeof exports!="undefined")?exports:this);(function(){var document=this.document;var window=document.window=this;var UID=1;this.$uid=(window.ActiveXObject)?function(item){return(item.uid||(item.uid=[UID++]))[0]}:function(item){return item.uid||(item.uid=UID++)};$uid(window);$uid(document);var ua=navigator.userAgent.toLowerCase(),platform=navigator.platform.toLowerCase(),UA=ua.match(/(opera|ie|firefox|chrome|trident|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0];if(UA[1]=="trident"){UA[1]="ie";UA[2]=parseInt(UA[2],10)+4}var mode=UA[1]=="ie"&&document.documentMode;var Browser=this.Browser={extend:Function.prototype.extend,name:(UA[1]=="version")?UA[3]:UA[1],version:mode||parseFloat((UA[1]=="opera"&&UA[4])?UA[4]:UA[2]),Platform:{name:ua.match(/ip(?:ad|od|hone)/)?"ios":(ua.match(/(?:webos|android)/)||platform.match(/mac|win|linux/)||["other"])[0]},Features:{xpath:!!(document.evaluate),air:!!(window.runtime),query:!!(document.querySelector),json:!!(window.JSON)},Plugins:{}};Browser[Browser.name]=true;Browser[Browser.name+parseInt(Browser.version,10)]=true;Browser.Platform[Browser.Platform.name]=true;Browser.Request=(function(){var XMLHTTP=function(){return new XMLHttpRequest()};var MSXML2=function(){return new ActiveXObject("MSXML2.XMLHTTP")};var MSXML=function(){return new ActiveXObject("Microsoft.XMLHTTP")};return Function.attempt(function(){XMLHTTP();return XMLHTTP},function(){MSXML2();return MSXML2},function(){MSXML();return MSXML})})();Browser.Features.xhr=!!(Browser.Request);var version=(Function.attempt(function(){return navigator.plugins["Shockwave Flash"].description},function(){return new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")})||"0 r0").match(/\d+/g);Browser.Plugins.Flash={version:Number(version[0]||"0."+version[1])||0,build:Number(version[2])||0};Browser.exec=function(text,force){if(!text){return text}if(window.execScript){window.execScript(text)}else{if(Browser.firefox&&force){window.eval(text)}else{var script=document.createElement("script");script.setAttribute("type","text/javascript");script.text=text;document.head.appendChild(script);document.head.removeChild(script)}}return text};String.implement("stripScripts",function(exec,force){var scripts="";var text=this.replace(/<script([^>]*)>([\s\S]*?)<\/script>/gi,function(all,attribs,code){if(/type=['"]text\/html['"]/.test(attribs)&&exec===true){var script=document.createElement("script");script.setAttribute("type","text/html");if(/id=['"]([^'"]+)['"]/.test(attribs)){script.setAttribute("id",RegExp.$1)}script.text=code;document.head.appendChild(script);return""}scripts+=code+"\n";return""});if(exec===true){Browser.exec(scripts,force)}else{if(typeOf(exec)=="function"){exec(scripts,text)}}return text});Browser.extend({Document:this.Document,Window:this.Window,Element:this.Element,Event:this.Event});this.Window=this.$constructor=new Type("Window",function(){});this.$family=Function.from("window").hide();Window.mirror(function(name,method){window[name]=method});this.Document=document.$constructor=new Type("Document",function(){});document.$family=Function.from("document").hide();Document.mirror(function(name,method){document[name]=method});document.html=document.documentElement;document.head=document.getElementsByTagName("head")[0];if(document.execCommand){try{document.execCommand("BackgroundImageCache",false,true)}catch(e){}}if(this.attachEvent&&!this.addEventListener){var unloadEvent=function(){this.detachEvent("onunload",unloadEvent);document.head=document.html=document.window=null};this.attachEvent("onunload",unloadEvent)}var arrayFrom=Array.from;try{arrayFrom(document.html.childNodes)}catch(e){Array.from=function(item){if(typeof item!="string"&&Type.isEnumerable(item)&&typeOf(item)!="array"){var i=item.length,array=new Array(i);while(i--){array[i]=item[i]}return array}return arrayFrom(item)};var prototype=Array.prototype,slice=prototype.slice;["pop","push","reverse","shift","sort","splice","unshift","concat","join","slice"].each(function(name){var method=prototype[name];Array[name]=function(item){return method.apply(Array.from(item),slice.call(arguments,1))}})}})();(function(){var a=this.Class=new Type("Class",function(h){if(instanceOf(h,Function)){h={initialize:h}}var g=function(){e(this);if(g.$prototyping){return this}this.$caller=null;var i=(this.initialize)?this.initialize.apply(this,arguments):this;this.$caller=this.caller=null;return i}.extend(this).implement(h);g.$constructor=a;g.prototype.$constructor=g;g.prototype.parent=c;return g});var c=function(){if(!this.$caller){throw new Error('The method "parent" cannot be called.')}var g=this.$caller.$name,h=this.$caller.$owner.parent,i=(h)?h.prototype[g]:null;if(!i){throw new Error('The method "'+g+'" has no parent.')}return i.apply(this,arguments)};var e=function(g){for(var h in g){var j=g[h];switch(typeOf(j)){case"object":var i=function(){};i.prototype=j;g[h]=e(new i);break;case"array":g[h]=j.clone();break}}return g};var b=function(g,h,j){if(j.$origin){j=j.$origin}var i=function(){if(j.$protected&&this.$caller==null){throw new Error('The method "'+h+'" cannot be called.')}var l=this.caller,m=this.$caller;this.caller=m;this.$caller=i;var k=j.apply(this,arguments);this.$caller=m;this.caller=l;return k}.extend({$owner:g,$origin:j,$name:h});return i};var f=function(h,i,g){if(a.Mutators.hasOwnProperty(h)){i=a.Mutators[h].call(this,i);if(i==null){return this}}if(typeOf(i)=="function"){if(i.$hidden){return this}this.prototype[h]=(g)?i:b(this,h,i)}else{Object.merge(this.prototype,h,i)}return this};var d=function(g){g.$prototyping=true;var h=new g;delete g.$prototyping;return h};a.implement("implement",f.overloadSetter());a.Mutators={Extends:function(g){this.parent=g;this.prototype=d(g)},Implements:function(g){Array.from(g).each(function(j){var h=new j;for(var i in h){f.call(this,i,h[i],true)}},this)}}})();(function(){this.Chain=new Class({$chain:[],chain:function(){this.$chain.append(Array.flatten(arguments));return this},callChain:function(){return(this.$chain.length)?this.$chain.shift().apply(this,arguments):false},clearChain:function(){this.$chain.empty();return this}});var a=function(b){return b.replace(/^on([A-Z])/,function(c,d){return d.toLowerCase()})};this.Events=new Class({$events:{},addEvent:function(d,c,b){d=a(d);this.$events[d]=(this.$events[d]||[]).include(c);if(b){c.internal=true}return this},addEvents:function(b){for(var c in b){this.addEvent(c,b[c])}return this},fireEvent:function(e,c,b){e=a(e);var d=this.$events[e];if(!d){return this}c=Array.from(c);d.each(function(f){if(b){f.delay(b,this,c)}else{f.apply(this,c)}},this);return this},removeEvent:function(e,d){e=a(e);var c=this.$events[e];if(c&&!d.internal){var b=c.indexOf(d);if(b!=-1){delete c[b]}}return this},removeEvents:function(d){var e;if(typeOf(d)=="object"){for(e in d){this.removeEvent(e,d[e])}return this}if(d){d=a(d)}for(e in this.$events){if(d&&d!=e){continue}var c=this.$events[e];for(var b=c.length;b--;){if(b in c){this.removeEvent(e,c[b])}}}return this}});this.Options=new Class({setOptions:function(){var b=this.options=Object.merge.apply(null,[{},this.options].append(arguments));if(this.addEvent){for(var c in b){if(typeOf(b[c])!="function"||!(/^on[A-Z]/).test(c)){continue}this.addEvent(c,b[c]);delete b[c]}}return this}})})();var Element=function(b,g){var h=Element.Constructors[b];if(h){return h(g)}if(typeof b!="string"){return document.id(b).set(g)}if(!g){g={}}if(!(/^[\w-]+$/).test(b)){var e=Slick.parse(b).expressions[0][0];b=(e.tag=="*")?"div":e.tag;if(e.id&&g.id==null){g.id=e.id}var d=e.attributes;if(d){for(var f=0,c=d.length;f<c;f++){var a=d[f];if(a.value!=null&&a.operator=="="&&g[a.key]==null){g[a.key]=a.value}}}if(e.classList&&g["class"]==null){g["class"]=e.classList.join(" ")}}return document.newElement(b,g)};if(Browser.Element){Element.prototype=Browser.Element.prototype}new Type("Element",Element).mirror(function(a){if(Array.prototype[a]){return}var b={};b[a]=function(){var h=[],e=arguments,j=true;for(var g=0,d=this.length;g<d;g++){var f=this[g],c=h[g]=f[a].apply(f,e);j=(j&&typeOf(c)=="element")}return(j)?new Elements(h):h};Elements.implement(b)});if(!Browser.Element){Element.parent=Object;Element.Prototype={"$family":Function.from("element").hide()};Element.mirror(function(a,b){Element.Prototype[a]=b})}Element.Constructors={};var IFrame=new Type("IFrame",function(){var e=Array.link(arguments,{properties:Type.isObject,iframe:function(f){return(f!=null)}});var c=e.properties||{},b;if(e.iframe){b=document.id(e.iframe)}var d=c.onload||function(){};delete c.onload;c.id=c.name=[c.id,c.name,b?(b.id||b.name):"IFrame_"+String.uniqueID()].pick();b=new Element(b||"iframe",c);var a=function(){d.call(b.contentWindow)};if(window.frames[c.id]){a()}else{b.addListener("load",a)}return b});var Elements=this.Elements=function(a){if(a&&a.length){var e={},d;for(var c=0;d=a[c++];){var b=Slick.uidOf(d);if(!e[b]){e[b]=true;this.push(d)}}}};Elements.prototype={length:0};Elements.parent=Array;new Type("Elements",Elements).implement({filter:function(a,b){if(!a){return this}return new Elements(Array.filter(this,(typeOf(a)=="string")?function(c){return c.match(a)}:a,b))}.protect(),push:function(){var d=this.length;for(var b=0,a=arguments.length;b<a;b++){var c=document.id(arguments[b]);if(c){this[d++]=c}}return(this.length=d)}.protect(),unshift:function(){var b=[];for(var c=0,a=arguments.length;c<a;c++){var d=document.id(arguments[c]);if(d){b.push(d)}}return Array.prototype.unshift.apply(this,b)}.protect(),concat:function(){var b=new Elements(this);for(var c=0,a=arguments.length;c<a;c++){var d=arguments[c];if(Type.isEnumerable(d)){b.append(d)}else{b.push(d)}}return b}.protect(),append:function(c){for(var b=0,a=c.length;b<a;b++){this.push(c[b])}return this}.protect(),empty:function(){while(this.length){delete this[--this.length]}return this}.protect()});(function(){var g=Array.prototype.splice,b={"0":0,"1":1,length:2};g.call(b,1,1);if(b[1]==1){Elements.implement("splice",function(){var e=this.length;g.apply(this,arguments);while(e>=this.length){delete this[e--]}return this}.protect())}Elements.implement(Array.prototype);Array.mirror(Elements);var f;try{var a=document.createElement("<input name=x>");f=(a.name=="x")}catch(c){}var d=function(e){return(""+e).replace(/&/g,"&amp;").replace(/"/g,"&quot;")};Document.implement({newElement:function(e,h){if(h&&h.checked!=null){h.defaultChecked=h.checked}if(f&&h){e="<"+e;if(h.name){e+=' name="'+d(h.name)+'"'}if(h.type){e+=' type="'+d(h.type)+'"'}e+=">";delete h.name;delete h.type}return this.id(this.createElement(e)).set(h)}})})();Document.implement({newTextNode:function(a){return this.createTextNode(a)},getDocument:function(){return this},getWindow:function(){return this.window},id:(function(){var a={string:function(d,c,b){d=Slick.find(b,"#"+d.replace(/(\W)/g,"\\$1"));return(d)?a.element(d,c):null},element:function(b,c){$uid(b);if(!c&&!b.$family&&!(/^(?:object|embed)$/i).test(b.tagName)){Object.append(b,Element.Prototype)}return b},object:function(c,d,b){if(c.toElement){return a.element(c.toElement(b),d)}return null}};a.textnode=a.whitespace=a.window=a.document=function(b){return b};return function(c,e,d){if(c&&c.$family&&c.uid){return c}var b=typeOf(c);return(a[b])?a[b](c,e,d||document):null}})()});if(window.$==null){Window.implement("$",function(a,b){return document.id(a,b,this.document)})}Window.implement({getDocument:function(){return this.document},getWindow:function(){return this}});[Document,Element].invoke("implement",{getElements:function(a){return Slick.search(this,a,new Elements)},getElement:function(a){return document.id(Slick.find(this,a))}});if(window.$$==null){Window.implement("$$",function(a){if(arguments.length==1){if(typeof a=="string"){return Slick.search(this.document,a,new Elements)}else{if(Type.isEnumerable(a)){return new Elements(a)}}}return new Elements(arguments)})}(function(){var k={},i={};var n={input:"checked",option:"selected",textarea:"value"};var e=function(p){return(i[p]||(i[p]={}))};var j=function(q){if(q.removeEvents){q.removeEvents()}if(q.clearAttributes){q.clearAttributes()}var p=q.uid;if(p!=null){delete k[p];delete i[p]}return q};var o=["defaultValue","accessKey","cellPadding","cellSpacing","colSpan","frameBorder","maxLength","readOnly","rowSpan","tabIndex","useMap"];var d=["compact","nowrap","ismap","declare","noshade","checked","disabled","readOnly","multiple","selected","noresize","defer","defaultChecked"];var g={html:"innerHTML","class":"className","for":"htmlFor",text:(function(){var p=document.createElement("div");return(p.innerText==null)?"textContent":"innerText"})()};var m=["type"];var h=["value","defaultValue"];var l=/^(?:href|src|usemap)$/i;d=d.associate(d);o=o.associate(o.map(String.toLowerCase));m=m.associate(m);Object.append(g,h.associate(h));var c={before:function(q,p){var r=p.parentNode;if(r){r.insertBefore(q,p)}},after:function(q,p){var r=p.parentNode;if(r){r.insertBefore(q,p.nextSibling)}},bottom:function(q,p){p.appendChild(q)},top:function(q,p){p.insertBefore(q,p.firstChild)}};c.inside=c.bottom;var b=function(s,r){if(!s){return r}s=Slick.parse(s);var q=s.expressions;for(var p=q.length;p--;){q[p][0].combinator=r}return s};Element.implement({set:function(r,q){var p=Element.Properties[r];(p&&p.set)?p.set.call(this,q):this.setProperty(r,q)}.overloadSetter(),get:function(q){var p=Element.Properties[q];return(p&&p.get)?p.get.apply(this):this.getProperty(q)}.overloadGetter(),erase:function(q){var p=Element.Properties[q];(p&&p.erase)?p.erase.apply(this):this.removeProperty(q);return this},setProperty:function(q,r){q=o[q]||q;if(r==null){return this.removeProperty(q)}var p=g[q];(p)?this[p]=r:(d[q])?this[q]=!!r:this.setAttribute(q,""+r);return this},setProperties:function(p){for(var q in p){this.setProperty(q,p[q])}return this},getProperty:function(q){q=o[q]||q;var p=g[q]||m[q];return(p)?this[p]:(d[q])?!!this[q]:(l.test(q)?this.getAttribute(q,2):(p=this.getAttributeNode(q))?p.nodeValue:null)||null},getProperties:function(){var p=Array.from(arguments);return p.map(this.getProperty,this).associate(p)},removeProperty:function(q){q=o[q]||q;var p=g[q];(p)?this[p]="":(d[q])?this[q]=false:this.removeAttribute(q);return this},removeProperties:function(){Array.each(arguments,this.removeProperty,this);return this},hasClass:function(p){return this.className.clean().contains(p," ")},addClass:function(p){if(!this.hasClass(p)){this.className=(this.className+" "+p).clean()}return this},removeClass:function(p){this.className=this.className.replace(new RegExp("(^|\\s)"+p+"(?:\\s|$)"),"$1");return this},toggleClass:function(p,q){if(q==null){q=!this.hasClass(p)}return(q)?this.addClass(p):this.removeClass(p)},adopt:function(){var s=this,p,u=Array.flatten(arguments),t=u.length;if(t>1){s=p=document.createDocumentFragment()}for(var r=0;r<t;r++){var q=document.id(u[r],true);if(q){s.appendChild(q)}}if(p){this.appendChild(p)}return this},appendText:function(q,p){return this.grab(this.getDocument().newTextNode(q),p)},grab:function(q,p){c[p||"bottom"](document.id(q,true),this);return this},inject:function(q,p){c[p||"bottom"](this,document.id(q,true));return this},replaces:function(p){p=document.id(p,true);p.parentNode.replaceChild(this,p);return this},wraps:function(q,p){q=document.id(q,true);return this.replaces(q).grab(q,p)},getPrevious:function(p){return document.id(Slick.find(this,b(p,"!~")))},getAllPrevious:function(p){return Slick.search(this,b(p,"!~"),new Elements)},getNext:function(p){return document.id(Slick.find(this,b(p,"~")))},getAllNext:function(p){return Slick.search(this,b(p,"~"),new Elements)},getFirst:function(p){return document.id(Slick.search(this,b(p,">"))[0])},getLast:function(p){return document.id(Slick.search(this,b(p,">")).getLast())},getParent:function(p){return document.id(Slick.find(this,b(p,"!")))},getParents:function(p){return Slick.search(this,b(p,"!"),new Elements)},getSiblings:function(p){return Slick.search(this,b(p,"~~"),new Elements)},getChildren:function(p){return Slick.search(this,b(p,">"),new Elements)},getWindow:function(){return this.ownerDocument.window},getDocument:function(){return this.ownerDocument},getElementById:function(p){return document.id(Slick.find(this,"#"+(""+p).replace(/(\W)/g,"\\$1")))},getSelected:function(){this.selectedIndex;return new Elements(Array.from(this.options).filter(function(p){return p.selected}))},toQueryString:function(){var p=[];this.getElements("input, select, textarea").each(function(r){var q=r.type;if(!r.name||r.disabled||q=="submit"||q=="reset"||q=="file"||q=="image"){return}var s=(r.get("tag")=="select")?r.getSelected().map(function(t){return document.id(t).get("value")}):((q=="radio"||q=="checkbox")&&!r.checked)?null:r.get("value");Array.from(s).each(function(t){if(typeof t!="undefined"){p.push(encodeURIComponent(r.name)+"="+encodeURIComponent(t))}})});return p.join("&")},destroy:function(){var p=j(this).getElementsByTagName("*");Array.each(p,j);Element.dispose(this);return null},empty:function(){Array.from(this.childNodes).each(Element.dispose);return this},dispose:function(){return(this.parentNode)?this.parentNode.removeChild(this):this},match:function(p){return !p||Slick.match(this,p)}});var a=function(u,t,r){var p=u.getAttributeNode("id");if(p){u.removeAttributeNode(p)}if(r){u.setAttribute("id",t.getAttribute("id"))}if(Browser.ie){u.clearAttributes();u.mergeAttributes(t);u.removeAttribute("uid");if(u.options){var v=u.options,q=t.options;for(var s=v.length;s--;){v[s].selected=q[s].selected}}}var w=n[t.tagName.toLowerCase()];if(w&&t[w]){u[w]=t[w]}};Element.implement("clone",function(r,p){r=r!==false;var w=this.cloneNode(r);if(r){var s=w.getElementsByTagName("*"),u=this.getElementsByTagName("*");for(var q=s.length;q--;){a(s[q],u[q],p)}}a(w,this,p);if(Browser.ie){var t=w.getElementsByTagName("object"),v=this.getElementsByTagName("object");for(var q=t.length;q--;){t[q].outerHTML=v[q].outerHTML}}return document.id(w)});var f={contains:function(p){return Slick.contains(this,p)}};if(!document.contains){Document.implement(f)}if(!document.createElement("div").contains){Element.implement(f)}[Element,Window,Document].invoke("implement",{addListener:function(s,r){if(s=="unload"){var p=r,q=this;r=function(){q.removeListener("unload",r);p()}}else{k[$uid(this)]=this}if(this.addEventListener){this.addEventListener(s,r,!!arguments[2])}else{this.attachEvent("on"+s,r)}return this},removeListener:function(q,p){if(this.removeEventListener){this.removeEventListener(q,p,!!arguments[2])}else{this.detachEvent("on"+q,p)}return this},retrieve:function(q,p){var s=e($uid(this)),r=s[q];if(p!=null&&r==null){r=s[q]=p}return r!=null?r:null},store:function(q,p){var r=e($uid(this));r[q]=p;return this},eliminate:function(p){var q=e($uid(this));delete q[p];return this}});if(window.attachEvent&&!window.addEventListener){window.addListener("unload",function(){Object.each(k,j);if(window.CollectGarbage){CollectGarbage()}})}})();Element.Properties={};Element.Properties.style={set:function(a){this.style.cssText=a},get:function(){return this.style.cssText},erase:function(){this.style.cssText=""}};Element.Properties.tag={get:function(){return this.tagName.toLowerCase()}};(function(a){if(a!=null){Element.Properties.maxlength=Element.Properties.maxLength={get:function(){var b=this.getAttribute("maxLength");return b==a?null:b}}}})(document.createElement("input").getAttribute("maxLength"));Element.Properties.html=(function(){var c=Function.attempt(function(){var e=document.createElement("table");e.innerHTML="<tr><td></td></tr>"});var d=document.createElement("div");var a={table:[1,"<table>","</table>"],select:[1,"<select>","</select>"],tbody:[2,"<table><tbody>","</tbody></table>"],tr:[3,"<table><tbody><tr>","</tr></tbody></table>"]};a.thead=a.tfoot=a.tbody;var b={set:function(){var f=Array.flatten(arguments).join("");var g=(!c&&a[this.get("tag")]);if(g){var h=d;h.innerHTML=g[1]+f+g[2];for(var e=g[0];e--;){h=h.firstChild}this.empty().adopt(h.childNodes)}else{this.innerHTML=f}}};b.erase=b.set;return b})();(function(){var c=document.html;Element.Properties.styles={set:function(f){this.setStyles(f)}};var e=(c.style.opacity!=null);var d=/alpha\(opacity=([\d.]+)\)/i;var b=function(g,f){if(!g.currentStyle||!g.currentStyle.hasLayout){g.style.zoom=1}if(e){g.style.opacity=f}else{f=(f==1)?"":"alpha(opacity="+f*100+")";var h=g.style.filter||g.getComputedStyle("filter")||"";g.style.filter=d.test(h)?h.replace(d,f):h+f}};Element.Properties.opacity={set:function(g){var f=this.style.visibility;if(g==0&&f!="hidden"){this.style.visibility="hidden"}else{if(g!=0&&f!="visible"){this.style.visibility="visible"}}b(this,g)},get:(e)?function(){var f=this.style.opacity||this.getComputedStyle("opacity");return(f=="")?1:f}:function(){var f,g=(this.style.filter||this.getComputedStyle("filter"));if(g){f=g.match(d)}return(f==null||g==null)?1:(f[1]/100)}};var a=(c.style.cssFloat==null)?"styleFloat":"cssFloat";Element.implement({getComputedStyle:function(h){if(this.currentStyle){return this.currentStyle[h.camelCase()]}var g=Element.getDocument(this).defaultView,f=g?g.getComputedStyle(this,null):null;return(f)?f.getPropertyValue((h==a)?"float":h.hyphenate()):null},setOpacity:function(f){b(this,f);return this},getOpacity:function(){return this.get("opacity")},setStyle:function(g,f){switch(g){case"opacity":return this.set("opacity",parseFloat(f));case"float":g=a}g=g.camelCase();if(typeOf(f)!="string"){var h=(Element.Styles[g]||"@").split(" ");f=Array.from(f).map(function(k,j){if(!h[j]){return""}return(typeOf(k)=="number")?h[j].replace("@",Math.round(k)):k}).join(" ")}else{if(f==String(Number(f))){f=Math.round(f)}}this.style[g]=f;return this},getStyle:function(l){switch(l){case"opacity":return this.get("opacity");case"float":l=a}l=l.camelCase();var f=this.style[l];if(!f||l=="zIndex"){f=[];for(var k in Element.ShortStyles){if(l!=k){continue}for(var j in Element.ShortStyles[k]){f.push(this.getStyle(j))}return f.join(" ")}f=this.getComputedStyle(l)}if(f){f=String(f);var h=f.match(/rgba?\([\d\s,]+\)/);if(h){f=f.replace(h[0],h[0].rgbToHex())}}if(Browser.opera||(Browser.ie&&isNaN(parseFloat(f)))){if((/^(height|width)$/).test(l)){var g=(l=="width")?["left","right"]:["top","bottom"],i=0;g.each(function(m){i+=this.getStyle("border-"+m+"-width").toInt()+this.getStyle("padding-"+m).toInt()},this);return this["offset"+l.capitalize()]-i+"px"}if(Browser.opera&&String(f).indexOf("px")!=-1){return f}if((/^border(.+)Width|margin|padding/).test(l)){return"0px"}}return f},setStyles:function(g){for(var f in g){this.setStyle(f,g[f])}return this},getStyles:function(){var f={};Array.flatten(arguments).each(function(g){f[g]=this.getStyle(g)},this);return f}});Element.Styles={left:"@px",top:"@px",bottom:"@px",right:"@px",width:"@px",height:"@px",maxWidth:"@px",maxHeight:"@px",minWidth:"@px",minHeight:"@px",backgroundColor:"rgb(@, @, @)",backgroundPosition:"@px @px",color:"rgb(@, @, @)",fontSize:"@px",letterSpacing:"@px",lineHeight:"@px",clip:"rect(@px @px @px @px)",margin:"@px @px @px @px",padding:"@px @px @px @px",border:"@px @ rgb(@, @, @) @px @ rgb(@, @, @) @px @ rgb(@, @, @)",borderWidth:"@px @px @px @px",borderStyle:"@ @ @ @",borderColor:"rgb(@, @, @) rgb(@, @, @) rgb(@, @, @) rgb(@, @, @)",zIndex:"@",zoom:"@",fontWeight:"@",textIndent:"@px",opacity:"@"};Element.ShortStyles={margin:{},padding:{},border:{},borderWidth:{},borderStyle:{},borderColor:{}};["Top","Right","Bottom","Left"].each(function(l){var k=Element.ShortStyles;var g=Element.Styles;["margin","padding"].each(function(m){var n=m+l;k[m][n]=g[n]="@px"});var j="border"+l;k.border[j]=g[j]="@px @ rgb(@, @, @)";var i=j+"Width",f=j+"Style",h=j+"Color";k[j]={};k.borderWidth[i]=k[j][i]=g[i]="@px";k.borderStyle[f]=k[j][f]=g[f]="@";k.borderColor[h]=k[j][h]=g[h]="rgb(@, @, @)"})})();(function(){var h=document.createElement("div"),e=document.createElement("div");h.style.height="0";h.appendChild(e);var d=(e.offsetParent===h);h=e=null;var l=function(m){return k(m,"position")!="static"||a(m)};var i=function(m){return l(m)||(/^(?:table|td|th)$/i).test(m.tagName)};Element.implement({scrollTo:function(m,n){if(a(this)){this.getWindow().scrollTo(m,n)}else{this.scrollLeft=m;this.scrollTop=n}return this},getSize:function(){if(a(this)){return this.getWindow().getSize()}return{x:this.offsetWidth,y:this.offsetHeight}},getScrollSize:function(){if(a(this)){return this.getWindow().getScrollSize()}return{x:this.scrollWidth,y:this.scrollHeight}},getScroll:function(){if(a(this)){return this.getWindow().getScroll()}return{x:this.scrollLeft,y:this.scrollTop}},getScrolls:function(){var n=this.parentNode,m={x:0,y:0};while(n&&!a(n)){m.x+=n.scrollLeft;m.y+=n.scrollTop;n=n.parentNode}return m},getOffsetParent:d?function(){var m=this;if(a(m)||k(m,"position")=="fixed"){return null}var n=(k(m,"position")=="static")?i:l;while((m=m.parentNode)){if(n(m)){return m}}return null}:function(){var m=this;if(a(m)||k(m,"position")=="fixed"){return null}try{return m.offsetParent}catch(n){}return null},getOffsets:function(){if(this.getBoundingClientRect&&!Browser.Platform.ios){var r=this.getBoundingClientRect(),o=document.id(this.getDocument().documentElement),q=o.getScroll(),t=this.getScrolls(),s=(k(this,"position")=="fixed");return{x:r.left.toInt()+t.x+((s)?0:q.x)-o.clientLeft,y:r.top.toInt()+t.y+((s)?0:q.y)-o.clientTop}}var n=this,m={x:0,y:0};if(a(this)){return m}while(n&&!a(n)){m.x+=n.offsetLeft;m.y+=n.offsetTop;if(Browser.firefox){if(!c(n)){m.x+=b(n);m.y+=g(n)}var p=n.parentNode;if(p&&k(p,"overflow")!="visible"){m.x+=b(p);m.y+=g(p)}}else{if(n!=this&&Browser.safari){m.x+=b(n);m.y+=g(n)}}n=n.offsetParent}if(Browser.firefox&&!c(this)){m.x-=b(this);m.y-=g(this)}return m},getPosition:function(p){if(a(this)){return{x:0,y:0}}var q=this.getOffsets(),n=this.getScrolls();var m={x:q.x-n.x,y:q.y-n.y};if(p&&(p=document.id(p))){var o=p.getPosition();return{x:m.x-o.x-b(p),y:m.y-o.y-g(p)}}return m},getCoordinates:function(o){if(a(this)){return this.getWindow().getCoordinates()}var m=this.getPosition(o),n=this.getSize();var p={left:m.x,top:m.y,width:n.x,height:n.y};p.right=p.left+p.width;p.bottom=p.top+p.height;return p},computePosition:function(m){return{left:m.x-j(this,"margin-left"),top:m.y-j(this,"margin-top")}},setPosition:function(m){return this.setStyles(this.computePosition(m))}});[Document,Window].invoke("implement",{getSize:function(){var m=f(this);return{x:m.clientWidth,y:m.clientHeight}},getScroll:function(){var n=this.getWindow(),m=f(this);return{x:n.pageXOffset||m.scrollLeft,y:n.pageYOffset||m.scrollTop}},getScrollSize:function(){var o=f(this),n=this.getSize(),m=this.getDocument().body;return{x:Math.max(o.scrollWidth,m.scrollWidth,n.x),y:Math.max(o.scrollHeight,m.scrollHeight,n.y)}},getPosition:function(){return{x:0,y:0}},getCoordinates:function(){var m=this.getSize();return{top:0,left:0,bottom:m.y,right:m.x,height:m.y,width:m.x}}});var k=Element.getComputedStyle;function j(m,n){return k(m,n).toInt()||0}function c(m){return k(m,"-moz-box-sizing")=="border-box"}function g(m){return j(m,"border-top-width")}function b(m){return j(m,"border-left-width")}function a(m){return(/^(?:body|html)$/i).test(m.tagName)}function f(m){var n=m.getDocument();return(!n.compatMode||n.compatMode=="CSS1Compat")?n.html:n.body}})();Element.alias({position:"setPosition"});[Window,Document,Element].invoke("implement",{getHeight:function(){return this.getSize().y},getWidth:function(){return this.getSize().x},getScrollTop:function(){return this.getScroll().y},getScrollLeft:function(){return this.getScroll().x},getScrollHeight:function(){return this.getScrollSize().y},getScrollWidth:function(){return this.getScrollSize().x},getTop:function(){return this.getPosition().y},getLeft:function(){return this.getPosition().x}});(function(){Element.Properties.events={set:function(c){this.addEvents(c)}};[Element,Window,Document].invoke("implement",{addEvent:function(g,i){var j=this.retrieve("events",{});if(!j[g]){j[g]={keys:[],values:[]}}if(j[g].keys.contains(i)){return this}j[g].keys.push(i);var h=g,c=Element.Events[g],e=i,k=this;if(c){if(c.onAdd){c.onAdd.call(this,i)}if(c.condition){e=function(l){if(c.condition.call(this,l)){return i.call(this,l)}return true}}h=c.base||h}var f=function(){return i.call(k)};var d=Element.NativeEvents[h];if(d){if(d==2){f=function(l){l=new Event(l,k.getWindow());if(e.call(k,l)===false){l.stop()}}}this.addListener(h,f,arguments[2])}j[g].values.push(f);return this},removeEvent:function(f,e){var d=this.retrieve("events");if(!d||!d[f]){return this}var i=d[f];var c=i.keys.indexOf(e);if(c==-1){return this}var h=i.values[c];delete i.keys[c];delete i.values[c];var g=Element.Events[f];if(g){if(g.onRemove){g.onRemove.call(this,e)}f=g.base||f}return(Element.NativeEvents[f])?this.removeListener(f,h,arguments[2]):this},addEvents:function(c){for(var d in c){this.addEvent(d,c[d])}return this},removeEvents:function(c){var e;if(typeOf(c)=="object"){for(e in c){this.removeEvent(e,c[e])}return this}var d=this.retrieve("events");if(!d){return this}if(!c){for(e in d){this.removeEvents(e)}this.eliminate("events")}else{if(d[c]){d[c].keys.each(function(f){this.removeEvent(c,f)},this);delete d[c]}}return this},fireEvent:function(f,d,c){var e=this.retrieve("events");if(!e||!e[f]){return this}d=Array.from(d);e[f].keys.each(function(g){if(c){g.delay(c,this,d)}else{g.apply(this,d)}},this);return this},cloneEvents:function(f,e){f=document.id(f);var d=f.retrieve("events");if(!d){return this}if(!e){for(var c in d){this.cloneEvents(f,c)}}else{if(d[e]){d[e].keys.each(function(g){this.addEvent(e,g)},this)}}return this}});try{if(typeof HTMLElement!="undefined"){HTMLElement.prototype.fireEvent=Element.prototype.fireEvent}}catch(b){}Element.NativeEvents={click:2,dblclick:2,mouseup:2,mousedown:2,contextmenu:2,mousewheel:2,DOMMouseScroll:2,mouseover:2,mouseout:2,mousemove:2,selectstart:2,selectend:2,keydown:2,keypress:2,keyup:2,orientationchange:2,touchstart:2,touchmove:2,touchend:2,touchcancel:2,gesturestart:2,gesturechange:2,gestureend:2,focus:2,blur:2,change:2,reset:2,select:2,submit:2,load:2,unload:1,beforeunload:2,resize:1,move:1,DOMContentLoaded:1,readystatechange:1,error:1,abort:1,scroll:1};var a=function(c){var d=c.relatedTarget;if(d==null){return true}if(!d){return false}return(d!=this&&d.prefix!="xul"&&typeOf(this)!="document"&&!this.contains(d))};Element.Events={mouseenter:{base:"mouseover",condition:a},mouseleave:{base:"mouseout",condition:a},mousewheel:{base:(Browser.firefox)?"DOMMouseScroll":"mousewheel"}}})();(function(){var f=this.Fx=new Class({Implements:[Chain,Events,Options],options:{fps:60,unit:false,duration:500,frames:null,frameSkip:true,link:"ignore"},initialize:function(g){this.subject=this.subject||this;this.setOptions(g)},getTransition:function(){return function(g){return -(Math.cos(Math.PI*g)-1)/2}},step:function(g){if(this.options.frameSkip){var h=(this.time!=null)?(g-this.time):0,i=h/this.frameInterval;this.time=g;this.frame+=i}else{this.frame++}if(this.frame<this.frames){var j=this.transition(this.frame/this.frames);this.set(this.compute(this.from,this.to,j))}else{this.frame=this.frames;this.set(this.compute(this.from,this.to,1));this.stop()}},set:function(g){return g},compute:function(i,h,g){return f.compute(i,h,g)},check:function(){if(!this.isRunning()){return true}switch(this.options.link){case"cancel":this.cancel();return true;case"chain":this.chain(this.caller.pass(arguments,this));return false}return false},start:function(k,j){if(!this.check(k,j)){return this}this.from=k;this.to=j;this.frame=(this.options.frameSkip)?0:-1;this.time=null;this.transition=this.getTransition();var i=this.options.frames,h=this.options.fps,g=this.options.duration;this.duration=f.Durations[g]||g.toInt();this.frameInterval=1000/h;this.frames=i||Math.round(this.duration/this.frameInterval);this.fireEvent("start",this.subject);b.call(this,h);return this},stop:function(){if(this.isRunning()){this.time=null;d.call(this,this.options.fps);if(this.frames==this.frame){this.fireEvent("complete",this.subject);if(!this.callChain()){this.fireEvent("chainComplete",this.subject)}}else{this.fireEvent("stop",this.subject)}}return this},cancel:function(){if(this.isRunning()){this.time=null;d.call(this,this.options.fps);this.frame=this.frames;this.fireEvent("cancel",this.subject).clearChain()}return this},pause:function(){if(this.isRunning()){this.time=null;d.call(this,this.options.fps)}return this},resume:function(){if((this.frame<this.frames)&&!this.isRunning()){b.call(this,this.options.fps)}return this},isRunning:function(){var g=e[this.options.fps];return g&&g.contains(this)}});f.compute=function(i,h,g){return(h-i)*g+i};f.Durations={"short":250,normal:500,"long":1000};var e={},c={};var a=function(){var h=Date.now();for(var j=this.length;j--;){var g=this[j];if(g){g.step(h)}}};var b=function(h){var g=e[h]||(e[h]=[]);g.push(this);if(!c[h]){c[h]=a.periodical(Math.round(1000/h),g)}};var d=function(h){var g=e[h];if(g){g.erase(this);if(!g.length&&c[h]){delete e[h];c[h]=clearInterval(c[h])}}}})();Fx.CSS=new Class({Extends:Fx,prepare:function(c,d,b){b=Array.from(b);if(b[1]==null){b[1]=b[0];b[0]=c.getStyle(d)}var a=b.map(this.parse);return{from:a[0],to:a[1]}},parse:function(a){a=Function.from(a)();a=(typeof a=="string")?a.split(" "):Array.from(a);return a.map(function(c){c=String(c);var b=false;Object.each(Fx.CSS.Parsers,function(f,e){if(b){return}var d=f.parse(c);if(d||d===0){b={value:d,parser:f}}});b=b||{value:c,parser:Fx.CSS.Parsers.String};return b})},compute:function(d,c,b){var a=[];(Math.min(d.length,c.length)).times(function(e){a.push({value:d[e].parser.compute(d[e].value,c[e].value,b),parser:d[e].parser})});a.$family=Function.from("fx:css:value");return a},serve:function(c,b){if(typeOf(c)!="fx:css:value"){c=this.parse(c)}var a=[];c.each(function(d){a=a.concat(d.parser.serve(d.value,b))});return a},render:function(a,d,c,b){a.setStyle(d,this.serve(c,b))},search:function(a){if(Fx.CSS.Cache[a]){return Fx.CSS.Cache[a]}var c={},b=new RegExp("^"+a.escapeRegExp()+"$");Array.each(document.styleSheets,function(f,e){var d=f.href;if(d&&d.contains("://")&&!d.contains(document.domain)){return}var g=f.rules||f.cssRules;Array.each(g,function(k,h){if(!k.style){return}var j=(k.selectorText)?k.selectorText.replace(/^\w+/,function(i){return i.toLowerCase()}):null;if(!j||!b.test(j)){return}Object.each(Element.Styles,function(l,i){if(!k.style[i]||Element.ShortStyles[i]){return}l=String(k.style[i]);c[i]=((/^rgb/).test(l))?l.rgbToHex():l})})});return Fx.CSS.Cache[a]=c}});Fx.CSS.Cache={};Fx.CSS.Parsers={Color:{parse:function(a){if(a.match(/^#[0-9a-f]{3,6}$/i)){return a.hexToRgb(true)}return((a=a.match(/(\d+),\s*(\d+),\s*(\d+)/)))?[a[1],a[2],a[3]]:false},compute:function(c,b,a){return c.map(function(e,d){return Math.round(Fx.compute(c[d],b[d],a))})},serve:function(a){return a.map(Number)}},Number:{parse:parseFloat,compute:Fx.compute,serve:function(b,a){return(a)?b+a:b}},String:{parse:Function.from(false),compute:function(b,a){return a},serve:function(a){return a}}};Fx.Morph=new Class({Extends:Fx.CSS,initialize:function(b,a){this.element=this.subject=document.id(b);this.parent(a)},set:function(a){if(typeof a=="string"){a=this.search(a)}for(var b in a){this.render(this.element,b,a[b],this.options.unit)}return this},compute:function(e,d,c){var a={};for(var b in e){a[b]=this.parent(e[b],d[b],c)}return a},start:function(b){if(!this.check(b)){return this}if(typeof b=="string"){b=this.search(b)}var e={},d={};for(var c in b){var a=this.prepare(this.element,c,b[c]);e[c]=a.from;d[c]=a.to}return this.parent(e,d)}});Element.Properties.morph={set:function(a){this.get("morph").cancel().setOptions(a);return this},get:function(){var a=this.retrieve("morph");if(!a){a=new Fx.Morph(this,{link:"cancel"});this.store("morph",a)}return a}};Element.implement({morph:function(a){this.get("morph").start(a);return this}});Fx.Tween=new Class({Extends:Fx.CSS,initialize:function(b,a){this.element=this.subject=document.id(b);this.parent(a)},set:function(b,a){if(arguments.length==1){a=b;b=this.property||this.options.property}this.render(this.element,b,a,this.options.unit);return this},start:function(c,e,d){if(!this.check(c,e,d)){return this}var b=Array.flatten(arguments);this.property=this.options.property||b.shift();var a=this.prepare(this.element,this.property,b);return this.parent(a.from,a.to)}});Element.Properties.tween={set:function(a){this.get("tween").cancel().setOptions(a);return this},get:function(){var a=this.retrieve("tween");if(!a){a=new Fx.Tween(this,{link:"cancel"});this.store("tween",a)}return a}};Element.implement({tween:function(a,c,b){this.get("tween").start(arguments);return this},fade:function(c){var e=this.get("tween"),d="opacity",a;c=[c,"toggle"].pick();switch(c){case"in":e.start(d,1);break;case"out":e.start(d,0);break;case"show":e.set(d,1);break;case"hide":e.set(d,0);break;case"toggle":var b=this.retrieve("fade:flag",this.get("opacity")==1);e.start(d,(b)?0:1);this.store("fade:flag",!b);a=true;break;default:e.start(d,arguments)}if(!a){this.eliminate("fade:flag")}return this},highlight:function(c,a){if(!a){a=this.retrieve("highlight:original",this.getStyle("background-color"));a=(a=="transparent")?"#fff":a}var b=this.get("tween");b.start("background-color",c||"#ffff88",a).chain(function(){this.setStyle("background-color",this.retrieve("highlight:original"));b.callChain()}.bind(this));return this}});(function(){var a=("onprogress" in new Browser.Request);var c=this.Request=new Class({Implements:[Chain,Events,Options],options:{url:"",data:"",headers:{"X-Requested-With":"XMLHttpRequest",Accept:"text/javascript, text/html, application/xml, text/xml, */*"},async:true,format:false,method:"post",link:"ignore",isSuccess:null,emulation:true,urlEncoded:true,encoding:"utf-8",evalScripts:false,evalResponse:false,timeout:0,noCache:false},initialize:function(d){this.xhr=new Browser.Request();this.setOptions(d);this.headers=this.options.headers},onStateChange:function(){var d=this.xhr;if(d.readyState!=4||!this.running){return}this.running=false;this.status=0;Function.attempt(function(){var e=d.status;this.status=(e==1223)?204:e}.bind(this));d.onreadystatechange=function(){};clearTimeout(this.timer);this.response={text:this.xhr.responseText||"",xml:this.xhr.responseXML};if(this.options.isSuccess.call(this,this.status)){this.success(this.response.text,this.response.xml)}else{this.failure()}},isSuccess:function(){var d=this.status;return(d>=200&&d<300)},isRunning:function(){return !!this.running},processScripts:function(d){if(this.options.evalResponse||(/(ecma|java)script/).test(this.getHeader("Content-type"))){return Browser.exec(d)}return d.stripScripts(this.options.evalScripts,true)},success:function(e,d){this.onSuccess(this.processScripts(e),d)},onSuccess:function(){this.fireEvent("complete",arguments).fireEvent("success",arguments).callChain()},failure:function(){this.onFailure()},onFailure:function(){this.fireEvent("complete").fireEvent("failure",this.xhr)},loadstart:function(d){this.fireEvent("loadstart",[d,this.xhr])},progress:function(d){this.fireEvent("progress",[d,this.xhr])},timeout:function(){this.fireEvent("timeout",this.xhr)},setHeader:function(d,e){this.headers[d]=e;return this},getHeader:function(d){return Function.attempt(function(){return this.xhr.getResponseHeader(d)}.bind(this))},check:function(){if(!this.running){return true}switch(this.options.link){case"cancel":this.cancel();return true;case"chain":this.chain(this.caller.pass(arguments,this));return false}return false},send:function(n){if(!this.check(n)){return this}this.options.isSuccess=this.options.isSuccess||this.isSuccess;this.running=true;var k=typeOf(n);if(k=="string"||k=="element"){n={data:n}}var g=this.options;n=Object.append({data:g.data,url:g.url,method:g.method},n);var i=n.data,e=String(n.url),d=n.method.toLowerCase();switch(typeOf(i)){case"element":i=document.id(i).toQueryString();break;case"object":case"hash":i=Object.toQueryString(i)}if(this.options.format){var l="format="+this.options.format;i=(i)?l+"&"+i:l}if(this.options.emulation&&!["get","post"].contains(d)){var j="_method="+d;i=(i)?j+"&"+i:j;d="post"}if(this.options.urlEncoded&&["post","put"].contains(d)){var f=(this.options.encoding)?"; charset="+this.options.encoding:"";this.headers["Content-type"]="application/x-www-form-urlencoded"+f}if(!e){e=document.location.pathname}var h=e.lastIndexOf("/");if(h>-1&&(h=e.indexOf("#"))>-1){e=e.substr(0,h)}if(this.options.noCache){e+=(e.contains("?")?"&":"?")+String.uniqueID()}if(i&&d=="get"){e+=(e.contains("?")?"&":"?")+i;i=null}var m=this.xhr;if(a){m.onloadstart=this.loadstart.bind(this);m.onprogress=this.progress.bind(this)}m.open(d.toUpperCase(),e,this.options.async,this.options.user,this.options.password);if((this.options.user||this.options.withCredentials)&&"withCredentials" in m){m.withCredentials=true}m.onreadystatechange=this.onStateChange.bind(this);Object.each(this.headers,function(p,o){try{m.setRequestHeader(o,p)}catch(q){this.fireEvent("exception",[o,p])}},this);this.fireEvent("request");m.send(i);if(!this.options.async){this.onStateChange()}if(this.options.timeout){this.timer=this.timeout.delay(this.options.timeout,this)}return this},cancel:function(){if(!this.running){return this}this.running=false;var d=this.xhr;d.abort();clearTimeout(this.timer);d.onreadystatechange=d.onprogress=d.onloadstart=function(){};this.xhr=new Browser.Request();this.fireEvent("cancel");return this}});var b={};["get","post","put","delete","GET","POST","PUT","DELETE"].each(function(d){b[d]=function(f){var e={method:d};if(f!=null){e.data=f}return this.send(e)}});c.implement(b);Element.Properties.send={set:function(d){var e=this.get("send").cancel();e.setOptions(d);return this},get:function(){var d=this.retrieve("send");if(!d){d=new c({data:this,link:"cancel",method:this.get("method")||"post",url:this.get("action")});this.store("send",d)}return d}};Element.implement({send:function(d){var e=this.get("send");e.send({data:this,url:d||e.options.url});return this}})})();Request.HTML=new Class({Extends:Request,options:{update:false,append:false,evalScripts:true,filter:false,headers:{Accept:"text/html, application/xml, text/xml, */*"}},success:function(e){var d=this.options,b=this.response;b.html=e.stripScripts(function(f){b.javascript=f});var c=b.html.match(/<body[^>]*>([\s\S]*?)<\/body>/i);if(c){b.html=c[1]}var a=new Element("div").set("html",b.html);b.tree=a.childNodes;b.elements=a.getElements("*");if(d.filter){b.tree=b.elements.filter(d.filter)}if(d.update){document.id(d.update).empty().set("html",b.html)}else{if(d.append){document.id(d.append).adopt(a.getChildren())}}if(d.evalScripts){Browser.exec(b.javascript)}this.onSuccess(b.tree,b.elements,b.html,b.javascript)}});Element.Properties.load={set:function(a){var b=this.get("load").cancel();b.setOptions(a);return this},get:function(){var a=this.retrieve("load");if(!a){a=new Request.HTML({data:this,link:"cancel",update:this,method:"get"});this.store("load",a)}return a}};Element.implement({load:function(){this.get("load").send(Array.link(arguments,{data:Type.isObject,url:Type.isString}));return this}});Request.JSON=new Class({Extends:Request,options:{secure:true},initialize:function(a){this.parent(a);Object.append(this.headers,{Accept:"application/json","X-Request":"JSON"})},success:function(c){var b=this.options.secure;var a=this.response.json=Function.attempt(function(){return JSON.decode(c,b)});if(a==null){this.onFailure()}else{this.onSuccess(a,c)}}});var Cookie=new Class({Implements:Options,options:{path:"/",domain:false,duration:false,secure:false,document:document,encode:true},initialize:function(b,a){this.key=b;this.setOptions(a)},write:function(b){if(this.options.encode){b=encodeURIComponent(b)}if(this.options.domain){b+="; domain="+this.options.domain}if(this.options.path){b+="; path="+this.options.path}if(this.options.duration){var a=new Date();a.setTime(a.getTime()+this.options.duration*24*60*60*1000);b+="; expires="+a.toGMTString()}if(this.options.secure){b+="; secure"}this.options.document.cookie=this.key+"="+b;return this},read:function(){var a=this.options.document.cookie.match("(?:^|;)\\s*"+this.key.escapeRegExp()+"=([^;]*)");return(a)?decodeURIComponent(a[1]):null},dispose:function(){new Cookie(this.key,Object.merge({},this.options,{duration:-1})).write("");return this}});Cookie.write=function(b,c,a){return new Cookie(b,a).write(c)};Cookie.read=function(a){return new Cookie(a).read()};Cookie.dispose=function(b,a){return new Cookie(b,a).dispose()};(function(j,l){var m,g,f=[],c,b,n=true;try{n=j.frameElement!=null}catch(i){}var h=function(){clearTimeout(b);if(m){return}Browser.loaded=m=true;l.removeListener("DOMContentLoaded",h).removeListener("readystatechange",a);l.fireEvent("domready");j.fireEvent("domready")};var a=function(){for(var e=f.length;e--;){if(f[e]()){h();return true}}return false};var k=function(){clearTimeout(b);if(!a()){b=setTimeout(k,10)}};l.addListener("DOMContentLoaded",h);var d=l.createElement("div");if(d.doScroll&&!n){f.push(function(){try{d.doScroll();return true}catch(o){}return false});c=true}if(l.readyState){f.push(function(){var e=l.readyState;return(e=="loaded"||e=="complete")})}if("onreadystatechange" in l){l.addListener("readystatechange",a)}else{c=true}if(c){k()}Element.Events.domready={onAdd:function(e){if(m){e.call(this)}}};Element.Events.load={base:"load",onAdd:function(e){if(g&&this==j){e.call(this)}},condition:function(){if(this==j){h();delete Element.Events.load}return true}};j.addEvent("load",function(){g=true})})(window,document);if(typeof JSON=="undefined"){this.JSON={}}Object.append(JSON,{$specialChars:{"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},$replaceChars:function(a){return JSON.$specialChars[a]||"\\u00"+Math.floor(a.charCodeAt()/16).toString(16)+(a.charCodeAt()%16).toString(16)},encode:function(b){switch(typeOf(b)){case"string":return'"'+b.replace(/[\x00-\x1f\\"]/g,JSON.$replaceChars)+'"';case"array":return"["+String(b.map(JSON.encode).clean())+"]";case"object":case"hash":var a=[];Object.each(b,function(e,d){var c=JSON.encode(e);if(c){a.push(JSON.encode(d)+":"+c)}});return"{"+a+"}";case"number":case"boolean":return String(b);case"null":return"null"}return null},decode:function(string,secure){if(typeOf(string)!="string"||!string.length){return null}if(secure&&!(/^[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]*$/).test(string.replace(/\\./g,"@").replace(/"[^"\\\n\r]*"/g,""))){return null}return eval("("+string+")")}});Class.Mutators.Binds=function(a){if(!this.prototype.initialize){this.implement("initialize",function(){})}return a};Class.Mutators.initialize=function(a){return function(){Array.from(this.Binds).each(function(b){var c=this[b];if(c){this[b]=c.bind(this)}},this);return a.apply(this,arguments)}};Class.Occlude=new Class({occlude:function(c,b){b=document.id(b||this.element);var a=b.retrieve(c||this.property);if(a&&this.occluded!=null){return this.occluded=a}this.occluded=false;b.store(c||this.property,this);return this.occluded}});Class.refactor=function(b,a){Object.each(a,function(e,d){var c=b.prototype[d];if(c&&c.$origin){c=c.$origin}if(typeof e=="function"){b.implement(d,function(){var f=this.previous;this.previous=c||function(){};var g=e.apply(this,arguments);this.previous=f;return g})}else{b.implement(d,e)}});return b};(function(){var a=function(b){return b!=null};Object.extend({getFromPath:function(e,d){var f=d.split(".");for(var c=0,b=f.length;c<b;c++){if(e.hasOwnProperty(f[c])){e=e[f[c]]}else{return null}}return e},cleanValues:function(b,c){c=c||a;for(key in b){if(!c(b[key])){delete b[key]}}return b},erase:function(b,c){if(b.hasOwnProperty(c)){delete b[c]}return b},run:function(c){var b=Array.slice(arguments,1);for(key in c){if(c[key].apply){c[key].apply(c,b)}}return c}})})();Element.implement({isDisplayed:function(){return this.getStyle("display")!="none"},isVisible:function(){var a=this.offsetWidth,b=this.offsetHeight;return(a==0&&b==0)?false:(a>0&&b>0)?true:this.style.display!="none"},toggle:function(){return this[this.isDisplayed()?"hide":"show"]()},hide:function(){var b;try{b=this.getStyle("display")}catch(a){}if(b=="none"){return this}return this.store("element:_originalDisplay",b||"").setStyle("display","none")},show:function(a){if(!a&&this.isDisplayed()){return this}a=a||this.retrieve("element:_originalDisplay")||"block";return this.setStyle("display",(a=="none")?"block":a)},swapClass:function(a,b){return this.removeClass(a).addClass(b)}});Document.implement({clearSelection:function(){if(document.selection&&document.selection.empty){document.selection.empty()}else{if(window.getSelection){var a=window.getSelection();if(a&&a.removeAllRanges){a.removeAllRanges()}}}}});Elements.from=function(e,d){if(d||d==null){e=e.stripScripts()}var b,c=e.match(/^\s*<(t[dhr]|tbody|tfoot|thead)/i);if(c){b=new Element("table");var a=c[1].toLowerCase();if(["td","th","tr"].contains(a)){b=new Element("tbody").inject(b);if(a!="tr"){b=new Element("tr").inject(b)}}}return(b||new Element("div")).set("html",e).getChildren()};Events.Pseudos=function(f,c,d){var b="monitorEvents:";var a=function(g){return{store:g.store?function(h,i){g.store(b+h,i)}:function(h,i){(g.$monitorEvents||(g.$monitorEvents={}))[h]=i},retrieve:g.retrieve?function(h,i){return g.retrieve(b+h,i)}:function(h,i){if(!g.$monitorEvents){return i}return g.$monitorEvents[h]||i}}};var e=function(h){if(h.indexOf(":")==-1){return null}var g=Slick.parse(h).expressions[0][0],i=g.pseudos;return(f&&f[i[0].key])?{event:g.tag,value:i[0].value,pseudo:i[0].key,original:h}:null};return{addEvent:function(l,n,i){var m=e(l);if(!m){return c.call(this,l,n,i)}var j=a(this),r=j.retrieve(l,[]),o=f[m.pseudo],s=o.options||{};var q=this;var p=function(){o.listener.call(q,m,n,arguments,s)};r.include({event:n,monitor:p});j.store(l,r);var g=m.event,h=s[g]||{},k=Array.slice(arguments,2);if(h.args){k.append(Array.from(h.args))}if(h.base){g=h.base}c.apply(this,[l,n].concat(k));return c.apply(this,[g,p].concat(k))},removeEvent:function(k,m){var l=e(k);if(!l){return d.call(this,k,m)}var i=a(this),o=i.retrieve(k),n=f[l.pseudo],p=n.options||{};if(!o){return this}var g=l.event,h=p[g]||{},j=Array.slice(arguments,2);if(h.args){j.append(Array.from(h.args))}if(h.base){g=h.base}d.apply(this,[k,m].concat(j));o.each(function(q,r){if(!m||q.event==m){d.apply(this,[g,q.monitor].concat(j))}delete o[r]},this);i.store(k,o);return this}}};(function(b){var c={once:{listener:function(e,f,d){f.apply(this,d);this.removeEvent(e.original,f)}}};Events.definePseudo=function(d,e){c[d]=Type.isFunction(e)?{listener:e}:e;return this};var a=Events.prototype;Events.implement(Events.Pseudos(c,a.addEvent,a.removeEvent));["Request","Fx"].each(function(d){if(b[d]){b[d].implement(Events.prototype)}})})(this);(function(){var b={once:{listener:function(d,e,c){e.apply(this,c);this.removeEvent(d.original,e)}}};Event.definePseudo=function(c,d){b[c]=Type.isFunction(d)?{listener:d}:d;return this};var a=Element.prototype;[Element,Window,Document].invoke("implement",Events.Pseudos(b,a.addEvent,a.removeEvent))})();(function(){var a=!(window.attachEvent&&!window.addEventListener),b=Element.NativeEvents;b.focusin=2;b.focusout=2;Event.definePseudo("relay",{listener:function(h,i,g,k){var c=g[0],e=k[h.event],d=e?e.condition:null;for(var f=c.target;f&&f!=this;f=f.parentNode){var j=document.id(f);if(Slick.match(f,h.value)&&(!d||d.call(j,c))){if(j){i.call(j,c,j)}return}}},options:{mouseenter:{base:"mouseover",condition:Element.Events.mouseenter.condition},mouseleave:{base:"mouseout",condition:Element.Events.mouseleave.condition},focus:{base:"focus"+(a?"":"in"),args:[true]},blur:{base:a?"blur":"focusout",args:[true]}}})})();Fx.Elements=new Class({Extends:Fx.CSS,initialize:function(b,a){this.elements=this.subject=$$(b);this.parent(a)},compute:function(g,h,j){var c={};for(var d in g){var a=g[d],e=h[d],f=c[d]={};for(var b in a){f[b]=this.parent(a[b],e[b],j)}}return c},set:function(b){for(var c in b){if(!this.elements[c]){continue}var a=b[c];for(var d in a){this.render(this.elements[c],d,a[d],this.options.unit)}}return this},start:function(c){if(!this.check(c)){return this}var h={},j={};for(var d in c){if(!this.elements[d]){continue}var f=c[d],a=h[d]={},g=j[d]={};for(var b in f){var e=this.prepare(this.elements[d],b,f[b]);a[b]=e.from;g[b]=e.to}}return this.parent(h,j)}});(function(){var b=null,a={},d={};var c=function(f){if(instanceOf(f,e.Set)){return f}else{return a[f]}};var e=this.Locale={define:function(f,j,h,i){var g;if(instanceOf(f,e.Set)){g=f.name;if(g){a[g]=f}}else{g=f;if(!a[g]){a[g]=new e.Set(g)}f=a[g]}if(j){f.define(j,h,i)}if(!b){b=f}return f},use:function(f){f=c(f);if(f){b=f;this.fireEvent("change",f)}return this},getCurrent:function(){return b},get:function(g,f){return(b)?b.get(g,f):""},inherit:function(f,g,h){f=c(f);if(f){f.inherit(g,h)}return this},list:function(){return Object.keys(a)}};Object.append(e,new Events);e.Set=new Class({sets:{},inherits:{locales:[],sets:{}},initialize:function(f){this.name=f||""},define:function(i,g,h){var f=this.sets[i];if(!f){f={}}if(g){if(typeOf(g)=="object"){f=Object.merge(f,g)}else{f[g]=h}}this.sets[i]=f;return this},get:function(r,j,q){var p=Object.getFromPath(this.sets,r);if(p!=null){var m=typeOf(p);if(m=="function"){p=p.apply(null,Array.from(j))}else{if(m=="object"){p=Object.clone(p)}}return p}var h=r.indexOf("."),o=h<0?r:r.substr(0,h),k=(this.inherits.sets[o]||[]).combine(this.inherits.locales).include("en-US");if(!q){q=[]}for(var g=0,f=k.length;g<f;g++){if(q.contains(k[g])){continue}q.include(k[g]);var n=a[k[g]];if(!n){continue}p=n.get(r,j,q);if(p!=null){return p}}return""},inherit:function(g,h){g=Array.from(g);if(h&&!this.inherits.sets[h]){this.inherits.sets[h]=[]}var f=g.length;while(f--){(h?this.inherits.sets[h]:this.inherits.locales).unshift(g[f])}return this}})})();Locale.define("en-US","Date",{months:["January","February","March","April","May","June","July","August","September","October","November","December"],months_abbr:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],days_abbr:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dateOrder:["month","date","year"],shortDate:"%m/%d/%Y",shortTime:"%I:%M%p",AM:"AM",PM:"PM",ordinal:function(a){return(a>3&&a<21)?"th":["th","st","nd","rd","th"][Math.min(a%10,4)]},lessThanMinuteAgo:"less than a minute ago",minuteAgo:"about a minute ago",minutesAgo:"{delta} minutes ago",hourAgo:"about an hour ago",hoursAgo:"about {delta} hours ago",dayAgo:"1 day ago",daysAgo:"{delta} days ago",weekAgo:"1 week ago",weeksAgo:"{delta} weeks ago",monthAgo:"1 month ago",monthsAgo:"{delta} months ago",yearAgo:"1 year ago",yearsAgo:"{delta} years ago",lessThanMinuteUntil:"less than a minute from now",minuteUntil:"about a minute from now",minutesUntil:"{delta} minutes from now",hourUntil:"about an hour from now",hoursUntil:"about {delta} hours from now",dayUntil:"1 day from now",daysUntil:"{delta} days from now",weekUntil:"1 week from now",weeksUntil:"{delta} weeks from now",monthUntil:"1 month from now",monthsUntil:"{delta} months from now",yearUntil:"1 year from now",yearsUntil:"{delta} years from now"});(function(){var a=this.Date;a.Methods={ms:"Milliseconds",year:"FullYear",min:"Minutes",mo:"Month",sec:"Seconds",hr:"Hours"};["Date","Day","FullYear","Hours","Milliseconds","Minutes","Month","Seconds","Time","TimezoneOffset","Week","Timezone","GMTOffset","DayOfYear","LastMonth","LastDayOfMonth","UTCDate","UTCDay","UTCFullYear","AMPM","Ordinal","UTCHours","UTCMilliseconds","UTCMinutes","UTCMonth","UTCSeconds","UTCMilliseconds"].each(function(s){a.Methods[s.toLowerCase()]=s});var o=function(u,t,s){if(!s){s="0"}return new Array(t-String(u).length+1).join(s)+u};a.implement({set:function(u,t){u=u.toLowerCase();var s=a.Methods;if(s[u]){this["set"+s[u]](t)}return this}.overloadSetter(),get:function(t){t=t.toLowerCase();var s=a.Methods;if(s[t]){return this["get"+s[t]]()}return null},clone:function(){return new a(this.get("time"))},increment:function(s,u){s=s||"day";u=u!=null?u:1;switch(s){case"year":return this.increment("month",u*12);case"month":var t=this.get("date");this.set("date",1).set("mo",this.get("mo")+u);return this.set("date",t.min(this.get("lastdayofmonth")));case"week":return this.increment("day",u*7);case"day":return this.set("date",this.get("date")+u)}if(!a.units[s]){throw new Error(s+" is not a supported interval")}return this.set("time",this.get("time")+u*a.units[s]())},decrement:function(s,t){return this.increment(s,-1*(t!=null?t:1))},isLeapYear:function(){return a.isLeapYear(this.get("year"))},clearTime:function(){return this.set({hr:0,min:0,sec:0,ms:0})},diff:function(t,s){if(typeOf(t)=="string"){t=a.parse(t)}return((t-this)/a.units[s||"day"](3,3)).round()},getLastDayOfMonth:function(){return a.daysInMonth(this.get("mo"),this.get("year"))},getDayOfYear:function(){return(a.UTC(this.get("year"),this.get("mo"),this.get("date")+1)-a.UTC(this.get("year"),0,1))/a.units.day()},getWeek:function(){return(this.get("dayofyear")/7).ceil()},getOrdinal:function(s){return a.getMsg("ordinal",s||this.get("date"))},getTimezone:function(){return this.toString().replace(/^.*? ([A-Z]{3}).[0-9]{4}.*$/,"$1").replace(/^.*?\(([A-Z])[a-z]+ ([A-Z])[a-z]+ ([A-Z])[a-z]+\)$/,"$1$2$3")},getGMTOffset:function(){var s=this.get("timezoneOffset");return((s>0)?"-":"+")+o((s.abs()/60).floor(),2)+o(s%60,2)},setAMPM:function(s){s=s.toUpperCase();var t=this.get("hr");if(t>11&&s=="AM"){return this.decrement("hour",12)}else{if(t<12&&s=="PM"){return this.increment("hour",12)}}return this},getAMPM:function(){return(this.get("hr")<12)?"AM":"PM"},parse:function(s){this.set("time",a.parse(s));return this},isValid:function(s){return !isNaN((s||this).valueOf())},format:function(t){if(!this.isValid()){return"invalid date"}if(!t){t="%x %X"}var s=t.toLowerCase();if(r[s]){return r[s](this)}t=f[s]||t;var u=this;return t.replace(/%([a-z%])/gi,function(w,v){switch(v){case"a":return a.getMsg("days_abbr")[u.get("day")];case"A":return a.getMsg("days")[u.get("day")];case"b":return a.getMsg("months_abbr")[u.get("month")];case"B":return a.getMsg("months")[u.get("month")];case"c":return u.format("%a %b %d %H:%M:%S %Y");case"d":return o(u.get("date"),2);case"e":return o(u.get("date"),2," ");case"H":return o(u.get("hr"),2);case"I":return o((u.get("hr")%12)||12,2);case"j":return o(u.get("dayofyear"),3);case"k":return o(u.get("hr"),2," ");case"l":return o((u.get("hr")%12)||12,2," ");case"L":return o(u.get("ms"),3);case"m":return o((u.get("mo")+1),2);case"M":return o(u.get("min"),2);case"o":return u.get("ordinal");case"p":return a.getMsg(u.get("ampm"));case"s":return Math.round(u/1000);case"S":return o(u.get("seconds"),2);case"U":return o(u.get("week"),2);case"w":return u.get("day");case"x":return u.format(a.getMsg("shortDate"));case"X":return u.format(a.getMsg("shortTime"));case"y":return u.get("year").toString().substr(2);case"Y":return u.get("year");case"T":return u.format("%H:%M:%S");case"z":return u.get("GMTOffset");case"Z":return u.get("Timezone")}return v})},toISOString:function(){return this.format("iso8601")}});a.alias("toJSON","toISOString");a.alias("compare","diff");a.alias("strftime","format");var f={db:"%Y-%m-%d %H:%M:%S",compact:"%Y%m%dT%H%M%S",iso8601:"%Y-%m-%dT%H:%M:%S%z","short":"%d %b %H:%M","long":"%B %d, %Y %H:%M"};var j=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],g=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var r={rfc822:function(s){return j[s.get("day")]+s.format(", %d ")+g[s.get("month")]+s.format(" %Y %H:%M:%S %Z")},rfc2822:function(s){return j[s.get("day")]+s.format(", %d ")+g[s.get("month")]+s.format(" %Y %H:%M:%S %z")}};var c=[];var m=a.parse;var q=function(v,x,u){var t=-1;var w=a.getMsg(v+"s");switch(typeOf(x)){case"object":t=w[x.get(v)];break;case"number":t=w[x];if(!t){throw new Error("Invalid "+v+" index: "+x)}break;case"string":var s=w.filter(function(y){return this.test(y)},new RegExp("^"+x,"i"));if(!s.length){throw new Error("Invalid "+v+" string")}if(s.length>1){throw new Error("Ambiguous "+v)}t=s[0]}return(u)?w.indexOf(t):t};a.extend({getMsg:function(t,s){return Locale.get("Date."+t,s)},units:{ms:Function.from(1),second:Function.from(1000),minute:Function.from(60000),hour:Function.from(3600000),day:Function.from(86400000),week:Function.from(608400000),month:function(t,s){var u=new a;return a.daysInMonth(t!=null?t:u.get("mo"),s!=null?s:u.get("year"))*86400000},year:function(s){s=s||new a().get("year");return a.isLeapYear(s)?31622400000:31536000000}},daysInMonth:function(t,s){return[31,a.isLeapYear(s)?29:28,31,30,31,30,31,31,30,31,30,31][t]},isLeapYear:function(s){return((s%4===0)&&(s%100!==0))||(s%400===0)},parse:function(v){var u=typeOf(v);if(u=="number"){return new a(v)}if(u!="string"){return v}v=v.clean();if(!v.length){return null}var s;c.some(function(w){var t=w.re.exec(v);return(t)?(s=w.handler(t)):false});if(!(s&&s.isValid())){s=new a(m(v));if(!(s&&s.isValid())){s=new a(v.toInt())}}return s},parseDay:function(s,t){return q("day",s,t)},parseMonth:function(t,s){return q("month",t,s)},parseUTC:function(t){var s=new a(t);var u=a.UTC(s.get("year"),s.get("mo"),s.get("date"),s.get("hr"),s.get("min"),s.get("sec"),s.get("ms"));return new a(u)},orderIndex:function(s){return a.getMsg("dateOrder").indexOf(s)+1},defineFormat:function(s,t){f[s]=t},defineFormats:function(s){for(var t in s){a.defineFormat(t,s[t])}},defineParser:function(s){c.push((s.re&&s.handler)?s:k(s))},defineParsers:function(){Array.flatten(arguments).each(a.defineParser)},define2DigitYearStart:function(s){n=s%100;h=s-n}});var h=1900;var n=70;var d=function(s){return new RegExp("(?:"+a.getMsg(s).map(function(t){return t.substr(0,3)}).join("|")+")[a-z]*")};var l=function(s){switch(s){case"T":return"%H:%M:%S";case"x":return((a.orderIndex("month")==1)?"%m[-./]%d":"%d[-./]%m")+"([-./]%y)?";case"X":return"%H([.:]%M)?([.:]%S([.:]%s)?)? ?%p? ?%z?"}return null};var i={d:/[0-2]?[0-9]|3[01]/,H:/[01]?[0-9]|2[0-3]/,I:/0?[1-9]|1[0-2]/,M:/[0-5]?\d/,s:/\d+/,o:/[a-z]*/,p:/[ap]\.?m\.?/,y:/\d{2}|\d{4}/,Y:/\d{4}/,z:/Z|[+-]\d{2}(?::?\d{2})?/};i.m=i.I;i.S=i.M;var e;var b=function(s){e=s;i.a=i.A=d("days");i.b=i.B=d("months");c.each(function(u,t){if(u.format){c[t]=k(u.format)}})};var k=function(u){if(!e){return{format:u}}var s=[];var t=(u.source||u).replace(/%([a-z])/gi,function(w,v){return l(v)||w}).replace(/\((?!\?)/g,"(?:").replace(/ (?!\?|\*)/g,",? ").replace(/%([a-z%])/gi,function(w,v){var x=i[v];if(!x){return v}s.push(v);return"("+x.source+")"}).replace(/\[a-z\]/gi,"[a-z\\u00c0-\\uffff;&]");return{format:u,re:new RegExp("^"+t+"$","i"),handler:function(y){y=y.slice(1).associate(s);var v=new a().clearTime(),x=y.y||y.Y;if(x!=null){p.call(v,"y",x)}if("d" in y){p.call(v,"d",1)}if("m" in y||y.b||y.B){p.call(v,"m",1)}for(var w in y){p.call(v,w,y[w])}return v}}};var p=function(s,t){if(!t){return this}switch(s){case"a":case"A":return this.set("day",a.parseDay(t,true));case"b":case"B":return this.set("mo",a.parseMonth(t,true));case"d":return this.set("date",t);case"H":case"I":return this.set("hr",t);case"m":return this.set("mo",t-1);case"M":return this.set("min",t);case"p":return this.set("ampm",t.replace(/\./g,""));case"S":return this.set("sec",t);case"s":return this.set("ms",("0."+t)*1000);case"w":return this.set("day",t);case"Y":return this.set("year",t);case"y":t=+t;if(t<100){t+=h+(t<n?100:0)}return this.set("year",t);case"z":if(t=="Z"){t="+00"}var u=t.match(/([+-])(\d{2}):?(\d{2})?/);u=(u[1]+"1")*(u[2]*60+(+u[3]||0))+this.getTimezoneOffset();return this.set("time",this-u*60000)}return this};a.defineParsers("%Y([-./]%m([-./]%d((T| )%X)?)?)?","%Y%m%d(T%H(%M%S?)?)?","%x( %X)?","%d%o( %b( %Y)?)?( %X)?","%b( %d%o)?( %Y)?( %X)?","%Y %b( %d%o( %X)?)?","%o %b %d %X %z %Y","%T","%H:%M( ?%p)?");Locale.addEvent("change",function(s){if(Locale.get("Date")){b(s)}}).fireEvent("change",Locale.getCurrent())})();(function(){var c={a:/[]/g,A:/[]/g,c:/[]/g,C:/[]/g,d:/[]/g,D:/[]/g,e:/[]/g,E:/[]/g,g:/[]/g,G:/[]/g,i:/[]/g,I:/[]/g,l:/[]/g,L:/[]/g,n:/[]/g,N:/[]/g,o:/[]/g,O:/[]/g,r:/[]/g,R:/[]/g,s:/[]/g,S:/[]/g,t:/[]/g,T:/[]/g,ue:/[]/g,UE:/[]/g,u:/[]/g,U:/[]/g,y:/[]/g,Y:/[]/g,z:/[]/g,Z:/[]/g,th:/[]/g,TH:/[]/g,dh:/[]/g,DH:/[]/g,ss:/[]/g,oe:/[]/g,OE:/[]/g,ae:/[]/g,AE:/[]/g},b={" ":/[\xa0\u2002\u2003\u2009]/g,"*":/[\xb7]/g,"'":/[\u2018\u2019]/g,'"':/[\u201c\u201d]/g,"...":/[\u2026]/g,"-":/[\u2013]/g,"&raquo;":/[\uFFFD]/g};var a=function(e,f){var d=e;for(key in f){d=d.replace(f[key],key)}return d};String.implement({standardize:function(){return a(this,c)},repeat:function(d){return new Array(d+1).join(this)},pad:function(d,g,f){if(this.length>=d){return this}var e=(g==null?" ":""+g).repeat(d-this.length).substr(0,d-this.length);if(!f||f=="right"){return this+e}if(f=="left"){return e+this}return e.substr(0,(e.length/2).floor())+this+e.substr(0,(e.length/2).ceil())},tidy:function(){return a(this,b)},truncate:function(d,e,h){var g=this;if(e==null&&arguments.length==1){e=""}if(g.length>d){g=g.substring(0,d);if(h){var f=g.lastIndexOf(h);if(f!=-1){g=g.substr(0,f)}}if(e){g+=e}}return g}})})();(function(){var a=function(b,c){b=b||"";var d=c?"<"+b+"(?!\\w)[^>]*>([\\s\\S]*?)</"+b+"(?!\\w)>":"</?"+b+"([^>]+)?>";reg=new RegExp(d,"gi");return reg};String.implement({getTags:function(b,c){return this.match(a(b,c))||[]},stripTags:function(b,c){return this.replace(a(b,c),"")}})})();String.implement({parseQueryString:function(d,a){if(d==null){d=true}if(a==null){a=true}var c=this.split(/[&;]/),b={};if(!c.length){return b}c.each(function(i){var e=i.indexOf("="),g=i.substr(e+1),f=e<0?[""]:i.substr(0,e).match(/([^\]\[]+|(\B)(?=\]))/g),h=b;if(!f){return}if(a){g=decodeURIComponent(g)}f.each(function(k,j){if(d){k=decodeURIComponent(k)}var l=h[k];if(j<f.length-1){h=h[k]=l||{}}else{if(typeOf(l)=="array"){l.push(g)}else{h[k]=l!=null?[l,g]:g}}})});return b},cleanQueryString:function(a){return this.split("&").filter(function(e){var b=e.indexOf("="),c=b<0?"":e.substr(0,b),d=e.substr(b+1);return a?a.call(null,c,d):(d||d===0)}).join("&")}});var Asset={javascript:function(f,c){if(!c){c={}}var a=new Element("script",{src:f,type:"text/javascript"}),g=c.document||document,b=0,d=c.onload||c.onLoad;var e=d?function(){if(++b==1){d.call(this)}}:function(){};delete c.onload;delete c.onLoad;delete c.document;return a.addEvents({load:e,readystatechange:function(){if(["loaded","complete"].contains(this.readyState)){e.call(this)}}}).set(c).inject(g.head)},css:function(d,a){if(!a){a={}}var b=new Element("link",{rel:"stylesheet",media:"screen",type:"text/css",href:d});var c=a.onload||a.onLoad,e=a.document||document;delete a.onload;delete a.onLoad;delete a.document;if(c){b.addEvent("load",c)}return b.set(a).inject(e.head)},image:function(c,b){b=Object.merge({onload:function(){},onabort:function(){},onerror:function(){}},b);var d=new Image();var a=document.id(d)||new Element("img");["load","abort","error"].each(function(e){var g="on"+e;var f=e.capitalize();if(b["on"+f]){b[g]=b["on"+f];delete b["on"+f]}var h=b[g];delete b[g];d[g]=function(){if(!d){return}if(!a.parentNode){a.width=d.width;a.height=d.height}d=d.onload=d.onabort=d.onerror=null;h.delay(1,a,a);a.fireEvent(e,a,1)}});d.src=a.src=c;if(d&&d.complete){d.onload.delay(1)}return a.set(b)},images:function(c,b){b=Object.merge({onComplete:function(){},onProgress:function(){},onError:function(){},properties:{}},b);c=Array.from(c);var a=0;return new Elements(c.map(function(e,d){return Asset.image(e,Object.append(b.properties,{onload:function(){a++;b.onProgress.call(this,a,d,e);if(a==c.length){b.onComplete()}},onerror:function(){a++;b.onError.call(this,a,d,e);if(a==c.length){b.onComplete()}}}))}))}};var IframeShim=new Class({Implements:[Options,Events,Class.Occlude],options:{className:"iframeShim",src:'javascript:false;document.write("");',display:false,zIndex:null,margin:0,offset:{x:0,y:0},browsers:(Browser.ie6||(Browser.firefox&&Browser.version<3&&Browser.Platform.mac))},property:"IframeShim",initialize:function(b,a){this.element=document.id(b);if(this.occlude()){return this.occluded}this.setOptions(a);this.makeShim();return this},makeShim:function(){if(this.options.browsers){var c=this.element.getStyle("zIndex").toInt();if(!c){c=1;var b=this.element.getStyle("position");if(b=="static"||!b){this.element.setStyle("position","relative")}this.element.setStyle("zIndex",c)}c=((this.options.zIndex!=null||this.options.zIndex===0)&&c>this.options.zIndex)?this.options.zIndex:c-1;if(c<0){c=1}this.shim=new Element("iframe",{src:this.options.src,scrolling:"no",frameborder:0,styles:{zIndex:c,position:"absolute",border:"none",filter:"progid:DXImageTransform.Microsoft.Alpha(style=0,opacity=0)"},"class":this.options.className}).store("IframeShim",this);var a=(function(){this.shim.inject(this.element,"after");this[this.options.display?"show":"hide"]();this.fireEvent("inject")}).bind(this);if(!IframeShim.ready){window.addEvent("load",a)}else{a()}}else{this.position=this.hide=this.show=this.dispose=Function.from(this)}},position:function(){if(!IframeShim.ready||!this.shim){return this}var a=this.element.measure(function(){return this.getSize()});if(this.options.margin!=undefined){a.x=a.x-(this.options.margin*2);a.y=a.y-(this.options.margin*2);this.options.offset.x+=this.options.margin;this.options.offset.y+=this.options.margin}this.shim.set({width:a.x,height:a.y}).position({relativeTo:this.element,offset:this.options.offset});return this},hide:function(){if(this.shim){this.shim.setStyle("display","none")}return this},show:function(){if(this.shim){this.shim.setStyle("display","block")}return this.position()},dispose:function(){if(this.shim){this.shim.dispose()}return this},destroy:function(){if(this.shim){this.shim.destroy()}return this}});window.addEvent("load",function(){IframeShim.ready=true});Request.JSONP=new Class({Implements:[Chain,Events,Options],options:{onRequest:function(a){if(this.options.log&&window.console&&console.log){console.log("JSONP retrieving script with url:"+a)}},onError:function(a){if(this.options.log&&window.console&&console.warn){console.warn("JSONP "+a+" will fail in Internet Explorer, which enforces a 2083 bytes length limit on URIs")}},url:"",callbackKey:"callback",injectScript:document.head,data:"",link:"ignore",timeout:0,log:false},initialize:function(a){this.setOptions(a)},send:function(c){if(!Request.prototype.check.call(this,c)){return this}this.running=true;var d=typeOf(c);if(d=="string"||d=="element"){c={data:c}}c=Object.merge(this.options,c||{});var e=c.data;switch(typeOf(e)){case"element":e=document.id(e).toQueryString();break;case"object":case"hash":e=Object.toQueryString(e)}var b=this.index=Request.JSONP.counter++;var f=c.url+(c.url.test("\\?")?"&":"?")+(c.callbackKey)+"=Request.JSONP.request_map.request_"+b+(e?"&"+e:"");if(f.length>2083){this.fireEvent("error",f)}Request.JSONP.request_map["request_"+b]=function(){this.success(arguments,b)}.bind(this);var a=this.getScript(f).inject(c.injectScript);this.fireEvent("request",[a.get("src"),a]);if(c.timeout){this.timeout.delay(c.timeout,this)}return this},getScript:function(a){if(!this.script){this.script=new Element("script[type=text/javascript]",{async:true,src:a})}return this.script},success:function(b,a){if(!this.running){return false}this.clear().fireEvent("complete",b).fireEvent("success",b).callChain()},cancel:function(){if(this.running){this.clear().fireEvent("cancel")}return this},isRunning:function(){return !!this.running},clear:function(){this.running=false;if(this.script){this.script.destroy();this.script=null}return this},timeout:function(){if(this.running){this.running=false;this.fireEvent("timeout",[this.script.get("src"),this.script]).fireEvent("failure").cancel()}return this}});Request.JSONP.counter=0;Request.JSONP.request_map={};/*
Copyright (c) 2009 Arieh Glazer

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE
*/
(function(a){function b(){}a.instantiate=function(d,g){b.prototype=d.prototype;var e=new b(),c=d.apply(e,g);return c||e};a.implement({instantiate:function(c){return a.instantiate(this,c)}})})(Function);IdleTimer=new Class({Implements:[Events,Options],options:{timeout:60000,events:["mousemove","keydown","mousewheel","mousedown"]},initialize:function(b,a){this.setOptions(a);this.element=$(b);this.activeBound=this.active.bind(this);this.isIdle=false;this.started=false},stop:function(){clearTimeout(this.timer);for(var a in this.options.events){this.element.removeEvent(this.options.events[a],this.activeBound)}this.bound=false;this.started=false;this.fireEvent("stop");return this},active:function(){clearTimeout(this.timer);if(this.isIdle){this.fireEvent("active")}this.isIdle=false;this.start()},idle:function(){if(this.timer){clearTimeout(this.timer)}this.isIdle=true;this.fireEvent("idle")},start:function(){this.timer=this.idle.delay(this.options.timeout,this);this.lastActive=new Date().getTime();if(!this.bound){this.bind()}this.started=true;return this},bind:function(){for(var a in this.options.events){this.element.addEvent(this.options.events[a],this.activeBound)}this.bound=true;this.fireEvent("start")},getIdleTime:function(a){return a?Math.round((Date.now()-this.lastActive)/1000):Date.now()-this.lastActive},setTimeout:function(c,d){var b=this.options.timeout;this.options.timeout=c;if(d){return this}clearTimeout(this.timer);this.fireEvent("timeoutChanged",c);var a=this.getIdleTime();if(a<c&&this.isIdle){this.fireEvent("active");this.isIdle=false}else{if(a>=c){this.idle();return this}}this.timer=this.idle.delay(c-a,this);return this}});Element.Properties.idle={set:function(a){var b=this.retrieve("idle");if(b){b.stop()}return this.eliminate("idle").store("idle:options",a)},get:function(a){if(a||!this.retrieve("idle")){if(a||!this.retrieve("idle:options")){this.set("idle",a)}this.store("idle",new IdleTimer(this,this.retrieve("idle:options")))}return this.retrieve("idle")}};Element.Events.idle={onAdd:function(a){var b=this.get?false:true;var c=b?window.idleTimer:this.get("idle");if(b&&!c){c=window.idleTimer=new IdleTimer(this)}if(!c.started){c.start()}c.addEvent("idle",a)}};Element.Events.active={onAdd:function(a){(this.get?this.get("idle"):window.idleTimer).addEvent("active",a)}};var HoverIntent=new Class({Implements:[Options,Events],options:{sensitivity:7,interval:100,timeout:0,over:function(){},out:function(){}},initialize:function(c,b){this.setOptions(b);this.ob=c;var a=this;this.ob.addEvents({mouseenter:function(d){a.handleHover(d)},mouseleave:function(d){a.handleHover(d)}})},track:function(a){this.cX=a.page.x;this.cY=a.page.y},_compare:function(c,b){var a=this;b.hoverIntent_t=clearTimeout(b.hoverIntent_t);if((Math.abs(this.pX-this.cX)+Math.abs(this.pY-this.cY))<this.options.sensitivity){b.removeEvent("mousemove",a.track);b.hoverIntent_s=1;return this.options.over.apply(b,[c])}else{this.pX=this.cX;this.pY=this.cY;b.hoverIntent_t=(function(){a._compare(c,b)}).delay(this.options.interval)}},_delay:function(b,a){a.hoverIntent_t=clearTimeout(a.hoverIntent_t);a.hoverIntent_s=0;return this.options.out.apply(a,[b])},handleHover:function(c){var b=c;var a=this;if(this.ob.hoverIntent_t!==undefined){this.ob.hoverIntent_t=clearTimeout(a.ob.hoverIntent_t)}if(c.type=="mouseover"){this.pX=b.page.x;this.pY=b.page.y;this.ob.addEvent("mousemove",function(d){a.track(d)});if(this.ob.hoverIntent_s!=1){this.ob.hoverIntent_t=(function(){a._compare(b,a.ob)}).delay(a.options.interval)}}else{this.ob.removeEvent("mousemove",function(d){a.track(d)});if(this.ob.hoverIntent_s==1){this.ob.hoverIntent_t=(function(){a._delay(b,a.ob)}).delay(a.options.interval)}}}});Element.implement({hoverIntent:function(a){new HoverIntent(this,a);return this}});Array.implement({getRandomIndex:function(){return Number.random(0,this.length-1)},copy:function(){return this.splice(0,this.length)},toQueryString:function(){var a=this.map(function(c,b){switch(typeOf(c)){case"element":return ta.id(c).toQueryString();break;case"object":return Object.toQueryString(c)}});return a.join("&")}});Cookie=Class.refactor(Cookie,{write:function(b){if(this.options.encode){b=encodeURIComponent(b)}if(this.options.domain){b+="; domain="+this.options.domain}if(this.options.path){b+="; path="+this.options.path}if(this.options.duration){var a=new Date();a.setTime(a.getTime()+this.options.duration*24*60*60*1000);b+="; expires="+a.toGMTString()}if(this.options.time){var a=new Date();a.setTime(a.getTime()+this.options.time*1000);b+="; expires="+a.toGMTString()}if(this.options.expires){var a=new Date(this.options.expires);b+="; expires="+a.toGMTString()}if(this.options.secure){b+="; secure"}this.options.document.cookie=this.key+"="+b;return this},readRaw:function(a){var b=this.options.document.cookie.match("(?:^|;)\\s*"+this.key.escapeRegExp()+"=([^;]*)");return b?b[1]:false}});Cookie.exist=function(a){return document.cookie.match("(?:^|;)\\s*"+a.escapeRegExp()+"=([^;]*)")!=null};Cookie.readSession=function(c,a){if(a==null){a={}}var b=new Cookie("TASession",{encode:false}).readRaw();var d=a.pattern?a.pattern:"[^\\*]+";var e=new RegExp("(\\*|^)"+c+"\\.("+d+")");if(e.test(b)){return{cookie:b,pattern:e,start:RegExp.$1,value:RegExp.$2}}return{cookie:b,pattern:e}};Cookie.writeSession=function(d,e,c){var a=this.readSession(d,c);if(!a.cookie){return false}var b;if(a.value){b=a.cookie.replace(a.pattern,a.start+d+"."+e)}else{b=a.cookie+"*"+d+"."+e}new Cookie("TASession",{domain:cookieDomain,encode:false}).write(b);return true};Cookie.readRaw=function(a){return new Cookie(a).readRaw()};(function(){var a=Asset.javascript;Asset.javascript=function(c,b){if(!b){b={}}try{if(window.CDNHOST&&c.indexOf&&c.indexOf(window.CDNHOST)==0&&!b.crossorigin){b.crossorigin="anonymous"}}catch(d){if(window.ta&&ta.util&&ta.util.error&&ta.util.error.record){ta.util.error.record(d,"Asset.javascript - error attempting to add crossorgin property")}}a(c,b)}})();Element.implement({hasClass:function(a){return typeof this.className==="string"&&this.className.clean().contains(a," ")},getParentBySelector:function(a){try{if(!a){return $(this.parentNode)}return this.getParents(a)[0]||null}catch(b){ta.util.error.record(b,"Element.extend - getParentBySelector",null,{selector:a})}},findParentByClass:function(b){if(!this.parentNode){return null}var a=$(this.parentNode);if(a==document){return null}if(a.hasClass(b)){return a}return a.findParentByClass(b)},getLastElement:function(a){return $(this.getElements(a,true).reverse()[0]||false)},centerOnScreen:function(){var a=this.getCoordinates();this.style.left=Math.round((Window.getWidth()-a.width)/2)+Window.getScrollLeft()+"px";this.style.top=Math.round((Window.getHeight()-a.height)/2)+Window.getScrollTop()+"px"},positionOnScreen:function(b,a){this.style.left=Window.getScrollLeft()+b+"px";this.style.top=Window.getScrollTop()+a+"px"},containsEvent:function(c){if(!c||!c.page||!c.client){return false}c=new Event(c);var b=c.page;var a=this.getCoordinates();if("fixed"==(this.getOffsetParent()||this).style.position){b=c.client}return(b.y>=a.top&&b.y<=a.bottom&&b.x>=a.left&&b.x<=a.right)},overlaps:function(a){var d=this.getCoordinates();var b=a.getCoordinates();if(d.left>b.right||b.left>d.right||d.top>b.bottom||b.top>d.bottom){return false}return true},linkify:function(){var b=new Element("a",{"class":this.className,href:"javascript:;"}).set("html",this.innerHTML).replaces(this);_processLink(b);return b},setContent:function(a){if(a instanceof Array||typeOf(a)=="elements"){a.each(function(b){this.adopt($(b))},this)}else{if(typeOf(a)=="string"){this.set("html",a)}else{this.adopt($(a))}}return this},isHidden:function(){return this.getStyle("display")=="none"},inDocument:function(){return this.parentNode!=null&&this.parentNode.nodeType!=11},isFullyVisible:function(){if(this.isVisible()){var b=this.getCoordinates().top;var a=window.getScroll().y+window.getSize().y;return b<=a}else{return false}},removePropertyEvent:function(d,b){if(d.substr(0,2)!=="on"){d="on"+d}var i="ta.call(",h=this.getProperty(d),a=h&&h.indexOf(b),g=h&&h.indexOf(")",a),f;if(!h||a<0){return}if(h.charAt(g+1)==";"){g++}if(h.charAt(a+b.length)=="("){f=h.slice(0,a)+h.slice(g+1)}else{if(a>=i.length+1&&h.substr(a-i.length-1,i.length)==i){a-=i.length+1;f=h.slice(0,a)+h.slice(g+1)}}this.setProperty(d,f&&f.trim())}});Function.implement({invokeLater:function(b,c,a){return setTimeout(this.pass(a,c),b)},executeContinuations:function(b,d){var c=Array.prototype.slice.apply(arguments);if(c.length>2){d=c[2]}if(b.length>0){var a=b[0];var e=Function.executeContinuations.partial(b.slice(1),null,d);a(e,d)}else{}},inContinuationPassingForm:function(a){return function(c,b){if(a()){if(c){c()}}else{if(b){b()}}}}});Function.implement({_:{},partial:function(){var d=this;var b=Function._;var a=Array.prototype.slice.call(arguments);var f=[],e;for(var c=0;c<arguments.length;c++){arguments[c]==b&&f.push(c)}return function(){var h=a.concat(Array.prototype.slice.call(arguments,f.length));for(var g=0;g<Math.min(f.length,arguments.length);g++){h[f[g]]=arguments[g]}for(var g=0;g<h.length;g++){if(h[g]==b){return d.partial.apply(d,h)}}return d.apply(this,h)}}});Request=Class.refactor(Request,{initialize:function(b){if(b.url){var a=String(b.url);if(!/^http/.test(a)){b.url=window.location.protocol+"//"+window.location.host+a}else{if(/^(\w+):\/\/([\w.\-]+)\/(.*)/.test(a)&&RegExp.$2!=window.location.host){b.url=RegExp.$1+"://"+window.location.host+"/"+RegExp.$3}}}if(b&&b.data&&b.data.constructor&&(b.data instanceof Array)){b.data=b.data.toQueryString()}try{if(b.trackEvent&&ta&&ta.analytics){var d=ta.analytics._toEvtParams(b.trackEvent);if(d){if(b.data){if(typeof b.data=="string"){b.data=b.data+"&"+Object.toQueryString(d)}else{if(typeof b.data=="object"){b.data=Object.merge(b.data,d)}}}else{b.data=d}}}}catch(c){if(ta&&ta.util&&ta.util.error&&ta.util.error.record){ta.util.error.record(c,"Request.Absolute.initialize.trackEvent")}}return this.previous(b)},processScripts:function(c){if(this.options.keepScripts){return c}var a=c;try{a=this.previous(c)}catch(b){ta.util.error.record(b,"Request.processScripts",null,{"request url":this.options.url})}return a},send:function(a){var c=this.previous(a);if(ta&&ta.util&&ta.util.cookie){ta.util.cookie.removePIDCookie()}try{if(this.options&&ta&&ta.analytics){if(this.options.trackEvent){ta.analytics._trackEventAfterAjax(this.options.trackEvent)}if(this.options.trackPath){ta.analytics._trackEventPathAfterAjax(this.options.trackPath)}}}catch(b){if(ta&&ta.util&&ta.util.error&&ta.util.error.record){ta.util.error.record(b,"Request.Absolute.send.trackEventAfterAjax")}}return c}});(function(){var w=this;var s=w._;var d={};var m=Array.prototype,C=Object.prototype,E=Function.prototype;var l=m.push,u=m.slice,y=m.unshift,x=C.toString,q=C.hasOwnProperty;var p=m.forEach,k=m.map,A=m.reduce,g=m.reduceRight,o=m.filter,b=m.every,z=m.some,v=m.indexOf,h=m.lastIndexOf,e=Array.isArray,B=Object.keys,n=E.bind;var D=function(G){return new j(G)};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=D}exports._=D}else{w._=D}D.VERSION="1.3.3";var f=D.each=D.forEach=function(L,K,J){if(L==null){return}if(p&&L.forEach===p){L.forEach(K,J)}else{if(L.length===+L.length){for(var I=0,G=L.length;I<G;I++){if(K.call(J,L[I],I,L)===d){return}}}else{for(var H in L){if(D.has(L,H)){if(K.call(J,L[H],H,L)===d){return}}}}}};D.defaults=function(G){f(u.call(arguments,1),function(H){for(var I in H){if(G[I]==null){G[I]=H[I]}}});return G};D.extend=function(G){f(u.call(arguments,1),function(H){for(var I in H){G[I]=H[I]}});return G};D.escape=function(G){return(""+G).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")};D.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var t=/.^/;var a={"\\":"\\","'":"'",r:"\r",n:"\n",t:"\t",u2028:"\u2028",u2029:"\u2029"};for(var F in a){a[a[F]]=F}var c=/\\|'|\r|\n|\t|\u2028|\u2029/g;var i=/\\(\\|'|r|n|t|u2028|u2029)/g;var r=function(G){return G.replace(i,function(H,I){return a[I]})};D.template=function(L,K,I){I=D.defaults(I||{},D.templateSettings);var J="__p+='"+L.replace(c,function(M){return"\\"+a[M]}).replace(I.escape||t,function(M,N){return"'+\n((__t=("+r(N)+"))==null?'':_.escape(__t))+\n'"}).replace(I.interpolate||t,function(M,N){return"'+\n((__t=("+r(N)+"))==null?'':__t)+\n'"}).replace(I.evaluate||t,function(M,N){return"';\n"+r(N)+"\n__p+='"})+"';\n";if(!I.variable){J="with(obj||{}){\n"+J+"}\n"}J="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'')};\n"+J+"return __p;\n";var H=new Function(I.variable||"obj","_",J);if(K){return H(K,D)}var G=function(M){return H.call(this,M,D)};G.source="function("+(I.variable||"obj")+"){\n"+J+"}";return G};var j=function(G){this._wrapped=G}}).call(this);ta={};var api=ta=(function(){if(window.IS_DEBUG==null){var c=false}if(window.VERSION_MAP==null){var a={}}if(window.CDNHOST==null){var d=""}ta={overlays:{},maps:{},bmaps:{},common:{},phac:{},servlet:{},support:{},util:{},widgets:{},commerce:{},mobfull:{},photos:{},media:{},hac:{filters:{}},t4b:{},api:{maps:{}},p13n:{},registration:{},meta:{},reviews:{}};ta.id=function(f){try{return document.id(f)}catch(g){if(ta.util.error){ta.util.error.record(g,"ta.id - trouble wrapping",null,{elmtArg:ta.util.error.describe(f)})}}};ta.select=function(){var g=Array.from(arguments),h=g.length>1&&(("string"===typeof g[0])?g.pop():g.shift())||document,f=g.shift();return Slick.search(h,f,new Elements)};ta.invoke=function(f,g){f.each(function(h){h[g]()})};ta.selectInvoke=function(f,g){ta.invoke($$(f),g)};ta.css=function(g,f){return Asset.css(g,Object.merge({media:"screen, print"},f))};ta.throttle=function(l,g,i,j){var h=(new Date()).getTime();var k;if(g in e){k=e[g];if(h-k.lastReset<k.minResolution){k.cb=l;return}}else{k=e[g]={start:h,minResolution:Math.max(Math.floor(i/10),50)}}k.cb=l;function f(){delete e[g];k.cb()}if(k.timeout){clearTimeout(k.timeout)}if(j&&(h-k.start>j)){f()}else{k.lastReset=h;k.timeout=setTimeout(f,i)}};var e={};var b=ta;b.extend=_.extend;b.bind=function(f,g){return Function.prototype.bind.apply(f,Array.from(arguments).slice(1))};b.addEvent=function(f,h,g){return f&&$(f).addEvent(h,g)};b.removeEvent=function(f,h,g){return f&&$(f).removeEvent(h,g)};b.createElement=function(f,g){return new Element(f,g)};b.getSize=function(f){return f&&$(f).getSize()};b.getPosition=function(f){return f&&$(f).getPosition()};b.getCoords=function(f){return f&&$(f).getCoordinates()};b.addClass=function(f,g){return f&&$(f).addClass(g)};b.removeClass=function(f,g){return f&&$(f).removeClass(g)};b.find=function(f,g){return $(g||document).getElement(f)};b.bindAll=function(f){if(arguments.length>1){Array.from(arguments).slice(1).each(function(g){f[g]=b.bind(f[g],f)})}else{Object.each(f,function(h,g){f[g]=b.bind(h,f)})}return f};b.checkBrowser=function(){return Array.from(arguments).some(function(f){return !!Browser[f]})};return b})();var ifdefNN=function(a){return typeof(a)!=="undefined"&&a!==null};(function(a){var b={};a.store=function(c,d){b[c]=d;return d};a.retrieve=function(c){return b[c]};a.has=function(c){return typeof(b[c])!="undefined"};a.retrieveOrStore=function(c,d){var e=b[c];if(typeof(e)=="undefined"){b[c]=d;e=d}return e};a.remove=function(c){var d=b[c];delete b[c];return d};a.keep=function(e,f){var d=[];var c=a.retrieve(e);if(c){if(c instanceof Array){d=c}else{d.push(c)}}if(f instanceof Array){d=d.combine(f)}else{d.push(f)}a.store(e,d)};a.merge=function(c,e){var d=a.retrieve(c)||{};a.store(c,Object.merge(d,e))};a.asInt=function(d,c){var e=parseInt(a.retrieve(d));return isNaN(e)?(c||0):e};a.asFloat=function(d,c){var e=parseFloat(a.retrieve(d));return isNaN(e)?(c||0):e}})(ta);ta.load=function(c,g){var f=false;var d=ta.findFileKey(c);if(d){f=VERSION_MAP[d]}if(f){var a=d+"_callback";if(ta.has(a)){var e=ta.retrieve(a);e.push(g);ta.store(a,e)}else{ta.store(a,[function(){delete VERSION_MAP[d];if(g){g()}}]);var b=function(){var h=ta.remove(a);h.each(function(i){if(i){i()}})};if(typeof f==="object"){ta.loadInOrder(f,b)}else{Asset.javascript(f,{onLoad:b})}}}return f};ta.loadInOrder=function(a,d){var c=a.slice();var b=function(){if(c.length===0){d()}else{Asset.javascript(c.shift(),{onLoad:b})}};b()};ta.findFileKey=function(f){if(typeof f!="string"||!VERSION_MAP){return}var d=false;var c=false;if(VERSION_MAP[f]){c=f}else{if(VERSION_MAP[f+".js"]){c=f+".js"}else{var a=f.split(".");var b=0;while(a&&a.length>1&&b<10){a=a.slice(0,-1);var e=a.join("-")+".js";if(e&&VERSION_MAP[e]){c=e;break}b++}}}return c};(function(ta){var _eventListeners={};ta.call=function(funcName,evnt,elmt){if(evnt==null){if(IS_DEBUG){alert("You must pass the event.\n\nUsage:\nta.call('ta.namespace.Class.function', event);")}return false}if(funcName==null){if(IS_DEBUG){alert("ta.call of undefined function")}return false}var func=funcName;if(typeof(funcName)==="function"){funcName="<func>"}else{if(!/^ta\.[\w\d\.]+$/.test(funcName)){if(IS_DEBUG){alert("Invalid function name. Must be of the form: ta.namespace.Class.function")}return false}}var e=new Event(evnt||window.event);if(!elmt){elmt=e.target}elmt=ta.id(elmt);if(!elmt){ta.util.error.record(null,"ta.call re-wrap fail (non-DOM element) - "+funcName,evnt,{elmtArg:ta.util.error.describe({none:"none"}),funcName:funcName})}else{if(!elmt.$family){ta.util.error.record(null,"ta.call re-wrap fail - "+funcName,evnt,{elmtArg:ta.util.error.describe(elmt),funcName:funcName})}}var argSet=arguments;var args=Array.from(argSet).slice(3);args.splice(0,0,e,elmt);try{args.unshift({callback:_ta_call_defer,evt:e});args.unshift(func);return ta.run.apply(null,args)}catch(_ex){ta.util.error.record(_ex,"ta.call - "+funcName,evnt)}return false};var _ta_call_defer=function(func,options){if(options){delete (options.evt)}ta.run.apply(null,arguments)};ta.run=function(func,options){var argSet=arguments,args=Array.from(argSet).slice(2);try{var fn=ta.fn(func);if(fn&&typeOf(fn)==="function"){var retVal=fn.apply(window,Array.from(args));if(options&&options.onComplete){var completeFun=ta.fn(options.onComplete);if(completeFun){completeFun(retVal)}}return retVal}else{if(options&&options.evt){new Event(options.evt).preventDefault()}}var callback=options&&options.callback;ta.load(func,(callback||ta.run).pass(arguments))}catch(_ex){ta.util.error.record(_ex,"ta.run - "+func)}return false};ta.on=function(name,f){var v=_eventListeners[name];if(!v){v=_eventListeners[name]=[]}v.push(f)};ta.fireEvent=function(name){var args=Array.from(arguments),listeners=_eventListeners[name];args.shift();if(listeners){listeners.each(function(callback){callback.attempt(args)})}};ta.off=function(name,f){var v=_eventListeners[name],index;if(v instanceof Array){index=v.indexOf(f);if(index>=0){v.splice(index,1)}}};var OneTimeFunctionQueue=function(evtName){var _queue=[];var _runNow=false;var _execFn=function(fn,name){try{fn()}catch(_ex){try{ta.util.error.record(_ex,"OneTimeFunctionQueue "+evtName+(name?"-"+name:""))}catch(ignore){}}};var _runQueuedFunctions=function(){var startTiming=new Date();var funcTimings={};var anonFuncCounter=1;var recordTiming=ta.has("ta.js_load_tracking")&&evtName=="load";_queue.sort(function(a,b){return(a.priority-b.priority)||(a.subpriority-b.subpriority)});for(var i=0;i<_queue.length;++i){var funcStartTime=new Date();_execFn(_queue[i].func,_queue[i].name);if(recordTiming){var funcEndTime=new Date();var funcName=_queue[i].name;if(!funcName){funcName="Anon "+(anonFuncCounter++)}funcTimings[funcName]=funcEndTime.getTime()-funcStartTime.getTime()}}_queue=[];if(recordTiming){var endTiming=new Date();var totalTime=endTiming.getTime()-startTiming.getTime();ta.util.perf.loadPingback(totalTime,funcTimings)}};if(evtName!=null){window.addEvent(evtName,function(){_runNow=true;_runQueuedFunctions()})}this.addToQueue=function(fn,priority,name){if(!fn){ta.util.error.record(null,"addToQueue for "+evtName+" queue - no function");return}if(typeof priority==="string"){name=priority;priority=false}if(_runNow){_execFn(fn,name)}else{priority=priority||(100+_queue.length);_queue.push({func:fn,priority:priority,name:name,subpriority:_queue.length})}};this.executeQueue=function(){_runQueuedFunctions()}};var _readyQ=new OneTimeFunctionQueue("domready");var _loadQ=new OneTimeFunctionQueue("load");var _lazyImgQ=new OneTimeFunctionQueue(null);ta.queueForReady=function(fn,priority,name){_readyQ.addToQueue(fn,priority,name)};ta.queueForLoad=function(fn,priority,name){if(typeof IS_DEBUG!="undefined"&&IS_DEBUG){var tempName=name;if(typeof priority==="string"){tempName=priority}}_loadQ.addToQueue(fn,priority,name)};ta.queueLazyImg=function(element){var priority;try{priority=element.priority||1000}catch(ignore){return}var _fn=function(){try{if(element.oSRC!==""){if(element.tagName.toUpperCase()==="IMG"){element.src=element.oSRC}else{element.style.backgroundImage="url('"+element.oSRC+"')"}element.oSRC="";element.priority=""}}catch(e){ta.util.error.record(e,"lazy img",null,{src:element.src,oSRC:element.oSRC})}};_lazyImgQ.addToQueue(_fn,priority)};ta.manualProcessLoadQueue=function(){_loadQ.executeQueue()};ta.processLazyImages=function(){_lazyImgQ.executeQueue()};ta.fn=function(fn){switch(typeof(fn)){case"function":return fn;case"string":var f=false;try{f=eval(fn)}catch(e){}if(!f){var ns=fn.split("."),n=ns.pop();try{ns=eval(ns.join("."));f=ns&&ns._magic&&ns._magic.partial(n)}catch(e){}}if(f&&typeof(f)==="function"){return f}break}return null}}(ta));(function(B,d,j){d=B.ta=B.ta||{};d.analytics||(d.analytics={});var G=8;var b="impressionTrackingTree";var f=0,g=1,o=2;var i=[];var A=60;var D=function(Q){return typeof Q==="function"};var w=function(){var R=["MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],T;if(B.XMLHttpRequest){T=new XMLHttpRequest()}else{for(var Q=0;Q<R.length;Q++){try{T=new ActiveXObject(R[Q]);break}catch(S){}}}return T};var m=function(Q,R){try{if(!Q||typeof R!=="object"){return}if(B.JSON&&JSON.stringify){var S=JSON.stringify(R);if(S&&S.length<100000){i.push([Q,S]);if(i.length>A){i.shift()}}}}catch(T){}};var s=function(V,R,W){if(!V||typeof R!=="object"){z(new Error("postUrl/dataObj is null/empty/undefined"),"TA.Record _simpleAjaxPost",null,arguments);if(W){W()}return}var S;if(typeof Request!=="undefined"&&B.MooTools){S={url:V,method:"post",data:R};if(W){S.onComplete=W;S.timeout=3000}var T=new Request(S).send();m(V,R);return T}else{if(typeof Zepto!=="undefined"&&Zepto&&D(Zepto.ajax)){S={type:"POST",url:V,data:R,error:function(Z,X){var Y=/InvalidTrackingTreeException/;if(B.IS_DEBUG&&new RegExp(Y).exec(Z.response)){var aa=/Caused by:\s(.*)\n/;alert("TRACKING ERROR DETECTED\n"+new RegExp(aa).exec(Z.response)[1])}z(new Error("XHR error, errorType = "+X),"TA.Record _simpleAjaxPost",null,arguments)}};if(W){S.complete=W;S.timeout=3000}Zepto.ajax(S)}else{if(typeof jQuery=="function"){S={url:V,type:"POST",data:R};if(W){S.complete=W;S.timeout=3000}jQuery.ajax(S)}else{var Q=w(),U=h(R);Q.open("POST",V,false);Q.setRequestHeader("Content-type","application/x-www-form-urlencoded");Q.setRequestHeader("Content-length",U.length);Q.send(U)}}}m(V,R)};var z=function(){if(d&&d.util&&d.util.error&&d.util.error.record){d.util.error.record.apply(this,arguments)}else{if(d&&d.m&&D(d.m.recordJSError)){d.m.recordJSError(arguments)}}};var x=function(Q){if(Q===j||Q==null){return""}if(typeof Q!=="string"){Q=Q.toString()}return Q.replace(/!/g,"!!").replace(/\./g,"!.").replace(/\*/g,"!*")};var P=function(T){var Q=[];for(var R in T){var S=T[R];Q.push(x(R)+"."+x(S))}return Q.join("*")};var q=function(Q){var R=/(https?:\/\/[^\/]+)?\/([^#.?-]*)/;var S=R.exec(Q);if(S){if(typeof S[2]!="undefined"){return(S[2])?S[2]:"Home"}}return null};var L=function(){var Q=d.analytics.pageData&&d.analytics.pageData.length&&d.analytics.pageData[d.analytics.pageData.length-1];if(Q&&Q.url){return Q.url.substring(1)}else{var R=/\/([^-]*)/.exec(B.location.pathname);return R?R[1]:null}};var M=function(S,Q,T){var R=new RegExp("(-"+Q+"([0-9]+))|([?&]"+T+"=([0-9]+))");var U=R.exec(S);if(U){if(typeof U[2]!="undefined"){return U[2]}if(typeof U[4]!="undefined"){return U[4]}}return null};var F=function(Q){return M(Q,"d","detail")||M(Q,"g","geo")};var r=function(T,U,R){try{var Q;if(R.encode){U=encodeURIComponent(U)}if(R.domain){U+="; domain="+R.domain}if(R.path){U+="; path="+R.path}if(R.duration){Q=new Date();Q.setTime(Q.getTime()+R.duration*1000);U+="; expires="+Q.toGMTString()}if(R.secure){U+="; secure"}document.cookie=T+"="+U}catch(S){z(S,"_setCookieInSeconds",null,arguments)}};var O=function(){if(d.m&&d.m.store&&d.m.store.has("bookingSessionId")){return d.m.store.get("bookingSessionId")}return null};var y=function(){var Q=false;if(typeof d.userLoggedIn==="boolean"){if(typeof d.userSecurelyLoggedIn==="boolean"){Q=d.userLoggedIn?(d.userSecurelyLoggedIn?o:g):f}else{Q=d.userLoggedIn}}return Q};var J=function(T,R){var Q={gac:T[1],gaa:T[2],gal:T[3],gav:T[4],gani:T[5],gass:L(),gasl:F(document.location.href),gads:q(R),gadl:F(R),gapu:d.uid,gams:y()},S=O();if(!Q.gass){throw new Error("Src servlet undefined, gac:"+Q.gac+", gaa:"+Q.gaa+", gal:"+Q.gal)}if(!Q.gads){throw new Error("Dst servlet undefined. gac:"+Q.gac+", gaa:"+Q.gaa+", gal:"+Q.gal)}if(d.has&&d.has("gatt")){Q.gatt=d.retrieve("gatt")}if(S){Q.bsid=S}r("EVT",P(Q),{domain:cookieDomain,duration:5,encode:true})};var K=function(T){if(!T||!T.className||!T.firstChild){return false}var S=new RegExp("\\b"+b+"\\b"),Q=T.firstChild.nodeType,R=T.firstChild.nodeValue;return S.test(T.className)&&Q===G&&R!==""};d.analytics._GARecordRequest=function(U,S){var R={gac:U[1],gaa:U[2],gal:U[3],gav:U[4],gani:U[5],gass:L(),gasl:F(document.location.href),gapu:d.uid,gams:y()},T=O(),Q;if(S){R.gacl=S}if(d.has&&d.has("gatt")){R.gatt=d.retrieve("gatt")}if(T){R.bsid=T}if(typeof Request!="undefined"&&B.MooTools){Q=new Request({url:"/GARecord",data:R})}else{Q={get:function(){setTimeout(function(){var V=new XMLHttpRequest();V.open("GET","/GARecord?"+h(R),true);V.send(null)},1)}}}m("/GARecord",R);return Q};var h=function(R){var S=[];for(var Q in R){S.push(encodeURIComponent(Q)+"="+encodeURIComponent(R[Q]))}return S.join("&")};d.urlArgLookup=function(T,Q){var S=new RegExp("[\\?&]"+T+"=(\\w+)");var R=S.exec(Q);if(R&&typeof R[1]!==j){return R[1]}return null};d.analytics._JSON_parse=function(Q){if(JSON.parse){return JSON.parse(Q)}if(JSON.decode){return JSON.decode(Q)}throw new Error("No JSON.parse or JSON.decode")};d.analytics._validatedTrackEventArray=function(S,U,Q,T,R){if(S&&typeof S!="string"){S=S.toString()}if(U&&typeof U!="string"){U=U.toString()}if(Q&&typeof Q!="string"){Q=Q.toString()}if(!T){T=0}else{if(typeof T!="number"){T=parseFloat(T);if(isNaN(T)){T=0}}}if(typeof R!="boolean"){R=(R===true)}return["_trackEvent",S,U,Q,T,R]};d.analytics._toEvtParams=function(S){try{var Q={gac:S.module,gaa:S.action,gal:S.context,gav:S.value,gani:S.noninteraction};Q.gass=L();Q.gasl=F(document.location.href);Q.gapu=d.uid;Q.gams=y();return Q}catch(R){z(R,"ta.analytics._toEvtParams",null,S)}};d.analytics._trackEventAfterAjax=function(R){try{d.trackDMPBehavior(R.module,R.action,R.context,R.value,R.noninteraction)}catch(Q){z(Q,"ta.analytics._trackEventAfterAjax",null,R)}};d.getEventPathOptions=function(V,S,R){try{var U=t(R,V);if(!U){z(null,"ta.getEventPathOptions - invalid element",null,arguments);return}var Q=E(U);if(S){Q.noninteraction=S}return Q}catch(T){z(T,"ta.getEventPathOptions",null,arguments)}};d.analytics._trackEventPathAfterAjax=function(Q){try{d.trackEventOnPage(Q.category,Q.action,Q.label,Q.value,Q.noninteraction)}catch(R){z(R,"ta.analytics._trackEventPathAfterAjax",null,arguments)}};d.trackPhysicalCommerce=function(S,R,V,Q){try{var T=d.analytics._validatedTrackEventArray(S,"Commerce-Physical",R,V,false);d.analytics._GARecordRequest(T,Q).get()}catch(U){z(U,"ta.trackPhysicalCommerce",null,arguments)}};d.trackAttemptedCommerce=function(R,Q,T){try{d.trackDMPBehavior(R,Q,T,null,null)}catch(S){z(S,"ta.trackAttemptedCommerce",null,arguments)}};d.trackPhysicalAndAttemptedCommerce=function(S,R,T,U,Q){d.trackPhysicalCommerce(S,R,U,Q);d.trackAttemptedCommerce(S,R,T,U)};d.trackImpressionEventOnPage=function(R,T,Q,S){R=R||"";T=T||"";Q=Q||"";S=S||0;d.trackEventOnPage(R,T,Q,S,true)};d.trackEventOnPage=function(R,V,Q,U,T){try{var S=d.analytics._validatedTrackEventArray(R,V,Q,U,T);d.analytics._GARecordRequest(S).get();d.trackDMPBehavior(R,V,Q,U,T)}catch(W){z(W,"ta.trackEventOnPage",null,arguments)}};d.trackEventOnPageOnce=function(T,V,S){var Q="eventsAlreadyTracked";var U=d.retrieve(Q);if(!U){U={};d.store(Q,U)}var R=T+"|"+V+"|"+S;if(!U[R]){d.trackEventOnPage(T,V,S,0,false);U[R]=true}};d.trackDMPBehavior=function(R,U,Q,T,S){try{if(d.common&&d.common.dmp&&d.common.dmp.isEnabled()){d.common.dmp.sendGABehavior(R,U,Q,T,S)}}catch(V){z(V,"Error adding and sending GARecord behavior to DMP")}};d.setEvtCookie=function(S,V,R,U,Q){try{var T=d.analytics._validatedTrackEventArray(S,V,R,U,false);J(T,Q);if(d.common&&d.common.dmp&&d.common.dmp.isEnabled()){d.common.dmp.sendEventBehavior(S,V,R,U,I())}}catch(W){z(W,"ta.setEvtCookie",null,arguments)}};var l="trk";var a=l.length;var H="etk";var p=/^([A-Z]{1,2}:)?[A-Za-z_0-9\-\.]+$/;var I=function(){var Q=(typeof event!="undefined")?event:B.event;if(Q){return Q.target||Q.srcElement}return document.activeElement};d.analytics.getCommentTrackingPath=function(Q,R){return t(Q,R)};var t=function(W,Y){if(!W){W=I();if(!W){z(null,"_getCommentTrackingPath - no element provided or event target element",null,arguments);return null}}if(W.nodeType!=1){return null}var ab=[];if(Y&&typeof Y=="string"&&Y!==""){if(p.test(Y)){if(Y.substring(0,2)=="P:"){ab.push(Y.substring(2));return ab}else{ab.push(Y)}}}if(typeof W.previousSibling==="undefined"){z(null,"_getCommentTrackingPath - browser does not support previousSibling",null,arguments);return ab}LOOP_PARENT_NODES:for(var T=W;T!=document.body;T=T.parentNode){if(T==null){z(null,"_getCommentTrackingPath - LOOP_PARENT_NODES got unexpected null node",null,arguments);break}var Z=0;for(var Q=T.previousSibling;Q!=null;Q=Q.previousSibling){if(Q.nodeType==G){var S=Q.nodeValue;if(S==H){Z++;continue}if(S.substring(0,a)!=l){continue}if(Z>0){Z--;continue}var V=S.substring(a).split("/");if(!V){z(null,'ta._getCommentTrackingPath - cannot split context class: "'+S+'"',null,arguments)}for(var aa=V.length-1;aa>=0;aa--){var R=V[aa];var X=p.exec(R);if(!X){z(null,'ta._getCommentTrackingPath - tracking prefix used with invalid context: "'+V[aa]+'"',null,arguments);continue}if(X[1]=="P:"){var U=X[0].substring(2);ab.push(U);break LOOP_PARENT_NODES}else{ab.push(X[0])}}}}}return ab};var E=function(S){if(S.length===0){return null}var Q={action:S[0],label:"",value:"1",category:S[S.length-1]};S.shift();for(var R=S.length-2;R>=0;R--){Q.label+=S[R];if(R>0){Q.label+="/"}if(S[R].substring(0,2)=="N:"){Q.value=S[R].substring(2)}}if(Q.label===""){Q.label="Unknown"}return Q};d.trk=function(X,T,S,U){try{var W=t(S,X);if(!W){z(null,"ta.trk - invalid element for "+X,null,arguments);return}if(U&&U.length>0&&W.length&&W.splice){for(var R=U.length-1;R>=0;R--){if(typeof(U[R])==="string"){W.splice(1,0,U[R])}}}var Q=E(W);d.trackEventOnPage(Q.category,Q.action,Q.label,Q.value,T)}catch(V){z(V,"ta.trk",null,arguments)}};d.trkImpTree=function(R,T){try{if(!K(R)){z(null,"ta.trkImpTree called with invalid trackTreeElem!",null,arguments);if(T){T()}return}var Q=R.firstChild.nodeValue;n(Q,T)}catch(S){z(S,"ta.trkImpTree",null,arguments);if(T){T()}}};d.recordImpression=function(Q,S){if(!Q){if(S){S()}return}try{n(C(Q),S)}catch(R){z(R,"ta.recordImpression",null,arguments);if(S){S()}}};var v="<!--";var u="-->";var C=function(Q){var R=Q.indexOf(v),S=0,T=Q.indexOf(u);if(R!==-1){S=R+v.length}if(T===-1){T=Q.length}return Q.substring(S,T)};d.analytics.stripCommentsFromTree=C;var k="\\";var c="/";d.analytics.appendAscendTokens=function(R){var T=0,S=0,Q=0;for(T=0;T<R.length;T++){if(R[T]===c){Q++}else{if(R[T]===k){S=T+1;while(S<R.length&&R[S]===k){Q--;T=S;S++}}}}if(Q>0){for(T=0;T<Q;T++){R+=k}}return R};var n=function(Q,S){var R={tTreeStr:Q&&Q.trim(),tTreeUid:d.uid&&d.uid.trim(),tTreeLastReferrer:B.location.href,tTreeIsMemberSignedIn:y()};if(d.m&&d.m.store&&d.m.store.has("bookingSessionId")){R.bsid=d.m.store.get("bookingSessionId")}if(!R.tTreeStr){z(new Error("tTreeStr is null/undefined/empty."),"ta._sendTreeImpression",null)}else{if(!R.tTreeUid){z(new Error("tTreeUid is null/undefined/empty."),"ta._sendTreeImpression",null)}}s("/ImpressionRecord",R,S)};d.setEvtCookieAndPath=function(V,Q,S){try{if(!S){S=I()}var U=t(S,V);if(!U){z(null,"ta.setEvtCookieAndPath - invalid element for "+V,null,arguments);return}var R=E(U);if(!Q){while(S.nodeName!="A"){if(S==document.body){break}S=S.parentNode}Q=S.href;if(!Q){z(null,"ta.setEvtCookieAndPath - no url parameter and cannot find a.href",null,arguments);return}}d.setEvtCookie(R.category,R.action,R.label,R.value,Q)}catch(T){z(T,"ta.setEvtCookieAndPath",null,arguments)}};d.recordPageview=function(R,U){if(!R){return}var Q=q(R),T="/PageviewRecord",S=U?U:{};if(Q){S.servletName=Q;s(T,S)}};d.resetPageDataUrl=function(){var Q;if(d&&d.analytics&&d.analytics.pageData){Q=d.analytics.pageData&&d.analytics.pageData.length&&d.analytics.pageData[d.analytics.pageData.length-1];if(Q){Q.url=""}}};d.trackEngagementClick=function(Q,R){if(!Q||!R){z(new Error("object/selectionFunction is null/undefined"),"ta.trackEngagementClick",null,arguments);return}if(!D(R)){z(new Error("passed variable selectionFunction is not a function"),"ta.trackEngagementClick",null,R);return}R(Q)};d.placementNodeSelectorTracker=function(V){if(!V||!V.element||!V.type){z(new Error("object/element/type is null/undefined"),"ta.placementNodeSelectorTracker",null,V);return}var aa=V.element;var U=V.type;var W;var R;var ac;var ab;var Q;var Z;var S=d.analytics.getCommentTrackingPath(aa);U=U+"_Click";if(!S){z(new Error("trackTreePath is null/undefined"),"ta.placementNodeSelectorTracker",null,arguments);return}if(S.length<1){z(new Error("trackTreePath is missing information"),"ta.placementNodeSelectorTracker",null,arguments);return}W=S.getLast();if(!W){z(new Error("placement is null/undefined"),"ta.placementNodeSelectorTracker",null,S);return}for(Z=S.length-1;Z>=0;Z--){Q=S[Z];if(!Q){continue}if(Q.indexOf("N:")===0){R=Q;break}}if(W==="HH_MainList"){R="N:1"}else{if(!R){z(new Error("positionNode is null/undefined"),"ta.placementNodeSelectorTracker",null,S);return}}ac=R.split(":");if(ac&&ac.length===2){ab=ac[1]}else{z(new Error("positionSplit appears to be incorrect"),"ta.placementNodeSelectorTracker",null,arguments);return}if(!ab){z(new Error("position is null/undefined"),"ta.placementNodeSelectorTracker",null,arguments);return}var Y=parseInt(ab,10);if(isNaN(Y)){z(new Error("position is not a number"),"ta.placementNodeSelectorTracker",null,ab);return}var ad=N(W);if(ad===-1){return}ab=Y+ad;W=e(W);var T;var X=d.select("#jfy_filter_bar_sort .jfy_sort.selected");if(X&&X.length===1){X=X[0];T=X.getAttribute("data-currentSort")}d.trackEventOnPage(W,U,T,ab)};var e=function(Q){if(!Q){return Q}if(L()!=="Hotels"){return"Clicks_"+Q}var R;if(Q==="Hotels_MainList"||Q==="Hotels_MainList_Sponsored"){R="Clicks_"+Q}else{if(Q==="hotels_list_short_cells2"){R="Clicks_Hotels_MainList"}else{if(Q==="sponsored_coupon_listing"){R="Clicks_Hotels_MainList_Sponsored"}}}if(d.id("sponsoredCouponListingWrap")&&R==="Clicks_Hotels_MainList"){R+="_Sponsored"}R+=(d.widgets.calendar.getCheckRatesData())?"_PostDates":"_PreDates";return R};var N=function(T){if(!T){z(new Error("placement is null/undefined"),"ta._shiftOrdinalsWithSponsoredPlacement",null,T);return -1}if(L()!=="Hotels"){return 0}var R=0;var V=d.retrieve("hac.offset");if(V&&V>0){R=V}if(!d.id("sponsoredCouponListingWrap")){return R}var S=document.getElement("#HAC_RESULTS .pageNumbers .current");var Q;if(S){var U=S.getAttribute("data-page-number");Q=parseInt(U,10);if(isNaN(Q)||!Q){z(new Error("pageNumber is not a number"),"ta._shiftOrdinalsWithSponsoredPlacement",null,U);return -1}}if(T==="hotels_list_short_cells2"||T==="Hotels_MainList"){R+=Q;return R}if(V&&V>0&&(T==="sponsored_coupon_listing"||T==="Hotels_MainList_Sponsored")){R+=(Q-1)}return R};d.getRecentTARecords=function(){return i}})(window,ta);(function(){var f=[];var a=3000;function b(l,n){var g=f.length;f.push({name:l,properties:[]});for(var m in n){var h=true;if(g>0){for(var j=0;h&&j<g;j++){if(f[j].properties.indexOf(m)!=-1){h=false}}}if(h){f[g].properties.push(m)}}}b("node",document.createTextNode(""));b("Element",Element.prototype);f[1].properties.push("uid");b("element",document.createElement("div"));b("input",document.createElement("input"));f[3].properties.push("autocomplete");var e={element:"E",number:"N","function":"F",string:"S","boolean":"B",object:"O",collection:"C",whitespace:"W"};function d(h){var g=typeOf(h);return null==h?"_":(e[g]?e[g]:(g=="null"?"!":g))}ta.util.error={types:f,override:false,errorCount:0,record:function(y,h,s,u,n){if(!y){y=new Error("Stub error to build stack.")}if(ta.has("ta.error.record.inFlight")||ta.util.error.errorCount>9){return}ta.util.error.errorCount++;ta.store("ta.error.record.inFlight",true);var p=false;try{p=document.getElement("body").hasClass("js_logging")}catch(B){}if(!p){return}if(IS_DEBUG&&console.error){console.error("JS_ERROR_RECORD: "+h,y)}var E=true;if(u&&u.hasOwnProperty("error_script")&&!ta.util.error.isInternalScript(u.error_script)&&!ta.util.error.isScriptInline(u.error_script)){E=false}var m={};var D=false;try{if(s||window.event){s=new Event(s||window.event);D=ta.id(s.target);m.eTarg=this.getSelectorString(D)}}catch(r){}if(typeof(debugCacheKey)!="undefined"){m.key=debugCacheKey}var g=window.pageServlet;if(!g){g="unknown"}m.servlet=g;if(!n||typeof n!="string"){n="ERROR"}if(!E){n="WARN";m.warnReason="externalError"}else{if(!IS_DEBUG&&ta.util.error.errorCount>1){n="WARN";m.warnReason="notFirstJSError"}}var H={extraInfoError:"Problem storing extra info"};var G="";var l={};try{var j="";try{j=window.navigator.userAgent}catch(t){}var k="";var i="";if(D){if(typeof D.id!=="function"){k=D.id}i=D.className}var w=false;try{w=doCookieCheck()}catch(B){}var z="";if(typeof serverPool!="undefined"&&serverPool){z=serverPool}var v="";if(window.MooTools){v+="MooTools "}if(window.jQuery){v+="jQuery ";n="WARN";m.warnReason="jquery"}l={TARGET_ID:k,TARGET_CLASS:i,PAGE_UID:ta.uid,INTERNAL_JS:ta.util.error.getScriptSrcs(),CLIENT_POOL:z,COOKIES_ENABLED:w,JS_LIBS:v};if(!E){l.INTERNAL_ERROR="false"}if(ta.util.error.errorCount>1){l.PRIOR_JS_PAGE_ERRORS=ta.util.error.errorCount-1}}catch(A){u=H}m.xInfo=ta.util.error._getExtraInfoString(l,u);try{m.eUrl=window.location.href}catch(r){}var o="No Error";try{if(y){if(Object.prototype.toString.call(y)===Object.prototype.toString.call(new Error)){o=y.name+"-"+y.message}else{if(typeof y==="object"){o="non-Error object "+Object.prototype.toString.call(y)+" passed, sample properties - ";var F=0;for(prop in y){if(y.hasOwnProperty(prop)){o+=prop.substring(0,30)+": "+(y[prop]&&y[prop].toString?y[prop].toString().substring(0,20):y[prop])+", ";if(++F>4){break}}}}else{o="non-Object error passed: "+(""+y).substring(0,30)}}o=o.replace(/[\r\n]/g,"")}}catch(r){}m.eMsg=o;var x="";try{x=ta.util.error.getErrorBlock(h).substring(0,150);m.eBlk=x}catch(r){}try{if(x.indexOf("window.onerror")!=0){var C=ta.util.error.getErrorStack(y);if(C){m.eStak=C}}}catch(r){}try{if(ta.widgets&&ta.widgets.calendar){m.eDates=ta.widgets.calendar.getErrorDates()}}catch(r){}m.eLogLevel=n;try{new Request({url:"/JSErrorRecord",data:m}).send()}catch(B){m={eBlk:"JSErrorRecord Error",servlet:g,eLogLevel:"ERROR",eMsg:"no error retrieved"};new Request({url:"/JSErrorRecord",data:m}).send()}if(IS_DEBUG){(window.ERRORS||(window.ERRORS=[])).push(m)}if(ta.util.error.override){if(ta.util.error.override.match(/alert/)){ta.util.error.alert(m)}if(ta.util.error.override.match(/console/)&&console){ta.util.error.console(m)}}ta.remove("ta.error.record.inFlight");if(IS_DEBUG&&y&&n==="ERROR"&&false){throw y}if(IS_DEBUG){var q=ta.util.error._buildToolbarElement(o,h,n);if(ta.has("debug.toolbar.loaded")){ta.util.error.addErrorInJSToolbar(q)}else{ta.util.error._jsToolbarErrorsToAdd.push(q)}}},_jsToolbarErrorsToAdd:[],_buildToolbarElement:function(i,h,g){var j="<td class='"+g+"'>"+g+"</td><td><b>Error Block</b>:: "+h+", <b>Error Message</b>:: "+i+"</td>";return new Element("tr",{html:j})},addErrorInJSToolbar:function(i){var g=document.getElement("#DEBUG_JS_ERROR_DETAILS tbody"),h=document.getElement(".perfButtonWrap .jsErrors");if(!i){return}if(g){i.inject(g)}if(i.innerHTML&&i.innerHTML.indexOf("ERROR")>-1){h.addClass("ERROR")}else{h.addClass("WARN")}},_getExtraInfoString:function(q,g){var m="_extraInfoError_:Problem storing extra info.";var o={};var r="";try{var p=typeOf(g);var j={};if(p==="array"||p==="arguments"){for(var l=0;l<g.length;l++){var h=g[l];var n=typeof h;if(n==="string"||n==="number"||n==="boolean"){j[l]=h}else{j[l]=typeof h}}g=j}o=Object.merge(q,g);r=JSON.encode(o);if(r){if(r.length>a){r=r.substring(0,a)}return r.replace(/[\r\n]/g,"")}}catch(k){}try{o=q;r=JSON.encode(o);if(r){if(r.length>a){r=r.substring(0,a)}return r.replace(/[\r\n]/g,"")}}catch(k){}return m},getErrorBlock:function(g){if(typeof g!="undefined"&&g!==null){return g.toString().replace(/[\r\n]/g,"")}return"null or undefined"},getErrorStack:function(m){var n="";try{if(arguments&&arguments.callee&&!Browser.chrome&&!Browser.firefox&&!Browser.safari){var p=[];var h=arguments.callee.caller;h=h.caller;var k=0;while(h&&k++<20){var i=h.toString();if(i.match(/onErrorFunc/)){h=h.caller;continue}var g=i.length;var j=g>100?100:g;var q=i.substring(0,j);q=q.replace(/(\n|\r|\'|\")/g,"");q+="::";p.push(q);h=h.caller}return p.join(" ")}}catch(l){n="-arguments.callee issue"}if(m&&m.stack){var o=m.stack.split("\n");o=o.map(function(s){var r=s.lastIndexOf("/");if(r>0){s=s.substr(r+1)}return s});return o.join()}return"none"+n},getSelectorString:function(h){if(!h){return""}var g=[h];while(typeof h!="undefined"&&h&&typeof h.parentNode!="undefined"){g.push(h=h.parentNode)}g=g.map(function(j){if(j&&j.tagName){var i=j.tagName;if(j.id){i+="#"+j.id}if(j.className){i+="."+j.className}return i}return""});g=g.reverse().join(">");g=g.replace(/\s+/g,".");return g},ajaxFailure:function(i,h,g){ta.util.error.record(null,i,null,Object.merge({status:h.status},g))},alert:function(g){var h="";Object.each(g,function(j,i){h=h+i+": "+j+"\n"});window.alert(h)},console:function(g){if(console){console.error(g)}},getScriptSrcs:function(){var g="";Array.each(document.getElementsByTagName("script"),function(k,h){if(!k){return}var j=k.src;if(ta.util.error.isInternalScript(j)){var i="";if(g!=""){i=", "}j=j.substring(j.indexOf("/js")+1);g=g+i+j}});if(g.length>a){g=g.substring(0,a)}return g},isInternalScript:function(g){if(!g||!g.indexOf){return false}var h=window.CDNHOST||"";if(window.IS_DEBUG&&h==""){return g.match(/(js3\/|js\/)/)!=null}else{return g.indexOf(h)==0}},isScriptInline:function(h){if(!h||!h.indexOf){return false}var g="noPage";try{g=window.location.href}catch(i){}if(h===g){return true}return false},describe:function(h){if(null==h){return"_N"}var j=d(h),i=[],l,m;for(var k in h){l=false;for(var g=0;!l&&g<f.length;g++){if(f[g].properties.indexOf(k)!=-1){l=true;if(i.indexOf(f[g].name)==-1){i.push(f[g].name)}}}if(!l){j+=","+k+":"+d(h[k])}}if(i.length>0){j+=","+i.join(",")}return j}};var c=Cookie.read("JS_ERROR_HANDLING");if(c){ta.util.error.override=c}})();window.ta||(window.ta={});(function(a){a.util||(a.util={});var c="interruption_record";var e=["popup","popunder","gate","other"];var d=function(h,f){try{if(a&&a.util&&a.util.error&&a.util.error.record&&typeof a.util.error.record==="function"){a.util.error.record(f,h,null,null)}}catch(g){}};var b=function(g){for(var f=0;f<e.length;f++){if(g===e[f]){return true}}return false};a.util.recordInterruption=function(g,f){try{if(!b(g)){d("ta.util.recordInterruption: Invalid type")}else{if(!f){d("ta.util.recordInterruption: Name cannot be null or blank")}else{if(a.trackEventOnPage&&typeof a.trackEventOnPage==="function"){a.trackEventOnPage(c,g,f.replace(",",""),0,true)}else{d("ta.util.recordInterruption: cannot track event on page")}}}}catch(h){d("ta.util.recordInterruption: exception tracking event",h)}}}(ta));(function(k,e){var r=false,g="taLsTest",f="1",m="TALocalStorageCurrentSessionId",i=false,j="session-",h=false;var p=function(u){if(!i&&!h){typeof k!=="undefined"&&k.util&&k.util.error&&k.util.error.record(null,"Accessing localStorage session cookie before session logic intialized: "+u);return false}return true};var l=function(u){var w;try{var v=JSON.parse(r.getItem(u)||"0"),y;if(!v){return null}if(v.ttl&&v.ttl+v.now<new Date().getTime()){r.removeItem(u);return null}r.setItem("512",v.value);y=r.getItem("512");r.removeItem("512");return y}catch(x){}return w};var s=function(u){try{r.removeItem(u)}catch(v){}};var t=function(u){try{var w=r.getItem(u);if(w!==null&&w!==e){return true}}catch(v){}return false};var a=function(v,w,u){try{r.setItem(v,JSON.stringify({ttl:u||0,now:new Date().getTime(),value:w}))}catch(x){}};var n=function(u){h=true;if(!u){typeof k!=="undefined"&&k.util&&k.util.error&&k.util.error.record(null,"Attempting to initialize localStorage with invalid sesion key: "+u);return false}if(!q()){return false}i=l(m);if(!i||i!=u){i=u;a(m,i);b();if(t(m)){typeof k!=="undefined"&&k.store&&k.store("isFirstSessionPageView",true)}}};var b=function(){try{var w=j+i;var u=new RegExp("^"+j);if(r.length){for(var v=0;v<r.length;v++){var y=r.key(v);try{if(u.test(y)&&y!=w){s(y)}}catch(x){}}}}catch(z){}};var q=function(){var v=false;try{if(r&&r.setItem){r.setItem(g,f);v=r.getItem(g)!=f;r.removeItem(g);if(v){r=false}return !!r}}catch(u){}return false};var d=function(u){try{r.setItem("session-"+i,JSON.stringify(u))}catch(v){}};var o=function(){try{var u=r.getItem("session-"+i);if(u){return JSON.parse(u)}}catch(v){}return{}};var c={enabled:q(),get:l,set:a,remove:s,has:t,updateSessionId:n,getSessionKey:function(v){if(!p(v)){return null}var u=o();if(u){return u[v]}return null},setSessionKey:function(v,w){if(!p(v)){return}var u=o();if(!u){u={}}u[v]=w;d(u)},removeSessionKey:function(v){if(!p(v)){return}var u=o();if(!u){return}delete u[v];d(u)},hasSessionKey:function(v){if(!p(v)){return false}var u=o();if(u){var w=u[v];if(w!==null&&w!==e){return true}}return false},setStorage:function(u){r=u;this.enabled=q()}};k.localStorage=c;if(typeof window!=="undefined"){k.localStorage.setStorage(window.localStorage)}}(ta));(function(i,k,e){var l=[],m=[],h=false;var d,n;if(typeof document.hidden!=="undefined"){d="hidden";n="visibilitychange"}else{if(typeof document.mozHidden!=="undefined"){d="mozHidden";n="mozvisibilitychange"}else{if(typeof document.msHidden!=="undefined"){d="msHidden";n="msvisibilitychange"}else{if(typeof document.webkitHidden!=="undefined"){d="webkitHidden";n="webkitvisibilitychange"}}}}function j(){for(var o in m){if(m.hasOwnProperty(o)){m[o]()}}}function f(){for(var o in l){if(l.hasOwnProperty(o)){l[o]()}}}function g(){var p=document[d]?l:m;for(var o in p){if(p.hasOwnProperty(o)){p[o]()}}}function a(){if(typeof document[d]==="undefined"){k.addEvent("focus",j);k.addEvent("blur",f)}else{document.addEventListener(n,g)}h=true}function b(){if(typeof document[d]==="undefined"){k.removeEvent("focus",j);k.removeEvent("blur",f)}else{document.removeEventListener(n,g)}h=false}function c(q,p){var o=q.indexOf(p);if(o>=0){return q.splice(o,1)}return null}i.pageVisibility={addFocusListener:function(o){m.push(o);if(!h){a()}},addBlurListener:function(o){l.push(o);if(!h){a()}},removeFocusListener:function(o){if(o){c(m,o)}else{m.length=0}if(m.length===0&&l.length===0){b()}},removeBlurListener:function(o){if(o){c(l,o)}else{l.length=0}if(m.length===0&&l.length===0){b()}}}})(ta,window);(function(){ta=window.ta=window.ta||{};var b=ta.prerender||(ta.prerender={});b.states={PREFETCH_SENT:"prefetchSent",CLEAR:"clear"};var a=function(f){if(ta&&ta.util&&ta.util.error&&ta.util.error.record){ta.util.error.record(f)}};var e=function(i,k,g,j,h){if(ta.analytics&&ta.analytics._validatedTrackEventArray&&ta.analytics._GARecordRequest){var f=ta.analytics._validatedTrackEventArray(i,k,g,j,h);ta.analytics._GARecordRequest(f).get();return true}return false};var d=function(){if("visibilityState" in document){b._visibilityState="visibilityState";b._visibilitystatechanged="visibilitychange";return}var g=["webkit","moz","ms","o"];for(var f=0;f<g.length;f++){if((g[f]+"VisibilityState") in document){b._visibilityState=g[f]+"VisibilityState";b._visibilitystatechanged=g[f]+"visibilitychange"}}};var c=function(){try{if(b._state===b.states.PREFETCH_SENT&&document[b._visibilityState]!=="prerender"){e("Prerender","shown","",0,true);b._state=b.states.CLEAR}}catch(f){a(f)}};b._init=function(f){try{b._enabled=f;b._state=b.states.CLEAR;d();if(!b.isSupported()||!b.isEnabled()){return}if(document[b._visibilityState]==="prerender"){if(e("Prerender","prefetch","",0,true)){b._state=b.states.PREFETCH_SENT;document.addEventListener(b._visibilitystatechanged,c,false)}}}catch(g){a(g)}};b.isEnabled=function(){return b._enabled};b.isSupported=function(){return b._visibilityState!==undefined}})();(function(){if(typeof performancePingbackInit=="undefined"||performancePingbackInit.initialized){return}performancePingbackInit.initialized=true;ta.queueForReady(function(){if(typeof performancePingbackInit!="undefined"){performancePingbackInit.domready=new Date().getTime()}},0,"perf.recordReady");ta.queueForLoad(function(){if(typeof performancePingbackInit!="undefined"){performancePingbackInit.load=new Date().getTime();setTimeout(function(){a()},0)}},10000000,"perf.recordLoad");function b(){var c=performancePingbackInit.domready-performancePingbackInit.start;var d=performancePingbackInit.load-performancePingbackInit.start;var g="/PerformancePingback?ppuid="+performancePingbackInit.uid+"&load="+d+"&domready="+c+"&servlet="+performancePingbackInit.servlet;if(performancePingbackInit.behaviorEnd&&performancePingbackInit.behaviorStart){var f=performancePingbackInit.behaviorEnd-performancePingbackInit.behaviorStart;g+="&behavior="+f}if(window.performance&&window.performance.timing){for(var e in window.performance.timing){var h=window.performance.timing[e];if(typeof h==="number"){g+="&"+e+"="+h}}}g+="&coldcache="+(!performancePingbackInit.isTaReferrer);new Request({url:g}).send()}function a(){if(typeof performancePingbackInit!="undefined"&&performancePingbackInit.enabled&&performancePingbackInit.domready&&performancePingbackInit.load){if(!("readyState" in document)||!("onreadystatechange" in document)||!("addListener" in document)){b();return}if(document.readyState==="complete"){setTimeout(function(){b()},0)}else{document.addListener("readystatechange",function(){if(document.readyState==="complete"){setTimeout(function(){b()},0)}})}}}})();(function(){ta.util.perf={loadPingback:function(c,d){try{var a={};var f="";var b=false;f+="[[";Object.each(d,function(h,e){if(b){f+=","}f+=e+":"+h;b=true});f+="]]";a.functionTimes=f;a.totalTime=c;if(ta.uid){a.uid=ta.uid+""}a.errorsOnLoad=ta.has("ta.onload.errors");a.servlet=window.pageServlet;new Request({url:"/LoadRecord",data:a}).send()}catch(g){ta.util.error.record(g,"ta.util.perf.loadPingback",false,{totalLoadTime:c,funcTimes:d})}}}})();(function(a){Object.append(a,{isHotelsRedesign2011:function(){if(ta.has("hac.isHotelsRedesign2011")){return ta.retrieve("hac.isHotelsRedesign2011")}if(window.pageServlet=="LastMinute"){ta.store("hac.isHotelsRedesign2011",true);return true}var c=ta.id("HAC_SMRY");var b=c&&c.hasClass("hotels_re_2011");ta.store("hac.isHotelsRedesign2011",b);return b},isSmartDealsFilters:function(){if(ta.has("smartdeals.isSmartDealsFilters")){return ta.retrieve("smartdeals.isSmartDealsFilters")}var b=ta.id("DEALS");var c=b&&b.hasClass("sdfilters");ta.store("smartdeals.isSmartDealsFilters",c);return c},isDHTMLCRRedesign2012:function(){if(ta.has("overlays.isDHTMLCRRedesignBasic")){return ta.retrieve("overlays.isDHTMLCRRedesignBasic")}var b=$$(".overlay");var c=b&&b.hasClass("rgba_flyout");ta.store("overlays.isDHTMLCRRedesignBasic",c);return c},isRestaurantsRedesign2012:function(){if(ta.has("eateries.isRestaurants")){return ta.retrieve("eateries.isRestaurants")}var c=ta.id("EATERIES_2012");var b=c&&c.hasClass("gridA");ta.store("eateries.isRestaurants",b);return b},isAttractionsRedesign2012:function(){if(ta.has("attractions.isAttractions")){return ta.retrieve("attractions.isAttractions")}var b=ta.id("ATTRACTIONS_2012");var c=b&&b.hasClass("gridA");ta.store("attractions.isAttractions",c);return c},isMetaHomepageIntegration2013:function(){if(ta.has("home.isMetaHomepageIntegration2013")){return ta.retrieve("home.isMetaHomepageIntegration2013")}var c=ta.id("PPT");var b=c&&c.hasClass("ppt_container");ta.store("home.isMetaHomepageIntegration2013",b);return b},isMetaHotels2013:function(){if(ta.has("hotelsMeta.isMetaHotels2013")){return ta.retrieve("hotelsMeta.isMetaHotels2013")}var c=ta.id("PAGE");var b=c&&c.hasClass("meta_hotels");ta.store("hotelsMeta.isMetaHotels2013",b);return b},isMetaHotel2013:function(){if(ta.has("hotel.meta2013")){return ta.retrieve("hotel.meta2013")}var d=ta.id("MAIN"),c=d&&(d.hasClass("Hotel_Review")||d.hasClass("ShowUserReviews")||d.hasClass("Hotels")||d.hasClass("HACSearch"));ta.store("hotel.meta2013",c);return c},isFlights2013:function(){return $$(".new_lander").length>0},isMetaHotelsRequest:function(){return ta.has("isMetaHotelsRequest")},isHacMap:function(){return ta.has("hac.maps.isHacMap")},isFall2013MastheadRefresh:function(){return ta.has("fall_2013_masthead_refresh")},isHRTabs2014:function(){return ta.has("hr_tabs_2014")},isTabletAlbumViewer:function(){return ta.retrieve("tabletAlbumPhotoLightbox.enabled")},isTabletAlbumViewerCTA:function(){return ta.retrieve("tabletAlbumPhotoLightboxCTA.enabled")},isTabletRotationCTATest:function(){return ta.retrieve("tabletRotationCTATest.enabled")},isWarUsabilityTest:function(){return ta.id(document.body).hasClass("war_usability")},isAirport:function(){return window.pageServlet=="Airport"}})})(ta);(function(a,c,b,d){b.browser=(function(g){var f=function(){return navigator.userAgent.contains("MSIE 10.0")},h=function(){return g.retrieve("ta.isIE11orHigher")},e=function(){var n=g.retrieve("metaCheckRatesDebugFeatureEnabled"),j=null,k=h(),l=k?127:0,i=(c.innerWidth==screen.width&&((screen.height-c.innerHeight)===l));if(n){return true}try{j=!!new ActiveXObject("htmlfile")}catch(m){j=false}return !j&&i&&(k||f())};return{isIE9orHigher:function(){if(h()||(Browser.ie&&Browser.version>=9)){return true}return false},isIE10Metro:function(){return f()&&e()},isIEMetro:function(){return e()}}}(b))}(document,window,ta));(function(a,f,b,h){var g="screenSizeRecord";function c(){var l=a.documentElement,j=a.body,k=f.innerWidth||l.clientWidth||j.clientWidth,i=f.innerHeight||l.clientHeight||j.clientHeight,n=screen.width,m=screen.height;return"s"+n+"x"+m+"b"+k+"x"+i}function e(k){var i=c(),j=b.localStorage.getSessionKey(g);if(i!==j){b.localStorage.setSessionKey(g,i);b.trackEventOnPage("screenSizeRecord",k,i)}}function d(){if(!b.retrieve("screenSizeRecord")||!b.localStorage.enabled){return}e("load");var i;f.addEvent("resize",function(){if(i){clearTimeout(i)}i=setTimeout(function(){e("resize")},250)})}b.queueForLoad(d,"ScreenSizeRecord.onLoad")})(document,window,ta);/* Dust - Asynchronous Templating - v2.3.5
* http://linkedin.github.io/dustjs/
* Copyright (c) 2014 Aleksander Williams; Released under the MIT License */
(function(root){var dust={},NONE="NONE",ERROR="ERROR",WARN="WARN",INFO="INFO",DEBUG="DEBUG",loggingLevels=[DEBUG,INFO,WARN,ERROR,NONE],EMPTY_FUNC=function(){},logger={},originalLog,loggerContext;dust.debugLevel=NONE;dust.silenceErrors=false;if(root&&root.console&&root.console.log){loggerContext=root.console;originalLog=root.console.log}logger.log=loggerContext?function(){if(typeof originalLog==="function"){logger.log=function(){originalLog.apply(loggerContext,arguments)}}else{logger.log=function(){var message=Array.prototype.slice.apply(arguments).join(" ");originalLog(message)}}logger.log.apply(this,arguments)}:function(){};dust.log=function(message,type){type=type||INFO;if(dust.debugLevel!==NONE&&dust.indexInArray(loggingLevels,type)>=dust.indexInArray(loggingLevels,dust.debugLevel)){if(!dust.logQueue){dust.logQueue=[]}dust.logQueue.push({message:message,type:type});logger.log("[DUST "+type+"]: "+message)}if(!dust.silenceErrors&&type===ERROR){if(typeof message==="string"){throw new Error(message)}else{throw message}}};dust.onError=function(error,chunk){logger.log("[!!!DEPRECATION WARNING!!!]: dust.onError will no longer return a chunk object.");dust.log(error.message||error,ERROR);if(!dust.silenceErrors){throw error}else{return chunk}};dust.helpers={};dust.cache={};dust.register=function(name,tmpl){if(!name){return}dust.cache[name]=tmpl};dust.render=function(name,context,callback){var chunk=new Stub(callback).head;try{dust.load(name,chunk,Context.wrap(context,name)).end()}catch(err){dust.log(err,ERROR)}};dust.stream=function(name,context){var stream=new Stream();dust.nextTick(function(){try{dust.load(name,stream.head,Context.wrap(context,name)).end()}catch(err){dust.log(err,ERROR)}});return stream};dust.renderSource=function(source,context,callback){return dust.compileFn(source)(context,callback)};dust.compileFn=function(source,name){name=name||null;var tmpl=dust.loadSource(dust.compile(source,name));return function(context,callback){var master=callback?new Stub(callback):new Stream();dust.nextTick(function(){if(typeof tmpl==="function"){tmpl(master.head,Context.wrap(context,name)).end()}else{dust.log(new Error("Template ["+name+"] cannot be resolved to a Dust function"),ERROR)}});return master}};dust.load=function(name,chunk,context){var tmpl=dust.cache[name];if(tmpl){return tmpl(chunk,context)}else{if(dust.onLoad){return chunk.map(function(chunk){dust.onLoad(name,function(err,src){if(err){return chunk.setError(err)}if(!dust.cache[name]){dust.loadSource(dust.compile(src,name))}dust.cache[name](chunk,context).end()})})}return chunk.setError(new Error("Template Not Found: "+name))}};dust.loadSource=function(source,path){return eval(source)};if(Array.isArray){dust.isArray=Array.isArray}else{dust.isArray=function(arr){return Object.prototype.toString.call(arr)==="[object Array]"}}dust.indexInArray=function(arr,item,fromIndex){fromIndex=+fromIndex||0;if(Array.prototype.indexOf){return arr.indexOf(item,fromIndex)}else{if(arr===undefined||arr===null){throw new TypeError('cannot call method "indexOf" of null')}var length=arr.length;if(Math.abs(fromIndex)===Infinity){fromIndex=0}if(fromIndex<0){fromIndex+=length;if(fromIndex<0){fromIndex=0}}for(;fromIndex<length;fromIndex++){if(arr[fromIndex]===item){return fromIndex}}return -1}};dust.nextTick=(function(){return function(callback){setTimeout(callback,0)}})();dust.isEmpty=function(value){if(dust.isArray(value)&&!value.length){return true}if(value===0){return false}return(!value)};dust.filter=function(string,auto,filters){if(filters){for(var i=0,len=filters.length;i<len;i++){var name=filters[i];if(name==="s"){auto=null}else{if(typeof dust.filters[name]==="function"){string=dust.filters[name](string)}else{dust.log("Invalid filter ["+name+"]",WARN)}}}}if(auto){string=dust.filters[auto](string)}return string};dust.filters={h:function(value){return dust.escapeHtml(value)},j:function(value){return dust.escapeJs(value)},u:encodeURI,uc:encodeURIComponent,js:function(value){if(!JSON){dust.log("JSON is undefined.  JSON stringify has not been used on ["+value+"]",WARN);return value}else{return JSON.stringify(value)}},jp:function(value){if(!JSON){dust.log("JSON is undefined.  JSON parse has not been used on ["+value+"]",WARN);return value}else{return JSON.parse(value)}}};function Context(stack,global,blocks,templateName){this.stack=stack;this.global=global;this.blocks=blocks;this.templateName=templateName}dust.makeBase=function(global){return new Context(new Stack(),global)};Context.wrap=function(context,name){if(context instanceof Context){return context}return new Context(new Stack(context),{},null,name)};Context.prototype.get=function(path,cur){if(typeof path==="string"){if(path[0]==="."){cur=true;path=path.substr(1)}path=path.split(".")}return this._get(cur,path)};Context.prototype._get=function(cur,down){var ctx=this.stack,i=1,value,first,len,ctxThis;first=down[0];len=down.length;if(cur&&len===0){ctxThis=ctx;ctx=ctx.head}else{if(!cur){while(ctx){if(ctx.isObject){ctxThis=ctx.head;value=ctx.head[first];if(value!==undefined){break}}ctx=ctx.tail}if(value!==undefined){ctx=value}else{ctx=this.global?this.global[first]:undefined}}else{if(ctx){if(ctx.head){ctx=ctx.head[first]}else{ctx=undefined}}}while(ctx&&i<len){ctxThis=ctx;ctx=ctx[down[i]];i++}}if(typeof ctx==="function"){var fn=function(){try{return ctx.apply(ctxThis,arguments)}catch(err){return dust.log(err,ERROR)}};fn.isFunction=true;return fn}else{if(ctx===undefined){dust.log("Cannot find the value for reference [{"+down.join(".")+"}] in template ["+this.getTemplateName()+"]")}return ctx}};Context.prototype.getPath=function(cur,down){return this._get(cur,down)};Context.prototype.push=function(head,idx,len){return new Context(new Stack(head,this.stack,idx,len),this.global,this.blocks,this.getTemplateName())};Context.prototype.rebase=function(head){return new Context(new Stack(head),this.global,this.blocks,this.getTemplateName())};Context.prototype.current=function(){return this.stack.head};Context.prototype.getBlock=function(key,chk,ctx){if(typeof key==="function"){var tempChk=new Chunk();key=key(tempChk,this).data.join("")}var blocks=this.blocks;if(!blocks){dust.log("No blocks for context[{"+key+"}] in template ["+this.getTemplateName()+"]",DEBUG);return}var len=blocks.length,fn;while(len--){fn=blocks[len][key];if(fn){return fn}}};Context.prototype.shiftBlocks=function(locals){var blocks=this.blocks,newBlocks;if(locals){if(!blocks){newBlocks=[locals]}else{newBlocks=blocks.concat([locals])}return new Context(this.stack,this.global,newBlocks,this.getTemplateName())}return this};Context.prototype.getTemplateName=function(){return this.templateName};function Stack(head,tail,idx,len){this.tail=tail;this.isObject=head&&typeof head==="object";this.head=head;this.index=idx;this.of=len}function Stub(callback){this.head=new Chunk(this);this.callback=callback;this.out=""}Stub.prototype.flush=function(){var chunk=this.head;while(chunk){if(chunk.flushable){this.out+=chunk.data.join("")}else{if(chunk.error){this.callback(chunk.error);dust.log("Chunk error ["+chunk.error+"] thrown. Ceasing to render this template.",WARN);this.flush=EMPTY_FUNC;return}else{return}}chunk=chunk.next;this.head=chunk}this.callback(null,this.out)};function Stream(){this.head=new Chunk(this)}Stream.prototype.flush=function(){var chunk=this.head;while(chunk){if(chunk.flushable){this.emit("data",chunk.data.join(""))}else{if(chunk.error){this.emit("error",chunk.error);dust.log("Chunk error ["+chunk.error+"] thrown. Ceasing to render this template.",WARN);this.flush=EMPTY_FUNC;return}else{return}}chunk=chunk.next;this.head=chunk}this.emit("end")};Stream.prototype.emit=function(type,data){if(!this.events){dust.log("No events to emit",INFO);return false}var handler=this.events[type];if(!handler){dust.log("Event type ["+type+"] does not exist",WARN);return false}if(typeof handler==="function"){handler(data)}else{if(dust.isArray(handler)){var listeners=handler.slice(0);for(var i=0,l=listeners.length;i<l;i++){listeners[i](data)}}else{dust.log("Event Handler ["+handler+"] is not of a type that is handled by emit",WARN)}}};Stream.prototype.on=function(type,callback){if(!this.events){this.events={}}if(!this.events[type]){dust.log("Event type ["+type+"] does not exist. Using just the specified callback.",WARN);if(callback){this.events[type]=callback}else{dust.log("Callback for type ["+type+"] does not exist. Listener not registered.",WARN)}}else{if(typeof this.events[type]==="function"){this.events[type]=[this.events[type],callback]}else{this.events[type].push(callback)}}return this};Stream.prototype.pipe=function(stream){this.on("data",function(data){try{stream.write(data,"utf8")}catch(err){dust.log(err,ERROR)}}).on("end",function(){try{return stream.end()}catch(err){dust.log(err,ERROR)}}).on("error",function(err){stream.error(err)});return this};function Chunk(root,next,taps){this.root=root;this.next=next;this.data=[];this.flushable=false;this.taps=taps}Chunk.prototype.write=function(data){var taps=this.taps;if(taps){data=taps.go(data)}this.data.push(data);return this};Chunk.prototype.end=function(data){if(data){this.write(data)}this.flushable=true;this.root.flush();return this};Chunk.prototype.map=function(callback){var cursor=new Chunk(this.root,this.next,this.taps),branch=new Chunk(this.root,cursor,this.taps);this.next=branch;this.flushable=true;callback(branch);return cursor};Chunk.prototype.tap=function(tap){var taps=this.taps;if(taps){this.taps=taps.push(tap)}else{this.taps=new Tap(tap)}return this};Chunk.prototype.untap=function(){this.taps=this.taps.tail;return this};Chunk.prototype.render=function(body,context){return body(this,context)};Chunk.prototype.reference=function(elem,context,auto,filters){if(typeof elem==="function"){elem.isFunction=true;elem=elem.apply(context.current(),[this,context,null,{auto:auto,filters:filters}]);if(elem instanceof Chunk){return elem}}if(!dust.isEmpty(elem)){return this.write(dust.filter(elem,auto,filters))}else{return this}};Chunk.prototype.section=function(elem,context,bodies,params){if(typeof elem==="function"){elem=elem.apply(context.current(),[this,context,bodies,params]);if(elem instanceof Chunk){return elem}}var body=bodies.block,skip=bodies["else"];if(params){context=context.push(params)}if(dust.isArray(elem)){if(body){var len=elem.length,chunk=this;if(len>0){if(context.stack.head){context.stack.head["$len"]=len}for(var i=0;i<len;i++){if(context.stack.head){context.stack.head["$idx"]=i}chunk=body(chunk,context.push(elem[i],i,len))}if(context.stack.head){context.stack.head["$idx"]=undefined;context.stack.head["$len"]=undefined}return chunk}else{if(skip){return skip(this,context)}}}}else{if(elem===true){if(body){return body(this,context)}}else{if(elem||elem===0){if(body){return body(this,context.push(elem))}}else{if(skip){return skip(this,context)}}}}dust.log("Not rendering section (#) block in template ["+context.getTemplateName()+"], because above key was not found",DEBUG);return this};Chunk.prototype.exists=function(elem,context,bodies){var body=bodies.block,skip=bodies["else"];if(!dust.isEmpty(elem)){if(body){return body(this,context)}}else{if(skip){return skip(this,context)}}dust.log("Not rendering exists (?) block in template ["+context.getTemplateName()+"], because above key was not found",DEBUG);return this};Chunk.prototype.notexists=function(elem,context,bodies){var body=bodies.block,skip=bodies["else"];if(dust.isEmpty(elem)){if(body){return body(this,context)}}else{if(skip){return skip(this,context)}}dust.log("Not rendering not exists (^) block check in template ["+context.getTemplateName()+"], because above key was found",DEBUG);return this};Chunk.prototype.block=function(elem,context,bodies){var body=bodies.block;if(elem){body=elem}if(body){return body(this,context)}return this};Chunk.prototype.partial=function(elem,context,params){var partialContext;partialContext=dust.makeBase(context.global);partialContext.blocks=context.blocks;if(context.stack&&context.stack.tail){partialContext.stack=context.stack.tail}if(params){partialContext=partialContext.push(params)}if(typeof elem==="string"){partialContext.templateName=elem}partialContext=partialContext.push(context.stack.head);var partialChunk;if(typeof elem==="function"){partialChunk=this.capture(elem,partialContext,function(name,chunk){partialContext.templateName=partialContext.templateName||name;dust.load(name,chunk,partialContext).end()})}else{partialChunk=dust.load(elem,this,partialContext)}return partialChunk};Chunk.prototype.helper=function(name,context,bodies,params){var chunk=this;try{if(dust.helpers[name]){return dust.helpers[name](chunk,context,bodies,params)}else{dust.log("Invalid helper ["+name+"]",WARN);return chunk}}catch(err){dust.log(err,ERROR);return chunk}};Chunk.prototype.capture=function(body,context,callback){return this.map(function(chunk){var stub=new Stub(function(err,out){if(err){chunk.setError(err)}else{callback(out,chunk)}});body(stub.head,context).end()})};Chunk.prototype.setError=function(err){this.error=err;this.root.flush();return this};function Tap(head,tail){this.head=head;this.tail=tail}Tap.prototype.push=function(tap){return new Tap(tap,this)};Tap.prototype.go=function(value){var tap=this;while(tap){value=tap.head(value);tap=tap.tail}return value};var HCHARS=new RegExp(/[&<>\"\']/),AMP=/&/g,LT=/</g,GT=/>/g,QUOT=/\"/g,SQUOT=/\'/g;dust.escapeHtml=function(s){if(typeof s==="string"){if(!HCHARS.test(s)){return s}return s.replace(AMP,"&amp;").replace(LT,"&lt;").replace(GT,"&gt;").replace(QUOT,"&quot;").replace(SQUOT,"&#39;")}return s};var BS=/\\/g,FS=/\//g,CR=/\r/g,LS=/\u2028/g,PS=/\u2029/g,NL=/\n/g,LF=/\f/g,SQ=/'/g,DQ=/"/g,TB=/\t/g;dust.escapeJs=function(s){if(typeof s==="string"){return s.replace(BS,"\\\\").replace(FS,"\\/").replace(DQ,'\\"').replace(SQ,"\\'").replace(CR,"\\r").replace(LS,"\\u2028").replace(PS,"\\u2029").replace(NL,"\\n").replace(LF,"\\f").replace(TB,"\\t")}return s};if(typeof exports==="object"){module.exports=dust}else{root.dust=dust}})((function(){return this})());/* dustjs-helpers - v1.2.0
* https://github.com/linkedin/dustjs-helpers
* Copyright (c) 2014 Aleksander Williams; Released under the MIT License */
(function(dust){var _console=(typeof console!=="undefined")?console:{log:function(){}};function isSelect(context){var value=context.current();return typeof value==="object"&&value.isSelect===true}function jsonFilter(key,value){if(typeof value==="function"){return value.toString().replace(/(^\s+|\s+$)/mg,"").replace(/\n/mg,"").replace(/,\s*/mg,", ").replace(/\)\{/mg,") {")}return value}function filter(chunk,context,bodies,params,filterOp){params=params||{};var body=bodies.block,actualKey,expectedValue,filterOpType=params.filterOpType||"";if(typeof params.key!=="undefined"){actualKey=dust.helpers.tap(params.key,chunk,context)}else{if(isSelect(context)){actualKey=context.current().selectKey;if(context.current().isResolved){filterOp=function(){return false}}}else{_console.log("No key specified for filter in:"+filterOpType+" helper ");return chunk}}expectedValue=dust.helpers.tap(params.value,chunk,context);if(filterOp(coerce(expectedValue,params.type,context),coerce(actualKey,params.type,context))){if(isSelect(context)){context.current().isResolved=true}if(body){return chunk.render(body,context)}else{_console.log("Missing body block in the "+filterOpType+" helper ");return chunk}}else{if(bodies["else"]){return chunk.render(bodies["else"],context)}}return chunk}function coerce(value,type,context){if(value){switch(type||typeof(value)){case"number":return +value;case"string":return String(value);case"boolean":value=(value==="false"?false:value);return Boolean(value);case"date":return new Date(value);case"context":return context.get(value)}}return value}var helpers={tap:function(input,chunk,context){if(typeof input!=="function"){return input}var dustBodyOutput="",returnValue;returnValue=chunk.tap(function(data){dustBodyOutput+=data;return""}).render(input,context);chunk.untap();if(returnValue.constructor!==chunk.constructor){return returnValue}else{if(dustBodyOutput===""){return false}else{return dustBodyOutput}}},sep:function(chunk,context,bodies){var body=bodies.block;if(context.stack.index===context.stack.of-1){return chunk}if(body){return bodies.block(chunk,context)}else{return chunk}},idx:function(chunk,context,bodies){var body=bodies.block;if(body){return bodies.block(chunk,context.push(context.stack.index))}else{return chunk}},contextDump:function(chunk,context,bodies,params){var p=params||{},to=p.to||"output",key=p.key||"current",dump;to=dust.helpers.tap(to,chunk,context);key=dust.helpers.tap(key,chunk,context);if(key==="full"){dump=JSON.stringify(context.stack,jsonFilter,2)}else{dump=JSON.stringify(context.stack.head,jsonFilter,2)}if(to==="console"){_console.log(dump);return chunk}else{return chunk.write(dump)}},"if":function(chunk,context,bodies,params){var body=bodies.block,skip=bodies["else"];if(params&&params.cond){var cond=params.cond;cond=dust.helpers.tap(cond,chunk,context);if(eval(cond)){if(body){return chunk.render(bodies.block,context)}else{_console.log("Missing body block in the if helper!");return chunk}}if(skip){return chunk.render(bodies["else"],context)}}else{_console.log("No condition given in the if helper!")}return chunk},math:function(chunk,context,bodies,params){if(params&&typeof params.key!=="undefined"&&params.method){var key=params.key,method=params.method,operand=params.operand,round=params.round,mathOut=null,operError=function(){_console.log("operand is required for this math method");return null};key=dust.helpers.tap(key,chunk,context);operand=dust.helpers.tap(operand,chunk,context);switch(method){case"mod":if(operand===0||operand===-0){_console.log("operand for divide operation is 0/-0: expect Nan!")}mathOut=parseFloat(key)%parseFloat(operand);break;case"add":mathOut=parseFloat(key)+parseFloat(operand);break;case"subtract":mathOut=parseFloat(key)-parseFloat(operand);break;case"multiply":mathOut=parseFloat(key)*parseFloat(operand);break;case"divide":if(operand===0||operand===-0){_console.log("operand for divide operation is 0/-0: expect Nan/Infinity!")}mathOut=parseFloat(key)/parseFloat(operand);break;case"ceil":mathOut=Math.ceil(parseFloat(key));break;case"floor":mathOut=Math.floor(parseFloat(key));break;case"round":mathOut=Math.round(parseFloat(key));break;case"abs":mathOut=Math.abs(parseFloat(key));break;default:_console.log("method passed is not supported")}if(mathOut!==null){if(round){mathOut=Math.round(mathOut)}if(bodies&&bodies.block){return chunk.render(bodies.block,context.push({isSelect:true,isResolved:false,selectKey:mathOut}))}else{return chunk.write(mathOut)}}else{return chunk}}else{_console.log("Key is a required parameter for math helper along with method/operand!")}return chunk},select:function(chunk,context,bodies,params){var body=bodies.block;if(params&&typeof params.key!=="undefined"){var key=dust.helpers.tap(params.key,chunk,context);if(body){return chunk.render(bodies.block,context.push({isSelect:true,isResolved:false,selectKey:key}))}else{_console.log("Missing body block in the select helper ");return chunk}}else{_console.log("No key given in the select helper!")}return chunk},eq:function(chunk,context,bodies,params){if(params){params.filterOpType="eq"}return filter(chunk,context,bodies,params,function(expected,actual){return actual===expected})},ne:function(chunk,context,bodies,params){if(params){params.filterOpType="ne";return filter(chunk,context,bodies,params,function(expected,actual){return actual!==expected})}return chunk},lt:function(chunk,context,bodies,params){if(params){params.filterOpType="lt";return filter(chunk,context,bodies,params,function(expected,actual){return actual<expected})}},lte:function(chunk,context,bodies,params){if(params){params.filterOpType="lte";return filter(chunk,context,bodies,params,function(expected,actual){return actual<=expected})}return chunk},gt:function(chunk,context,bodies,params){if(params){params.filterOpType="gt";return filter(chunk,context,bodies,params,function(expected,actual){return actual>expected})}return chunk},gte:function(chunk,context,bodies,params){if(params){params.filterOpType="gte";return filter(chunk,context,bodies,params,function(expected,actual){return actual>=expected})}return chunk},"default":function(chunk,context,bodies,params){if(params){params.filterOpType="default"}return filter(chunk,context,bodies,params,function(expected,actual){return true})},size:function(chunk,context,bodies,params){var key,value=0,nr,k;params=params||{};key=params.key;if(!key||key===true){value=0}else{if(dust.isArray(key)){value=key.length}else{if(!isNaN(parseFloat(key))&&isFinite(key)){value=key}else{if(typeof key==="object"){nr=0;for(k in key){if(Object.hasOwnProperty.call(key,k)){nr++}}value=nr}else{value=(key+"").length}}}}return chunk.write(value)}};dust.helpers=helpers})(typeof exports!=="undefined"?module.exports=require("dustjs-linkedin"):dust);(function(e){var f=/^ *(\w+) +in +([$_a-zA-Z][.$_\w]*)/;var h=/^\//;var d=/ctx\.(?:get\("(.*?)"\)|getPath\(false,\["(.*?)"\]\)),ctx,"h"(?:,\["(.*?)"\])?/;var k=/","/g;var b=/^\s|\s(?=\s|$)/g;var l=e.helpers["if"].bind(e.helpers);var i=e.helpers.eq.bind(e.helpers);var j=e.helpers.select.bind(e.helpers);var g=e.helpers.tap.bind(e.helpers);function m(n){return n===~~n}function a(o){if(typeof o!="function"){return o}o=o.toString();var n="";var q=/(?:reference\((.*?)\)|write\("(.*?)"\))[.;]/g;var p;var r;while(!!(p=q.exec(o))){if(p[1]){r=p[1].match(d);if(r){if(r[1]){n+=" {"+r[1]}else{if(r[2]){n+=" {"+r[2].replace(k,".")}}if(r[3]){n+="|"+r[3].replace(k,"|")}n+="} "}}else{if(p[2]){n+=p[2]}}}return n.replace(b,"")}function c(p,n){var o=n.split(".");while(p&&o.length>0){p=p[o.shift()]}return p}if(typeof console=="undefined"){console={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){}}}e.helpers["if"]=function(o,p,n,r){try{return l(o,p,n,r)}catch(q){console.error("Error in @if statement: "+q.name+": "+q.message+".",'Condition "'+a(r.cond)+'"','evaluated to "'+g(r.cond,o,p)+'".');return o}};e.helpers.select=function(o,q,n,r){var p=g(r.key,o,q);if(p==0){if(p==="0"){r.key=0}}else{if(p==+p){r.key=+p}}return j(o,q,n,r)};e.helpers.eq=function(o,q,n,s){var p=g(s.key,o,q);var r=g(s.value,o,q);if(p==+p){s.key=+p}if(r==+r){s.value=+r}return i(o,q,n,s)};e.helpers.contains=function(o,p,n,r){if(!(r.collection&&r.collection.indexOf)){console.error("@contains helper requires a valid 'collection' parameter");return o}var q=g(r.value,o,p);if(typeof q=="undefined"){console.error("@contains requires a 'value' parameter");return o}if(~r.collection.indexOf(q)){return n.block(o,p)}return n["else"]?n["else"](o,p):o};e.helpers.range=function(w,o,n,r){var q=+g(r.begin,w,o);if(!m(q)){q=0}var s=+g(r.end,w,o);if(!m(s)){console.error("@range requires an integral 'end' parameter")}var p=+g(r.step,w,o);if(!m(p)){p=(s-q)/Math.abs(s-q)}var t=p>0;try{for(var u=q;t?u<s:u>s;u=u+p){o.stack.head.$val=u;n.block(w,o)}}catch(v){console.error("Error in @range block",v.message)}delete o.stack.head.$val;return w};e.helpers.truncate=function(o,p,n,t){var s=e.escapeHtml(g(t.value,o,p))||"";var q=g(t.length,o,p)||100;var r=s.length<=q?s:(s.slice(0,q-3).replace(/(?:\s*\&\S*|\s+)$/,"")+"...");return o.write(r)};e.helpers.localizeInt=function(o,q,n,u){var s=g(u.val,o,q)||0;var r=s.toString().split("");if(r.length>3){r.reverse();s="";var t=",";if(q.global.LOCALE=="de"||q.global.LOCALE=="it"||q.global.LOCALE=="nl"||q.global.LOCALE=="br"||q.global.LOCALE=="sv"){t="."}else{if(q.global.LOCALE=="fr"||q.global.LOCALE=="pl"||q.global.LOCALE=="es"||q.global.LOCALE=="in"){t=" "}}for(var p=0;p<r.length;p++){s=r[p]+s;if(p%3==2&&p<r.length-1){s=t+s}}}return o.write(s)};e.helpers.quotes=function(r,s,p,t){t=t||{};var q=g(t.italics,r,s)||"";var n=s.global.IS_RTL?"&#x201d;":"&#x201c;";var o=s.global.IS_RTL?"&#x201c;":"&#x201d;";if(q=="true"){n="<i>"+n+"</i>";o="<i>"+o+"</i>"}r.write(n);p.block(r,s);return r.write(o)};e.helpers.fbPic=function(o,q,n,r){var s=g(r.id,o,q);var p=g(r.size,o,q);o.write("<img ");if(s){o.write('src="//graph.facebook.com/'+s+"/picture?type=square");if(p){o.write("&width="+p+"&height="+p)}o.write('" ')}n.block(o,q);return o.write("/>")};e.helpers.img=function(o,p,n,r){var q=g(r.src,o,p);o.write("<img ");if(q){if(!h.test(q)){q="/"+q}o.write('src="'+p.global.CDN_HOST+q+'" ')}if(n.block){n.block(o,p)}return o.write("/>")};e.helpers.fittedImg=function(y,s,p,v){var o=g(v.src,y,s);var u=g(v.height,y,s);var r=g(v.width,y,s);var q=o.url;var x=o.height;var w=o.width;var n="";var z="";var t;if(w==0||x==0){n='style= "width:'+r+"px; height: "+u+'px;" '}else{if(u/x<r/w){t=r/w;x=Math.floor(x*t);w=r;z=Math.floor((x-u)/2)*-1;n='style= "width:'+w+"px; height: "+x+"px; margin-top: "+z+'px;" '}else{t=u/x;w=Math.floor(w*t);x=u;z=Math.floor((w-r)/2)*-1;n='style= "width: '+w+"px; height: "+x+"px; margin-left: "+z+'px; "'}}y.write('<div style="height:'+u+"px; width:"+r+'px; overflow: hidden;" >');if(q){y.write('<img src="'+q+'" '+n+"/>")}p.block(y,s);return y.write("</div>")};e.helpers.lazyimg=function(p,q,o,s){var n=g(s["class"],p,q);var r=g(s.src,p,q);p.write('<img class="lazy '+(n?n:"")+'" ');if(r){if(typeof window=="undefined"){p.write('data-src="'+r+'" ')}else{p.write('src="'+r+'" ')}}o.block(p,q);return p.write("/>")};e.helpers.avatarWithFBOverlay=function(q,r,o,s){var p=g(s.avatar,q,r);var t=g(s.id,q,r);var n=g(s["class"],q,r);q.write('<div class="avatar-with-overlay '+n+'" ');if(p){q.write('style="background-image: url('+p+')">')}else{q.write('style="background-image: url(//graph.facebook.com/'+t+'/picture?type=square)">')}q.write('<img src="'+r.global.CDN_HOST+'/img2/social/social_on_mobile/fb_icon_20x20.png" ');q.write('class="overlay" />');return q.write("</div>")};e.helpers.avatar=function(q,r,o,s){var p=g(s.avatar,q,r);var t=g(s.id,q,r);var n=g(s["class"],q,r);q.write('<div class="avatar '+n+'" ');if(p){q.write('style="background-image: url('+p+')">')}else{q.write('style="background-image: url(//graph.facebook.com/'+t+'/picture?type=square)">')}return q.write("</div>")};e.helpers.pos=function(p,q,n,r){var o=r&&r.start!=null?r.start:1;if(q.stack){q.stack.head.$pos=q.stack.index+o}if(n&&n.block){n.block(p,q)}return p};e.helpers.bubbleRating=function(q,r,p,t){var s=e.helpers.tap(t.value,q,r);var u=e.helpers.tap(t.ratingType,q,r)||"ss";var n=s?(s.toString().length==1?s.toString()+"0":s*10):null;var o=e.helpers.tap(t["class"],q,r);s=+s;q.write('<div class="rate rate_'+u+" "+u+n+" "+(o?o:"")+'">');q.write("<img ");q.write('src="'+r.global.CDN_HOST+'/img2/sprites/ratings-v6.png" ');q.write('class="sprite-ratings" property="v:rating" alt="');q.write(s+' of 5 stars" content="'+s+'" />');return q.write("</div>")};e.helpers.bubbleRatingSvg=function(o,p,n,s){var r=e.helpers.tap(s.value,o,p);var t=+e.helpers.tap(s.multiplier,o,p)||20;var q=r*t;q=q<0?0:q>100?100:q;o.write('<div class="svgico bubblesempty">');o.write('<div class="bubbles" style="width:'+q+'%;"><div class="svgico bubblesfull"></div></div>');return o.write("</div>")};e.helpers.removeNonDigits=function(o,p,n,r){var q=g(r.value,o,p);return o.write(q.replace(/[^0-9]/g,""))};e.helpers.digitize=function(t,o,n,q){var v=+g(q.value,t,o);var s=+g(q.padding,t,o);var p=m(v)?v.toString().split(""):[];if(!m(s)){s=0}var u=s-p.length;if(u>0){while(u--){p.unshift("0")}}for(var r=0;r<p.length;r++){n.block(t,e.makeBase({digit:p[r]}))}return t};e.helpers.oxEach=function(t,n,s,A){if(n.stack.tail&&!(n.stack.head&&n.stack.head.__ox__)){console.error("Cannot call @oxEach within a section block");return t}var D=g(A.context,t,n);var r=D.match(f);var y=r[1];var v=r[2].split(".");var u=n.get(v[0]);var x;for(x=1;u&&x<v.length;x++){u=u[v[x]]}if(!u){return t}var E=g(A.name,t,n)||("each"+y.charAt(0).toUpperCase()+y.slice(1));var q="begin" in A||"end" in A;var B=+g(A.begin,t,n);if(!m(B)||B<0){B=0}var o=+g(A.end);o=isNaN(o)?null:o;if(o!=null&&(!m(o)||o<B)){console.error("Invalid @oxEach end index in collection"+v);o=null}var p=u.__offset__||0;t.write('<!-- @oxEach name="'+E+'" context="'+D+'"');if(q){t.write(' begin="'+B+'"');if(o!=null){t.write(' end="'+o+'"')}}t.write(" -->\n");B=B-p;if(o!=null){o=Math.min(o-p,u.length)}else{o=u.length}for(x=B;x<o;x++){var z=u[x];if(!z){console.error("@oxEach requires non-null items in collection "+v);break}var C={};for(var w in n.stack.head){C[w]=n.stack.head[w]}C[y]=z;C.$idx=x+p;C.$idx1=C.$idx+1;C.__ox__=true;C=n.rebase(C);s.block(t,C)}t.write("<!-- /oxEach -->\n");return t};e.helpers.oxContains=function(o,q,n,t){if(!(t.collection&&t.collection.indexOf)){console.error("@oxContains helper requires a valid 'collection' parameter");return o}var p=g(t.key,o,q);if(typeof p=="undefined"){console.error("@oxContains requires a 'key' parameter");return o}var s=g(t.value,o,q);if(typeof s=="undefined"){console.error("@oxContains requires a 'value' parameter");return o}var r=function(u){return u!=null&&c(u,p)==s};if(t.collection.filter(r).length>0){return n.block(o,q)}return n["else"]?n["else"](o,q):o};e.helpers.ifChanged=function(p,r,o,t){var s=t.collection;if(!(s&&s.indexOf)){console.error("@ifChanged helper requires a valid 'collection' parameter");return p}var q=g(t.key,p,r);if(typeof q=="undefined"){console.error("@ifChanged requires a valid 'key' parameter");return p}var n=+g(t.idx,p,r);if(!m(n)){console.error("@ifChanged requires a valid 'idx' parameter");return p}if(n<1||c(s[n],q)!=c(s[n-1],q)){return o.block(p,r)}return o["else"]?o["else"](p,r):p};e.helpers.oxSection=function(s,o,n,q){var p=g(q.namespace,s,o);var r=g(q.nsid,s,o);var v=g(q.tag,s,o)||"div";if(typeof p==="undefined"){console.error("@oxSection requires a valid 'namespace' parameter");return s}s.write("<"+v+' data-ox-section-name="'+p+'"');if(typeof r!=="undefined"){s.write(' data-ox-section-id="'+r+'"')}for(var u in q){if(u==="namespace"||u==="nsid"||u==="tag"){continue}var t=g(q[u],s,o);if(typeof u==="undefined"||typeof t==="undefined"){console.error("@oxSection key or value is undefined: "+u);continue}s.write(" "+u+'="'+t+'"')}s.write(" />\n");n.block(s,o);s.write("</"+v+">\n");return s};e.helpers.substr=function(w,x,n,r){var v=e.escapeHtml(e.helpers.tap(r.str,w,x))||"",o=e.helpers.tap(r.begin,w,x)||0,s=e.helpers.tap(r.end,w,x)||v.length,t=e.helpers.tap(r.len,w,x)||v.length,p=e.helpers.tap(r.underflow,w,x)||"",q=e.helpers.tap(r.overflow,w,x)||"";var u=(o==0?"":p)+(t<s-o?v.substr(o,t)+q:v.slice(o,s));return w.write(u)}}(dust));(function(h){var r=h.helpers.tap.bind(h.helpers),q="__ttParentContext",t="dustTree",g="\\",n="/",a=/^([A-Z]{1,2}:)?[\\$-.\a-zA-Z_0-9|]+$/,l=/\\+$/,b=function(u){return u.global.__treeString},e=function(u){return u.global.__incrementingCounters},s=function(v,u,w){if(!v.global.__incrementingCounters){v.global.__incrementingCounters={}}v.global.__incrementingCounters[u]=w},k=function(v){var u=v.global.__treeString;v.global.__treeString=null;v.global.__incrementingCounters={};return u},j=function(v){var u=b(v),w=v.global[q];if(u!=null){return}u=v.global.__treeString=[];v.global.__incrementingCounters={};if((typeof w==="string"||w instanceof String)&&w.length>0){if(w[w.length-1]===g){u.push(w.substring(0,w.length-1));u.push(g)}else{u.push(w)}}},m=function(v,w,u){if(u&&u.block){u.block(v,w)}},p=function(v,u,w){if(u&&u.block&&v){v.write(w)}},f=function(y,w,x,v){var u=b(x),z=u.length;if(z===0||u[z-1]===g){u.push(y)}else{u.push(n);u.push(y)}p(w,v,"<!--trk"+y+"-->")},c=function(v,w,u){b(w).push(g);p(v,u,"<!--etk-->")},o=function(y,v,w,u){var x=d(y);j(w);if(x){f(y,v,w,u)}m(v,w,u);if(x){c(v,w,u)}return v},i=function(v){var u=b(v);return u?u.join(""):""},d=function(u){return(typeof u==="string"||u instanceof String)&&a.test(u)};h.helpers.track=function(v,w,u,y){if(y&&y.noTrack){m(v,w,u);return v}var x=r(y&&y.name,v,w);return o(x,v,w,u)};h.helpers.trackTree=function(w,y,v,B){var A,x=r(B&&B.name,w,y),u=k(y),z=t;j(y);m(w,y,v);A=i(y);if(w&&w.write){if(x){z=z+" "+x}w.write("<div class='"+z+"' data-tree='"+A+"'></div>")}y.global.__treeString=u;return w};h.helpers.trackWithIncrementingValue=function(w,x,u,B){var y,z,A=r(B&&B.name,w,x),v=window.ta&&ta.retrieve&&ta.store?ta.retrieve("dust.continue_inc_track"):null;if(A&&A.indexOf(":")<0){y=e(x);if(!y){return}if(!y[A]){if(v&&v[A]){z=v[A]+1}else{z=1}}else{z=y[A]+1}s(x,A,z);A=A+":"+z;if(v){ta.store("dust.continue_inc_track",y)}}return o(A,w,x,u)};h.tracking={TREE_CLASS:t,setParentTree:function(v,u){if(u&&u.global){u.global[q]=v}},cleanTree:function(u){return u?u.replace(l,""):u}}}(dust));(function(f,e,g){var a=null,d=function(){if(a!=null){return a}try{a=JSON.parse(ta.retrieve("dustGlobalContext"));return a}catch(h){}return{}},c=function(j,l,h,n){var k=d(),m=f.find(h),i=e.makeBase(k).rebase(l);if(!m||!j||!k.LOCALE||!e){return false}e.render(b(j),i,function(p,o){if(o){m.innerHTML=o}else{if(p){ta.util.error.record(p,"Error rendering dust template "+j)}}if(n){n(l)}});return true},b=function(h){var i=h.replace(/\//g,"_").replace(".dust",""),j=d().LOCALE;return j+i};f.dust={render:c}})(ta,dust);ta.util.cookie={expireTimeForPID:5,expireTimeForPID_remove:0,cookiePIDName:"NPID",setPIDCookie:function(a){try{Cookie.write(ta.util.cookie.cookiePIDName,a,{domain:cookieDomain,time:ta.util.cookie.expireTimeForPID})}catch(b){var c="";if(typeof cookieDomain!="undefined"){c=cookieDomain}ta.util.error.record(b,"set pid cookie",null,{pid:a,cookieDomain:c})}},removePIDCookie:function(){try{Cookie.write(ta.util.cookie.cookiePIDName,"",{domain:cookieDomain,time:ta.util.cookie.expireTimeForPID_remove})}catch(a){}},openWindowWithPID:function(b,a){if(a){ta.util.cookie.setPIDCookie(a)}window.open(b,"_blank");ta.util.cookie.removePIDCookie()},setAjaxAction:function(c,a){if(c[0]!="/"){c="/"+c}c="target:"+c;try{var f=Array.from(arguments).join("|");Cookie.write("ajaxAction",f,{domain:cookieDomain,path:"/"})}catch(b){var d="";if(typeof cookieDomain!="undefined"){d=cookieDomain}ta.util.error.record(b,"set pid cookie",null,{pid:pid,cookieDomain:d})}},setPID:function(b,a){if(ta.id(a).get("tag")!="a"){a=a.getParent("a")}if(pid=a.className.match(/pid(\d+)/)){ta.util.cookie.setPIDCookie(pid[1])}},setPIDNoA:function(a){pid=a.className.match(/pid(\d+)/);if(pid){ta.util.cookie.setPIDCookie(pid[1])}},showCookieBanner:function(){try{var b=ta.id("COOKIE_BANNER"),c=$(document.body);if(b&&c){b.inject(c,"top");b.setStyles({position:"fixed",top:-3000,left:-3000});b.show();var a=b.getHeight();b.setStyle("margin-top",0-a);b.hide();b.setStyles({top:0,left:0,position:"relative"});b.show();b.set("tween",{duration:"long"});b.tween("margin-top",0);Cookie.write("cookieconsent","1",{duration:3600})}}catch(d){ta.util.error.record(d,"ta.util.cookie.showCookieBanner")}}};setPID=ta.util.cookie.setPIDCookie;ta.util.ASDF={asdf:function(b,a){if(a){ta.util.cookie.setPIDCookie(a)}window.location=asdf(b)},asdfPxlAndPid:function(d,b,a){var e="http://ad.doubleclick.net/ad/";var c=";sz=1x1";if(a){ta.util.cookie.setPIDCookie(a)}if(b){new Element("img",{src:e+b+c})}window.location=asdf(d)},asdfPopup:function(b,a){if(a){ta.util.cookie.setPIDCookie(a)}ta.servlet.Popup.open(asdf(b))},asdfPopupEmail:function(a){ta.servlet.Popup.open(asdf(a),"email",580,460,30,25)},asdfPopupGuide:function(a){ta.servlet.Popup.open(asdf(a),"dest_guide",565,700,(screen.width-700)/2,(screen.height-600)/2)},asdfPopupTerms:function(a){ta.servlet.Popup.open(asdf(a),"terms",300,300,30,25)},asdfPopupDir:function(a){new Request({url:"/ActionRecord?action=getDirectionsListings"}).send();ta.servlet.Popup.open(asdf(a),null,800,600)},asdfDcd:function(a){return asdf(a)}};function getOffset(a){if(a>=97&&a<=122){return a-61}if(a>=65&&a<=90){return a-55}if(a>=48&&a<=71){return a-48}return -1}function asdf(d){var g={"":["&","=","p","6","?","H","%","B",".com","k","9",".html","n","M","r","www.","h","b","t","a","0","/","d","O","j","http://","_","L","i","f","1","e","-","2",".","N","m","A","l","4","R","C","y","S","o","+","7","I","3","c","5","u",0,"T","v","s","w","8","P",0,"g",0],q:[0,"__3F__",0,"Photos",0,"https://",".edu","*","Y",">",0,0,0,0,0,0,"`","__2D__","X","<","slot",0,"ShowUrl","Owners",0,"[","q",0,"MemberProfile",0,"ShowUserReviews",'"',"Hotel",0,0,"Expedia","Vacation","Discount",0,"UserReview","Thumbnail",0,"__2F__","Inspiration","V","Map",":","@",0,"F","help",0,0,"Rental",0,"Picture",0,0,0,"hotels",0,"ftp://"],x:[0,0,"J",0,0,"Z",0,0,0,";",0,"Text",0,"(","x","GenericAds","U",0,"careers",0,0,0,"D",0,"members","Search",0,0,0,"Post",0,0,0,"Q",0,"$",0,"K",0,"W",0,"Reviews",0,",","__2E__",0,0,0,0,0,0,0,"{","}",0,"Cheap",")",0,0,0,"#",".org"],z:[0,"Hotels",0,0,"Icon",0,0,0,0,".net",0,0,"z",0,0,"pages",0,"geo",0,0,0,"cnt","~",0,0,"]","|",0,"tripadvisor","Images","BookingBuddy",0,"Commerce",0,0,"partnerKey",0,"area",0,"Deals","from","\\",0,"urlKey",0,"'",0,"WeatherUnderground",0,"MemberSign","Maps",0,"matchID","Packages","E","Amenities","Travel",".htm",0,"!","^","G"]};var b="";for(var a=0;a<d.length;a++){var h=d.charAt(a);var e=h;if(g[h]&&a+1<d.length){a++;e+=d.charAt(a)}else{h=""}var f=getOffset(d.charCodeAt(a));if(f<0||typeof g[h][f]=="String"){b+=e}else{b+=g[h][f]}}return b};ta.util.Doer={doit:function(e,d){var c="/"+e;var b=0;for(var a in d){if(b===0){c+="?"}else{c+="&"}c+=a+"="+d[a];b++}return c},aimdoit:function(j,c,a,k){var b=ta.util.Doer.doit(j,c);new Event(a).preventDefault();var i=475;var d=390;var g=210;var f=5;if(k){i=980;d=800;g=240}else{if(screen.width>=1024&&screen.height>=768&&c&&(c.area.indexOf("Text")!=-1||c.area.indexOf("Thumbnail")!=-1)){i=900;d=768;g=240}else{if(screen.width>1024){i=800;d=600;g=240}else{if(screen.width>800){i=620;d=500;g=240}}}}ta.store("commerce.AIMWindow",ta.servlet.Popup.open(b,null,i,d,g,f,false,true));if(ta.retrieve("isDaoDao")){if(ta.retrieve("checkrates.check_more_re")){dd.commerce.checkrates.checkMorePopupAIM(a,c)}}else{var e=ta.retrieve("meta.popProPhotosCRLeavebehind")&&!ta.widgets.calendar.hasPageDates()&&c&&c.area!="Icon_Amenities";if(ta.retrieve("checkrates.isCRLB")&&!ta.id("CHECK_RATES_LB")&&(!ta.retrieve("checkrates.meta_ui_post_click_prices")||e)){ta.run("ta.overlays.Factory.loadCheckRatesLBOverlay",{},a,null,c)}}},tadoit:function(d,b,c,a){window.location=ta.util.Doer.tadoless(d,b,c,a)},tadoless:function(g,c,f,j,b){var a="/"+g;for(var h in c){a+="-"+h+c[h]}var e=f.length;for(var d=0;d<e;d++){a+="-"+f[d]}if(!b){a+=".html"}if(j.length>0){a+=j}return a}};ta.util.pending={};ta.util.pending.waitForMore=function(e,c,a,b,d){if(ta.has("pending."+e)){ta.util.pending.cancel(e)}ta.store("pending."+e,{timer:c.delay(a,d,b),fn:c,t:"m",n:a})};ta.util.pending.waitForFn=function(id,fn){try{var tmp=eval(fn),data;if(tmp){if(typeOf(tmp)==="function"){if(ta.has("pending.callback."+id)){ta.retrieve("pending.callback."+id)()}else{if(ta.has("pending."+id)){data=ta.retrieve("pending."+id);if(data.evnt){tmp.attempt([data.evnt,data.elmt])}else{tmp.attempt()}}else{tmp.attempt()}}}else{if(IS_DEBUG){alert("fn is not a function: "+typeOf(tmp))}}}else{ta.util.pending.waitForFnAgain(id,fn)}}catch(e){ta.util.pending.waitForFnAgain(id,fn)}};ta.util.pending.WAIT_DELAY=100;ta.util.pending.WAIT_TIMEOUT=50;ta.util.pending.waitForFnAgain=function(c,a){var b=ta.has("pending."+c)?ta.retrieve("pending."+c):{t:"f",fn:a,count:1};if(b.count<ta.util.pending.WAIT_TIMEOUT){b.count++;b.timer=ta.util.pending.waitForFn.invokeLater(ta.util.pending.WAIT_DELAY,null,[c,a]);ta.store("pending."+c,b)}else{if(IS_DEBUG&&!ta.has("pending.ignore."+c)){alert("timed out ("+(ta.util.pending.WAIT_TIMEOUT*ta.util.pending.WAIT_DELAY)+"ms) waiting for function: "+a)}}};ta.util.pending.waitForFile=function(c,a,b){if(ta.load(a)){ta.util.pending.waitForFn(c,b)}};ta.util.pending.waitForHandler=function(d,b,c,a){ta.store("pending."+d,{count:0,t:"f",fn:b,evnt:c,elmt:a});ta.util.pending.waitForFn(d,b)};ta.util.pending.cancel=function(b){var a=ta.remove("pending."+b);if(a&&a.timer){clearTimeout(a.timer)}};ta.util.pending.lock=function(d,b,c,a){if(ta.has("pending."+d)){return[a,false].pick()}ta.store("pending."+d,true);if(c){ta.util.pending.unlock.delay(c,null,d)}return b()};ta.util.pending.unlock=function(b){var a=ta.remove("pending."+b);if(a&&typeof a==="object"){a.count--;if(a.count===0){a.fn()}else{ta.store("pending."+b,a)}}};ta.util.pending.multilock=function(c,a,b){ta.store("pending."+c,{count:b,fn:a})};ta.util.pending.multilockUpdate=function(d,c){var b="pending."+d,a=ta.retrieve(b);if(a){a.count+=c}};ta.util.pending.wait=function(e,c,b,d,a){ta.store("pending."+e,{timer:c.delay(b,d,a)})};ta.util.pending.waitForElement=function(d,a,c){if(ta.has("pending."+d)){return}var b=$(a);if(b){ta.util.pending.cancel("pending."+d);c(b)}else{ta.store("pending."+d,{timer:ta.util.pending.waitForElement.delay(2,null,[d,a,c])})}};ta.util.pending.waitFor=function(a,c,b){if(a()){return c()}setTimeout(function(){ta.util.pending.waitFor(a,c,b)},b);return false};ta.util.load={loadedMap:false,loadingMap:false,callbacks:[]};ta.util.load.GMaps=function loadGMaps(a){return ta.util.load.maps(a)};ta.util.load.maps=function(a){if(ta.util.load.loadedMap){a&&a()}else{if(ta.util.load.loadingMap){ta.util.load.callbacks.push(a)}else{ta.util.load.loadingMap=true;return ta.maps.load.library(function(){ta.util.load.loadedMap=true;ta.util.load.loadingMap=false;a&&a();ta.util.load.callbacks.each(function(b){b&&b()})})}}};ta.util.load.mapsLazy=function(a){return ta.run("ta.maps.load.library",{},a)};function _loadMapsV2(d,c,e){d=d||[];var b=ta.remove("infobox_js");if(b){var a=1+d.length;var f=function(){a--;if(!a){c()}};if(!ta.load(e,function(){ta.util.load.maps(function(){Asset.javascript((b),{onLoad:f})})})){ta.util.error("Rollup file was not found: ",e)}d.each(function(g){Asset.css(g,{onLoad:f})})}else{ta.util.error("'infobox_js' path was not specified for this page")}}ta.util.load.loadMapV2Lite=function(a,b){_loadMapsV2(b,a,"ta-mapsv2-lite")};ta.util.load.loadMapV2=function(a,b){_loadMapsV2(b,a,"ta-mapsv2")};ta.util.load.GoogleLoader=function(a){if(ta.has("googleloader.state")){if(ta.retrieve("googleloader.state")=="loaded"){return a()}else{return ta.util.load.GoogleLoader.delay(500,this,a)}}else{ta.store("googleloader.state","loading");ta.store("googleloader.callback",a);new Asset.javascript("//www.google.com/jsapi?callback=ta.util.load.GoogleLoaderCallback")}};ta.util.load.GoogleLoaderCallback=function(){ta.store("googleloader.state","loaded");var a=ta.remove("googleloader.callback");a()};ta.util.load.LocalSearch=function(a){ta.util.load.GoogleLoader(function(){google.load("search","1",{callback:function(){}})})};ta.util.date={};ta.util.date.MS_IN_DAY=1000*60*60*24;ta.util.date.DAYS_IN_MONTH=[31,28,31,30,31,30,31,31,30,31,30,31];ta.util.date.HOUR_CONST=12;ta.util.date.THAI_BUDDHIST_YEAR_OFFSET=543;ta.util.date.MAX_STAY_DURATION_DAYS=30;ta.util.date.MAX_DAYS_BEFORE_RETURN_FLIGHT=330;ta.util.date.inDateSet=function(c,b){if((c==null)||(b==null)){return false}var e=b.length;for(var d=0;d<e;d++){var f=b[d];if(f.length){var g=f[0].getTime();var a=f[1].getTime();if((g<=c.getTime())&&(a>=c.getTime())){return true}}else{if(c.getTime()==f.getTime()){return true}}}return false};ta.util.date.rangesIntersect=function(a,b){return Math.max(a[0].getTime(),b[0].getTime())<=Math.min(a[1].getTime(),b[1].getTime())};ta.util.date.getDaysInRange=function(b,a){return Math.round((a.getTime()-b.getTime())/ta.util.date.MS_IN_DAY)+1};ta.util.date.getLastDayOfMonth=function(a){var b=new Date();if(a){b=new Date(a.getTime())}b=new Date(ta.util.date.normalize(b));b.setDate(1);b.setMonth(b.getMonth()+1);b.setDate(0);return b.getDate()};ta.util.date.getDaysApart=function(c,b){var a=24*60*60*1000;if(c&&b){return Math.round(Math.abs((c.getTime()-b.getTime())/(a)))}return 0};ta.util.date.inSameMonth=function(b,a){return(b!=null)&&(a!=null)&&(b.getMonth()==a.getMonth())&&(b.getYear()==a.getYear())};ta.util.date.normalize=function(a){return a.setHours(ta.util.date.HOUR_CONST,0,0,0)};ta.util.date.create=function(c,a,b){return new Date(c,a,b,ta.util.date.HOUR_CONST)};ta.util.currency={};ta.util.currency.formatCurrency=function(d,a,h,b){var g=a?a:"USD";var c=currencySymbol[g];var f=d;if(!b){f=ta.util.currency.formatThousands(Math.round(d))}var e=c[0];if(h&&ta.util.currency.addSpace(e)){if(!c[1]){return e+" "+f}else{return f+" "+e}}if(!c[1]){return e+f}else{return f+e}};ta.util.currency.formatCurrencyRange=function(g,b,a,f){var e=a?a:"USD";var c=currencySymbol[e];var d=c[0];if(f&&ta.util.currency.addSpace(d)){g=ta.util.currency.formatThousands(Math.round(g));b=ta.util.currency.formatThousands(Math.round(b));return ta.util.currency.formatCurrency(g+" - "+b,a,true,true)}else{g=ta.util.currency.formatCurrency(g,a);b=ta.util.currency.formatCurrency(b,a);return g+" - "+b}};ta.util.currency.addSpace=function(a){return/^[a-zA-Z]+$/i.test(a)};ta.util.currency.formatThousands=function(b){if(typeof groupingSize=="undefined"||typeof groupingSeparator=="undefined"||groupingSize<1){return b}var a="";var d=""+b;for(var c=1;c<=d.length;c++){a=d.charAt(d.length-c)+a;if(c%groupingSize==0&&c<d.length){a=groupingSeparator+a}}return a};ta.util.currency.setCurrencyAndReload=function(a,b){var c="SetCurrency";Cookie.write(c,a,{time:15});b=b?b+"|":"";ta.trackEventOnPage("CurrencyPicker","Select",b+a);location.reload(true)};ta.util.Toggle={};ta.util.Toggle.siblings=function(c,b){c.preventDefault();var a=true;if(b.hasClass("closed")){a=false}b.toggleClass("closed sprite-arrow_toggle_blu_lft");b.getParent().getChildren().each(function(d){if(d!=b&&typeof d.hasClass!=="undefined"&&d.hasClass!=null&&!d.hasClass("ignore_toggle")){d.setStyle("display",a?"none":"block")}})};ta.util.Toggle.parentClass=function(c,a){c.preventDefault();var b=a.getParent(".toggle");b.toggleClass("off")};ta.util.Toggle.toggleTarget=function(d,b,c){d.preventDefault();var a=true;if($(b).hasClass("closed")){a=false}$(b).toggleClass("closed");$(b).toggleClass("open");$(c).setStyle("display",a?"none":"block")};ta.util.Toggle.toggleForm=function(b,d,c){var a=$(b).getParent(".formToggle");if(/sel_(\w+)/.test(a.className)){var e=RegExp.$1;a.removeClass("sel_"+e);a.getElement(".form_"+e).hide();var f=a.getElement(".header_"+e);if(f){f.hide()}}a.addClass("sel_"+d);var f=a.getElement(".header_"+d);if(f){f.show()}a.getElement(".form_"+d).show();return false};ta.util.Toggle.toggleLI=function(e,d,a){var c=e.getNext();for(var b=0;b<1000&&c&&c.id!=d.id;b++){if(a){c.show()}else{c.hide()}c=c.getNext()}if(a){e.hide()}else{e.show()}if(a){d.show()}else{d.hide()}};ta.util.Toggle.splitHotel=function(){var c=$$("#HOTEL_DESCRIPTION .descriptive_text").get("text").toString();var b=1000;if(c&&c.length>b){var a=c.substring(0,b);var d=c.substring(b,c.length);$$("#HOTEL_DESCRIPTION .descriptive_text").set("text",a);$$("#HOTEL_DESCRIPTION .description_ellipsis").show("inline");$$("#HOTEL_DESCRIPTION .more_description").show("inline");$$("#HOTEL_DESCRIPTION .descriptive_text_last").set("text",d)}};ta.util.Toggle.expandHotel=function(c,b){var a=b.getPrevious(".descriptive_text_last");var d=b.getNext(".less_description");b.hide();if(a){a.show("inline");a.getPrevious()&&a.getPrevious().hide()}d&&d.show("inline")};ta.util.Toggle.truncateHotel=function(c,b){var d=b.getPrevious(".more_description");var a=b.getPrevious(".descriptive_text_last");d&&d.show("inline");if(a){a.hide();a.getPrevious()&&a.getPrevious().show("inline")}b.hide()};ta.util.Toggle.toggleRecentReview=function(c,e,d){var b=c.getPrevious().getChildren();for(i=0;i<b.length;i++){var a=b[i];if(a.style.display=="none"){a.style.display=""}else{a.style.display="none"}}c.set("text",c.get("text").contains("<")?e+" > ":d+" < ")};ta.util.Toggle.expandList=function(c,a,f){try{var b=c.getChildren();if(b.length>a){for(i=a;i<b.length;i++){b[i].hide()}var g=new Element("span",{html:f,"class":"taLnk hvrIE6 moreLink",events:{click:function(){for(i=a;i<b.length;i++){b[i].show()}g.hide()}}});g.inject(c,"after")}}catch(d){ta.util.error.record(d,"Failed to Toggle.expandList")}};ta.util.URL={parse:function(c){if(/^(\w+):(.*)/.test(c)){c=RegExp.$2;switch(RegExp.$1){case"DOM":elmt=document.getElement(c);c=(elmt&&elmt.href)?elmt.href:"#";break;case"GMapsLC":if(c.length==0){break}tmp=c.split(",");ops={from:pageServlet,Action:tmp.shift()};tmp.each(function(d){if(/^g(\d+)$/.test(d)){ops.g=RegExp.$1}else{if("ext"==d){ops.ext="y"}else{if(/^(.*)=(.*)$/.test(d)){ops[RegExp.$1]=RegExp.$2}else{ops[d]=""}}}});c="/GMapsLocationController?"+Object.toQueryString(ops);break;case"ABS":var a=(window.location.port=="80"||window.location.port=="")?"":(":"+window.location.port);if(c.charAt(0)!="/"){c="/"+c}c=window.location.protocol+"//"+window.location.hostname+a+c;break;case"ABSPAGE":var a=(window.location.port=="80"||window.location.port=="")?"":(":"+window.location.port);if(c.charAt(0)!="/"){c="/"+c}c=window.location.protocol+"//"+window.location.hostname+a+c;if(c.indexOf(".html")==-1){c+=".html"}break;case"REL":var b=window.location.pathname.substring(0,window.location.pathname.lastIndexOf("/"));if(/\/$/.test(window.location.pathname)){b=window.location.pathname}var a=window.location.port=="80"?"":(":"+window.location.port);if(c.charAt(0)!="/"){c="/"+c}c=window.location.protocol+"//"+window.location.hostname+a+b+c;break;default:c=RegExp.$1+":"+c;break}}return c},getParameter:function(c,a){var b=new RegExp("[?&]"+a+"=([^&]+)");if(b.test(c)){return RegExp.$1}return false},getAbsoluteUrl:function(a){return location.protocol+"//"+location.hostname+a},https:function(a){a=a||"";if(a.indexOf("http")===-1){a=ta.util.URL.getAbsoluteUrl(a)}if(a.indexOf("https://")===0){return a}if(ta.retrieve("access_control_headers")){return a.replace("http://","https://")}return a},getServletNameFromUrl:function(a){return/^(?:\w+:\/\/.*)?\/([^-?]*).*/.exec(a)&&RegExp.$1}};ta.util.i18n={};ta.util.i18n.isRtl=function(){return ta.id(document.body).hasClass("rtl")};ta.util.element={};ta.util.element.replaceContent=function(f,e,c){var d=f;var b=e;if(!b.getElement(".progresstab")){var a=c+(c.indexOf("?")==-1?"?":"&")+"xhr=true";var g=new Element("div",{"class":"progresstab"});g.inject(b);new Request({url:a,onSuccess:function(h,i){b.empty();b.innerHTML=h;if(window.behavior){window.behavior.apply(b)}b.fireEvent("onContentReplaced",[d,b])},evalScripts:true}).get()}};ta.util.element.trackIfMapView=function(){if(ta.retrieve("maps_v2_open")){ta.trackEventOnPage("QC_Meta_Map_Detail","map_open")}};ta.util.element.spinner=function(b,a){$(a).getParent(".spinnerReplaceable").getChildren().each(function(c){if(c.hasClass("spinner")){c.show()}else{c.hide()}})};ta.util.element.clearDefault=function(b,a){if(a.value==a.defaultValue){a.value=""}};ta.util.element.limitLength=function(b,a,c){if(a.value.length>=c){a.value=a.value.substr(0,c);return false}};ta.util.element.updateValue=function(a,b){if(a&&a.get("value")!=b){a.set("value",b);a.fireEvent("change",a)}};ta.util.element.moveContent=function(a,b){if(!a||!b){return}b.innerHTML=a.innerHTML;a.innerHTML=""};ta.util.element.keepInWindow=function(d,c){if(!d||!d.setStyle){return}if(!c){c={top:true,right:true,bottom:true,left:true}}function e(h,i){var j=parseInt(h.getStyle(i));return j||j===0}var g=2;var f=d.getCoordinates();var b=Window.getSize();var a=Window.getScroll();if(c.right&&e(d,"right")){if(f.left<a.x+g){d.setStyle("right",b.x+a.x-f.width-g)}else{if(f.right>b.x-a.x-g){d.setStyle("right",g)}}}else{if(c.left&&e(d,"left")){if(f.left<a.x+g){d.setStyle("left",g)}else{if(f.right>b.x-a.x-g){d.setStyle("left",b.x+a.x-f.width-g)}}}}if(c.bottom&&e(d,"bottom")){if(f.top<a.y+g){d.setStyle("bottom",b.y+a.y-f.height-g)}else{if(f.bottom>b.y-a.y-g){d.setStyle("bottom",g)}}}else{if(c.top&&e(d,"top")){if(f.top<a.y+g){d.setStyle("top",g)}else{if(f.bottom>b.y-a.y-g){d.setStyle("top",b.y+a.y-f.height-g)}}}}};ta.util.element.makeTextFit=function(o,k,g,j,c){c=c||1;j=j||8;var r=false;var q=ta.select(o);for(var h=0;h<q.length;h++){var i;var n;var f;if(parseInt(g)==g){i=g;n=i}else{f=q[h].getElement(g);if(!f){return}i=f.getSize();n=i.y}var a=q[h].getElement(k);if(!a){return}var p=a.getSize();if(n<p.y){var d=a.getStyle("font-size");if(d){var e=function(t,s){return(s=="px"&&t>=j)||(s=="em"&&t>=0.5)||(s=="pt"&&t>6)||(s=="%"&&t>=50)};var l=d.replace(/[\d\.]/g,"");var b=parseFloat(d)*Math.sqrt(n/p.y);if(l=="px"){b=Math.max(parseInt(b),j)}if(e(b,l)){a.setStyle("font-size",b+l);r=true}}}}if(r>0&&c<4){var m=this;setTimeout(function(){m.makeTextFit(o,k,g,j,c+1)},1)}};ta.util.element.makeTextFitOneLine=(function(){var a=4;var b=0.9;var c=function(d,e){fontSize=d.getStyle("font-size");newSize=parseFloat(fontSize)*e;unit=fontSize.replace(/[\d\.]/g,"");if(unit=="px"&&newSize<8){newSize=8}if(unit=="em"&&newSize<0.5){newSize=0.5}if(unit=="pt"&&newSize<6){newSize=6}if(unit=="%"&&newSize<50){newSize=50}d.setStyle("font-size",newSize+unit)};return function(g,d){var e=ta.select(g);e.forEach(function(k){var h=(parseFloat(k.getStyle("padding-left"))||0)+(parseFloat(k.getStyle("padding-right"))||0);for(var j=0;j<a&&k.scrollWidth>k.clientWidth;j++){var l=(k.clientWidth-h)/(k.scrollWidth-h);c(k,l)}if(k.scrollWidth>k.clientWidth){c(k,b)}});if(d){var f;e.forEach(function(i){var h=i.getStyle("font-size");if(!f||parseFloat(h)<parseFloat(f)){f=h}});e.forEach(function(h){h.setStyle("font-size",f)})}}})();ta.util.element.autoResizeTextInNode=(function(){var a=4;var b=0.9;var c=function(d,e){fontSize=d.getStyle("font-size");newSize=parseFloat(fontSize)*e;unit=fontSize.replace(/[\d\.]/g,"");if(unit=="px"&&newSize<8){newSize=8}if(unit=="em"&&newSize<0.5){newSize=0.5}if(unit=="pt"&&newSize<6){newSize=6}if(unit=="%"&&newSize<50){newSize=50}d.setStyle("font-size",newSize+unit)};ta.on("refreshedDOMContent",function(d){ta.util.element.autoResizeTextInNode(d)});ta.queueForLoad(function(){if(ta.id(document.body)){ta.util.element.autoResizeTextInNode(ta.id(document.body))}},"autoResize all targets on load");return function(e,d){if(!ta.id(e)){return}var f=ta.id(e).getElements(".autoResize");f.forEach(function(k){var h=(parseFloat(k.getStyle("padding-left"))||0)+(parseFloat(k.getStyle("padding-right"))||0);for(var j=0;j<a&&k.scrollWidth>k.clientWidth;j++){var l=(k.clientWidth-h)/(k.scrollWidth-h);c(k,l)}if(k.scrollWidth>k.clientWidth){c(k,b)}k.removeClass("autoResize")});if(d){var g;f.forEach(function(i){var h=i.getStyle("font-size");if(!g||parseFloat(h)<parseFloat(g)){g=h}});f.forEach(function(h){h.setStyle("font-size",g)})}}})();ta.util.element.makeSameWidth=function(a){var b=0;var c=document.getElements(a);if(c&&c.length>1){c.forEach(function(e){var d=Math.round(parseFloat(e.getStyle("width")));if(d&&d>b){b=d}});c.setStyle("width",b)}};ta.util.element.fitToContentsHorizontally=function(b,c,d,a){a=a||1;if(a<=0||c>d){return}var e=function(f){return f.scrollWidth>f.clientWidth||f.scrollHeight>f.clientHeight};ta.select(b).forEach(function(f){f.setStyle("width",c);for(var g=c;g<d&&e(f);g+=a){f.setStyle("width",g)}if(e(f)){f.setStyle("width",d)}})};ta.util.element.scrollIntoView=function(b,f,a,h){if(!b){return}var g=b.getPosition().y+(f||0);if(a&&Fx.Scroll){try{var c=b.getParent();while(c&&c!=document.body&&c.style.overflow!="auto"){c=c.getParent()}}catch(d){c=null}if(!c||c==document.body||c.style.overflow!="auto"){c=window}(new Fx.Scroll(c,{wait:false,duration:300,onComplete:function(){h&&h()}})).start(0,g)}else{window.scrollTo(0,g);h&&h()}};ta.util.element.isScrolledIntoView=function(d,g){if(!d){return false}var f;try{f=d.getBoundingClientRect()}catch(c){return false}var e=f.bottom;var b=f.top;if(g){var a=g.offsetHeight;var h=g.getPosition();if(a){if(h&&h.y==0){e-=a}else{b+=a}}}return(!!f&&e>=0&&f.right>=0&&b<=document.documentElement.clientHeight&&f.left<=document.documentElement.clientWidth)};ta.util.element.doIfElementIsVisible=function(d,e,b){function a(){if(d&&ta.util.element.isScrolledIntoView(d)){e.apply(null,b);window.removeEvent("scroll",a);window.removeEvent("resize",c)}}function c(){if(d&&ta.util.element.isScrolledIntoView(d)){e.apply(null,b);window.removeEvent("scroll",a);window.removeEvent("resize",c)}}if(d&&ta.util.element.isScrolledIntoView(d)){e.apply(null,b)}else{window.addEvent("scroll",a);window.addEvent("resize",c)}};ta.util.element.isScrolledIntoAdjustedView=function(c,k,d){if(!c){return false}var h;try{h=c.getBoundingClientRect()}catch(f){return false}var j=h.bottom,i=h.top,b=h.left,a=h.right;if(k){if(k.bottom){j=j+k.bottom>0?j+k.bottom:0}if(k.top){i=i+k.top>0?i+k.top:0}if(k.left){b=b+k.left>0?b+k.left:0}if(k.right){a=a+k.right>0?a+k.right:0}}if(d){var e=d.offsetHeight;var g=d.getPosition();if(e){if(g&&g.y==0){j-=e}else{i+=e}}}return(!!h&&j>=0&&a>=0&&i<=document.documentElement.clientHeight&&b<=document.documentElement.clientWidth)};ta.util.element.doIfElementAdjustedPositionIsVisible=function(d,f,e,b){function a(){if(d&&ta.util.element.isScrolledIntoAdjustedView(d,f)){e.apply(null,b);window.removeEvent("scroll",a);window.removeEvent("resize",c)}}function c(){if(d&&ta.util.element.isScrolledIntoAdjustedView(d,f)){e.apply(null,b);window.removeEvent("scroll",a);window.removeEvent("resize",c)}}if(d&&ta.util.element.isScrolledIntoAdjustedView(d,f)){e.apply(null,b)}else{window.addEvent("scroll",a);window.addEvent("resize",c)}};(function(){ta.util.element.trackWhenScrolledIntoView=function(e,f,g,d,c){if(e&&f){a.push({e:e,k:f,cb:g,once:!d,persistent:c})}};var a=[];function b(){for(var c=a.length-1;c>=0;c--){var e=a[c];var f;if(e.e.substr){f=ta.select(e.e)}else{if(e.e.join){f=e.e}else{f=new Elements([e.e])}}if(f.length>0){var d=e.inView;f.each(function(g){var h=g.offsetWidth==0&&g.offsetHeight==0||g.getStyle("display")=="none";if(!h){e.inView=e.inView||ta.util.element.isScrolledIntoView(g,e.persistent)}});if(!d&&e.inView){if(!e.cb||e.cb()){ta.trackEventOnPage(e.k[0],e.k[1],e.k[2],e.k[3]);if(e.once){a.splice(c,1)}}}}}}window.addEvent("scroll",function(){ta.throttle(b,"ta.util.element.trackWhenScrolledIntoView",250,1000)});window.addEvent("resize",b);window.addEvent("load",b)})();ta.util.element.getTotalWidth=function(b){if(!b){return 0}var a=b.getComputedStyle("width");if(a&&isNaN(parseInt(a))){return b.getWidth()}return(parseInt(b.getComputedStyle("width"))||0)+(parseInt(b.getComputedStyle("margin-left"))||0)+(parseInt(b.getComputedStyle("margin-right"))||0)+(parseInt(b.getComputedStyle("padding-left"))||0)+(parseInt(b.getComputedStyle("padding-right"))||0)+(parseInt(b.getComputedStyle("border-left-width"))||0)+(parseInt(b.getComputedStyle("border-right-width"))||0)};ta.util.element.getTotalHeight=function(a){if(!a){return 0}var b=a.getComputedStyle("height");if(b&&isNaN(parseInt(b))){return a.getHeight()}return(parseInt(a.getComputedStyle("height"))||0)+(parseInt(a.getComputedStyle("margin-top"))||0)+(parseInt(a.getComputedStyle("margin-bottom"))||0)+(parseInt(a.getComputedStyle("padding-top"))||0)+(parseInt(a.getComputedStyle("padding-bottom"))||0)+(parseInt(a.getComputedStyle("border-top-height"))||0)+(parseInt(a.getComputedStyle("border-bottom-height"))||0)};ta.util.element.copyAjaxPreserves=function(f,g){var d,e,h,c,a,j,b;if(!g||!f){return}d=g.getElements(".ajax_preserve");if(d&&d.length>0){h={};e=f.getElements(".ajax_preserve");for(c=0;c<e.length;++c){a=e[c].getAttribute("data-ajax-preserve");if(a){h[a]=e[c]}}for(c=0;c<d.length;++c){j=d[c];a=j.getAttribute("data-ajax-preserve");if(!a||!j.parentElement){continue}b=h[a];if(b){j.parentElement.replaceChild(b,j)}}}};ta.util.element.replaceContentWithAjaxPreserve=function(c,b){ta.util.element.copyAjaxPreserves(b,c);b.innerHTML="";var a=document.createDocumentFragment();while(c.firstChild){a.appendChild(c.firstChild)}b.appendChild(a)};ta.util.element.setContentElementWithAjaxPreserve=function(b,a){ta.util.element.copyAjaxPreserves(b,a);b.innerHTML="";b.appendChild(a)};ta.util.link={ajaxSubmit:function(a,c,b){if(a){new Event(a).preventDefault()}if(b){ta.util.cookie.setPIDCookie(b)}if(!c.className.match(/\bform_(\w+)\b/)){return}var f=$(RegExp.$1);var e={url:c.href,data:f,onFailure:function(h){if(f){f.removeClass("ajaxInFlight")}ta.util.error.ajaxFailure("link - ajaxSubmit",h)}};var g=window["callback"+f.id];if(c.className.match(/method_(\w+)\b/)){e.method=RegExp["$1"]}if(c.className.match(/\btgt_(\w+)\b/)){e.update=RegExp["$1"]}else{e.onSuccess=function(h){if(f){f.removeClass("ajaxInFlight")}ta.overlays.showInLightbox(h);if(g&&typeOf(g)=="function"){g()}}}var d=window["validate"+f.id];if(d&&typeOf(d)=="function"&&d.apply(f)==false){return}f.addClass("ajaxInFlight");if(c.className.match(/\bevalScripts\b/)){e.evalScripts=true}(e.update?new Request.HTML(e):new Request(e)).send()},ajaxCall:function(a,b){if(a){new Event(a).preventDefault()}if(!(tgt=b.className.match(/\btgt_(\w+)\b/))){return}tgt=$(tgt[1]);new Request.HTML({url:b.href,update:tgt,onFailure:ta.util.error.ajaxFailure.partial("link - ajaxCall")}).send()},popResWidth:function(b,e,d){try{var a=475,f=390,i=210;if(screen.width>1024){a=800;f=600;i=240}else{if(screen.width>800){a=620;f=500;i=240}}var g=Object.merge({width:a,height:f,xOffset:i,yOffset:5},d);ta.util.link.popup(b,e,g)}catch(c){ta.util.error.record(c,"ta.util.link - popCustom",b,g)}},popPhoto:function(a,d,c){try{Cookie.write("PhotoPop","1",{domain:cookieDomain});var e=Object.merge({name:"media",width:782,height:820},c);ta.util.link.popup(a,d,e)}catch(b){ta.util.error.record(b,"ta.util.link - popPhoto",a,e)}},popup:function(m,a,j){try{var g=Object.merge({name:false,width:950,height:610,xOffset:false,yOffset:false,noScroll:0,aHref:false,fullOptions:true,ensureReferrer:false,isAsdf:false},j);new Event(m).preventDefault();var f=false,b="",l=false;var c=1;if(ta.has("ta.popups.popupIndex")&&typeof ta.retrieve("ta.popups.popupIndex")!="undefined"){c=ta.retrieve("ta.popups.popupIndex")}if(!g.aHref){g.aHref=a.href}g.aHref=g.aHref.replace("%7Cnavarea%7C",ta.meta.link.getPhotoNavArea(a));if(g.isAsdf&&g.aHref){if(ta.util.ASDF.asdfDcd){g.aHref=ta.util.ASDF.asdfDcd(g.aHref).replace(/&amp;/g,"&")}}if(g.aHref&&g.aHref.indexOf("p=HotelsCom")>-1){g.width=Math.max(g.width,960);try{g.height=Math.max(g.height,window.getHeight(),600)}catch(h){g.height=Math.max(g.height,600)}}if(g.width){b+=",width="+g.width}if(g.height){b+=",height="+g.height}if(g.xOffset){b+=",screenX="+g.xOffset+",left="+g.xOffset}if(g.yOffset){b+=",screenY="+g.yOffset+",top="+g.yOffset}if(!Browser.chrome){g.noScroll=1}if(g.fullOptions){var i=1;if(ta.browser.isIE9orHigher()){i=0}b="toolbar=1,resizable=1,menubar="+i+",location=1,status=1,scrollbars="+g.noScroll+b}else{b="toolbar=0,resizable=1,menubar=0,location=0,status=0,scrollbars="+g.noScroll+b}if(!g.name){g.name="p"+(c++)}ta.store("ta.popups.popupIndex",c);if(g.ensureReferrer&&Browser&&Browser.ie){try{l=new Element("a",{target:g.name,href:g.aHref});l.inject(ta.id(document.body),"bottom");f=window.open("",g.name,b);l.click();l.destroy()}catch(d){ta.util.error.record(d,"ta.util.link - pop ensure referrer",m,g)}}else{try{f=window.open(g.aHref,g.name,b)}catch(h){ta.util.error.record(h,"ta.util.link - popping window",m,{href:g.aHref,name:g.name,args:b})}}if(typeof f!="undefined"&&f!==null){try{f.opener=self;f.focus()}catch(d){}}}catch(k){ta.util.error.record(k,"ta.util.link - popup",m,g)}},directionsPop:function(a,c,b,d){if(d){new Request({url:"/ActionRecord?action="+d}).send()}if(ta.trackEventOnPage){ta.trackEventOnPage("map_pin_overlay","directions_click")}ta.util.link.popup(a,c,b)},directionsPopInfoCard:function(a,c,b,d){if(d){new Request({url:"/ActionRecord?action="+d}).send()}if(ta.trackEventOnPage){ta.trackEventOnPage("dynamic_large_map","map_info_window","directions_cta")}ta.util.link.popup(a,c,b)},targetBlank:function(a,d,c){try{var e=Object.merge({aHref:false,isAsdf:false},c);if(e.isAsdf&&e.aHref){if(ta.util.ASDF.asdfDcd){e.aHref=ta.util.ASDF.asdfDcd(e.aHref).replace(/&amp;/g,"&")}}var f=c&&c.action&&(c.action=="website"||c.action=="deals"||c.action=="packages");if(ta.retrieve("ta.bl_calendar_lb")&&!ta.widgets.calendar.hasPageDates()&&f){ta.run("ta.overlays.Factory.loadCheckRatesLBOverlay",{},a,d,{detail:c.detailId,gaContext:"BLLightbox-"+c.action})}if(e.newTab||navigator.appVersion.indexOf("MSIE 7.")!=-1){window.open(e.aHref,"_blank")}else{if(ta.retrieve("ta.bl_calendar_lb")&&f){ta.servlet.Popup.openExternalWithDefaultOptions(e.aHref)}else{window.open(e.aHref,"_blank")}}}catch(b){ta.util.error.record(b,"ta.util.link - targetBlank",a,e)}}};ta||(ta={});ta.util||(ta.util={});ta.util.localstorage=(function(a,d,b,e){var f="taLsTest",c="1";return{canUseLocalStore:function(){try{if(d.localStorage){localStorage.setItem(f,c);return(c===localStorage.getItem(f))}}catch(g){}return false},canUseSessionStore:function(){try{if(d.sessionStorage){sessionStorage.setItem(f,c);return(c===sessionStorage.getItem(f))}}catch(g){}return false}}}(document,window,ta));(function(a){a.util.sessionStorage={};a.util.sessionStorage.canUseSessionStore=function(){try{if(window.sessionStorage){var c="taLsTest";sessionStorage.setItem(c,"1");var b=sessionStorage.getItem(c);return(b=="1")}}catch(d){return false}}}(ta));(function(){window.ta||(window.ta={});window.ta.util||(window.ta.util={});var a=["success","failure","always","progress"];var e={resolved:["success","always"],rejected:["failure","always"]};var g=function(){};function h(i){g.prototype[i]=function(k,j){return b(this,i,j?k.bind(j):k)}}for(var d=0;d<a.length;d++){h(a[d])}g.prototype.then=function(j,k){var i=this.success(j);return k?i.failure(k):i};window.ta.util.Deferred=function(l){var i="pending";var k=new g();k.queue=[];k.args=null;k.aplus=(typeof l==="boolean")&&l;k.status=function(){return i};var j={notify:function(){if(c(i)){throw new Error("Promise has already been fulfilled.")}var n=Array.prototype.slice.call(arguments);var p,o,m;for(o=0,m=k.queue.length;o<m;o++){p=k.queue[o];if(p.hook==="progress"){p.callback.apply(null,n)}}return k},resolve:function(){if(c(i)){throw new Error("Promise has already been fulfilled.")}i="resolved";k.args=Array.prototype.slice.call(arguments);return f(k)},reject:function(){if(c(i)){throw new Error("Promise has already been fulfilled.")}i="rejected";k.args=Array.prototype.slice.call(arguments);return f(k)},promise:function(){return k}};return j};var c=function(i){return i==="resolved"||i==="rejected"};var b=function(j,i,k){j.queue.push({hook:i,callback:k});return f(j)};var f=function(k){var j,i;while(c(k.status())&&(j=k.queue.shift())){if(~e[k.status()].indexOf(j.hook)){i=j.callback.apply(null,k.args);if(i instanceof g){i.queue=i.queue.concat(k.queue);k=i}else{if(i&&k.aplus){k.args=[i]}}}}return k}}());ta.util.decoder={base64Decoder:function(g){g=g.replace(/\-/g,"+").replace(/\_/g,"/");if(g.length%4!==0){var h=4-g.length%4;for(var f=0;f<h;f++){g=g+"="}}var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",a="",p,n,k="",o,l,j,i="";for(var e=0;e<g.length;e+=4){o=d.indexOf(g.charAt(e));l=d.indexOf(g.charAt(e+1));j=d.indexOf(g.charAt(e+2));i=d.indexOf(g.charAt(e+3));if(o==-1||l==-1||j==-1&&i==-1){ta.util.error.record(null,"Facebook signed request contains invalid base64 letter",null,{code:g});return}p=(o<<2)|(l>>4);n=((l&15)<<4)|(j>>2);k=((j&3)<<6)|i;a=a+String.fromCharCode(p);if(j!=64){a=a+String.fromCharCode(n)}if(i!=64){a=a+String.fromCharCode(k)}p=n=k="";o=l=j=i=""}return unescape(a)}};ta.util.files={reset:function(a){if(Browser.ie){a.clone(false,true).replaces(a)}else{a.value=""}},upload:function(c,e,g){function b(j,h){var k;try{k=document.createElement("<"+j+' name="'+h+'">')}catch(i){k=document.createElement(j);k.setAttribute("name",h)}return k}var f="upload_iframe_"+(Math.random()+"").split(".")[1];var d=b("iframe",f);d.setAttribute("id",f);d.setAttribute("src","about:blank");d.setAttribute("width","0");d.setAttribute("height","0");d.setAttribute("border","0");d.setAttribute("style","width:0; height:0; border:none; display:none; ");document.body.appendChild(d);c.target=f;function a(){ta.id(d).removeEvent("load",a);var h=d.contentWindow.document;g(h);setTimeout(function(){d.parentNode.removeChild(d)},250)}ta.id(d).addEvent("load",a);c.submit()}};ta.util.replace=(function(){return{img:function(b,a){try{b.src=ta.retrieve(a).src}catch(c){}}}})();(function(a){a.util||(a.util={});a.util.ajax=function(f){f||(f={});try{if(f.trackEvent&&a.analytics){var k=a.analytics._toEvtParams(f.trackEvent);f.data=a.util.merge(f.data||{},k)}}catch(i){if(a.util&&a.util.error&&a.util.error.record){a.util.error.record(i,"ta.util.ajax.initialize.trackEvent")}}var d=a.util.Deferred();var h=function(e){};var j,c;var g={onComplete:typeof f.onComplete=="function"?f.onComplete:h,onSuccess:typeof f.onSuccess=="function"?f.onSuccess:h,onFailure:typeof f.onFailure=="function"?f.onFailure:h,onReadOnly:f.onReadOnly||h,onRedirect:f.onRedirect||h};f.onComplete=function(){var l;try{l=JSON.decode?JSON.decode(j.responseText):JSON.parse(j.responseText)}catch(m){l={text:j.responseText}}l||(l={text:j.responseText});if(!l.code){l.code=j.status||0}try{if(f&&f.trackEvent&&a.analytics){a.analytics._trackEventAfterAjax(this.options.trackEvent)}}catch(m){if(a&&a.util&&a.util.error&&a.util.error.record){a.util.error.record(m,"ta.util.ajax.onComplete.trackEventAfterAjax")}}if(l.code>=200&&l.code<300){l.status="ok";d.resolve(l)}else{if(l.code===301||l.code===302){l.status="redirect";d.reject(l)}else{l.status||(l.status="error");d.reject(l)}}};f.onCancel=function(){d.reject({code:0,status:"abort"})};f.onTimeout=function(){d.reject({code:0,status:"timeout"})};delete f.onLoadStart;delete f.onProgress;delete f.onException;delete f.onSuccess;delete f.onFailure;j=b(f);return d.promise().always(function(e){g.onComplete.call(j,e);if(e.status==="redirect"){g.onRedirect.call(j,e)}else{if(e.status==="readonly"){g.onReadOnly.call(j,e)}else{if(~["abort","timeout","error"].indexOf(e.status)){g.onFailure.call(j,e)}else{g.onSuccess.call(j,e)}}}})};function b(d){if(typeof MooTools!=="undefined"&&typeof Request!=="undefined"){return(new Request(d).send()).xhr}var h=new XMLHttpRequest();var j=h.abort.bind(h);var i=d.method.toUpperCase()||"GET";var g=d.url||"/";var c=[];var f,e;h.onreadystatechange=function(){if(this.readyState===4){clearTimeout(f);d.onComplete()}};h.abort=function(){j();d.onCancel()};if(d.timeout){f=setTimeout(function(){j();d.onTimeout()},d.timeout)}d.data||(d.data={});for(e in d.data){if(d.data.hasOwnProperty(e)&&d.data[e]!==null){c.push(e+"="+encodeURIComponent(d.data[e]))}}if(/GET/.test(d.method)){g+=(/\?/.test(g)?"&":"?")+c.join("&")}if(/POST/.test(d.method)){d.headers||(d.headers={});d.headers["Content-Type"]="application/x-www-form-urlencoded; charset=utf-8"}h.open(d.method,g);for(e in d.headers){h.setRequestHeader(e,d.headers[e])}d.onRequest&&d.onRequest.call(h);h.send(/POST/.test(d.method)?c.join("&"):null);return h}}(ta));try{(function(a){a.util||(a.util={});a.util.imageServer=function(c){var b=(typeof(CDNHOST)==="string"&&CDNHOST)||(typeof(cdnhost)==="string"&&cdnhost);if(b&&c){if(!/^\//.test(c)){c="/"+c}c=b+c}return c}})(ta)}catch(e){ta.util.error.record(e,"cannot do ta.util.imageServer",null,{path:path})};ta.common.search={langSelect:function(b,a){if(a.form.elements.q.value.length>0){a.form.submit()}},useCurrentLocation:function(a){ta.select(".locNotFound.hidden").removeClass("hidden")},clearOnFocus:function(b,a){if(a.value==a.defaultValue){a.value="";a.removeClass("focusClear")}},defaultOnBlur:function(b,a){if(a.value==""){a.addClass("focusClear");a.value=a.defaultValue}},validate:function(b,a){if(a.q.value.trim()==""||$(a.q).hasClass("focusClear")){return false}setOneTimeCookie("SRCHACT","NEW");return true},recordAndValidate:function(c,h,f,j){if(f||ta.common.search.validate(c,h)){j=j||ta.retrieve("ta_typeahead_widget");var g=j&&j.options?j.options.startTime:undefined;var k=j?j.lastSuccessfulQuery:undefined;var d=j&&j.options&&j.options.geoId;var e=j&&j.options?j.options.name:undefined;var b=j&&j.historyShown;var i=ta.id("TYPEAHEAD_REDIRECT");i.value="true";var l=ta.id("MASTAHEAD_TYPEAHEAD_START_TIME");l.value=g;var a=ta.id("MASTAHEAD_TYPEAHEAD_UI_ORIGIN");a.value=e;new Request({method:"GET",data:{hadHistory:b,action:"RECORD",eventType:"search_bttn",startTime:g,source:e,query:k,uiOrigin:e,global:(!d||pageServlet=="Search"),scope:(!d||pageServlet=="Search")?"G":d},onSuccess:function(m){if(j&&j.options&&j.options.onSubmit){j.options.onSubmit(j)}h.submit()},onFailure:function(m){if(j&&j.options&&j.options.onSubmit){j.options.onSubmit(j)}h.submit()},url:"/TypeAheadJson"}).send()}return false},selectLang:function(b,d){try{var n=function(o){var e=o.match(/([\d.]+)px/);if(e){return parseFloat(e)}return 0};var g=ta.id("SEARCH_LANG_SELECT_POPUP");if(!g){return false}if(!g.hasClass("hidden")){var f=ta.id("SEARCH_LANG_SELECT_INPUT");var i=ta.id("SEARCH_LANG_SELECTED");if(f){var h=d.id.match(/lang_(.+)/);if(h){var c=h[1];if("all"==c){f.value=""}else{f.value=c}}if(i){if(ta.isFall2013MastheadRefresh()){if(h){g.getElements(".langSelectOption").removeClass("selected");d.addClass("selected")}}else{i.set("html",ta.id(d).get("html"))}}}g.addClass("hidden");if(!ta.isFall2013MastheadRefresh()&&i&&!ta.common.search.widthfixed){var j=ta.common.search.width;var l=n(i.getStyle("width"));var a=Math.max(j,l);console.log("check width old "+j+" new "+l);if(j!=l){i.setStyle("width",a+"px");ta.common.search.widthfixed=true}}}else{g.removeClass("hidden");if(!ta.isFall2013MastheadRefresh()){var i=ta.id("SEARCH_LANG_SELECTED");if(i&&!ta.common.search.widthfixed){ta.common.search.width=n(i.getStyle("width"))}}}}catch(k){ta.util.error.record(k,"select search lang")}},reviews:function(c,b){new Request({url:"/ActionRecord?action=SearchReviews"}).send();if(b&&b.getElement){var a=b.getElement(".searchTestText");if(a){alert(a.innerHTML)}}else{alert("Coming Soon!")}return false},replaceOrAddParam:function(b,a){var e=a.split("=");var g=e[0];var f=e[1];var d=new RegExp("([\\?#&])("+g+"=\\w+)");var c=d.exec(b);if(c){return b.replace(d,"$1"+a)}else{return b+"&"+a}},extractParam:function(b,e,d){var c=new RegExp("[\\?#&]"+e+"=(\\w+)");var a=c.exec(b);if(a){return a[1]}else{if(d){return d}}return null},selectOption:function(b,d){var p=function(e){do{e=e.getParent()}while(e&&e.nodeName!=="FORM");return e};var c=ta.id(d);var i=ta.id(p(c));try{var o=function(q){var e=q.match(/([\d.]+)px/);if(e){return parseFloat(e)}return 0};var h=i.getElement(".SEARCH_SELECT_POPUP");if(!h){return false}if(!h.hasClass("hidden")){h.addClass("hidden");var f=i.getElement(".SEARCH_SELECT_INPUT");var j=i.getElement(".SEARCH_SELECTED");if(f){var g=c.hasClass("lang_all");if(g){f.value=1}else{f.value=2}if(j){j.set("html",c.get("html"))}}if(j){var k=ta.common.search.width;var n=o(j.getStyle("width"));var a=Math.max(k,n);j.setStyle("width",a+"px")}}else{h.removeClass("hidden");var j=i.getElement(".SEARCH_SELECTED");if(j){ta.common.search.width=o(j.getStyle("width"))}}}catch(l){ta.util.error.record(l,"select search lang")}}};ta.common.flyout={intlPopup:function(d,b){d.stop();b.onclick=null;flagsUrl=document.location.pathname;var c="/StaticVelocityPage?t=intSitesFly.vm&lt=evt&footerFlagFormat="+footerFlagFormat+"&flagsURL="+encodeURIComponent(flagsUrl);if(document.location.search!=""){c+=encodeURIComponent(document.location.search)}if(document.location.hash!=""){c+=encodeURIComponent(document.location.hash)}if(window.modelGeoId){c+="&geo="+modelGeoId}if(window.flagsSettings){for(var a=0;a<flagsSettings.length;a++){c+="&"+flagsSettings[a]+"=true"}}if(window.pageFeature){c+="&pageFeature="+pageFeature}new Asset.css(flagsFlyoutCSS);new ta.overlays.RelativeOverlayBelow({showCloseButton:true,activate:ta.overlays.ACTIVATE_CLICK,remoteContent:c},b);return false},showRecentLocationSaveOverlay:function(){setPID(3832);new Request({url:"/RecentlyViewedAjax",onSuccess:function(a){if(!a.match("emptyRecentlyViewed")){ta.overlays.showInLightbox(a,{style:"dg s4 RecentlyViewedOverlay"})}},data:{a:"save_overlay"},evalScripts:true,method:"get"}).send()},submitRecentLocationEmail:function(){var a=ta.retrieve("overlays.current");if($("rvEmailSend")){$("rvEmailSend").hide()}if($("rvEmailProgress")){$("rvEmailProgress").show()}setPID(4470);new Request({url:"/RecentlyViewedAjax",onSuccess:function(b){a.hide();if(!b.match("emptyRecentlyViewed")){ta.overlays.showInLightbox(b,{style:"dg s4 RecentlyViewedOverlay"})}},data:$("rvEmailForm"),evalScripts:true}).send()},submitRecentLocationSave:function(){var a=ta.retrieve("overlays.current");if($("rvEmailSend")){$("rvEmailSend").hide()}if($("rvEmailProgress")){$("rvEmailProgress").show()}setPID(4469);new Request({url:"/RecentlyViewedAjax",onSuccess:function(b){a.hide();if(!b.match("emptyRecentlyViewed")){ta.overlays.showInLightbox(b,{style:"dg s4 RecentlyViewedOverlay"})}},data:$("rvEmailForm"),evalScripts:true}).send()},showEmailHotelOverlay:function(c,d,a,b){new Asset.css(emailHotelCSS);new Request({url:"/EmailHotel",onSuccess:function(f){ta.run("ta.overlays.showInLightbox",{},f,{style:"dg s4"});if(ta.has("emailOwnerShowCaptcha")){ta.t4b.emailhotel.showRecaptcha()}},data:{detail:c,isOfferEmail:d,overrideOfferEmail:a,contactColumn:b},evalScripts:true,method:"get"}).send()},rvInquiryPrivacy:function(b,a){b.stop();a.onclick=null;new ta.overlays.RelativeOverlayBelow({showCloseButton:false,activate:ta.overlays.ACTIVATE_HOVER,content:$("rvPrivacyBox").innerHTML},a)},rvClearDefault:function(c,a){var b=$(c);if(b&&b.value==a){b.value="";b.removeClass("rvDefault")}},BLSpecialOffersUrl:function(b,a){b.stop();a.onclick=null;new ta.overlays.RelativeOverlayBelow({showCloseButton:false,activate:ta.overlays.ACTIVATE_HOVER,content:$("blLinkMsg").innerHTML},a)},destinationsPopup:function(b,a){b.stop();a.onclick=null;new ta.overlays.RelativeOverlayBelow({showCloseButton:true,activate:ta.overlays.ACTIVATE_CLICK,remoteContent:"/vpages/destinationsFly.html?lt=evt"},a)},funStuffPopup:function(b,a){b.stop();a.onclick=null;new ta.overlays.RelativeOverlayBelow({showCloseButton:true,activate:ta.overlays.ACTIVATE_CLICK,remoteContent:"/vpages/funStuffFly.html?lt=evt"},a)},bestValue:function(b,a){b.stop();a.onmouseover=null;new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_HOVER,remoteContent:"/vpages/bestValueFly.html?log=false"},a);return false},starAttribution:function(b,a){b.stop();a.onclick=null;new ta.overlays.RelativeOverlayBelow({showCloseButton:true,activate:ta.overlays.ACTIVATE_CLICK},a);return false},amenities:function(d,b,a,c){if(d){d.stop()}b.onclick=null;if(typeof(amenityOverlayCss)!="undefined"&&!ta.retrieve("ta.amenityOverlayCss")){ta.store("ta.amenityOverlayCss",Asset.css(amenityOverlayCss))}if(a&&a>0){setPID(a);new Request({url:"/ActionRecord?excludeFromVS=false&action=HRAmenitiesFlyout"}).send()}if(c){ta.store("amenities.suppressLinks",true)}ta.run("ta.overlays.Factory.createAmenitiesLightbox",{},b);return false}};ta.common.sendmessage={getMessageCode:function(){var e=new Date().getTime();var b="ABCDEFGHIJKLMNOPQRSTUVWXYZ123456";var f=[];for(var a=0;a<32;a++){f[a]=((e&(1<<a))!=0)?1:0}var c=[[],[],[],[],[],[]];for(var a=0;a<30;a++){c[a%(c.length)].push(f[f.length-1-a])}var d="";for(var a=0;a<c.length;a++){d+=b.substr(parseInt(c[a].reverse().join(""),2),1)}return d},communityLightbox:function(e,d){if(!communityEnabled){window.callback_communityLightboxEnable=function(){communityEnabled=true;var g=ta.retrieve("overlays.sendmessage");if(g){g.hide()}ta.common.sendmessage.communityLightbox(e,d)};var a=new StringBuffer();a.append('<p id="inviteStatusField" style="display: none; color: red;"></p>');a.append("<p>"+JS_mem_travelnet_friends_disabledM2M+".</p>");a.append('<p><a href="javascript:void(0)" onclick="ta.common.sendmessage.enableCommunity(window[\'callback_communityLightboxEnable\'], true); return false;">'+JS_common_Clickhere+"</a> "+JS_mem_travelnet_friends_turnOn+".</p>");var f=ta.overlays.showInLightbox(a.toString(),{backdrop:ta.overlays.BACKDROP_NEVER,onHide:ta.common.sendmessage.cancel.bind(this),noScroll:$("vrWideOverview")});f.container.setStyle("z-index","9997");if($("vrWideOverview")&&ta.has("vrShowCaptcha")){f.closeBtn.addEvent("click",function(){ta.vr.showRecaptcha()})}ta.store("overlays.sendmessage",f);return}if(d){var b=function(g){var h=ta.overlays.showInLightbox(g,{backdrop:ta.overlays.BACKDROP_NEVER,permanent:true,onHide:ta.common.sendmessage.cancel.bind(this),noScroll:$("vrWideOverview")});h.container.setStyle("z-index","9997");if($("vrWideOverview")&&ta.has("vrShowCaptcha")){h.closeBtn.addEvent("click",function(){ta.vr.showRecaptcha()})}ta.store("overlays.sendmessage",h);var i=window[d];if(i&&typeOf(i)=="function"){i()}}}else{var b=function(g){var h=ta.overlays.showInLightbox(g,{backdrop:ta.overlays.BACKDROP_NEVER,permanent:true,onHide:ta.common.sendmessage.cancel.bind(this),noScroll:$("vrWideOverview")});h.container.setStyle("z-index","9998");if($("vrWideOverview")&&ta.has("vrShowCaptcha")){h.closeBtn.addEvent("click",function(){ta.vr.showRecaptcha()})}ta.store("overlays.sendmessage",h)}}var c={url:e,onSuccess:b,evalScripts:true,onFailure:ta.util.error.ajaxFailure.partial("SendMessage:communityLightbox")};new Request(c).send()},enableCommunity:function(c,a){var b=c;if(!a){b=function(d){ta.common.sendmessage.enableCommunityResponse(d,c)}}if(typeof(JS_SECURITY_TOKEN)=="undefined"){JS_SECURITY_TOKEN=""}new Request({url:"/MemberSubscriptionsController",data:{Action:"ChangeM2M",set:"on",token:JS_SECURITY_TOKEN},onSuccess:b,onFailure:ta.util.error.ajaxFailure.partial("SendMessage:enableCommunity")}).send()},enableCommunityResponse:function(res,callback){if(txt.match(/^{/)){var data=eval("("+txt+")");if(data.ERROR){document.getElementById("inviteStatusField").innerHTML=data.ERROR;document.getElementById("inviteStatusField").style.display="block"}}else{document.getElementById("inviteStatusField").innerHTML=JS_community_on;document.getElementById("inviteStatusField").style.display="block"}},submitSendMessage:function(h,b){h.stop();b.onclick=null;var a=b.className.match(/LSO_(\w+)/)[1];$("LsoId").value=footprintGetWithSet(a);$("screenWidth").value=screen.width;$("screenHeight").value=screen.height;if(!b.className.match(/\bform_(\w+)\b/)){return}var e=$(RegExp.$1);var d={url:b.href,data:e,evalScripts:true,onFailure:ta.util.error.ajaxFailure.partial("SendMessage:submitSendMessage")};var g=window["callback_"+e.name];if(b.className.match(/method_(\w+)\b/)){d.method=RegExp["$1"]}if(b.className.match(/\btgt_(\w+)\b/)){d.update=RegExp["$1"]}else{d.onComplete=function(k,i){if(ta.retrieve("messaging.isiframe")&&ta.id("PAGE")){ta.id("PAGE").set("html",k);if(ta.id("SUCCESS")){window.top.location.href="/Messages?f=512&o=0&cnt=25&j=-3&oo=0&oj=-3"}}else{var j=ta.overlays.showInLightbox(k,{backdrop:ta.overlays.BACKDROP_NEVER,permanent:true,onHide:ta.common.sendmessage.cancel.bind(this),noScroll:$("vrWideOverview")});ta.store("overlays.sendmessage",j)}if(g&&typeOf(g)=="function"){g()}}}var c=window["validate"+e.id];if(c&&typeOf(c)=="function"&&c.apply(e)==false){return}if(b.className.match(/\bevalScripts\b/)){d.evalScripts=true}var f=ta.retrieve("overlays.sendmessage");if(f&&f.options&&f.options.permanent){f.options.permanent=false}new Request(d).send()},cancel:function(a){if(a){return}var b=ta.retrieve("overlays.sendmessage");if(b){ta.remove("overlays.sendmessage")}if(ta.has("community.needsReload")){window.location.reload()}},closeSendMessage:function(c,a){if(c&&c.stop){c.stop()}if(a){a.onclick=null}var b=ta.retrieve("overlays.sendmessage");if(b){b.hide(c)}if($("vrWideOverview")&&ta.has("vrShowCaptcha")){ta.vr.showRecaptcha()}}};ta.servlet.Inspiration={sortPopularity:function(b,a){sort("popularity")},sortAlphabetical:function(b,a){sort("alphabetical")}};ta.keep("facebook.onAvail",function(){FB.Event.subscribe("edge.create",function(d,f){try{var g=false;if(f){g=ta.id(f)}var a="";var c=d||"";if(g){if(g.className){var b=false;if(b=g.className.match(/track_(\w+)/)){a=b[1]}if(g.hasClass("expanded")){a+="_expanded"}}}new Request({url:"/ActionRecordPlus?action=LIKE&from="+a+"&url="+c}).send()}catch(e){ta.util.error.record(e,"FB like review tracking error")}})});ta.servlet.Reviews={expandCount:0,PAGING_HEIGHT:1000,expandReview:function(n,d,c){var a=0;if(ta.retrieve("expand_"+c)){return}ta.store("expand_"+c,true);a++;var b=ta.id(c);var m=new Event(n);try{a++;if(!b){ta.util.error.record(null,"expandReview - no container",m,{revId:c});return}var i,k,g=false;if(b.getElement){i=b.getElement(".dyn_full_review");k=b.getElement(".basic_review");g=b.getElement(".revBotContent")}if(!k||!k.hasClass){ta.util.error.record(null,"expandReview - no basic_rev",m,{revId:c});return}a++;var h=k.hasClass("first");if(g&&g.getElement){var f=g.getElement(".fb_like_button")}var j=k.getElement(".helpful");a++;if(i){i.setStyle("display","block");if(f){ta.servlet.Reviews.injectFBLikeIntoFull(f,i)}if(ta.servlet.Reviews.translationRatings.contains(expandedReviewId)){ta.servlet.Reviews.injectTranslationRating(k,i)}k.setStyle("display","none");ta.remove("expand_"+c)}else{a++;ta.servlet.Reviews.expandCount++;var l=k.getElement(".partnerRvw span.linkItem");a++;if(l){l.getElement("img.textArrow_more").setStyle("display","none");new Asset.image(CDNHOST+"/img2/spinner.gif",{"class":"anim_loop"}).inject(l)}a++;new Request({url:"/SingleUserReview-g"+modelGeoId+"-d"+modelLocId+"?review="+c+"&servlet="+pageServlet+"&expand="+ta.servlet.Reviews.expandCount,onSuccess:function(r,s){try{var q=0;i=new Element("div");i.addClass("dyn_full_review");i.set("html",r);i.inject(k,"after");q++;var t=i.getElement(".collapse");if(t){t.addEvent("click",function(){ta.servlet.Reviews.collapseReview(b)})}q++;if(h){i.getElement(".basic_review").addClass("first")}q++;setupTranslationRatingSlider(i);q++;if(typeof processLinks!=="undefined"){processLinks(i)}q++;ta.servlet.Reviews.fixMTHelpfulUrl(i,c);if(k){var w=k.getElement("img.anim_loop");w.dispose()}q++;if(l){var p=l.getElement("img.textArrow_more");if(typeof(p)!="undefined"&&p!=null){p.setStyle("display","inline")}}q++;var u=ta.retrieve("facebook.data.handlers.FRIEND_NAMES");var o=ta.retrieve("facebook.data.handlers.HIGHLIGHT_FRIENDS");if(u&&typeof(u)=="function"){u()}if(o&&typeof(u)=="function"){o({expanded:true})}if(f){ta.servlet.Reviews.injectFBLikeIntoFull(f,i)}if(j){helpfulVotingKey=j.id.match(/(helpful\w+)_\w+/);if(helpfulVotingKey){helpfulVotingKey=helpfulVotingKey[1];if(ta.retrieve(helpfulVotingKey)){var y=i.getElement(".helpful");if(y){y.innerHTML=j.innerHTML}}}}q++}catch(v){ta.util.error.record(v,"expandReview - post AJAX",null,{postProg:q})}if(k&&k.setStyle){k.setStyle("display","none")}if(g&&g.setStyle){g.setStyle("display","none")}ta.remove("expand_"+c);var x=ta.retrieve("ta.servlet.Reviews.callback");if(x!=null){x()}},evalScripts:true}).send()}}catch(e){ta.util.error.record(e,"expandReview",m,{revId:c,prog:a});ta.remove("expand_"+c)}},expandReviews:function(g,k,h,r,p){if(ta.retrieve("expand_"+h)){return}ta.store("expand_"+h,true);var m=ta.id(h);var o=new Event(g);try{if(!m){ta.util.error.record(null,"expandReviews - no container",o,{revId:h});return}var j,s,x=false;if(m.getElement){j=m.getElement(".dyn_full_review");s=m.getElement(".basic_review");x=m.getElement(".revBotContent")}if(!s||!s.hasClass){ta.util.error.record(null,"expandReviews - no basic_rev",o,{revId:h});return}if(j){ta.servlet.Reviews.showExpandedReview(h,true);ta.remove("expand_"+h)}else{ta.servlet.Reviews.expandCount++;var t=s.getElement(".partnerRvw span.moreLink");if(t){var c=t.getParent().getElement("img.textArrow_more");if(c){c.setStyle("display","none");new Asset.image(CDNHOST+"/img2/spinner.gif",{"class":"anim_loop"}).inject(t,"after")}}var w=$$("#REVIEWS .reviewSelector");var a;for(var u=0;u<w.length;u++){if(w[u].id==h){a=w.slice(u)}}var l=[];if(a&&a.length>0){for(var u=0;u<a.length;u++){var q=a[u].id;if(q&&q.indexOf("review_")===0){var v=a[u].getElement(".dyn_full_review");if(!v){var f=a[u].getElement(".basic_review");if(f){l[l.length]=q.split("_")[1]}else{ta.util.error.record(null,"expandReviews - basic_review content missing",null,{revId:q},"WARN")}}}}}if(l.length>0){var n=l[0];var b=0;if(r){b=r}var e=l.join(",");new Request({url:"/ExpandedUserReviews-g"+modelGeoId+"-d"+modelLocId+"?target="+n+"&context="+b+"&reviews="+e+"&servlet="+pageServlet+"&expand="+ta.servlet.Reviews.expandCount,trackEvent:{module:"Reviews",action:"expand"},onSuccess:function(F,B){try{var G=[];var y=new Element("div");y.set("html",F);var N=y.getChildren();var E=[];for(var M=0;M<N.length;M++){var C=N[M];var I=C.id.split("_")[2];var P=ta.id("review_"+I);if(P&&P.getElement){E.push(P.getProperty("id"));var L=P.getElement(".basic_review");if(L){G.push(I);C.erase("id").addClass(L.className.replace("basic_review","dyn_full_review")).inject(L,"after").hide();var Q=C.getChildren()[0];if(Q){Q.removeClass("review")}var H=C.getElement(".collapse");if(H){H.addEvent("click",ta.servlet.Reviews.getCollapseCallback(P))}setupTranslationRatingSlider(C);if(typeof processLinks!=="undefined"){processLinks(C)}if(ta.servlet.Reviews.translationRatings.contains(I)){ta.servlet.Reviews.injectTranslationRating(L,C)}ta.servlet.Reviews.fixMTHelpfulUrl(C,"review_"+I);if(I===n){var z=L.getElement("img.anim_loop");if(z){z.dispose()}ta.servlet.Reviews.refreshSidebarAds();ta.servlet.Reviews.injectInlineBanner(P);var K=L.getElement(".partnerRvw span.moreLink");if(K){var A=K.getParent().getElement("img.textArrow_more");if(typeof(A)!="undefined"&&A!=null){A.setStyle("display","inline")}}}}}}var D=true;for(var M=0;M<G.length;M++){if(M==1){D=false}var J="review_"+G[M];ta.servlet.Reviews.showExpandedReview(J,D)}if(lazyImgs!=null){window.setupLazyLoad()}}catch(R){ta.util.error.record(R,"expandReviews - post AJAX",null,{});var z=s.getElement("img.anim_loop");if(z){z.dispose()}var K=s.getElement(".partnerRvw span.moreLink");if(K){var A=K.getParent().getElement("img.textArrow_more");if(typeof(A)!="undefined"&&A!=null){A.setStyle("display","inline")}}}if(Browser.ie&&Browser.version<8){var O=function(){for(var S=0;S<E.length;++S){var T=ta.id(E[S]);if(T!==null){T.addClass("dummy")}}};setTimeout(O,0)}ta.remove("expand_"+h)},onFailure:function(i,y){ta.util.error.record(null,"ExpandedUserReviews ajax call failed",null,{reviewIds:e},"WARN");var A=s.getElement("img.anim_loop");if(A){A.dispose()}var B=s.getElement(".partnerRvw span.moreLink");if(B){var z=B.getParent().getElement("img.textArrow_more");if(typeof(z)!="undefined"&&z!=null){z.setStyle("display","inline")}}},evalScripts:true}).send()}}}catch(d){ta.util.error.record(d,"expandReviews",o,{revId:h});ta.remove("expand_"+h)}},injectInlineBanner:function(a){try{if(a){if(ta.has("ads.gptEnabled")){if(!ta.has("ads.inlineReviewAd.injected")){ta.store("ads.inlineReviewAd.injected",true);ta.common.ads.queueForInjection(["gpt-ad-468x60"])}else{var b=a.getElement(".iab_inlineBanner");if(b){b.destroy()}}}else{injectAdsTargeted(a)}}else{throw new Error("Review parent element is null")}}catch(c){ta.util.error.record(c,"unable to inject inline banner on review expansion")}},refreshSidebarAds:function(){try{if(ta.has("ads.gptEnabled")){ta.common.ads.refreshSidebarAds()}else{ta.common.ads.refreshSideBarAdsWithRefreshOrdKey()}}catch(a){ta.util.error.record(a,"unable to refresh sidebar ads on review expansion")}},getCollapseCallback:function(a){return function(){ta.servlet.Reviews.collapseReview(a)}},showExpandedReview:function(a,b){try{if(typeof(a)==="undefined"){ta.util.error.record(null,"showExpandedReview - reviewId is undefined");return}var e=ta.id(a);if(e){var h,j,f=false;if(e.getElement){h=e.getElement(".dyn_full_review");j=e.getElement(".basic_review");f=e.getElement(".revBotContent")}else{ta.util.error.record(null,"showExpandedReview - recContainer missing getElement attribute",null,{revId:a});return}if(!j){ta.util.error.record(null,"showExpandedReview - basic_rev is null",null,{revId:a});return}if(!j.hasClass){ta.util.error.record(null,"showExpandedReview - basic_rev missing hasClass attribute",null,{revId:a});return}if(f&&f.getElement){var d=f.getElement(".fb_like_button")}var i=j.getElement(".helpful");if(!h){ta.util.error.record(null,"showExpandedReview - no full");return}if(i){var g=i.id.match(/(helpful\w+)_\w+/);if(g){g=g[1];if(ta.retrieve(g)){var k=h.getElement(".helpful");if(k){k.innerHTML=i.innerHTML}}}}if(d){ta.servlet.Reviews.injectFBLikeIntoFull(d,h)}h.show();j.hide()}else{ta.util.error.record(null,"showExpandedReview - revContainer is null",null,{revId:a});return}}catch(c){ta.util.error.record(c,"showExpandedReview")}},fixMTHelpfulUrl:function(c,a){var d=c.getElement("input[name=returnTo]");if(d){var b=document.location.href;if(b.indexOf("#")>=0){b=b.substring(0,b.indexOf("#"))}d.value=b+"#mtreview_"+a}},injectFBLikeIntoFull:function(c,a){try{if(c){var e=c.getFirst();if(e){e.addClass("expanded")}var b=a.getElement(".helpful");if(b){c.inject(b,"after")}}}catch(d){ta.util.error.record(d,"expandReview - like button")}},injectTranslationRating:function(c,b){if(c&&b){var a=c.getElement(".translation"),d=b.getElement(".translation");if(a&&d){d.set("html",a.get("html"))}}},translationRatings:[],collapseReview:function(a){try{a=ta.id(a);var f=a.getElement(".dyn_full_review");var c=a.getElement(".basic_review");var d=a.getElement(".revBotContent");var b=f.getElement(".fb_like_button");if(c&&c.setStyle){c.setStyle("display","block")}if(d&&d.setStyle){d.setStyle("display","block")}if(b){var i=b.getFirst();if(i){i.addClass("expanded")}if(d){b.inject(d,"inside")}}var h=a.id.replace("review_","");if(ta.servlet.Reviews.translationRatings.contains(h)){ta.servlet.Reviews.injectTranslationRating(f,c)}f.setStyle("display","none")}catch(g){ta.util.error.record(g,"collapseReview")}},findLink:function(b,a){if(/\bt(r[\d]+)\b/.test(a.className)){window.location=$(RegExp.$1).href}},mtSubmitOnClick:function(b,a){if(a.value==="true"){ta.util.cookie.setPIDCookie(25173)}else{if(a.value==="false"){ta.util.cookie.setPIDCookie(25172)}}a.form.submit()},validateMTEdit:function(d,c){var b=ta.id("mtedit_mt");var a=b.getElements(".mtedit_orig_title")[0].value;var g=b.getElements(".mtedit_title")[0].value;var f=b.getElements(".mtedit_orig_text")[0].value;var e=b.getElements(".mtedit_text")[0].value;return g&&e&&(g!=a||e!=f)},enableMTEditSubmit:function(c,b){var a=ta.id("mtedit_submit");if(a.disabled&&ta.servlet.Reviews.validateMTEdit(c,b)){a.disabled=false}},submitMTEdit:function(f,d,a,e){var b=ta.id("mtedit_submit");b.disabled=true;ta.select(".mtedit_error").each(function(i){i.hide()});if(ta.servlet.Reviews.validateMTEdit(f,d)){var c=ta.id("mtedit_mt");var h=c.getElements(".mtedit_title")[0].value;var g=c.getElements(".mtedit_text")[0].value;new Request({url:"/MachineTranslationEditSubmit?r="+a,data:{title:h,body:g,token:e},onSuccess:function(){try{ta.id("mtedit").hide();ta.id("mtedit_received").show();ta.retrieve("translationEditOverlay").position();var i=ta.id("mtForm"+a);i.getElement(".mtRateLabel").hide();i.getElement(".mtImproveButton").hide();i.getElement(".mtEditThanksLabel").show()}catch(j){ta.util.error.record(j,"submitMTEdit:onSuccess")}},onFailure:function(i){try{if(i.status>=400&&i.status<=499){ta.id("mtedit_404").show()}else{b.disabled=false;ta.id("mtedit_500").show()}}catch(j){ta.util.error.record(j,"submitMTEdit:onFailure")}}}).send()}else{ta.id("mtedit_nochange").show()}},rateMTReview:function(a,d){var c=ta.id(d.form);var h=c.getElement("input[name=translateRating]:checked");if(h){var e=h.value;var f=c.elements.userId.value;var b=c.elements.reviewId.value;ta.servlet.Reviews.translationRatings.push(b);var g=c.action+"?at=true&rateValue="+b+","+f+","+e;new Request({url:g}).send();var i=c.getElement(".thanks").innerHTML;c.getElement(".translationRatingForm").innerHTML=i}},rateMTReviewNew:function(a,d,b,e){var c=ta.id("mtForm"+b);if(c){var h=c.elements.userId;if(h){ta.servlet.Reviews.translationRatings.push(b);var i=c.action+"?at=true&rateValue="+b+","+h.value+","+e;new Request({url:i}).send();var f=document.getElement(".mtRatingOverlay");if(f){f.hide()}var g=c.getElement(".mtRatingButton");if(g){g.hide()}var j=c.getElement(".thanks");if(j){j.show()}}}},popSocialShare:function(b,a){if(b&&b.href){var c="toolbar=1,location=1,directories=1,status=1,menubar=1,resizable=1,copyhistory=1,scrollbars=1,width=800,height=400,left=40,top=40,screenx=40,screeny=40";window.open(b.href,"SocialShare",c)}new Request({url:"/ActionRecord?action=shareOn"+a}).send();return false},helpfulVoteHandlerOb:(function(){var a={};return function(c,b,d){if(a[b]){return}a[b]=true;new Event(c).preventDefault();var e=b.className.match(/\btgt_(\w+)\b/);if(!e){return}e=e[1];d=ta.util.ASDF.asdfDcd(d);new Request({url:d,onSuccess:function(f,h){var i=ta.id(e+"_expanded");var g=ta.id(e+"_collapsed");if(i){i.innerHTML=f}if(g){g.innerHTML=f;ta.store(e,true)}},onComplete:function(){delete a[b]}}).send()}})(),recordUnattached:function(b,a){new Request({url:"/ActionRecord?action=START_UNATTACHED_RVW_SEARCH"}).send();a.removePropertyEvent("keyup","ta.servlet.Reviews.recordUnattached")},changeSearchType:function(o,c){if(window.searchType){$$("span."+window.searchType.id).hide()}window.searchType=c;ta.select("span."+c.id).setStyle("display","inline");var f=c.getAttribute("data-type")||c.value;ta.find('input[name="type"]').value=f;var r=ta.id("query");var i=r.retrieve("typeahead");if(r&&i){var p=ta.servlet.Reviews.poiTypeIdMap[f];i.options.search=TypeAhead.utils.query(false,p,null,null,true,10);i.search()}var b=ta.find(".poiSearch");if(b){if(c.id=="type_rental"){ta.select(".poiSearchForm, #UR_SELECT, #SRCH_RSLT").hide();ta.select(".vrSearchForm").show();var k=ta.id("reviewGeo");if(k){k.focus();k.select()}}else{var m={type_hotel:"hotel",type_attraction:"attr",type_restaurant:"eat",type_location:"geo"};ta.store("tpAhdType",m[c.id]);ta.select(".vrSearchForm, #SRCH_RSLT_VR, #MAIN_COL, #POST_PHOTOS_FORM").hide();ta.select(".poiSearchForm, #UR_SELECT").show();if(r.value.length>0){searchByType()}r.focus();r.select();var n=ta.id("queryGeo");if(n){var g=n.retrieve("typeAhead");if(g){var d="GEO";if(c.id=="type_attraction"){d="ATTRGEO"}else{if(c.id=="type_restaurant"){d="RESTGEO"}}g.changeUrl("/TypeAheadJson?action="+d);g.query();g.updateChoices()}}}ta.select("#SRCH_RSLT, .tips").hide();ta.store("searchResultFlag",true)}else{var j="GEO";if(c.id!="type_rental"){switch(c.id){case"type_hotel":ta.store("tpAhdType","hotel");break;case"type_attraction":ta.store("tpAhdType","attr");j="ATTRGEO";break;case"type_restaurant":ta.store("tpAhdType","eat");j="RESTGEO";break;case"type_location":ta.store("tpAhdType","geo");break}if($("SRCH_BOX_VR")){$("SRCH_BOX_VR").hide()}if($("SRCH_RSLT_VR")){$("SRCH_RSLT_VR").hide()}if($("MAIN_COL")){$("MAIN_COL").hide()}if($("POST_PHOTOS_FORM")){$("POST_PHOTOS_FORM").hide()}$("SRCH_BOX").show();$("UR_SELECT").show();var a=ta.id("query");var e=a.retrieve("typeAhead");var l=ta.id("SEARCH_GEO");if(e){var h="/TypeAheadJson?action=SINGLELOCTYPE&types="+ta.retrieve("tpAhdType")+"&global=true";if(ifdefNN(l)&&ifdefNN(l.value)){h+="&parentids="+l.value}e.changeUrl(h);if(ifdefNN(a.value)&&a.value.trim().length!==0){e.query();e.updateChoices()}}a.focus();a.select();var n=ta.id("queryGeo");if(n){var g=n.retrieve("typeAhead");if(g){g.changeUrl("/TypeAheadJson?action="+j);g.query();g.updateChoices()}}}else{$("SRCH_BOX_VR").show();$("SRCH_BOX").hide();$("UR_SELECT").hide();var k=$("reviewGeo");k.focus();k.select()}ta.store("searchResultFlag",true);ta.id("SRCH_RSLT").hide()}},unattachedSearchOnFocus:function(e,c,b){var d=ta.retrieve("tpAhdType");var a={xargs:"&types="+d};if(b){a.geo=b}ta.run("ta.widgets.typeahead.factory.global_mutable",{},e,c,"SINGLELOCTYPE","ta.widgets.typeahead.events.onSelectUnattached",a);c.removePropertyEvent("focus","ta.servlet.Reviews.unattachedSearchOnFocus")},unattachedSearchGeoOnFocusAttach:function(d,a){var b=ta.retrieve("tpAhdType"),c=a.retrieve("typeAhead");ta.run("ta.widgets.typeahead.factory.global_mutable",{},d,a,"GEOGRAPHICONLY","ta.widgets.typeahead.events.onSelectGeoUnattached",{xargs:"&types="+b,minLength:1,noSearchPrompt:true});a.removePropertyEvent("focus","ta.servlet.Reviews.unattachedSearchGeoOnFocus")},unattachedSearchGeoOnFocus:function(c,a){var b=ta.id("SEARCH_GEO");b.value=1;a.value=""},unattachedSearchGeoOnBlur:function(g,b){var f=ta.id("SEARCH_GEO"),c=ta.id("query"),d=b.retrieve("typeAhead"),a=c.retrieve("typeAhead");if(!d.selected){var e=d.choices.getFirst();if(b.value==""||!e||!e.responseObj||e.responseObj.notFound){f.value=1;b.value=""}else{f.value=e.responseObj.value;b.value=e.responseObj.name}a.changeUrl("/TypeAheadJson?action=SINGLELOCTYPE&types="+ta.retrieve("tpAhdType")+"&global=true&parentids="+f.value)}},ratingFlyoutScroll:function(b){try{var c=b.getScroll().y,a=b.getScrollSize().y;if(b.retrieve("canFetchMore",true)&&c>a-ta.servlet.Reviews.PAGING_HEIGHT){b.store("canFetchMore",false);ta.servlet.Reviews.fetchRatingPage(b)}}catch(d){ta.util.error.record(d,"ratingFlyoutScroll")}},fetchRatingPage:function(b){var a=b.getElement(".ratingVal").innerHTML,c=b.getElement(".locId").innerHTML,e=b.getElement(".revId"),d=e.innerHTML;if(d!=0){new Request({url:"/RatingPagingAjax",data:{locId:c,ratingVal:a,revId:d},method:"get",onSuccess:function(f,g){e.destroy();b.innerHTML+=f;b.store("canFetchMore",true)}}).send()}},toggleOnRecentReview:function(h,f,a){if(!h||!f||!a){return}var e=ta.id(h.target||h.srcElement);var d=ta.id("RECENT_REVIEW_QUOTE_"+a);if(d&&e&&e.id==f.id){var g=d.getElement(".speechBubble");if(g){g.addClass("highlight")}var c=d.getElement(".recentReview_meta_content");if(c){c.addClass("highlight")}}if(!d||!d.hasClass("hidden")){return}var b=ta.id("RECENT_REVIEW_ATTRIBUTION_"+a);if(!b){return}ta.select("#HR_HACKATHON_CONTENT .recentReviewQuote").each(function(i){if(i.get("id")!="RECENT_REVIEW_QUOTE_"+a){if(!i.hasClass("hidden")){i.addClass("hidden")}}else{i.removeClass("hidden")}});ta.select("#HR_HACKATHON_CONTENT .recentReviewAttribution").each(function(i){if(i.get("id")!="RECENT_REVIEW_ATTRIBUTION_"+a){if(!i.hasClass("hidden")){i.addClass("hidden")}}else{i.removeClass("hidden")}})},toggleOffRecentReview:function(g,e,a){if(!g||!e||!a){return}var c=ta.id("RECENT_REVIEW_QUOTE_"+a);if(!c){return}var d=ta.id(g.target||g.srcElement);if(d&&d.id==e.id){var f=c.getElement(".speechBubble");if(f){f.removeClass("highlight")}var b=c.getElement(".recentReview_meta_content");if(b){b.removeClass("highlight")}}},onClickRecentReview:function(d,c,a){if(!d||!c||!a){return}var b=ta.id("RECENT_REVIEW_QUOTE_"+a);if(!b){return}var e=b.getElement(".quoteLnk");if(e){e.click()}},toggleReview:function(a,c,b,e){if(!a||!c||!b){return}var g=ta.id("review_"+b);var f=ta.id("UR"+b);var i;if(f){i=f}else{if(g){i=g}else{return}}var h=i.getElement(".col2of2");var d=i.getElement(".innerBubble");if(h&&d){if(e){h.addClass("highlight");d.addClass("highlight")}else{h.removeClass("highlight");d.removeClass("highlight")}}},scrollToReview:function(b,d,c){var i=document.getElements(".persistent_tabs_header");var e=0;if(i){e=i.getHeight()}var g=ta.id("review_"+c);if(g){window.scrollTo(0,g.getPosition().y-e)}else{var f=ta.retrieve("location.helpful_review_highlight.full."+c);if(f){var h=ta.select("#REVIEWS .reviewSelector");var a=Elements.from(f);h.some(function(j){if(!j.getParent("#FRIENDS_LOCATION_CONTENT_SUMMARY")){a.inject(j,"before");g=ta.id("review_"+c);window.scrollTo(0,g.getPosition().y-e);return true}return false})}}},poiTypeIdMap:{2:"hotel",7:"eat",5:"attr"},selectPoiType:function(d,a){ta.select(".poiTypes li").removeClass("selected");a.addClass("selected");var b=a.id.replace("type_","");ta.ReviewTracking.trackEvent("TYPE",b);var c=ta.find(".unattachedTypeahead");c&&c.toggleClass("hidden",a.id=="type_rental");ta.servlet.Reviews.changeSearchType(d,a)},selectPoiIcon:function(d,a){ta.select(".poiTypes li").addClass("collapsed");a.removeClass("disabled");a.getSiblings().addClass("disabled");var b=a.id.replace("type_","");ta.ReviewTracking.trackEvent("TYPE",b);var c=ta.find(".unattachedTypeahead");c&&c.toggleClass("hidden",a.id=="type_rental");ta.servlet.Reviews.changeSearchType(d,a)},createUnattachedTypeahead:function(e,c){c.onfocus=null;var b=ta.find('input[name="type"]').value;var d=ta.servlet.Reviews.poiTypeIdMap[b];var f=TypeAhead.utils.query(false,d,null,null,true,10);var a={name:"UnattachedWarLander",minChars:3,maxResults:10,containerParent:ta.id("PAGE"),containerClass:"typeaheadResults",search:f,itemTemplate:TypeAhead.views.itemTemplate(),itemSelector:"li",width:348,positionRelative:false,selectInputText:false,selectOnBlur:false,assumeOnBlur:false,cacheResults:false,autopopulateHighlighted:false,forceProcessResults:true,shouldSubmit:function(){searchByType(c);g.hide();return false},onSelect:function(h){var i=ta.find('input[name="type"]').value;ta.trackEventOnPage("Unattached_search","action",ta.servlet.Reviews.poiTypeIdMap[i]);var j=ta.id("UR_SELECT");if(j&&h){j.appendChild(new Element("input",{type:"hidden",name:"detail",value:h.value}));j.submit()}},resolveSelection:function(h){return h.name.stripTags()},onShow:function(h){h.container.addClass("visible")},onHide:function(h){h.container.removeClass("visible")}};TypeAhead.views.configureTypeAheadForSegmentedResults(a);var g=new TypeAhead(c,a);c.store("typeahead",g)},initializeMap:function(c,g,d,b){var f=c;var e=g;function a(){var h=new ta.servlet.Reviews.Map();h.initialize(f,e,d,b);ta.store("reviews.map."+c,h)}if(document.readyState==="complete"){a()}else{google.maps.event.addDomListener(window,"load",a)}},addDraggableMarker:function(a){var b=ta.retrieve("reviews.map."+a);if(b){b.addMarker();b.userMarker.setDraggable(true)}},makeMarkerDraggable:function(a){var b=ta.retrieve("reviews.map."+a);if(b&&b.userMarker){b.userMarker.setDraggable(true)}},restoreDefaultMarker:function(a){var b=ta.retrieve("reviews.map."+a);if(b){b.resetMap();if(b.userMarker){b.userMarker.setDraggable(false)}if((ta.retrieve("reviews.pinRedist"))!="true"){b.userMarker.setVisible(false)}}},mapPinConfirmationOverlay:function(c,b){var a=ta.retrieve("map_pin_confirmation_overlay");if(!a){a=new ta.overlays.RelativeOverlayRight({activate:ta.overlays.ACTIVATE_NEVER,showArrow:true,arrowClass:"arrow arrowLeft",showCloseButton:true,style:"tooltip ttGreen small",mirrorIfRtl:true,offsetRight:3,offsetTop:77},b);ta.store("map_pin_confirmation_overlay",a)}a.show()},trackMapPinConfirmationEvent:function(a,c){var b=ta.retrieve("reviews.map."+a);if(b){ta.trackEventOnPage("WAR_Optional",b.trackingPrefix+c)}},pinVoteNo:function(c,b,a){ta.servlet.Reviews.trackMapPinConfirmationEvent(a,"no");ta.id("PIN_YES").removeClass("selected");ta.id("PIN_NOTSURE").removeClass("selected");ta.id("PIN_NO").addClass("selected");ta.id("pinVote").value="no";if((ta.retrieve("reviews.pinRedist"))=="true"){ta.servlet.Reviews.makeMarkerDraggable(a);ta.servlet.Reviews.mapPinConfirmationOverlay(c,ta.id("MAP_CONTAINER"))}else{ta.servlet.Reviews.restoreDefaultMarker(a)}},pinVoteNotSure:function(c,b,a){ta.servlet.Reviews.trackMapPinConfirmationEvent(a,"unsure");ta.id("PIN_YES").removeClass("selected");ta.id("PIN_NO").removeClass("selected");ta.id("PIN_NOTSURE").addClass("selected");ta.id("pinVote").value="unsure";ta.servlet.Reviews.restoreDefaultMarker(a)},pinVoteYes:function(c,b,a){ta.servlet.Reviews.trackMapPinConfirmationEvent(a,"yes");ta.id("PIN_NO").removeClass("selected");ta.id("PIN_NOTSURE").removeClass("selected");ta.id("PIN_YES").addClass("selected");ta.id("pinVote").value="yes";if((ta.retrieve("reviews.pinRedist"))!="true"){ta.servlet.Reviews.addDraggableMarker(a);ta.servlet.Reviews.makeMarkerDraggable(a);ta.servlet.Reviews.mapPinConfirmationOverlay(c,ta.id("MAP_CONTAINER"))}else{ta.servlet.Reviews.restoreDefaultMarker(a)}}};ta.servlet.Reviews.Map=function Map(){this.mapId=null;this.isInteractive=false;this.isZoomInitialized=false;this.googleMap=null;this.streetField=null;this.localStreetField=null;this.street1_local=null;this.street1=null;this.city=null;this.state=null;this.country=null;this.defaultLat=null;this.defaultLng=null;this.hasDefault=false;this.redistributable=false;this.userMarker=null;this.userMarkerMoved=false;this.userMarkerZoom=-1;this.resetPinButton=null;this.trackingPrefix=null;this.trackingInteractivePrefix=null;this.updateTimeout=null};ta.servlet.Reviews.Map.prototype.initialize=function(c,h,e,b){this.mapId=c;this.isInteractive=h;this.streetField=ta.id(e);this.localStreetField=ta.id(b);this.populateMapInfoFromServlet();ta.trackEventOnPage("WAR_Optional",this.trackingPrefix+"load");var a={center:this.hasDefault?{lat:this.defaultLat,lng:this.defaultLng}:{lat:13.081,lng:80.274},zoom:this.hasDefault?this.streetLevelZoom+1:2,streetViewControl:h,draggable:h,scrollwheel:h,disableDefaultUI:!h,disableDoubleClickZoom:!h};this.googleMap=new google.maps.Map(document.getElementById(c),a);var d,f;if(h){d=new google.maps.MarkerImage(CDNHOST+"/img2/maps/icons/pinSearchCustom.png");f=new google.maps.MarkerImage(CDNHOST+"/img2/maps/icons/pinSearchCustomOver.png")}else{d=new google.maps.MarkerImage(CDNHOST+"/img2/maps/icons/pin_v2_CurrentCenter.png");f=new google.maps.MarkerImage(CDNHOST+"/img2/maps/icons/pin_v2_CurrentCenterOver.png")}this.userMarker=new google.maps.Marker({visible:false,icon:d,zIndex:10,optimized:false,draggable:false,title:h?ta.retrieve("reviews.userMarkerTooltip"):""});this.userMarker.setMap(this.googleMap);this.userMarker.setVisible(this.redistributable);this.userMarker.setPosition(this.googleMap.getCenter());this.removeReportAnErrorButton(this.googleMap);if(h){this.addListeners(d,f);this.addMapControls()}this.clearMapWarnings();var g=this;google.maps.event.addListenerOnce(this.googleMap,"tilesloaded",function(){g.setupGeoCodes()})};ta.servlet.Reviews.Map.prototype.addListeners=function(b,a){Element.NativeEvents.input=2;var c=this.userMarker;var d=this;[this.streetField,this.localStreetField].forEach(function(g){if(g){var f="mapChangeEvent."+d.mapId+"."+g.id;var e=function(i){d.updateGeoCodes()};var h=ta.retrieve(f);["change","input"].forEach(function(i){g.removeEvent(i,h);g.addEvent(i,e)});ta.store(f,e)}});google.maps.event.addListener(c,"mouseover",function(){c.setIcon(a)});google.maps.event.addListener(c,"mouseout",function(){c.setIcon(b)});google.maps.event.addListener(this.googleMap,"bounds_changed",function(){if(d.isZoomInitialized){ta.trackEventOnPage("WAR_Optional",d.trackingPrefix+"map_zoom")}if(d.userMarker.getVisible()&&d.googleMap.getBounds().contains(d.userMarker.getPosition())){d.userMarkerZoom=Math.max(d.googleMap.getZoom(),d.userMarkerZoom)}d.validateMap()});google.maps.event.addListener(c,"dragend",function(){ta.trackEventOnPage("WAR_Optional",d.trackingInteractivePrefix+"pin_move");d.resetTimeout();d.userMarkerMoved=true;d.userMarkerZoom=d.googleMap.getZoom();d.validateMap();ta.id("newLat").value=c.getPosition().lat();ta.id("newLng").value=c.getPosition().lng()})};ta.servlet.Reviews.Map.prototype.removeReportAnErrorButton=function(d){var a={name:"Dummy Style"};var b=[{featureType:"road",elementType:"all",stylers:[{visibility:"on"}]}];var c=new google.maps.StyledMapType(b,a);d.mapTypes.set("Dummy Style",c);d.setMapTypeId("Dummy Style")};ta.servlet.Reviews.Map.prototype.populateMapInfoFromServlet=function(){this.streetLevelZoom=parseInt(ta.retrieve("reviews.street_level_zoom"))||15;this.redistributable=(ta.retrieve("reviews.pinRedist"))=="true";this.defaultLat=parseFloat(ta.retrieve("reviews.pinLat"));this.defaultLng=parseFloat(ta.retrieve("reviews.pinLng"));this.hasDefault=!!(this.defaultLat&&this.defaultLng);this.city=ta.retrieve("reviews.address_city");this.state=ta.retrieve("reviews.address_state");this.country=ta.retrieve("reviews.address_country");this.street1=ta.retrieve("reviews.address_street1");this.street1_local=ta.retrieve("reviews.address_street1_local");if(this.redistributable){this.trackingPrefix="map_confirm_";this.trackingInteractivePrefix="map_confirm_no_"}else{if(this.hasDefault){this.trackingPrefix="map_addpin_noregc_";this.trackingInteractivePrefix="map_addpin_noregc_yes_"}else{this.trackingPrefix="map_addpin_nogc_";this.trackingInteractivePrefix="map_addpin_nogc_yes_"}}};ta.servlet.Reviews.Map.prototype.handleNewGeoCodes=function(e,c){var f=null;var d=null;var b=false;if(c==google.maps.GeocoderStatus.OK){if(e&&e[0]&&e[0].geometry&&e[0].geometry.location){b=true;var a=e[0].geometry.location;this.googleMap.fitBounds(e[0].geometry.viewport);this.userMarker.setPosition(this.googleMap.getCenter());if(this.street1||this.street1_local){f=a.lat();d=a.lng();this.googleMap.setZoom(this.streetLevelZoom+1)}}}else{if(c==google.maps.GeocoderStatus.ZERO_RESULTS){b=true}}if(b){this.defaultLat=f;this.defaultLng=d;this.hasDefault=!!(f&&d);this.userMarker.setVisible(this.hasDefault);this.userMarkerMoved=false}this.validateMap()};ta.servlet.Reviews.Map.prototype.resetTimeout=function(){if(this.updateTimeout){clearTimeout(this.updateTimeout);this.updateTimeout=null}};ta.servlet.Reviews.Map.prototype.updateGeoCodes=function(b){if(this.updateTimeout){clearTimeout(this.updateTimeout)}var c=this;var a=function(){c.updateTimeout=null;c.street1=c.streetField?c.streetField.value:null;c.street1_local=c.localStreetField?c.localStreetField.value:null;var g=c.googleMap;var e=[];e.push(c.street1_local||c.street1);e.push(c.city);e.push(c.state);e.push(c.country);var d=e.join(", ");var f=new google.maps.Geocoder();f.geocode({address:d},function(i,h){c.handleNewGeoCodes(i,h)})};if(b){a()}else{this.updateTimeout=setTimeout(a,500)}};ta.servlet.Reviews.Map.prototype.setupGeoCodes=function(){if(this.hasDefault){this.userMarker.setPosition(new google.maps.LatLng(this.defaultLat,this.defaultLng));this.userMarker.setVisible(this.redistributable);this.googleMap.setCenter(this.userMarker.getPosition());this.googleMap.setZoom(this.streetLevelZoom+1);this.validateMap();this.isZoomInitialized=true}else{this.updateGeoCodes(true);var a=this;google.maps.event.addListenerOnce(this.googleMap,"tilesloaded",function(){a.isZoomInitialized=true})}};ta.servlet.Reviews.Map.prototype.resetMap=function(){this.resetTimeout();if(this.hasDefault){var a=new google.maps.LatLng(this.defaultLat,this.defaultLng);this.userMarker.setPosition(a);if(!this.googleMap.getBounds().contains(a)){this.googleMap.setCenter(a)}ta.id("newLat").value="";ta.id("newLng").value=""}else{this.userMarker.setVisible(false)}this.userMarkerMoved=false;this.validateMap()};ta.servlet.Reviews.Map.prototype.addMarker=function(){this.resetTimeout();this.userMarker.setPosition(this.googleMap.getCenter());this.userMarkerZoom=this.googleMap.getZoom();this.userMarker.setVisible(true);this.validateMap()};ta.servlet.Reviews.Map.prototype.addMapControls=function(){var e=this;var c=document.createElement("div");var b=ta.retrieve("reviews.resetPinText");var d=ta.retrieve("reviews.resetPinTooltip");var a=function(){return function(){ta.trackEventOnPage("WAR_Optional",e.trackingInteractivePrefix+"pin_reset");e.resetMap()}};e.resetPinButton=ta.servlet.Reviews.Map.prototype.createButton("resetPinButton",b,d,a());c.appendChild(e.resetPinButton);c.index=0;this.googleMap.controls[google.maps.ControlPosition.RIGHT_TOP].push(c)};ta.servlet.Reviews.Map.prototype.createButton=function(g,e,f,b){var a=document.createElement("div");a.id=g;a.className="mapButton";var d=document.createElement("div");d.className="mapButtonBorder";d.title=f;a.appendChild(d);var c=document.createElement("div");c.className="mapButtonText";c.innerHTML=e;d.appendChild(c);if(b!=null){google.maps.event.addDomListener(d,"click",b)}return a};ta.servlet.Reviews.Map.prototype.addMapWarning=function(c){var b=ta.id("warningMessages");var a=ta.id("warningMessageContainer");if(a){ta.id(a).show()}if(b){if(b.innerHTML.length>0){b.innerHTML+="<br />"}b.innerHTML+=c}};ta.servlet.Reviews.Map.prototype.clearMapWarnings=function(){var b=ta.id("warningMessages");var a=ta.id("warningMessageContainer");if(a){ta.id(a).hide()}if(b){b.innerHTML=""}};ta.servlet.Reviews.Map.prototype.validateMap=function(){if(!this.isInteractive){return}this.clearMapWarnings();if(!this.checkZoom()){this.addMapWarning(ta.retrieve("reviews.zoomInWarningMsg"))}if(!this.userMarkerMoved){ta.id(this.resetPinButton).hide()}else{ta.id(this.resetPinButton).show()}};ta.servlet.Reviews.Map.prototype.checkZoom=function(){return this.userMarkerZoom>this.streetLevelZoom||!this.userMarkerMoved};ta.servlet.Location={distanceUnitsCookieName:"TAdistanceCookie",showMi:function(){$$("#NEARBY .milesOption").each(function(b,a){b.checked=true});$$("#NEARBY .milesLabel").each(function(b,a){$(b).addClass("selected")});$$("#NEARBY .kmLabel").each(function(b,a){$(b).removeClass("selected")});$$("#NEARBY .distanceMiles").show();$$("#NEARBY .distanceKm").hide();Cookie.write(this.distanceUnitsCookieName,0)},showKm:function(){$$("#NEARBY .kmOption").each(function(b,a){b.checked=true});$$("#NEARBY .milesLabel").each(function(b,a){$(b).removeClass("selected")});$$("#NEARBY .kmLabel").each(function(b,a){$(b).addClass("selected")});$$("#NEARBY .distanceMiles").hide();$$("#NEARBY .distanceKm").show();Cookie.write(this.distanceUnitsCookieName,1)},reportClosedVote:function(b,a,c){if(c&&c>0){c=encodeURIComponent(c);new Request({method:"get",url:"/ReportIAP?action=geocodeclosed&id="+c,onSuccess:function(d){ta.overlays.showInLightbox(d,{style:"mg s4",delayedPosition:true})}}).send()}},reportGeoCode:function(d,c,e,b,a){if(e&&e>0){e=encodeURIComponent(e);new Request({method:"get",url:"/ReportIAP?action=geocodebad&id="+e,onSuccess:function(f){ta.overlays.showInLightbox(f,{style:"mg s4",delayedPosition:true})}}).send()}if(ta.trackEventOnPage&&b&&a){ta.trackEventOnPage(b,a,e)}},reportCorrectAddr:function(c,f,k,n,d,i,l,o){if(k&&k>0){k=encodeURIComponent(k);var h=document.getElementById("street").value;var j=document.getElementById("city").value;var b=document.getElementById("state").value;var e=document.getElementById("zip").value;var g=document.getElementById("country").value;var m=document.getElementById("phone").value;var a=document.getElementById("website").value;if(n==h&&d==j&&i==e&&l==m&&o==a){new Request({method:"post",url:"/ReportIAP?action=geocodecorrect&updated=false&id="+k,onSuccess:function(p){ta.overlays.showInLightbox(p,{style:"mg s4",delayedPosition:true})}}).send()}else{h=encodeURIComponent(h);j=encodeURIComponent(j);b=encodeURIComponent(b);e=encodeURIComponent(e);g=encodeURIComponent(g);m=encodeURIComponent(m);a=encodeURIComponent(a);new Request({method:"post",url:"/ReportIAP?action=geocodecorrect&updated=true&id="+k+"&street="+h+"&city="+j+"&state="+b+"&zip="+e+"&country="+g+"&phoneNumber="+m+"&webSite="+a,onSuccess:function(p){ta.overlays.showInLightbox(p,{style:"mg s4",delayedPosition:true})}}).send()}}},reportGeoCodeDialog:function(d,c,e,b,a){if(typeof(incorrectLocation)!="undefined"&&!this.incorrectLocationLink){this.incorrectLocationLink=Asset.css(incorrectLocation)}if(e&&e>0){e=encodeURIComponent(e);new Request({method:"get",url:"/ReportIAP?id="+e+"&action=geocodedialog",onSuccess:function(f){ta.overlays.showInLightbox(f,{style:"mg s4",delayedPosition:true})},evalScripts:true}).send()}if(ta.trackEventOnPage&&b&&a){ta.trackEventOnPage(b,a,e)}},updateListingInformation:function(a,c,e,i,f,b,h,g){if(e&&e>0){if(g){window.location.href=g}else{var d={style:"glnew_lightbox",closeButtonClass:"innerClose",delayedPosition:true,attachCloseEvent:false,permanent:true,showCloseButton:true};new Request({url:"/GetListedUpdate"+b+"?id="+e,onSuccess:function(k){var j=ta.overlays.showInLightbox(k,Object.merge(d,{title:h}));j.closeBtn.addEvent("click",function(){ta.GetListedNew.closeOverlay()})},evalScripts:true}).send()}}if(ta.trackEventOnPage&&i&&f){ta.trackEventOnPage(i,f,e)}},reportClosedVoteNew:function(d,c,f,b,a,e){if(f&&f>0){new Request({method:"post",url:"/"+e+"?action=closedareyousure&id="+f,onSuccess:function(g){ta.overlays.showInLightbox(g,{style:"glnew_update_areyousure mg s4",delayedPosition:true,isChild:true,showCloseButton:false})},evalScripts:true}).send()}},recordOpenVote:function(d,c,f,b,a,e){if(f&&f>0){new Request({method:"post",url:"/"+e+"?action=voteopen&id="+f,onSuccess:function(g){ta.overlays.showInLightbox(g,{style:"mg s4",delayedPosition:true,showCloseButton:false})},evalScripts:true}).send()}},requestListingWithLightbox:function(b,c,a,h,j,e){var f={};var i=document.getElementById("query");if(i&&i.value){f.query=i.value}var d={style:"glnew_lightbox",closeButtonClass:"innerClose",delayedPosition:true,attachCloseEvent:false,permanent:true,showCloseButton:true};var g="/GetListedLightbox?placetype="+a;if(j){g=g+"&showthanks=true"}if(e){g=g+"&fromWARToDo=true"}new Request({method:"post",url:g,data:f,onSuccess:function(l){var k=ta.overlays.showInLightbox(l,Object.merge(d,{title:h}));k.closeBtn.addEvent("click",function(){ta.GetListedNew.closeOverlay()});ta.select(".overlayBG").setStyle("height",Math.max(window.innerHeight?window.innerHeight:(document.documentElement.clientHeight?document.documentElement.clientHeight:document.body.offsetHeight),document.body.scrollHeight))},evalScripts:true}).send()},showReportForm:function(b,a,c){if(c&&c>0){c=encodeURIComponent(c);new Request({method:"get",url:"/ReportIAP?id="+c+"&action=geocodeform",onSuccess:function(d){ta.overlays.showInLightbox(d,{style:"mg s4",delayedPosition:true})},evalScripts:true}).send()}},setTrackPID:function(c,b,a){if(a==10022){ta.util.cookie.setPIDCookie(17138)}else{if(a==10021){ta.util.cookie.setPIDCookie(17137)}}},closeLightbox:function(){var a=ta.retrieve("overlays.current");if(a){a.hide()}},activateReportButton:function(){var a=ta.id("REPORT_LOCATION").getElements(".button")[0];a.removeClass("inactive");a.removeProperty("disabled")}};ta.servlet.Popup={index:0,open:function(a,b,c,p,l,k,g,o){try{if(isNaN(parseInt(c))){c=600}else{c=parseInt(c)}if(isNaN(parseInt(p))){p=400}else{p=parseInt(p)}if(isNaN(parseInt(l))){l=0}else{l=parseInt(l)}if(isNaN(parseInt(k))){k=0}else{k=parseInt(k)}if(a.indexOf("p=HotelsCom")>-1){c=Math.max(c,960);p=Math.max(p,window.getHeight(),600)}if(Browser.chrome){g=true}var f=1;if(g){f=0}var j=1;if(ta.browser.isIE9orHigher()){var j=0}var i=false;if(b&&typeof b=="string"){i=b}if(!i){var q=ta.servlet.Popup.index++;i="TripPop"+q}var d="";if(o){d="toolbar=1,resizable=1,location=1,status=1"}else{j=0;d="toolbar=0,resizable=1,location=0,status=0"}d+=",menubar="+j;d+=",scrollbars="+f;d+=",width="+c;d+=",height="+p;d+=",screenX="+l+",left="+l;d+=",screenY="+k+",top="+k;var m=window.open(a,i,d);if(m!=null){try{m.focus();m.opener=self}catch(n){}return m}}catch(h){ta.util.error.record(h,"Popup.open",null,{name:b,width:c,height:p,x:l,y:k,noScroll:g,allOptions:o})}},openExternalWithDefaultOptions:function(a){try{var b=475;var n=390;var k=210;var j=5;if(screen.width>=1024&&screen.height>=768){b=900;n=768;k=240}else{if(screen.width>1024){b=800;n=600;k=240}else{if(screen.width>800){b=620;n=500;k=240}}}if(a.indexOf("p=HotelsCom")>-1){b=Math.max(b,960);n=Math.max(n,window.getHeight(),600)}var f=false;if(Browser.chrome){f=true}var d=1;if(f){d=0}var i=1;if(ta.browser.isIE9orHigher()){var i=0}var o=ta.servlet.Popup.index++;var h="TripPop"+o;var c="toolbar=1,resizable=1,location=1,status=1";c+=",menubar="+i;c+=",scrollbars="+d;c+=",width="+b;c+=",height="+n;c+=",screenX="+k+",left="+k;c+=",screenY="+j+",top="+j;var l=window.open(a,h,c);if(l!=null){try{l.focus();l.opener=self}catch(m){}return l}}catch(g){ta.util.error.record(g,"Popup.open - openExternalWithDefaultOptions",null,{name:name,width:b,height:n,x:k,y:j,noScroll:f})}},openSizedPopup:function(e,b,d){new Event(e).preventDefault();var c=600;var a=400;if(sz=b.className.match(/sz(\d+)x(\d+)/)){c=sz[1];a=sz[2]}ta.servlet.Popup.open(b.href,"photoTPW",c,a,false,false,((typeof d!="undefined")?d:true),true)},checkrates:function(b,a){b.preventDefault();if(a.get("tag")!="a"){a=a.getParent("a")}ta.servlet.Popup.open(a.href,"cr",245,610,5,5);if(ta.trackEventOnPage){ta.trackEventOnPage("map_pin_overlay","check_rates_click")}},sponsorCheckRates:function(d,b){d.preventDefault();if(b.get("tag")!="span"){b=b.getParent("span")}var a=b.className.match(/id_(\d+)/)[1];var c="/HotelDateSearch?d="+a+"&fromPop=false&sponsid="+ta.retrieve("sponsor.id")+"&area=QC_Button_Map&from=HACSearchButton&returnTo=__2F__GMapsLocationController&sponsdet=mapsHacBottom";ta.servlet.Popup.open(c,"cr",245,610,5,5)},termsPopup:function(b,a){popup.apply(a,[b,"terms",300,300,30,25]);return false},openInParent:function(e,d,c){var a=false;if(window.top&&window.top.opener){a=window.top}else{if(window.opener){a=window}}if(!a){return true}var b="";if(d.get("tag")=="form"){b=d.action+"?"+d.toQueryString()}else{if(d.get("tag")=="a"){b=d.href}else{d=d.getParent("a");b=d.href}}if(b!=""){if(e){e.preventDefault()}a.opener.location=b;if(!(typeof c!="undefined"&&c)){a.close()}else{window.blur()}}},openInParentOrSelf:function(d,c){var a=false;if(window.top&&window.top.opener){a=window.top}else{if(window.opener){a=window}}var b="";if(c.get("tag")=="form"){b=c.action+"?"+c.toQueryString()}else{if(c.get("tag")=="a"){b=c.href}else{c=c.getParent("a");b=c.href}}if(b!=""){if(d){d.preventDefault()}if(!a||(typeof a.opener=="undefined")||!a.opener||(typeof a.opener.closed=="undefined")||a.opener.closed){window.location=b}else{a.opener.location=b;a.close()}}},photoGallery:function(a,d){try{if(!d){return false}if(!d.get||!d.getParentBySelector){d=$(d)}if(!d.get||!d.getParentBySelector){ta.util.error.record(j,"photoGallery - elmt not wrapped");return false}if(d.get("tag")!="a"){d=d.getParentBySelector("a")}}catch(j){ta.util.error.record(j,"photoGallery - get anchor elmt");return false}var b="";var c="1";if(d.className){b=d.className.match(/u_([^ ]*)/)[1];c=d.className.match(/#([0-9]+)/)[1]}try{if(typeof cookieDomain=="undefined"){var g=window.location.hostname.split("."),f=0,l;while(g[f]&&g[f]!="tripadvisor"){f++}l=g.slice(f).join(".");if(l){cookieDomain="."+l}}Cookie.write("PhotoPop",c,{domain:cookieDomain})}catch(j){ta.util.error.record(j,"photoGallery - cookie set")}try{var k="";if(b){k=ta.servlet.Popup.open(b,"media",780,800)}else{}try{if(k&&k.showImage){k.showImage(c)}}catch(j){}}catch(j){ta.util.error.record(j,"photoGallery - pop window")}return false},openAIMLink:function(d,c){new Event(d).preventDefault();var b;if(c.get("tag")=="span"&&c.hasClass("fkASDF")){b=c.className.match(/u_([^ ]*)/)[1]}else{if(c.getParent("div.fkASDF")){b=c.getParent("div.fkASDF").className.match(/u_([^ ]*)/)[1]}else{if(c.get("tag")=="a"){b=c.href}else{if(c.getParent().get("tag")=="a"){b=c.getParent().href}else{return}}}}b=b.replace("%7Cnavarea%7C",ta.meta.link.getPhotoNavArea(c));var a=c.className.match(/win(.+)/);if(a&&a.length>1){a=a[1]}else{a=null}ta.store("commerce.AIMWindow",ta.servlet.Popup.open(b,a,980,800,240,5,false,true));try{if(ta.has("checkrates.lpl_check_rates")&&c.href&&c.href.match(/LocationPhotosLightbox/)){ta.id("MEDIA_GALLERY").hide()}}catch(f){ta.util.error.record(f,"LPL photoGallery - could not hide photo gallery")}},openProviderWindow:function(b,a){new Event(b).preventDefault();ta.servlet.Popup.open(a.href,"photoTPW",1260,922,false,false,true,true)}};ta.servlet.Hotel={detailsTabClicked:function(b,a){showTab(locationId,"tabDetails")},photosTabClicked:function(b,a){showTab(locationId,"tabPhotos")},mapTabClicked:function(b,a){showTab(locationId,"tabMap")},ratingsTabClicked:function(b,a){showTab(locationId,"tabRatings")},anchorAtHotelsSortingHeader:function(){var a=ta.id("hotels_list_sorting_header");if(a){new Fx.Scroll(document.body,{offset:{x:0,y:a.getPosition().y}}).toTop()}},setPid:function(a){ta.util.cookie.setPIDCookie(a)},setConceptCookie:function(){if(ta.has("topconcepts.lastconcept")){var a=ta.retrieve("topconcepts.lastconcept");Cookie.write("CONCEPT",a,{domain:cookieDomain,time:5})}return true},voteRecorded:false,recordVote:function(b,g,e,c,a){if(a.checked&&!ta.servlet.Hotel.voteRecorded){ta.servlet.Hotel.voteRecorded=true;new Request({url:"/ActionRecord-g"+b+"-d"+g+"?action=TopConceptsHelpful_"+e}).send();var d=$("preVote");var f=$("postVote");if(d&&f){d.style.display="none";f.style.display="inline"}else{ta.util.error.record(null,"recordVote - cannot find voting spans")}}return true},isHotelsServlet:function(a){if(ta.has("is_hotels_serv")){return ta.retrieve("is_hotels_serv")}var b=ta.id("PAGE");if(b&&typeof b!="undefined"){if(b.hasClass("hotels_like")){ta.store("is_hotels_serv",true);return true}else{if(b.hasClass("non_hotels_like")){ta.store("is_hotels_serv",false);return false}}}if(typeof a!="undefined"){return a}return false},selectLanguage:function(d,b,e){var c=ta.id("LANG_FORM");var a=ta.id("filterLang");if(c&&a){ta.setEvtCookie("Reviews_Controls","language_sort","",0,window.location.href);a.value=e;c.submit()}},selectSeason:function(a,f,i,b,d,e){var g=ta.find("#MONTH_FORM .seasonLabel");if(ta.util.localstorage&&ta.util.localstorage.canUseLocalStore()){var h=new Date();h.setHours(h.getHours()+12);if(d!=0){localStorage.setItem("season_memory_expiry_time",h);localStorage.setItem("season_memory_loc_id",i);localStorage.setItem("season_memory_geo_id",b)}else{localStorage.removeItem("season_memory_expiry_time");localStorage.removeItem("season_memory_popup_shown");localStorage.removeItem("season_memory_loc_id");localStorage.removeItem("season_memory_new_popup_shown");localStorage.removeItem("season_memory_geo_id")}}if(g&&e){g.set("text",e)}var c=ta.id("MONTH_FORM");var k=ta.id("filterSeasons");if(c&&k){k.value=d;ta.trackEventOnPage("Reviews_Controls","season","",d);function j(){var l=ta.select(".seasonList .spinner img");l.forEach(function(n){n.remove()});var m=ta.find(".spinner",f);if(m){new Asset.image(CDNHOST+"/img2/spinner.gif").inject(m)}}j();c.submit()}}};ta.widgets.calendar={multiDateFormatter:function(f,g,e,c,d){var b={cname:"",contents:f.getDate()};var a="";if(!e){a="invalid"}else{if(f.getTime()==this.today.getTime()){if(this.newInDate&&f.getTime()==this.newInDate.getTime()){a="today inDate"}else{if(!g){a="today disabled"}else{a="today"}}}else{if(this.newInDate&&f.getTime()==this.newInDate.getTime()){a=d.inDateClass}}}b.cname=a;return b},calendarSingleSelect:function(h,g,a,f,b){try{ta.id(b).getParent(".overlay").overlay.calendar.singleDaySelect(h,ta.util.date.create(g,a,f),b)}catch(c){ta.util.error.record(c,"calendarSingleSelect issue")}},calendarMCSelect:function(h,g,a,f,b){try{ta.id(b).getParent(".overlay").overlay.calendar.multiCitySelect(h,ta.util.date.create(g,a,f),b)}catch(c){ta.util.error.record(c,"calendarMCSelect issue")}},dateFromString:function(d){d=d.replace(/\n/g,"");var a=ta.widgets.calendar.getDatePickerFormat("classic");var c=a.replace(/\w/g,"")[0];a=a.replace(/ /g,"").split(c);var b=d.replace(/ /g,"").split(c);if(a.contains("MM")&&a.contains("dd")&&a.contains("yyyy")){var h=a.indexOf("MM"),f=a.indexOf("dd"),g=a.indexOf("yyyy");var e=new Date(b[g],b[h]-1,b[f]);if(ta.retrieve("thai_buddhist_era_year")){e.setFullYear(e.getFullYear()-ta.util.date.THAI_BUDDHIST_YEAR_OFFSET)}if(e!="Invalid Date"){return e}}return undefined},lastDateBefore:function(b,c){if(b.multiCityFlight&&c>1){var a;var d=c;while((!a||a.trim()==="")&&d>1){--d;a=ta.id("date_picker_in_"+d).innerHTML}if(a&&a.trim()!==""){return ta.widgets.calendar.dateFromString(a)}}return this.getPageInDate()},calendarMultiSelect:function(h,g,a,f,b){try{ta.id(b).getParent(".overlay").overlay.calendar.multiSelect(h,ta.util.date.create(g,a,f),b)}catch(c){ta.util.error.record(c,"calendarMultiSelect issue")}},calendarMouseOver:function(f,e,a,c,b){ta.id(b).getParent(".overlay").overlay.calendar.dayOver(f,ta.util.date.create(e,a,c),b)},calendarPrev:function(c,b){var a=ta.id(b);if(a&&a.hasClass("sprite-date_picker-btnLeftInactive")){return}if(ta.util.i18n.isRtl()&&a&&a.hasClass("sprite-date_picker-btnRightInactive")){return}a.getParent(".overlay").overlay.calendar.prev()},calendarNext:function(c,b){var a=ta.id(b);if(a&&a.hasClass("sprite-date_picker-btnRightInactive")){return}if(ta.util.i18n.isRtl()&&a&&a.hasClass("sprite-date_picker-btnLeftInactive")){return}a.getParent(".overlay").overlay.calendar.next()},adultsOver:function(c,b){var a=document.getElements(".date_picker_adults_option");if(a){Array.each(a,function(d){ta.id(d).removeClass("adults_selected")})}ta.id(b).addClass("adults_selected")},removeMetaCalendarFromSync:function(c){if(!ta.has("metaDatePickerEnabled")){return}var b="avail.data."+c+"._met";var a=ta.retrieve("avail.data.objects");if(a){a.erase(b)}ta.store("avail.data.objects",a);ta.remove(b)},getCalendarObjectKey:function(d,b,a){var c="avail.data";if(a){c=c+"."+a}c=c+"."+d;if(b){c=c+"."+b}return c},trackCalendarObject:function(c){var a=ta.widgets.calendar.getCalendarObjectKey(c.locId,c.ext,c.calendar.options.pickerOption);ta.store(a,c);var b=ta.retrieve("avail.data.objects");if(!b){b=[]}b.include(a);ta.store("avail.data.objects",b)},trackCalendarFlyout:function(d,c,e){var f="date.picker.calendarflyout";var b=ta.retrieve(f);if(!b){b=[]}var a={};a.elmt=d;a.overlay=c;a.overlaySrc=e;b.push(a);ta.store(f,b);ta.remove("date.picker.calendarflyout.allCleared")},clearCalendarFlyouts:function(){var b="date.picker.calendarflyout";var a=ta.retrieve(b);if(a){a.each(function(c){var e=c.elmt;var d=c.overlay;var f=c.overlaySrc;if(e&&d&&f){e.removeEvent("mouseenter",d.showWithDelay);e.removeEvent("mouseleave",d.hideWithDelay);e.removeEvent("mouseenter",d.show);e.removeEvent("mouseleave",d.hide);e.removeEvent("click",d._pin);e.adopt(f)}});ta.store("date.picker.calendarflyout.allCleared",true)}},getDateBefore:function(b){var a=new Date(b.getTime());a.setDate(a.getDate()-1);return a},getDateAfter:function(b){var a=new Date(b.getTime());a.setDate(a.getDate()+1);return a},setPageInDate:function(a){if(a&&a.getDate){ta.store("date.picker.pageInDate",a)}if(ta.has("date.picker.pageOutDate")){ta.store("meta.page_dates",true)}},setPageOutDate:function(a){if(a&&a.getDate){ta.store("date.picker.pageOutDate",a)}if(ta.has("date.picker.pageInDate")){ta.store("meta.page_dates",true)}ta.widgets.calendar.updateCalendarPropertiesOnDateSet()},setTimeoutPageDates:function(){var b=ta.widgets.calendar._parseDatePickerDate(ta.retrieve("multiDP.inDateTimeout"));if(b){ta.widgets.calendar.setPageInDate(b)}var a=ta.widgets.calendar._parseDatePickerDate(ta.retrieve("multiDP.outDateTimeout"));if(a){ta.widgets.calendar.setPageOutDate(a)}},clearPageDates:function(){ta.store("data.picker.cachedDateCleared",true);ta.remove("date.picker.pageInDate");ta.remove("date.picker.pageOutDate");ta.remove("multiDP.inDate");ta.remove("multiDP.outDate");ta.remove("meta.page_dates");ta.remove("meta.session_dates");ta.remove("multiDP.priorDates");if(ta.isMetaHotelsRequest()||ta.has("meta.mini_meta_on_accommodations")){ta.store("dates.datesCleared",true)}},clearPageInDate:function(){ta.remove("date.picker.pageInDate");ta.remove("multiDP.inDate");ta.remove("meta.page_dates")},clearPageOutDate:function(){ta.remove("date.picker.pageOutDate");ta.remove("multiDP.outDate");ta.remove("meta.page_dates")},updateCalendarPropertiesOnDateSet:function(){var a=ta.retrieve("avail.data.objects");if(a){Array.each(a,function(c){var b=ta.retrieve(c);if(b&&b.calendar){b.calendar.setPermanent(false)}})}},setPageAdultsCount:function(a){if(a){ta.store("date.picker.adultsCount",a)}},getPageInDate:function(){var a=false;if(ta.has("date.picker.pageInDate")){a=ta.retrieve("date.picker.pageInDate")}if(!a&&ta.has("multiDP.inDate")){a=ta.widgets.calendar._parseDatePickerDate(ta.retrieve("multiDP.inDate"));if(a){ta.widgets.calendar.setPageInDate(a)}}if(a){return new Date(a.getTime())}return false},getPageOutDate:function(){var a=false;if(ta.has("date.picker.pageOutDate")){a=ta.retrieve("date.picker.pageOutDate");if(!ta.widgets.calendar.isValidStayLength(a)){ta.widgets.calendar.clearPageOutDate();return false}if(a){return new Date(a.getTime())}}if(!a&&ta.has("multiDP.outDate")){a=ta.widgets.calendar._parseDatePickerDate(ta.retrieve("multiDP.outDate"));if(a){ta.widgets.calendar.setPageOutDate(a)}if(!ta.widgets.calendar.isValidStayLength(a)){ta.widgets.calendar.clearPageDates();return false}if(a){return new Date(a.getTime())}}return false},haveDatesChanged:function(){var a=ta.widgets.calendar.getPageInDate(),b=ta.widgets.calendar.getPageOutDate(),d=ta.widgets.calendar._parseDatePickerDate(ta.retrieve("multiDP.inDate")),c=ta.widgets.calendar._parseDatePickerDate(ta.retrieve("multiDP.outDate"));return(!d||a.getTime()!=d.getTime())||(!c||b.getTime()!=c.getTime())},isValidStayLength:function(b){var c=ta.widgets.calendar.getPageInDate();if(!c||!b){return true}var d=0,a=0;if(ta.retrieve("allowLongTrips")){d=b-new Date();a=ta.util.date.MAX_DAYS_BEFORE_RETURN_FLIGHT}else{d=b-c;a=ta.util.date.MAX_STAY_DURATION_DAYS}d=Math.round(d/1000/60/60/24);if(d>a){return false}return true},getPageAdultsCount:function(){if(ta.has("date.picker.adultsCount")){return ta.retrieve("date.picker.adultsCount")}if(ta.has("multiDP.adultsCount")){ta.store("date.picker.adultsCount",ta.retrieve("multiDP.adultsCount"));return ta.retrieve("multiDP.adultsCount")}return"2"},getGuestsRoomsPickerData:function(){var g=ta.retrieve("guests.rooms.object"),c,b;if(!g){try{var f=Cookie.read("TATravelInfo");var a=ta.widgets.calendar.getGuestsRoomsValue(f,"A");if(a&&a!==""){c=parseInt(a,10)}var d=ta.widgets.calendar.getGuestsRoomsValue(f,"RS");if(d&&d!==""){b=parseInt(d,10)}if(c&&c>0&&b&&b>0){g={rooms:b,guests:c};ta.store("guests.rooms.object",g)}}catch(h){ta.util.error.record(h,"ta.widgets.calendar.getGuestsRoomsPickerData")}}if(!g){g={rooms:1,guests:2};ta.store("guests.rooms.object",g)}return g},getCheckRatesData:function(){var e=ta.widgets.calendar.getPageInDate();var b=ta.widgets.calendar.getPageOutDate();var c=ta.widgets.calendar.getPageAdultsCount();if(!e||!b||!e.getMonth||!b.getMonth){return false}var a={inMonth:(e.getMonth()+1)+" "+e.getFullYear(),inDay:e.getDate(),outMonth:(b.getMonth()+1)+" "+b.getFullYear(),outDay:b.getDate(),adults:c};if(ta.has("guests_rooms_picker.enabled")){var d=ta.widgets.calendar.getGuestsRoomsPickerData();a.adults=d.guests;a.rooms=d.rooms}return a},_parseDatePickerDate:function(c){try{if(c&&c.split&&c.split(" ").length>1){var a=c.split(" ");var b=new Date();ta.util.date.normalize(b);b.setFullYear(a[0]);b.setDate(1);b.setMonth(parseInt(a[1],10)-1);b.setDate(a[2]);return b}}catch(d){return false}},hasPageDates:function(){if(!ta.has("metaDatePickerEnabled")){return false}if(ta.has("meta.page_dates")){return true}ta.widgets.calendar.getPageInDate();ta.widgets.calendar.getPageOutDate();return ta.has("meta.page_dates")},oneDayMill:(24*60*60*1000),updateDateWidgetDisplay:function(a){if(!a){return}ta.id(a).removeClass("date_picker_error");var c=ta.widgets.calendar.getPageInDate();var b=ta.widgets.calendar.getPageOutDate();ta.widgets.calendar.updateDateDisplay(a,c,b);var d=document.getElements(".adults");if(d){d.each(function(e){ta.widgets.calendar.updateAdultsDisplay(e)})}},getPageInCalendarField:function(b,a){return ta.id("date_picker_in_"+b+a)},getPageOutCalendarField:function(b,a){return ta.id("date_picker_out_"+b+a)},getErrorDates:function(){var c="no dates";try{var a=ta.widgets.calendar.getDatePickerFormat("classic");if(ta.widgets.calendar.hasPageDates()){c=ta.widgets.calendar.dateToString(ta.widgets.calendar.getPageInDate(),a);c=c+" - "+ta.widgets.calendar.dateToString(ta.widgets.calendar.getPageOutDate(),a)}}catch(b){}return c},updateDateDisplay:function(b,c,g){var d,a,f,i,e,h,j;if(c&&g&&c.getTime()>g.getTime()){d=c;c=g;g=d}a=ta.widgets.calendar.getDatePickerFormat("classic");if(ta.id(b).getParent(".dual_date")){b.innerHTML=c?ta.widgets.calendar.dateToString(c,a):ta.retrieve("multiDP.checkIn");f=b.id.replace("date_picker_in","date_picker_out");if(f&&ta.id(f)){ta.id(f).innerHTML=g?ta.widgets.calendar.dateToString(g,a):ta.retrieve("multiDP.checkOut")}}else{i=b.innerHTML=ta.retrieve("multiDP.enterDatesText");e=ta.widgets.calendar.getSingleDateFieldDatesText(c,g,a);if(e){i=e}b.innerHTML=i;h=ta.id(b).getParent();if(h){j=h.getElement(".date_picker_calendar_nights");ta.widgets.calendar.updateNightsDisplay(j,c,g)}}},getSingleDateFieldDatesText:function(d,b,a){var c="";var e=ta.retrieve("multiDP.dateSeparator")||" - ";if(d){c=ta.widgets.calendar.dateToString(d,a)+e;if(b){c=c+ta.widgets.calendar.dateToString(b,a)}}return c},updateNightsDisplay:function(d,c,a){if(!d){return}if(!a){d.innerHTML="";return}var b=ta.widgets.calendar.getNumberOfNightsFromDates(c,a);if(b==1){d.innerHTML=ta.retrieve("multiDP.singleNightText")}else{d.innerHTML=ta.retrieve("multiDP.multiNightsText").replace(/\d+/,b)}},getNumberOfNights:function(){var b=ta.widgets.calendar.getPageInDate(),a=ta.widgets.calendar.getPageOutDate();return ta.widgets.calendar.getNumberOfNightsFromDates(b,a)},getNumberOfNightsFromDates:function(b,a){if(b&&a){return Math.round(Math.abs((b.getTime()-a.getTime())/ta.widgets.calendar.oneDayMill))}else{return 0}},updateAdultsDisplay:function(b){if(!b){return}var a=ta.widgets.calendar.getPageAdultsCount();if(a=="1"){b.innerHTML=ta.retrieve("multiDP.singleAdultsText")}else{b.innerHTML=ta.retrieve("multiDP.multiAdultsText").replace(/\d+/,a)}},syncAllDatePickers:function(){var c=document.getElements(".date_picker.date");if(c){Array.each(c,function(g){if(g&&!ta.id(g).hasClass("out_date")&&!ta.id(g).hasClass("multiCity")){ta.widgets.calendar.updateDateWidgetDisplay(g)}})}var a=$$(".tablet_date_label");if(a&&ta.widgets.calendar.hasPageDates()){a.addClass("showLabels")}a=document.getElements(".dateLabel");if(a){var f=ta.widgets.calendar.getDatePickerFormat("short");var b=ta.widgets.calendar.getDatePickerFormat("classic");var e=ta.widgets.calendar.dateToString(ta.widgets.calendar.getPageInDate(),b);if(ta.has("guests_rooms_picker_3.enabled")){e=ta.widgets.calendar.dateToString(ta.widgets.calendar.getPageInDate(),f)}var d=ta.widgets.calendar.dateToString(ta.widgets.calendar.getPageOutDate(),b);Array.each(a,function(g){var h=ta.id(g);if(h){if(h.hasClass("inDate")){h.innerHTML=e?e:ta.retrieve("multiDP.checkIn")}else{if(h.hasClass("outDate")){h.innerHTML=d?d:ta.retrieve("multiDP.checkOut")}}}})}},getDatePickerFormat:function(a){if(a==="classic"&&typeof DATE_PICKER_CLASSIC_FORMAT!="undefined"){return DATE_PICKER_CLASSIC_FORMAT}else{if(a==="short"&&typeof DATE_PICKER_SHORT_FORMAT!="undefined"){return DATE_PICKER_SHORT_FORMAT}else{if(typeof DATE_PICKER_META_FORMAT!="undefined"){return DATE_PICKER_META_FORMAT}}}if(typeof a!="string"){a="not_a_string"}return""},dateToString:function(d,e){var b,j,a,h,c,k,i,f,g;if(!d.getDate||!e){return""}if(e==ta.widgets.calendar.getDatePickerFormat("classic")){b=new Date(d);if(ta.retrieve("thai_buddhist_era_year")){b.setFullYear(b.getFullYear()+ta.util.date.THAI_BUDDHIST_YEAR_OFFSET)}j="MM";a="yyyy";h="dd";f=b.getDate()+"";if(f&&f.length===1){f="0"+f}g=(b.getMonth()+1)+"";if(g&&g.length===1){g="0"+g}e=e.replace(j,g).replace(h,f).replace(a,b.getFullYear()).replace(/'/g,"");return e}else{if(e==ta.widgets.calendar.getDatePickerFormat("short")){b=new Date(d);j="MM";h="dd";f=b.getDate()+"";if(f&&f.length==1){f="0"+f}g=(b.getMonth()+1)+"";if(g&&g.length==1){g="0"+g}e=e.replace(j,g).replace(h,f).replace(/'/g,"");return e}}c=ta.retrieve("multiDP.abbrevMonthList");k=d.getDay();if(ta.retrieve("multiDP.isMondayFirstDayOfWeek")){k=k-1}if(k==-1){k=6}i="EEE";j="MMM";if(e=="EEEE d MMMM"){i="EEEE";j="MMMM"}e=e.replace(i,jsGlobalDaysAbbrev[k]).replace(j,c[d.getMonth()]).replace(/\bd\b/,d.getDate()).replace(/'/g,"");return e},showCalendarByLocId:function(b,a){if(!/^\d+$/.test(b)){ta.util.error.record(null,"Cannot show calendar due to missing/invalid location ID: "+b);return}a=a||"";var c={id:"",className:"id_"+b+a,"data-date_suffix":a,toString:function(){return"[showCalendarSrc: "+b+a+"]"}};ta.widgets.calendar.setErrorStyling(c)},clickCalendarEvent:function(b){if(document.createEvent){var a=document.createEvent("HTMLEvents");a.initEvent("click",true,true);b.dispatchEvent(a)}else{b.click()}},setErrorStyling:function(d){var c=false,g=d["data-date_suffix"]||null;var b=d.id.match(/CHECK_RATE_([a-zA-Z]+)/);if(b&&b.length>1&&(b[1]=="mnf"||b[1]=="mnl"||b[1]=="photoviewer")){g="_"+b[1]}try{c=d.className.match(/\bid_(\d+)/)[1]}catch(f){}if(c){var a=false;var h="date_picker_in_";if(!a&&g){a=ta.id(h+c+g)}if(!a){a=ta.id(h+c+"_met")}if(!a){a=ta.id(h+c+"_cro")}if(!a){a=ta.id(h+c+"_per")}if(!a){a=ta.id(h+c+"_pop")}if(!a){a=ta.id(h+c+"_mnl")}if(!a){a=ta.id(h+c+"_mnm")}if(!a){a=ta.id(h+c+"_smt")}if(!a){a=ta.id(h+c+"_pto")}if(!a){a=ta.id(h+c+"_pal")}if(!a){a=ta.id(h+c+"_amo")}if(!a&&d.id.slice(-4)=="_inm"){a=ta.id(h+c+"_inm")}if(!a){a=ta.id(h+c)}if(a){setTimeout(function(){ta.widgets.calendar.clickCalendarEvent(a)},100)}}},launchInlineMeta:function(a){ta.widgets.calendar._crBtnOnclick("#CHECK_RATE",a)},launchMetaLightboxUpdate:function(){},launchCRLBUpdate:function(){ta.commerce.meta.clearStoredMiniData();ta.overlays.Factory.updateMiniMetaPlacements()},_crBtnOnclick:function(b,c){ta.store("meta.calendarCR",true);var a=document.getElement(b);if(a){document.getElement(b).onclick(c)}ta.remove("meta.calendarCR")},onShowPricesClick:function(a,b){if(!ta.widgets.calendar.hasPageDates()){return}ta.trackEventOnPage("GuestRoomSelector","ShowPrices_Calendar_click");if(b==="Hotels"){ta.servlet.HACSearch.doMetaDateSearch();ta.commerce.meta.updateHeaderDates()}else{if(b==="HotelHighlight"){ta.widgets.calendar.onCalendarRangeSelect(a)}else{window.fireEvent("newInlinePageDates",[a])}}ta.widgets.calendar.closeCalendarWidgets();if(ta.has("guests_rooms_picker_3.enabled")){this.displayStayInfoPicker()}},displayStayInfoPicker:function(){$$(".stayInfoHeader").removeClass("hidden");$$(".changeStayInfoButton").removeClass("hidden");$$(".date_control_wrapper").addClass("hidden")},closeCalendarWidgets:function(){var b=document.getElements(".date_picker_calendar");if(b){Array.each(b,function(e){if(e&&e.overlay){var d=true;var c=e.overlay.source;if(c&&(c.hasClass("isPreDatesPermanent")||c.getParent(".isPreDatesPermanent"))){d=false}if(d){e.overlay.hide()}}})}var a=document.getElement(".dp.overlay");if(a&&a.overlay){a.overlay.hide()}},getInOutTrackingKey:function(b){var a="avail.data.dateClicked";if(b){return a+".in"}else{return a+".out"}},removeInOutCalendarSelected:function(a){ta.remove(ta.widgets.calendar.getInOutTrackingKey(a))},trackInOutCalendarSelected:function(a){ta.store(ta.widgets.calendar.getInOutTrackingKey(a),true)},inOutCalendarSelected:function(a){return ta.retrieve(ta.widgets.calendar.getInOutTrackingKey(a))},trackCalendarEvent:function(c,d,b,g){try{var a=ta.has("multiDP.priorDates")?ta.retrieve("multiDP.priorDates"):ta.widgets.calendar.hasPageDates();b+=a?"|CHANGE":"|PRE";ta.trackEventOnPage(c,d,b,g,true)}catch(f){}},cancelAllExistingHAC:function(){if(ta.hac.filters&&ta.hac.filters.removeProcessingForExistingHACQuery){ta.hac.filters.removeProcessingForExistingHACQuery()}if(ta.meta.update&&ta.meta.update.cancelAllMetaCurrentQuery){ta.meta.update.cancelAllMetaCurrentQuery()}if(ta.commerce.metajson&&ta.commerce.metajson.cancelCurrentBulkFetch){ta.commerce.metajson.cancelCurrentBulkFetch()}},submitHacSearch:function(d,c,f){if(typeof(f)=="undefined"){f=false}if(ta.has("useHotelsFilterState")){return ta.widgets.calendar.submitHotelsForm(d,c,f)}var b="";c=ta.id(c);if(c.get("tag")=="form"){var e=c.getElement("input[name=q]");if(e){e.name=""}b=c.action+"?"+c.toQueryString()}else{if(c.get("tag")=="a"){b=c.href}else{c=c.getParent("a");b=c.href}}if(b!==""){if(ta.widgets.calendar.hasPageDates()){if(!b.match(/\?/)){b=b+"?"}var a=ta.widgets.calendar.getCheckRatesData();if(a){b=b+"&"+Object.toQueryString(a)}}if(d){new Event(d).preventDefault()}if(f){window.open(b)}else{window.location=b}}},clearSessionDates:function(b,a){new Request({url:"/UpdateSessionDatesAjax?clear=true",onSuccess:function(){ta.widgets.calendar.clearDates();if(b){document.location.href="./"+b}if(a&&typeof a==="function"){a()}}}).send()},clearAllDatePickers:function(){var c=ta.retrieve("avail.data.objects");if(c){Array.each(c,function(d){var e=ta.retrieve(d);if(e){e.clear()}})}var b=document.getElements(".date_picker.date");if(b){Array.each(b,function(d){ta.widgets.calendar.updateDateWidgetDisplay(d);ta.widgets.calendar.showEnterDates(d)})}var a=$$(".tablet_date_label");if(a){a.removeClass("showLabels")}},showEnterDates:function(a){if(!a){return}if(ta.id(a).getParent(".dual_date")){if(ta.id(a).hasClass("out_date")){a.innerHTML=ta.retrieve("multiDP.checkOut")}else{a.innerHTML=ta.retrieve("multiDP.checkIn")}}else{a.innerHTML=ta.retrieve("multiDP.enterDatesText")}},clearDates:function(){ta.widgets.calendar.clearPageDates();ta.widgets.calendar.clearAllDatePickers();var a=document.getElement(".clear_dates_button")||document.getElement(".clearDates");var j=document.getElement(".clear_dates_wrapper")||document.getElement(".clearDatesWrapper");var c=document.getElement(".showPriceButton");var b=document.getElement(".change_dates_button");var h=document.getElement(".date_picker_post_dates");var e=document.getElement(".date_picker_pre_dates");var f=document.getElement(".show_prices_button");var i=ta.id("ANIMATED_DATE_CTA");var d=ta.id("BC_PHOTOS");var g=document.getElement("#BC_PHOTOS .photo_slideshow");var k=document.getElement("#BC_PHOTOS .ug_thumbs");if(ta.retrieve("animate_date_reformat")){i=ta.id("ANIMATED_DATE_CTA_REFORMAT")}if(e){e.show()}if(h){h.hide()}if(a){a.hide()}if(j){j.hide()}if(b){b.hide()}if(f){f.show()}if(i){ta.servlet.HACSearch.loadAnimatedDateCTA()}if(c){c.hide()}if(d){d.style.opacity=1}if(g){g.style.opacity=1}if(k){k.style.opacity=1}if(ta.servlet.HACSearch&&ta.has("hac_timezone_awareness")){ta.servlet.HACSearch.clearDateFieldHighlighting()}if(ta.has("feature.date_pickers_as_text")){ta.overlays.Factory.unsetDatePickersAsText()}},clearDatesAndRedirect:function(){var a=window.location.hash;var b=false;var c=window.location.href.match(/geo=\d+/g);if(c&&c[0]){b=c[0]}if(!b){c=window.location.href.match(/-g\d+/g);if(c&&c[0]){b="geo="+c[0].substring(2)}}if(b){var d="HACSearch?"+b+a;ta.widgets.calendar.clearSessionDates(d)}},storePriorDates:function(){ta.store("multiDP.priorDates",ta.retrieve("multiDP.priorDates")||ta.widgets.calendar.hasPageDates())},datesExist:function(){var b=ta.widgets.calendar.getPageInDate();var a=ta.widgets.calendar.getPageOutDate();return b&&a},datesInRange:function(){var c=ta.widgets.calendar.getPageInDate();var a=ta.widgets.calendar.getPageOutDate();if(!ta.widgets.calendar.datesExist()){return false}var b=Math.round(Math.abs((c.getTime()-a.getTime())/ta.widgets.calendar.oneDayMill));return b>=1&&b<=ta.util.date.MAX_STAY_DURATION_DAYS},openFirstDatePicker:function(b){new Event(b).stopPropagation();var a=$$(".date_picker_calendar_wrap");if(a&&a.length>0){a[0].click()}ta.trackEventOnPage("price_filter_dates_link","click","")},justUpdateSessionDates:function(b,c,a){if((c&&!ta.widgets.calendar.haveDatesChanged())||(ta.util.date.getDaysApart(this.inDate,this.outDate)>ta.util.date.MAX_STAY_DURATION_DAYS)||(this.inDate&&this.outDate&&ta.util.date.normalize(this.inDate)==ta.util.date.normalize(this.outDate))){if(b&&typeof(b)=="function"){b()}return}new Request({url:"/UpdateSessionDatesAjax",data:Object.toQueryString(ta.widgets.calendar.getCheckRatesData()),method:"post",async:(a!==true),onSuccess:function(){if(b&&typeof(b)==="function"){b()}if(!ta.retrieve("dates.moniker.fired")){ta.store("dates.moniker.fired",true);ta.widgets.calendar.loadDateEnteredMonikers()}}}).send();return true},justUpdateSessionAdults:function(a){var b=ta.widgets.calendar.getPageAdultsCount();if(b<=0){return}new Request({url:"/UpdateSessionDatesAjax",data:Object.toQueryString({adults:b,onlyAdults:true}),method:"post",onSuccess:function(){if(a&&typeof(a)==="function"){a()}}}).send()},getGuestsRoomsValue:function(d,c){if(!d){return}var a=d.split("*");for(var b=0;b<a.length;b++){var e=a[b].split(".");if(e.length!=2){continue}if(e[0]===c){return e[1]}}},updateGuestsRoomsPickerDataFromCookie:function(){var e=Cookie.read("TATravelInfo"),f,b,c,a,d;a=ta.widgets.calendar.getGuestsRoomsValue(e,"A");if(a&&a!==""){c=parseInt(a,10)}d=ta.widgets.calendar.getGuestsRoomsValue(e,"RS");if(d&&d!==""){b=parseInt(d,10)}if(c>=1&&b>=1&&c.toFixed&&b.toFixed){f={rooms:b,guests:c};ta.store("guests.rooms.object",f)}},updateGuestsRoomsPickerUI:function(){var b=ta.widgets.calendar.getGuestsRoomsPickerData();var a=document.getElements(".grp-rooms-value");a.each(function(c){if(c){c.innerHTML=b.rooms}});a=document.getElements(".grp-guests-value");a.each(function(c){if(c){c.innerHTML=b.guests}})},updateGuestsRoomsButtonLabelsPluralization:function(b,c){var a=$$(b);a.each(function(d){if(c>1){d.addClass("multiple")}else{d.removeClass("multiple")}})},checkDatesMakeHacCallHR:function(a){if(ta.widgets.calendar.hasPageDates()){ta.widgets.calendar.handleNewDates(a)}},checkDatesMakeHacCallHotels:function(a){if(ta.widgets.calendar.hasPageDates()){ta.servlet.HACSearch.doMetaDateSearch(a)}},updateSDCalendar:function(){new Request({url:"/UpdateSessionDatesAjax",data:Object.toQueryString(ta.widgets.calendar.getCheckRatesData()),method:"post",onSuccess:function(){var e,d,c,b,a=document.getElement("#STATIC_DATE_PICKER_BAR .filterControls");window.fireEvent("sd_hh_datesChanged");if(ta.id("SDDatesHeaderCenter")){e=ta.id("SDDatesHeaderCenter");e.addClass("hide")}if((ta.id("SD_DATEBAR_TOOLTIP"))){e=ta.id("SDDatePickerBarStaticButton");e.addClass("hide");d=ta.id("SDDatePickerBarStaticChangeDates");d.removeClass("hide")}if(ta.id("SD_TV_CAMPAIGN")){c=ta.id("SD_TV_CAMPAIGN");c.addClass("hide")}if(ta.id("SD_MAP")){b=ta.id("SD_MAP");b.addClass("hide")}if(a){if(ta.widgets.calendar.datesExist()){a.removeClass("noDatesSelected");a.addClass("datesSelected")}else{a.removeClass("datesSelected");a.addClass("noDatesSelected")}}if(!ta.retrieve("dates.moniker.fired")){ta.store("dates.moniker.fired",true);ta.widgets.calendar.loadDateEnteredMonikers()}}}).send()},updateHLCalendar:function(){new Request({url:"/UpdateSessionDatesAjax",data:Object.toQueryString(ta.widgets.calendar.getCheckRatesData()),method:"post",onSuccess:function(){var h,a,d;window.fireEvent("sd_hh_datesChanged");a=ta.id("BODYCON");if(a){h=a.getElement("#HLDatePickerBar .metaDatePicker.moreProminent");d=a.getElement("#STATIC_DATE_PICKER_BAR .filterControls");if(d){if(ta.widgets.calendar.datesExist()){d.removeClass("noDatesSelected");d.addClass("datesSelected")}else{d.removeClass("datesSelected");d.addClass("noDatesSelected")}}}if(h){var f=document.getElement(".overlayBG");var c=document.getElement(".rgba_flyout.gray.overlay.relative");var g=document.getElement(".baseHotelInfoLeft");var b=document.getElement(".baseHotelInfoRight");var e=document.getElement(".HLBaseDisclaimer");if(f){f.destroy()}if(c){c.destroy()}if(g&&b){b.inject(g,"before")}if(e&&e.hasClass("hide")){e.removeClass("hide")}}if(!ta.retrieve("dates.moniker.fired")){ta.store("dates.moniker.fired",true);ta.widgets.calendar.loadDateEnteredMonikers()}}}).send()},updateSessionDates:function(a,b){new Request({url:"/UpdateSessionDatesAjax",data:b,method:"post",onSuccess:function(){if(a){if(ta.retrieve("smartDealsSearchIframe")){window.open(a,"_blank")}else{window.location=a}}},onFailure:function(){if(a){if(ta.retrieve("smartDealsSearchIframe")){window.open(a,"_blank")}else{window.location=a}}}}).send()},redirectToHotelOverview:function(a){this._redirectToHotelOverview(a,function(b){window.location=b})},openTabToHotelOverview:function(a){this._redirectToHotelOverview(a,function(b){window.open(b)})},_redirectToHotelOverview:function(b,c){if(b){b=JSON.decode(b);var a=b.url;if(ta.retrieve("is_from_sdprospect")&&a.contains("Hotels")){a=a.replace("Hotels","SmartDeals")}c(a)}else{c("/Hotels")}},submitHotelsForm:function(e,b,d){b=ta.id(b);if(typeof(d)=="undefined"){d=false}var c=b.toQueryString();if(ta.widgets.calendar.hasPageDates()){var a=ta.widgets.calendar.getCheckRatesData();if(a){c=c+"&"+Object.toQueryString(a)}}new Request({url:"/FilterState",data:c,method:"post",onSuccess:function(f){d?ta.widgets.calendar.openTabToHotelOverview(f):ta.widgets.calendar.redirectToHotelOverview(f)},onFailure:function(){d?ta.widgets.calendar.openTabToHotelOverview(null):ta.widgets.calendar.redirectToHotelOverview(null)}}).send();if(e){new Event(e).preventDefault()}return false},getPlacement:function(h){if(!h||!h.id){return null}var e=/date_picker_[0-9]*_([a-z]*)/;var i=/date_picker_in_[0-9]*_([a-z]*)/;var g=/date_picker_out_[0-9]*_([a-z]*)/;var f=/date_picker_adults_[0-9]*_([a-z]*)/;var a=h.id;var d=e.exec(a);if(!d){d=i.exec(a)}if(!d){d=g.exec(a)}if(!d){d=f.exec(a)}if(d){d=d[1]}if(!d){var b=h.getParent(".HotelDateSearch");if(b&&b.id){var c=(b.id).split("_");if(c.length>1){d=c[(c.length-1)]}}}return d},handleNewDates:function(k,n){if(ta.retrieve("hotel_review_low_price_message")){var e=document.getElement("#PRICE_ALERT_RIBBON");if(e){e.hide()}ta.remove("hidePriceAlertRibbon")}if(!ta.retrieve("dates.moniker.fired")){ta.store("dates.moniker.fired",true);ta.widgets.calendar.loadDateEnteredMonikers()}if(ta.retrieve("tablet_maps_v1")&&n){var b=n.getParent(".flexCard");if(b){b.addClass("withMeta")}}ta.store("meta.requestFromArea","");if(ta.retrieve("origHTMLForUserReviews")){var h=ta.id("noAvailRHS");if(h){h.innerHTML=ta.retrieve("origHTMLForUserReviews")}}var j=document.getElement(".seeMoreHotels");if(j){j.hide()}var d=ta.id("BC_PHOTOS");if(d){d.style.opacity=1}var g=document.getElement("#BC_PHOTOS .photo_slideshow");if(g){g.style.opacity=1}var m=document.getElement("#BC_PHOTOS .ug_thumbs");if(m){m.style.opacity=1}var c=ta.widgets.calendar.getPlacement(n);if(c=="geo"){ta.widgets.calendar.justUpdateSessionDates();return}if(ta.retrieve("ta.commerce.suppress_commerce_impressions.enabled")){if(pageServlet=="Hotel_Review"||pageServlet=="ShowUserReviews"){ta.store("meta.isFromDatesChange",true)}}ta.store("hotels.datesChanged",true);if(ta.commerce.datepickerpersist){ta.commerce.datepickerpersist.update()}var f="property_"+k;var i=ta.id(f);var a=ta.retrieve("overlay.lastElmt.className");var l=(c=="pop")&&(pageServlet=="Hotels")&&i&&a&&a.match(/custom_area_QC_Hotels_Meta/);if(ta.meta&&ta.meta.update&&!l){if(pageServlet==="Hotels"){ta.servlet.HACSearch.displayPostDatesLinks()}ta.overlays.Factory&&ta.overlays.Factory.tryToHideCROverlayPostDatesClose();window.fireEvent("newInlinePageDates",[k,c]);return}else{if(!l&&ta.util&&ta.util.error){ta.util.error.record(null,"handleNewDates - no meta js");return}}ta.store("hotels.datesChanged",true);ta.servlet.HACSearch.displayPostDatesLinks();ta.store("meta.redirectingToHR",true);ta.remove("overlay.lastElmt.className");ta.widgets.calendar.justUpdateSessionDates(false,false,true);ta.hac.filters.updateResultsFromDateSearch();window.open(i.href);document.getElements(".overlay").each(function(o){if(o.overlay&&o.overlay.hide){o.overlay.hide()}})},trackCRButtonClick:function(a){var c=ta.widgets.calendar.getPageInDate();var b=ta.widgets.calendar.getPageOutDate();var d=[a];if(c){d.push("CHECKIN")}if(b){d.push("CHECKOUT")}ta.trackEventOnPage("CRBUTTON","CLICK",d.join("|"))},setupNewDatesEvent:function(){try{ta.util.customEvent.addListener("newInlinePageDates",window,ta.widgets.calendar.inlineCalendarOnDateSelection)}catch(a){ta.util.error.record(a,"trouble building event - newInlinePageDates")}},inlineCalendarOnDateSelection:function(){ta.widgets.calendar.onCalendarChangeDates();var a=window.modelLocId;if(a){ta.widgets.calendar.onCalendarRangeSelect(a)}},onCalendarChangeDates:function(){ta.commerce.meta.tracking.resetAllTimingLocks();ta.commerce.meta.tracking.clearSuppressedAreas();ta.commerce.meta.polling.clearAllPollingInfo();if(ta.isHacMap()){ta.servlet.hotelsMap.map.cleanupOverlays()}},onCalendarRangeSelect:function(c,b){if(ta.commerce.metajson){ta.commerce.metajson.refetchAll()}if(typeof oxapp!="undefined"&&oxapp&&oxapp.context){var a=oxapp.context.has("TravelDates")&&oxapp.context.get("TravelDates");if(a){a.save()}}if(c&&ta.has("checkrates.meta_af")&&!(ta.retrieve("tablet_maps_v1")&&ta.retrieve("maps_v2_open"))){ta.commerce.meta.loadMetaAF(c,"AV_ABOVE_FOLD_META",false)}ta.store("ta.calRangeSelectCtx",{locId:c,ext:b});ta.fireEvent("onCalendarRangeSelect");ta.store("ta.calRangeSelectCtx",null)},trackCalendarSelect:function(c){var i=document.getElement(".inline_calendar");if(i){i=i.getParent()}if(!i){return}var f=i.getElement(".meta_date_field.first .date_picker");if(c){f=i.getElement('.meta_date_field:not([class="first"]) .date_picker')}if(!f){return}var d=ta.id(f).get("id");d=d.substring(d.length-3,d.length);var b="START";var g="DATES";var a=ta.widgets.calendar.getPageInDate();var e=ta.widgets.calendar.getPageOutDate();if(d=="upt"){g="Interrupter"}if(c){b="SELECT";if(ta.retrieve("ta.calendar.isPriceOverlayCalendar")){g="PRICE_CALENDAR"}else{if(a&&e){var h=ta.util.date.getDaysInRange(a,e)-1;if(h>ta.util.date.MAX_STAY_DURATION_DAYS){g="DATES_OVER_30_DAYS"}}}}if(ta.retrieve("meta.prof_photo_lb.post_date_close.overlay")){g="CalendarLightbox"}ta.widgets.calendar.trackCalendarEvent(ta.widgets.calendar.getTrackingString(),b,g)},setFirstDisplayMonth:function(c){var a=document.getElement(".month");if(!a){return false}var b=ta.widgets.calendar.getDateFromElem(a);if(!b){b=new Date(ta.util.date.normalize(new Date()))}if(c){b.setDate(1);b.setDate(32);b.setDate(1)}else{b.setDate(1);b.setDate(-1);b.setDate(1)}return b},updateCalendarMonths:function(a,g){try{if(!ta.has("ta.calendar.date.clickFunction")){ta.widgets.calendar.setClickMouseOverFunctions()}if(!a){return}a=ta.id(a);if(!g){if(ta.util.i18n.isRtl()&&!a.hasClass("sprite-date_picker-arrowButtonRight")){return}else{if(!ta.util.i18n.isRtl()&&!a.hasClass("sprite-date_picker-arrowButtonLeft")){return}}}else{if(ta.util.i18n.isRtl()&&!a.hasClass("sprite-date_picker-arrowButtonLeft")){return}else{if(!ta.util.i18n.isRtl()&&!a.hasClass("sprite-date_picker-arrowButtonRight")){return}}}var c=ta.widgets.calendar.setFirstDisplayMonth(g);var b=document.getElement(".inline_calendar");var d=b.getElements(".month");if(d){Array.each(d,function(e){e.dispose()})}var f=ta.widgets.calendar.createMonth(c);ta.widgets.calendar.injectMonth(f.elmt,b,true);ta.widgets.calendar.updatePrevNext(b,f)}catch(h){ta.util.error.record(h,"update calendar months")}},updatePrevNext:function(b,g){var c=g.date;var e=g.date;if(!ta.has("ta.calendar.firstDate")){ta.widgets.calendar.setFirstLastDates()}var i=ta.util.date.inSameMonth(c,ta.retrieve("ta.calendar.firstDate"));var a=ta.util.date.inSameMonth(e,ta.retrieve("ta.calendar.lastDate"));var f=ta.util.i18n.isRtl()?"sprite-date_picker-arrowButtonRight":"sprite-date_picker-arrowButtonLeft";var h=ta.util.i18n.isRtl()?"sprite-date_picker-arrowButtonLeft":"sprite-date_picker-arrowButtonRight";b.getElement(".prev").addClass(i?"":f).removeClass(i?f:"");b.getElement(".next").addClass(a?"":h).removeClass(a?h:"");var d=b.getElement(".prevText");if(d){if(i||!g.date){d.innerHTML=""}else{d.innerHTML=jsGlobalMonthsAbbrev[(g.date.getMonth()-1)%12]}}d=b.getElement(".nextText");if(d){if(a||!g.date){d.innerHTML=""}else{d.innerHTML=jsGlobalMonthsAbbrev[(g.date.getMonth()+1)%12]}}},dayClick:function(l,j,c,h,b){try{b=ta.id(b);if(!b||b.getParent(".disabled")){return}var k=ta.util.date.create(j,c,h);var a=ta.widgets.calendar.getPageOutDate();if(k){if(!ta.has("ta.first.date.selected")){if(a&&ta.widgets.calendar.isValidStayLength(a)){ta.widgets.calendar.clearPageDates()}ta.widgets.calendar.setPageInDate(k);ta.widgets.calendar.setFirstDateSelected(true);ta.widgets.calendar.trackCalendarSelect(false,b)}else{var i=ta.widgets.calendar.getPageInDate();if(!i){if(a&&ta.widgets.calendar.isValidStayLength(a)){ta.widgets.calendar.clearPageDates()}ta.widgets.calendar.setPageInDate(k);ta.widgets.calendar.setFirstDateSelected(true);return}else{if(i.getTime()==k.getTime()){return}else{if(i.getTime()>k.getTime()){ta.widgets.calendar.setPageInDate(k);ta.widgets.calendar.setPageOutDate(i)}else{ta.widgets.calendar.setPageOutDate(k)}}}ta.widgets.calendar.setFirstDateSelected(false);var f=1;if(typeof modelLocId!="undefined"){f=modelLocId}ta.widgets.calendar.handleNewDates(f);ta.widgets.calendar.showInlineCalendar(false);ta.widgets.calendar.trackCalendarSelect(true,b)}ta.widgets.calendar.updateSelectedDays(l,k,b);ta.widgets.calendar.syncAllDatePickers()}}catch(g){ta.util.error.record(g,"dayClick")}},setFirstDateSelected:function(a){if(a){ta.store("ta.first.date.selected",true);ta.widgets.calendar.addFirstDateFlag()}else{ta.remove("ta.first.date.selected");ta.widgets.calendar.removeFirstDateFlag();ta.widgets.calendar.removeHoverDateFlag()}ta.widgets.calendar.setMaxLengthOfStayStyling();ta.widgets.calendar.setInDateInputSelectState(a)},clearCalendarSelections:function(){ta.widgets.calendar.clearSelectedDays();ta.widgets.calendar.clearDates();ta.widgets.calendar.setFirstDateSelected(false)},addFirstDateFlag:function(){var a=ta.widgets.calendar.getPageInDate();var d=ta.widgets.calendar.getDayElemFromDate(a);var b=ta.retrieve("calendar.checkInText");if(b){var c=new ta.widgets.ArrowLabel(d,b);ta.store("ta.calendar.firstDateFlag",c)}},removeFirstDateFlag:function(){if(ta.has("ta.calendar.firstDateFlag")){var a=ta.retrieve("ta.calendar.firstDateFlag");if(a){a.remove();ta.remove("ta.calendar.firstDateFlag")}}},addHoverDateFlag:function(c,f,b){var a=ta.widgets.calendar.getPageInDate();if(a.getTime()==c.getTime()){ta.widgets.calendar.removeHoverDateFlag();return}if(ta.has("ta.calendar.hoverDateFlag")){var e=ta.retrieve("ta.calendar.hoverDateFlag");if(e){e.setParentElem(f);e.setText(b)}return}var d=new ta.widgets.ArrowLabel(f,b,{labelArrowBaseClass:"calendarDateStyling hoverDateStyling"});ta.store("ta.calendar.hoverDateFlag",d)},removeHoverDateFlag:function(){if(ta.has("ta.calendar.hoverDateFlag")){var a=ta.retrieve("ta.calendar.hoverDateFlag");if(a){a.remove();ta.remove("ta.calendar.hoverDateFlag")}}},addChooseDatesFlag:function(){if(!ta.has("ta.calendar.chooseDateFlag")){var a=ta.retrieve("calendar.enterDatesText");var b=document.getElement(".metaContentSection .largeOpenCalCRButton");var c=new ta.widgets.ArrowLabel(b,a,{labelArrowBaseClass:"calendarDateStyling enterDatesArrowElem",arrowSpriteClass:"sprite-date_picker-orangeArrowUp"});ta.store("ta.calendar.chooseDateFlag",c)}},removeChooseDatesFlag:function(){if(ta.has("ta.calendar.chooseDateFlag")){var a=ta.retrieve("ta.calendar.chooseDateFlag");if(a){a.remove();ta.remove("ta.calendar.chooseDateFlag")}}},onDateInputClick:function(a,b){var c=document.getElement(".inline_calendar");if(c&&c.hasClass("hidden")){ta.widgets.calendar.showInlineCalendar(true,!b.getParent(".meta_date_field.first"))}else{if(c&&ta.has("ta.first.date.selected")&&b&&b.getParent(".meta_date_field.first")){ta.widgets.calendar.clearCalendarSelections()}}},onDateInputOver:function(){if(!ta.widgets.calendar.hasPageDates()&&!ta.has("ta.first.date.selected")){ta.widgets.calendar.addChooseDatesFlag()}},onDateInputOut:function(){ta.widgets.calendar.removeChooseDatesFlag()},getDayElemFromDate:function(a){if(!a||!a.getTime){return false}return document.getElement(".date_"+a.getDate()+".month_"+a.getMonth()+".year_"+a.getFullYear())},getDateFromElem:function(c){var a,b=1,f=false,d=false,e;if(!c){return false}c=ta.id(c);a=c.className;if(!a){return false}e=a.match(/date_(\d+)/);if(e&&e[1]){b=e[1]}e=a.match(/month_(\d+)/);if(e&&e[1]){f=e[1]}e=a.match(/year_(\d+)/);if(e&&e[1]){d=e[1]}if(f===false||d===false){return false}return ta.util.date.create(d,f,b)},setMaxLengthOfStayStyling:function(){var e=ta.has("ta.first.date.selected");var f=document.getElements(".month td");if(e){var a=ta.widgets.calendar.getPageInDate();var c=ta.widgets.calendar.getPageInDate();c.setDate(c.getDate()+ta.util.date.MAX_STAY_DURATION_DAYS);if(f&&a){Array.each(f,function(h){var g=ta.widgets.calendar.getDateFromElem(h);if(g&&(g.getTime()<a.getTime()||c.getTime()<g.getTime())){h.addClass("disabled")}})}}else{if(f){var b=new Date(ta.util.date.normalize(new Date()));if(!ta.has("ta.calendar.lastDate")){ta.widgets.calendar.setFirstLastDates()}var d=ta.retrieve("ta.calendar.lastDate");Array.each(f,function(h){var g=ta.widgets.calendar.getDateFromElem(h);if(g&&(b.getTime()<=g.getTime()&&g.getTime()<=d.getTime())){h.removeClass("disabled")}})}}},setInDateInputSelectState:function(b,d){var c=document.getElements(".metaContentSection .date_picker_calendar_wrap");var a=ta.widgets.calendar.getSelArrowElem();if(c){Array.each(c,function(e){if(!d){if(e.getParent()&&e.getParent().hasClass("first")){if(b){e.removeClass("selectionStyle")}else{e.addClass("selectionStyle");e.getParent().adopt(a)}}else{if(b){e.addClass("selectionStyle");if(e.getParent()){e.getParent().adopt(a)}}else{e.removeClass("selectionStyle")}}}else{e.removeClass("selectionStyle");a.dispose()}})}},getSelArrowElem:function(){var a=document.getElement(".selectionUpArrow");if(!a){if(document.getElement(".inline_calendar")){a=new Element("div",{"class":"sprite-date_picker-pointer-orange-ac selectionUpArrow"})}else{a=new Element("div",{"class":"sprite-date_picker-pointer selectionUpArrow"})}}return a},showInlineCalendar:function(f,d){var h=document.getElement(".inline_calendar");if(h){if(f){var c=h.hasClass("hidden");h.removeClass("hidden");var b=document.getElement("#HR_HACKATHON_CONTENT .postShowMetaCR");if(b){b.dispose()}if(d){if(!ta.has("date.picker.pageInDate")){d=false}}ta.widgets.calendar.setFirstDateSelected(!!d);if(c){ta.widgets.calendar.trackCalendarEvent(ta.widgets.calendar.getTrackingString(),"OPEN","DATES")}}else{h.addClass("hidden");ta.widgets.calendar.setInDateInputSelectState(false,true);var g=document.getElement(".largeOpenCalCRButton");if(g){g.dispose()}var a=document.getElement(".open_calendar_legend");if(a){a.addClass("miniMetaHideHdr").removeClass("miniMetaShowHdr")}var e=document.getElement(".open_calendar_highlight_bg");if(e){e.removeClass("open_calendar_highlight_bg")}}}},dayOver:function(f,e,a,c,b){if(typeof(isIPad)!="undefined"&&isIPad){ta.widgets.calendar.dayClick(f,e,a,c,b);return}ta.widgets.calendar.updateSelectedDays(f,ta.util.date.create(e,a,c),b)},updateSelectedDays:function(p,l,m){var n,f="prevSel",j="start",b="end",h=false,e,k,c,o,g,a,i;if(!ta.has("ta.first.date.selected")){return}if(!m){ta.widgets.calendar.removeHoverDateFlag();return}m=ta.id(m).getParent();n=l;ta.widgets.calendar.clearSelectedDays();e=ta.widgets.calendar.getPageInDate();k=ta.widgets.calendar.getPageOutDate();h=false;c=false;if(e){h=document.getElement(".month_"+e.getMonth()+".date_"+e.getDate());c=e}else{if(k){h=document.getElement(".month_"+k.getMonth()+".date_"+k.getDate());c=k}}a=h;i=m;if(!a){a=document.getElement(".month td");if(a){a.addClass(f)}}else{a.addClass(j).addClass(f)}if(n.getTime()<c.getTime()){ta.widgets.calendar.removeHoverDateFlag();return}if(!i){i=document.getElement(".month_"+n.getMonth()+".date_"+ta.util.date.getLastDayOfMonth(n));i.addClass(f)}else{i.addClass(b)}ta.widgets.calendar.updateSelectedDaysHelper(a,i,true,f);if(m.hasClass("disabled")){ta.widgets.calendar.removeHoverDateFlag()}else{o=ta.retrieve("calendar.singleNightText");g=ta.util.date.getDaysInRange(c,n)-1;if(1<g){o=ta.retrieve("calendar.multiNightsText");o=o.replace(/\d+/,g)}ta.widgets.calendar.addHoverDateFlag(n,m,o)}},updateSelectedDaysHelper:function(e,j,g,h){if(!e||e==j){return}var f="nextSibling";var k="firstChild";if(!g){f="previousSibling";k="lastChild"}var d=false;if(ta.widgets.calendar.isValidDateElem(e.getNext())){d=e.getNext()}else{var a=ta.id(e.parentNode);if(a&&a.getNext()){d=a.getNext()[k]}else{if(a&&ta.id(a).getParent(".month")){var c=ta.id(a).getParent(".month");if(ta.util.i18n.isRtl()){f=(f=="previousSibling")?"nextSibling":"previousSibling"}var i=c.getNext();if(!i){return}var b=ta.id(i).getElements("td");if(!g){b.reverse()}b.some(function(l){if(ta.widgets.calendar.isValidDateElem(l)){d=l;return true}return false},this)}}}if(d){ta.id(d).addClass(h);ta.widgets.calendar.updateSelectedDaysHelper(d,j,g,h)}},isValidDateElem:function(b){if(!b||b.tagName!="TD"){return false}var a=b.className;if(a.match(/other/)||a.match(/disabled/)){return false}return true},clearSelectedDays:function(){var a=["prevSel","selected","start","end","inDate","inDate_DP7"];Array.each(a,function(c){var b=document.getElements(".inline_calendar .month td."+c);if(b){Array.each(b,function(d){d.removeClass(c)})}})},injectMonth:function(d,b,f){var c=b,a="top",e=b.getElement(".navCal");if(f&&e){c=e;a="after"}else{if(!f){a="bottom"}}d.inject(c,a);ta.widgets.calendar.setMaxLengthOfStayStyling();ta.widgets.calendar.removeFirstDateFlag();if(ta.has("ta.first.date.selected")){ta.widgets.calendar.addFirstDateFlag()}},setFirstLastDates:function(){var c=11;var b=new Date();b=new Date(ta.util.date.normalize(b));ta.store("ta.calendar.firstDate",b);var f=new Date(b.getTime());f.setDate(1);var a=f.getMonth();var e=a+c;f.setFullYear(f.getFullYear()+e/12);f.setMonth(e%12);f=new Date(ta.util.date.normalize(f));ta.store("ta.calendar.lastDate",f)},setClickMouseOverFunctions:function(){ta.store("ta.calendar.date.clickFunction","ta.widgets.calendar.dayClick");ta.store("ta.calendar.date.mouseOverFunction","ta.widgets.calendar.dayOver")},buildDayClass:function(a){var f="";var e=ta.widgets.calendar.getPageInDate();var c=ta.widgets.calendar.getPageOutDate();var b=new Date(ta.util.date.normalize(new Date()));if(!ta.has("ta.calendar.lastDate")){ta.widgets.calendar.setFirstLastDates()}var d=ta.retrieve("ta.calendar.lastDate");if(e&&e.getTime()==a.getTime()){f="inDate_DP7 start prevSel"}else{if(e&&c&&e.getTime()<a.getTime()&&c&&a.getTime()<c.getTime()){f="prevSel"}else{if(c&&c.getTime()==a.getTime()){f="inDate_DP7 end prevSel"}else{if(a.getTime()<b.getTime()||d.getTime()<a.getTime()){f="disabled"}}}}if(a.getTime()==b.getTime()){f="today "+f}return f},createMonth:function(l){var k={date:l},g,c="",o,m,b,p,a,e=-1,j,n,f,q,r,h;if(!ta.has("ta.calendar.firstDate")){ta.widgets.calendar.setFirstLastDates()}g=new Date(l.getTime());g.setDate(1);ta.util.date.normalize(g);o=l.getFullYear();m=l.getMonth();b;p=new Date(ta.util.date.normalize(new Date()));a=ta.retrieve("ta.calendar.lastDate");j=ta.widgets.calendar.getPageInDate();if(j&&g.getMonth()==j.getMonth()){e=j.getDate()}if(j){b=new Date(j.getTime());b.setDate(b.getDate()+ta.util.date.MAX_STAY_DURATION_DAYS+1)}n=o;if(ta.retrieve("thai_buddhist_era_year")){n=n+ta.util.date.THAI_BUDDHIST_YEAR_OFFSET}c+='<table cellspacing="0" cellpadding="0" border="0"><thead><tr><th class="caption" colspan="7">';if(typeof DATE_FORMAT_MMM_YYYY!="undefined"){c+=DATE_FORMAT_MMM_YYYY.replace(/MMM/,jsGlobalMonths[m]).replace(/YYYY/,n)}c+="</th></tr><tr>";for(f=0;f<jsGlobalDaysShort.length;f++){c+="<th>";c+=jsGlobalDaysShort[f];c+="</th>"}c+="</tr></thead><tbody><tr>";q=new Date(g.getTime());q.setDate(1);r=1-q.getDay();q.setDate(r);for(f=1;f<=42;f++){if(q.getDay()===0){c+="</tr><tr>"}h=ta.widgets.calendar.buildDayClass(q)+" "+ta.widgets.calendar.buildCalendarFrameClass(f);c+='<td class="month_'+q.getMonth()+" date_"+q.getDate()+" year_"+q.getFullYear()+" "+h+'">';if(q.getTime()<p.getTime()||a.getTime()<q.getTime()){c+=q.getDate()}else{c+=ta.widgets.calendar.buildDayAnchorTag(q)}c+="</td>";q.setDate(q.getDate()+1)}c+="</tr></tbody></table>";k.elmt=new Element("div",{"class":"month month_"+k.date.getMonth()+" year_"+k.date.getFullYear()}).set("html",c);return k},buildCalendarFrameClass:function(b){var a="";if(b%7===1){a="leftCalFrame"}else{if(b%7===0){a="rightCalFrame"}}if(b<8){a=a+" topCalFrame"}else{if(35<b){a=a+" bottomCalFrame"}}return a},buildDayAnchorTag:function(a){var b="";if(ta.has("checkrates.add_holding_windows")){b+='<a href="javascript:void(0);" class="no_cpu" '}else{b+='<a href="javascript:void(0);"'}if(ta.has("ta.calendar.date.clickFunction")){b+=' onmouseover="';b+=ta.retrieve("ta.calendar.date.mouseOverFunction");b+="(event,";b+=a.getFullYear();b+=",";b+=a.getMonth();b+=",";b+=a.getDate();b+=',this);"'}if(ta.has("ta.calendar.date.clickFunction")){b+=' onclick="';b+=ta.retrieve("ta.calendar.date.clickFunction");b+="(event,";b+=a.getFullYear();b+=",";b+=a.getMonth();b+=",";b+=a.getDate();b+=',this)";'}b+=">";b+=a.getDate();b+="</a>";return b},addCustomDayStyleString:function(g,f,d,h,c){var i="";var a=ta.widgets.calendar.getPageInDate();var e=ta.widgets.calendar.getPageOutDate();var b="";if(a&&e){b=" inDate_DP7 prevSel";if(c.getTime()>a.getTime()&&c.getTime()<e.getTime()){i=i+" prevSel"}}if(a&&d.date.getMonth()==a.getMonth()&&h==a.getDate()){i=i+" start"+b}if(e&&d.date.getMonth()==e.getMonth()&&h==e.getDate()){i=i+" end"+b}return i},getDateArgsObject:function(){try{var b=ta.widgets.calendar.getPageInDate();var e=ta.widgets.calendar.getPageOutDate();var h=ta.widgets.calendar.getPageAdultsCount();if(!b||!e||!h){return null}var i=b.getDate();var k=b.getMonth()+1;var g=b.getFullYear();var c=e.getDate();var f=e.getMonth()+1;var a=e.getFullYear();var j={inDay:i,inMonth:k+" "+g,outDay:c,outMonth:f+" "+a,adults:h};return j}catch(d){ta.util.error.record(d,"Unable to create calendar date args object");return null}},loadDateEnteredMonikers:function(){ta.common.ads.loadMonikers.delay(2000)},getTrackingString:function(){return ta.retrieve("multiDP.trackString")||"DATEPICKER"},clickDatepickerThroughBackdrop:function(f,c,a){if(!f){return}f=new Event(f);var g=f.page.x;var d=f.page.y;var b=false;Array.from([c,a]).each(function(i){if(!b){var j=i.getPosition();var h=i.getSize();if(g>=j.x&&g<=(j.x+h.x)&&d>=j.y&&d<=(j.y+h.y)){b=true;var e=new MouseEvent("click",{view:window,bubbles:true,cancelable:true});i.dispatchEvent(e);f.stopPropagation()}}})}};ta.widgets.ArrowLabel=new Class({Implements:Options,Binds:["shiftLeft","shiftRight"],options:{charWidth:7,sidePadding:0,labelArrowBaseClass:"calendarDateStyling",arrowElemClass:"defaultArrowElemStyling",textElemClass:"arrowTextElemStyling",arrowSpriteClass:"sprite-date_picker-grayDownArrow",arrowIconClass:"arrowIconStyling",arrowIconWidth:16},initialize:function(f,d,i){this.setOptions(i);if(!f||!d){return false}this.labelText=d;this.parentElem=f;var a=d.length+1;var h=(a*this.options.charWidth);var b=0;if(this.parentElem.getCoordinates&&this.parentElem.getCoordinates().width){b=this.parentElem.getCoordinates().width;if(b%2==1){b=b+1}}var c=0;if(h){if(h%2==1){h=h+1}c=(-1)*((h/2)-(b/2))}var g="left";if(ta.util.i18n.isRtl()){g="right"}this.inlineRelElem=new Element("div",{"class":this.options.labelArrowBaseClass+" inlineRelElemStyling"});this.arrowElem=new Element("div",{"class":this.options.arrowElemClass,styles:{width:h,padding:"0 "+this.options.sidePadding+"px"}});this.arrowElem.setStyle(g,c);this.arrowTextElem=new Element("div",{html:this.labelText,"class":this.options.textElemClass});this.arrowIconElem=new Element("div",{"class":this.options.arrowSpriteClass+" "+this.options.arrowIconClass});var e=0;if(this.options.arrowIconWidth){e=(-1)*((this.options.arrowIconWidth/2)-(b/2))}else{if(b){e=b/2}}this.arrowIconElem.setStyle(g,e);this.arrowTextElem.inject(this.arrowElem);this.arrowElem.inject(this.inlineRelElem);this.arrowIconElem.inject(this.inlineRelElem);this.inlineRelElem.inject(f)},setParentElem:function(a){if(a&&this.inlineRelElem){this.parentElem=a;this.parentElem.adopt(this.inlineRelElem)}},setText:function(a){this.labelText=a;this.arrowTextElem.innerHTML=this.labelText},remove:function(){if(this.inlineRelElem){this.inlineRelElem.destroy()}}});ta.widgets.Calendar=new Class({Binds:["addCustomDayStyleString","getCreatorElement"],Implements:[Options,Events],options:{selectedDate:null,firstDate:null,lastDate:null,dualCalendar:true,invalidDates:null,useLinks:true,dayNames:false,formatter:null,offsetOther:0,choiceLink:null,prevAction:null,nextAction:null,monthHeadingFormat:"",monthspan:11,indicateTurnoverDays:false,monthChangeDuration:500,postContent:null,prevStyle:false,nextStyle:false,showRange:false,isFirstCal:null,creatorElem:null,includeTodayInRange:false,holidaysOnCalendar:false,stableTableHeight:false,treatInvalidAsOutOfRange:false,useInoutMonth:true},initialize:function(b){this.setOptions(b);if(!this.options.firstDate){var c=ta.retrieve("calendar.serverTime");if(ta.has("hac_timezone_awareness")&&ta.has("ta.hac.locationTimezoneOffset")){var e=ta.retrieve("ta.hac.locationTimezoneOffset");var a=c?new Date(c):new Date();var d=a.getTime();d+=(a.getTimezoneOffset()*60000);var f=d+e;this.options.firstDate=new Date(f)}else{this.options.firstDate=c?new Date(c):new Date()}}if(!this.options.lastDate){this.setLastDate(this.options.monthspan)}this.today=new Date();this.selectedDate=this.options.selectedDate;if(b.oneWayFlight){this.options.choiceLink="ta.widgets.calendar.calendarSingleSelect"}if(b.multiCityFlight){this.options.choiceLink="ta.widgets.calendar.calendarMCSelect"}ta.util.date.normalize(this.today);if(this.options.firstDate){ta.util.date.normalize(this.options.firstDate)}if(this.options.lastDate){ta.util.date.normalize(this.options.lastDate)}if(this.selectedDate){ta.util.date.normalize(this.selectedDate)}this.container=new Element("div",{"class":"calendar"});this.addPrevNext();if(this.options.postContent){if(typeof(this.options.postContent)==="function"){this.options.postContent=this.options.postContent()}this.container.adopt(this.options.postContent)}if(this.options.wrapper){if(typeof(this.options.wrapper)==="function"){this.options.wrapper=this.options.wrapper()}this.options.wrapper.getElement(".wrapper_inner").adopt(this.container);this.container=this.options.wrapper}if(this.options.monthHeadingFormat==""&&DATE_FORMAT_MMM_YYYY){this.options.monthHeadingFormat=DATE_FORMAT_MMM_YYYY}},setLastDate:function(b){if(b==null||b<1){b=11}var e=new Date();e.setDate(1);var a=e.getMonth();var c=a+b;e.setFullYear(e.getFullYear()+c/12);e.setMonth(c%12);this.options.lastDate=e},getFirstDate:function(){return this.selectedDate||(this.theOtherCal&&this.theOtherCal.selectedDate)||this.today},update:function(){if(this.currentMonth){this.removeTable(null,this.currentMonth)}if(this.nextMonth){this.removeTable(null,this.nextMonth)}var c=this.getFirstDate();if(this.options.useInoutMonth){if(ta.widgets.calendar.getPageInDate()){c=new Date(ta.widgets.calendar.getPageInDate());if(ta.has("datepicker_autoadvance_fday")){c=ta.retrieve("datepicker_autoadvance_fday")}}if(ta.widgets.calendar.getPageOutDate()&&(!ta.widgets.calendar.getPageInDate()||(this.options.flights&&!this.isIn))){c=new Date(ta.widgets.calendar.getPageOutDate());c.setDate(0)}}if(this.options.firstDate&&c<this.options.firstDate){c=this.options.firstDate}if(this.options.dualCalendar){var f=new Date(c);f.setDate(ta.util.date.DAYS_IN_MONTH[f.getMonth()]);ta.util.date.normalize(f);if(f>=this.options.lastDate){c=new Date(c);if(c.getMonth()==0){c.setFullYear(c.getFullYear()-1,11,1)}else{c.setMonth(c.getMonth()-1,1)}}}this.currentMonth=this.createMonth(c);this.injectMonth(this.currentMonth.elmt,true);if(this.options.dualCalendar){var e=new Date(this.currentMonth.date);var a=e.getDate();var b=e.getMonth()+1;if(a>ta.util.date.DAYS_IN_MONTH[b]){a=ta.util.date.DAYS_IN_MONTH[b]}e.setMonth(b,a);this.nextMonth=this.createMonth(e);this.injectMonth(this.nextMonth.elmt,false)}this.updatePrevNext();return this},injectMonth:function(c,d){if(ta.util.i18n.isRtl()){d=!d}var b=this.container,a="top";if(!d&&ta.id(this.container).getElement(".wrapper_inner .calendar")){b=ta.id(this.container).getElement(".wrapper_inner .calendar")}if(d&&this.nav){b=this.nav;a="after"}else{if(!d){if(this.options.postContent){b=this.options.postContent;a="before"}else{a="bottom"}}}c.inject(b,a)},reposition:function(){this.currentMonth.elmt.setStyle("left","0px");if(this.options.dualCalendar){if(!ta.util.i18n.isRtl()){this.nextMonth.elmt.setStyle("left",this.currentMonth.elmt.getCoordinates().width+this.options.offsetOther+"px")}else{this.nextMonth.elmt.setStyle("left","0px");this.currentMonth.elmt.setStyle("left",this.nextMonth.elmt.getCoordinates().width+this.options.offsetOther+"px")}}return this},updatePrevNext:function(){var b=this.currentMonth.date;var a=this.options.dualCalendar?this.nextMonth.date:this.currentMonth.date;var d=ta.util.date.inSameMonth(b,this.options.firstDate);var c=ta.util.date.inSameMonth(a,this.options.lastDate);getChildByClass(this.container,"prev").style.display=(d?"none":"block");getChildByClass(this.container,"next").style.display=(c?"none":"block")},createPagingElement:function(a,b,c){return'<span class="'+a+'"><a style="display: block;" onclick="'+b+'(event, this);">'+c+"</a></span>"},addPrevNext:function(){if(!(this.options.prevAction&&this.options.nextAction)){return}var a=[],b=this.nav=new Element("div",{"class":"navCal"}).inject(this.container);a.push(this.createPagingElement("prev"+(this.options.prevStyle?" "+this.options.prevStyle:""),this.options.prevAction,"Previous Month"));a.push(this.createPagingElement("next"+(this.options.nextStyle?" "+this.options.nextStyle:""),this.options.nextAction,"Next Month"));b.set("html",a.join(""))},getHolidays:function(f,c,d,b){var e;if(f){var a=c+"-"+(d+1)+"-"+b;e=f[a]}return e},createMonth:function(C){var E={date:C};var o=new Date(C);o.setDate(1);ta.util.date.normalize(o);var q=(o.getDay()-jsGlobalDayOffset+7)%7;var A=new Date(C);A.setDate(0);this.prevDayValid=(this.isInvalidDate(A)?0:1);if(A<this.options.firstDate||A>this.options.lastDate){this.prevDayValid=-1}if(this.options.multiCityFlight&&this.crId>1){this.options.firstDate=ta.widgets.calendar.lastDateBefore(this.options,this.crId)}var c=[];var s=C.getFullYear();var u=C.getMonth();var h=new Date();var v;var B=ta.util.date.inSameMonth(h,C)?h.getDate():-1;var p=-1;if(this.selectedDate&&this.selectedDate.getMonth()==u&&this.selectedDate.getFullYear()==s){p=this.selectedDate.getDate()}var D;if(this.options.showRange&&this.theOtherCal&&this.theOtherCal.selectedDate){D=this.theOtherCal.selectedDate;ta.util.date.normalize(D)}if(this.options.singleSelect){if(this.options.pickerOption=="out"&&ta.widgets.calendar.getPageInDate()){if(!this.options.flights){v=new Date(ta.widgets.calendar.getPageInDate());v.setDate(v.getDate()+ta.util.date.MAX_STAY_DURATION_DAYS)}else{v=new Date();ta.util.date.normalize(v);v.setDate(v.getDate()+ta.util.date.MAX_DAYS_BEFORE_RETURN_FLIGHT)}}}var t=s;if(ta.retrieve("thai_buddhist_era_year")){t=t+ta.util.date.THAI_BUDDHIST_YEAR_OFFSET}c.push('<table cellspacing="0" cellpadding="0" border="0"><thead><tr><th class="caption" colspan="7">');c.push(this.options.monthHeadingFormat.replace(/MMM/,jsGlobalMonths[u]).replace(/YYYY/,t));c.push("</th></tr><tr>");for(var y=0;y<jsGlobalDaysShort.length;y++){c.push("<th>");c.push(this.options.dayNames?jsGlobalDaysAbbrev[y]:jsGlobalDaysShort[y]);c.push("</th>")}c.push("</tr></thead><tbody><tr>");var g=0;for(var y=0;y<q;y++){c.push('<td class="other">&nbsp;</td>');g++}q--;var x=0;var b=ta.util.date.DAYS_IN_MONTH[E.date.getMonth()];if(E.date.getMonth()==1&&E.date.getYear()%4==0){b+=1}var k=b;while(x<b){q=(q+1)%7;x++;o.setDate(x);var z=x;var e=null;var r=this.getHolidays(this.options.holidaysOnCalendar,s,u,x);if(this.options.includeTodayInRange){var a=!(o<=this.options.firstDate||o>this.options.lastDate||(v&&o>v))}else{var a=!(o<this.options.firstDate||o>this.options.lastDate||(v&&o>v))}var w=!this.isInvalidDate(o);var n=this.options.choiceLink;var m=!((this.selectedDate&&this.selectedDate.getTime()<o.getTime())||(D&&D.getTime()<o.getTime()));if(this.options.formatter){this.options.selectedDay=p;this.options.otherDate=D;var f=this.options.formatter.call(this,o,a,w,q,this.options);e=f.cname;z=f.contents;n=f.link||n}else{if(!w){e="invalid"}else{if(x==B){if(x==p||(D&&o.getTime()===D.getTime())){e="today selected "+(m?"start":"end");m=!m;if(this.selectedDate&&D){e+=" rngDt"}}else{if(!a){e="today disabled"}else{e="today"}}}else{if(x==p||(D&&o.getTime()===D.getTime())){e="selected "+(m?"start":"end");m=!m;if(this.selectedDate&&D){e+=" rngDt"}}else{if(this.selectedDate&&D&&((this.selectedDate.getTime()<o.getTime()&&o.getTime()<D.getTime())||(this.selectedDate.getTime()>o.getTime()&&o.getTime()>D.getTime()))){e="rngDt"}}}}}if(this.options.indicateTurnoverDays){if(w){if(this.prevDayValid==0){if(e){e+=" depart"}else{e="depart"}}this.prevDayValid=1}else{if(this.prevDayValid==1){if(e){e+=" arrive"}else{e="arrive"}}this.prevDayValid=0}if(!a){this.prevDayValid=-1}}if(q==0){c.push("</tr><tr>")}if(!a||(this.options.treatInvalidAsOutOfRange&&!w)){c.push('<td class="');c.push(e||"disabled");c.push('">');if(r){c.push(r)}else{c.push(z||x)}c.push("</td>")}else{if(this.options.singleSelect){var j=this.date;if(j&&j.getDate()==x&&j.getMonth()==u){e=e+" selected"}}var l=this.addCustomDayStyleString(n,s,E,x,o,z);if(l){e+=l}if(e){c.push('<td class="');c.push(e);c.push('">')}else{c.push("<td>")}c.push(this.buildDayAnchorTag(n,s,u,x,z,o));c.push("</td>")}}while(++q<7){c.push("<td class='other'>&nbsp;</td>");g++}if(this.options.stableTableHeight){while((b+g)<42){c.push("</tr><tr>");var y=0;for(y=0;y<7;y++){c.push("<td class='other'>&nbsp;</td>");g++}}}c.push("</tr></tbody></table>");E.elmt=new Element("div",{"class":"month"}).set("html",c.join(""));return E},addCustomDayStyleString:function(d,b,f,a,e,c){},buildDayAnchorTag:function(f,c,e,b,d,g){var a=[];if(this.options.useLinks&&f){if(ta.has("checkrates.add_holding_windows")){a.push('<a href="javascript:void(0);" class="no_cpu" ondragstart="return false;" onclick="')}else{a.push('<a href="javascript:void(0);" ondragstart="return false;" onclick="')}a.push(f);a.push("(event,");a.push(c);a.push(",");a.push(e);a.push(",");a.push(b);a.push(',this)"');if(this.options.dayMouseOver){a.push(' onmouseover="');a.push(this.options.dayMouseOver);a.push("(event,");a.push(c);a.push(",");a.push(e);a.push(",");a.push(b);a.push(',this)"')}if(this.options.dayMouseOut){a.push(' onmouseout="');a.push(this.options.dayMouseOut);a.push("(event,");a.push('this)"')}a.push(">");a.push(d);a.push("</a>")}else{a.push(d)}return a.join("")},isInvalidDate:function(a){return ta.util.date.inDateSet(a,this.options.invalidDates)},isValid:function(){if(!this.selectedDate){return true}return this.selectedDate.getTime()>=this.options.firstDate.getTime()&&this.selectedDate.getTime()<=this.options.lastDate.getTime()},prev:function(){if(this.animating){return}var k=this.options.dualCalendar;this.animating=true;var h=new Date(this.currentMonth.date);var g=h.getMonth()-1;if(g<0){g=g+12;h.setFullYear(h.getFullYear()-1)}var i=h.getDate();if(i>ta.util.date.DAYS_IN_MONTH[g]){i=ta.util.date.DAYS_IN_MONTH[g]}h.setMonth(g,i);var j=this.currentMonth.elmt.getCoordinates().width;var f=j+(k?this.nextMonth.elmt.getCoordinates().width:0);var b=this.createMonth(h);if(!ta.util.i18n.isRtl()){b.elmt.style.left="-"+j+"px"}else{b.elmt.style.left=f+"px"}this.injectMonth(b.elmt,true);var e=this.container.getElements("div.month");var a;if(!ta.util.i18n.isRtl()){a={"0":{left:[-j,0]},"1":{left:[0,j+this.options.offsetOther]}};if(k){a["2"]={left:[j+this.options.offsetOther,j*2+this.options.offsetOther]}}}else{a={"0":{left:[0,-j]},"1":{left:[j+this.options.offsetOther,0]}};if(k){a["2"]={left:[j*2+this.options.offsetOther,j+this.options.offsetOther]}}}var c=new Fx.Elements(e,{onComplete:this.doneAnimating.bind(this).partial(Function._,this.nextMonth||this.currentMonth),duration:this.options.monthChangeDuration});if(k){this.nextMonth=this.currentMonth}this.currentMonth=b;this.updatePrevNext();c.start(a)},next:function(){if(this.animating){return}var k=this.options.dualCalendar;this.animating=true;var h=new Date(this.currentMonth.date);var g=h.getMonth()+(k?2:1);if(g>11){g=g-12;h.setFullYear(h.getFullYear()+1)}var i=h.getDate();if(i>ta.util.date.DAYS_IN_MONTH[g]){i=ta.util.date.DAYS_IN_MONTH[g]}h.setMonth(g,i);var j=this.currentMonth.elmt.getCoordinates().width;var f=j+(k?this.nextMonth.elmt.getCoordinates().width:0);var b=this.createMonth(h);if(!ta.util.i18n.isRtl()){b.elmt.style.left=f+"px"}else{b.elmt.style.left="-"+j+"px"}this.injectMonth(b.elmt,false);var e=this.container.getElements("div.month");var a;if(!ta.util.i18n.isRtl()){a={"0":{left:[0,-j]},"1":{left:[j+this.options.offsetOther,0]}};if(k){a["2"]={left:[j*2+this.options.offsetOther,j+this.options.offsetOther]}}}else{a={"0":{left:[-j,0]},"1":{left:[0,j+this.options.offsetOther]}};if(k){a["2"]={left:[j+this.options.offsetOther,j*2+this.options.offsetOther]}}}var c=new Fx.Elements(e,{onComplete:this.doneAnimating.bind(this).partial(Function._,this.currentMonth),duration:this.options.monthChangeDuration});if(k){this.currentMonth=this.nextMonth;this.nextMonth=b}else{this.currentMonth=b}this.updatePrevNext();c.start(a)},removeTable:function(b,a){a.elmt.dispose()},doneAnimating:function(b,a){this.removeTable(b,a);this.animating=false},select:function(a,b){this.selectedDate=b;this.fireEvent("onSelect",[this,a])},clear:function(a){this.selectedDate=null;this.fireEvent("onClear",[this,a])},nearbyMonth:function(b,a){var c=b+a;if(c>11){c-=12}else{if(c<0){c+=12}}return c},getCreatorElement:function(){return this.options.creatorElem}});(function(){ta.widgets.SingleDateCalendar=new Class({Extends:ta.widgets.Calendar,Implements:[Options,Events],Binds:["onOutDateCalShow","updateInputStyling","updateDualDateInputStyling","showCalendarOverlay","setPositionElement","hashHack","getCalendarTopOffset","getCalendarLeftOffset","callOnSelect","setPageDates","getPageInDate","getPageOutDate"],options:{singleSelect:true,pickerOption:"in",autoAdvance:true,dualCalendar:true,dayMouseOver:"ta.widgets.calendar.calendarMouseOver",choiceLink:"ta.widgets.calendar.calendarMultiSelect",prevAction:"ta.widgets.calendar.calendarPrev",nextAction:"ta.widgets.calendar.calendarNext",selectedHoverClass:"rngDt",previousSelectedClass:"prevSel",inDateClass:"inDate",outDateClass:"outDate",selectionStartClass:false,selectionEndClass:false,captureKeyEvents:true,autoShow:false,displayCalendarInOverlay:true,formatter:ta.widgets.calendar.multiDateFormatter,monthChangeDuration:150,submitOnEnter:true,useClassicSkin:false,classicStyling:false},inDate:false,newInDate:false,oldInDate:false,startRangeElem:false,outDate:false,oneSelected:false,monthOffset:0,initialize:function(f,p,r,w,x){this.isIn=x;this.parent(f,this.input);this.crId=p;this.setPositionElement();if(typeof r==="function"){this.onSelect=r.bind(this)}this.argArray=w;if(this.options.displayCalendarInOverlay){var d=this.onCalendarOverlayShow.bind(this);var a=this.onCalendarOverlayHide.bind(this);var n=this.onCalendarOverlayShow.bind(this);var k=this.positionElement.getParent(".overlay");if(k){this.parentOverlay=k.overlay}var C=ta.overlays.ACTIVATE_CLICK;var o=ta.retrieve("datepicker_autoadvance")?0:(this.options.offsetLeft?this.options.offsetLeft:this.getCalendarLeftOffset());var v=this.options.offsetTop?this.options.offsetTop:this.getCalendarTopOffset();var A="date_picker_calendar";if(this.options.useClassicSkin){A="typeO"}if(this.options.classicStyling){A=A+" classicStyling"}if(this.options.oneWayStyling){A=A+" oneWayStyling"}if(!this.options.dualCalendar){A=A+" singleWidth"}if(!ta.widgets.calendar.hasPageDates()){A=A+" predates"}if(ta.has("feature.date_pickers_as_text")){A=A+" with_arrow"}var t=ta.retrieve("tablet_calendar_update.enabled")?ta.overlays.BACKDROP_ALWAYS:ta.overlays.BACKDROP_NEVER;var c=ta.retrieve("tablet_calendar_update_v2.enabled")?0.01:0.6;var B=null;if(ta.retrieve("tablet_calendar_update_v2.enabled")){var e=ta.id("date_picker_in_"+this.crId+this.options.ext);var h=ta.id("date_picker_out_"+this.crId+this.options.ext);B=function(D){ta.widgets.calendar.clickDatepickerThroughBackdrop(D,e,h)}}var u=ta.overlays.RelativeOverlayBelow;var z={style:A,noPadding:true,autoShow:false,noCpu:true,backdrop:t,backdropOpacity:c,onBackdropClick:B,offsetLeft:o,offsetTop:v,activate:C,onShow:d,onHide:a,onFocus:n,zIndex:1001,showCloseButton:false,parentContainer:this.options.parentContainer,fontSize:this.options.fontSize,dontCloseOnClick:window.tabletOnFullSite&&ta.retrieve("meta.full_meta_photos_v4")};if(ta.has("hr_meta_focus_predates")||ta.has("hr_meta_focus_with_dates")||ta.has("sd_datepicker_focus")||ta.has("hotels_meta_focus")){z.zIndex=10001}if(f&&f.isGuestsRoomsCalendar){z.useTransparentOverlayPadding=true;z.transparentOverlayPaddingValue=80}if(ta.isTabletAlbumViewer()||ta.retrieve("tablet_maps_v1")){var m=document.getElement(".footerPocketWithInsert");if(m&&m.isVisible()){if(this.positionElement&&this.positionElement.getParent(".footerPocketWithInsert")){z.parentContainer=m}else{z.positionType="fixed"}var s=z.onShow;z.onShow=function(D){if(s){s(D)}window.addEvent("orientationchange",this.hide)};var q=z.onHide;z.onHide=function(D){if(q){q(D)}window.removeEvent("orientationchange",this.hide)}}}this.calendarOverlay=new u(z,this.positionElement);var b=ta.id(this.positionElement).getParent();if(b&&b.hasClass("date_picker_calendar_wrap")){b.onclick=function(){};ta.id(this.positionElement).removeEvents("click");ta.id(this.positionElement).getParent().addEvent("click",this.showCalendarOverlay.bind(this))}if(b&&!window.tabletOnFullSite){b.addEvent("focus",this.showCalendarOverlay.bind(this))}if(this.outDateField){ta.id(this.outDateField).getParent().onclick=function(){};ta.id(this.outDateField).getParent().addEvent("click",this.onOutDateCalShow.bind(this));if(!window.tabletOnFullSite){ta.id(this.outDateField).getParent().addEvent("focus",this.onOutDateCalShow.bind(this))}}this.calendarOverlay.inner.adopt(this.container);this.calendarOverlay.calendar=this;if(this.positionElement&&(this.positionElement.hasClass("isPreDatesPermanent")||this.positionElement.getParent(".isPreDatesPermanent"))){this.calendarOverlay.options.permanent=true;this.calendarOverlay.options.pinnable=ta.overlays.PINNABLE_ALWAYS}this.calendarOverlay.container.addEvent("click",function(D){if(D||window.event){D=new Event(D||window.event);D.stopPropagation()}});if(ta.has("feature.date_pickers_as_text")){var y=new Element("span",{"class":"arrow"}).set("html",'<span class="arrow_in"></span>');y.inject(this.calendarOverlay.container)}this.update();this.reposition()}var l=this.onDocumentClick.bind(this);document.addEvent("click",l);if(ta.retrieve("datepicker_autoadvance")){var j=ta.id("date_picker_out_"+this.crId+this.options.ext);var g=ta.id("date_picker_in_"+this.crId+this.options.ext);var i=(j&&g)?j.getCoordinates().left-g.getCoordinates().left:0;if(x){this.container.addClass("calIn");if(ta.util.i18n.isRtl()){this.calendarOverlay.options.offsetLeft=0-i}}else{this.container.addClass("calOut");if(!ta.util.i18n.isRtl()){this.calendarOverlay.options.offsetLeft=i}}this.container.addEvent("mouseleave",this.resetDatepickerOnHover.bind(this))}},addCustomDayStyleString:function(k,j,h,l,g,c){var m="";var b=this.getPageInDate();var i=this.getPageOutDate();var f="";if(b&&i){f=" prevSel"+(ta.retrieve("datepicker_autoadvance")?"":" inDate_DP7");if(g.getTime()>b.getTime()&&g.getTime()<i.getTime()){m=m+" prevSel"}}if(b&&h.date.getMonth()==b.getMonth()&&l==b.getDate()){m=m+" inDate start"+f}if(i&&h.date.getMonth()==i.getMonth()&&l==i.getDate()){m=m+" inDate end"+f}if(ta.retrieve("cal_xsell")&&(this.today.getMonth()==g.getMonth()||((this.today.getMonth()+1)%12)==g.getMonth())){var e=ta.util.date.getDaysInRange(this.today,g)-1;if(!this.isIn){e-=1}var a=ta.retrieve("cal_xsell");if(e>=0&&e<a.availability.length){var d=a.availability[e];if(!d){m+=" calXSellUnAvail"}}}return m},buildDayAnchorTag:function(g,d,f,b,e,h){var a=[];var c=this.getHolidays(this.options.holidaysOnCalendar,d,f,b);if(this.options.useLinks&&g){if(ta.has("checkrates.add_holding_windows")){a.push('<div href="javascript:void(0);" class="day no_cpu')}else{a.push('<div href="javascript:void(0);" class="day')}if(c){a.push(" hld")}a.push(" day_"+b);a.push('" onclick="');a.push(g);a.push("(event,");a.push(d);a.push(",");a.push(f);a.push(",");a.push(b);a.push(',this)"');if(this.options.dayMouseOver){a.push(' onmouseover="');a.push(this.options.dayMouseOver);a.push("(event,");a.push(d);a.push(",");a.push(f);a.push(",");a.push(b);a.push(',this)"')}a.push(' value="');a.push(h.valueOf());a.push('"');a.push(">");if(c){a.push(c)}else{a.push(e)}a.push("</div>")}else{a.push(e)}return a.join("")},callOnSelect:function(){if(this.onSelect){this.fireEvent("onChangeDates");if(this.argArray&&this.argArray.length>0){this.onSelect.apply(this,this.argArray)}else{this.onSelect.call(this,this.crId,this.positionElement);if(ta.has("guests_rooms_picker_3.enabled")){ta.store("calendarClosedByDocClick",false)}}}},clear:function(b){this.date=null;ta.widgets.calendar.clearPageDates();if(this.positionElement&&!(this.positionElement.hasClass("tab0")&&this.positionElement.hasClass("header_tab"))){var a="";if(this.isIn){if(this.options.classicDateFormat&&typeof JS_DateFormat!="undefined"){a=JS_DateFormat}else{a=ta.retrieve("multiDP.checkIn")}}else{if(this.options.classicDateFormat&&typeof JS_DateFormat!="undefined"){a=JS_DateFormat}else{a=ta.retrieve("multiDP.checkOut")}}this.positionElement.innerHTML=a}this.fireEvent("onClear",[this,b]);if(this.calendarOverlay){this.calendarOverlay.hide()}},clearPrevSelectedDays:function(){if(!this.calendarTop){this.calendarTop=this.calendarOverlay.container.getElement(".calendar")}var a=this.calendarTop.getElements("td."+this.options.previousSelectedClass);a.removeClass(this.options.previousSelectedClass);this.options.selectionStartClass&&a.removeClass(this.options.selectionStartClass);this.options.selectionEndClass&&a.removeClass(this.options.selectionEndClass)},clearSelectedDays:function(){if(!this.calendarTop){this.calendarTop=this.calendarOverlay.container.getElement(".calendar")}var a=this.calendarTop.getElements("td."+this.options.selectedHoverClass);a.removeClass(this.options.selectedHoverClass);this.options.selectionStartClass&&a.removeClass(this.options.selectionStartClass);this.options.selectionEndClass&&a.removeClass(this.options.selectionEndClass)},createPagingElement:function(a,b,c){return'<span class="'+a+'" onclick="'+b+'(event, this);"></span>'},dayOver:function(c,f,b){ta.util.date.normalize(f);if(!this.oneSelected){if(ta.retrieve("datepicker_autoadvance")){if(!this.cursorLeftInitSel){if(!this.isIn&&this.getPageInDate()||this.isIn&&this.getPageOutDate()){var a=this.getPageInDate()||this.getPageOutDate();if(!b.getAttribute("value")||parseInt(b.getAttribute("value"))==a.valueOf()){return}}this.cursorLeftInitSel=true}this.updateDatepickerOnHover(f)}this.updateHoverElem(b);return}this.hoverDay=f;this.updateSelectedDays(f,b)},ensureValidDates:function(){var c=this.getPageInDate();var b=this.getPageOutDate();if(this.options.firstDate&&c){if(c<this.options.firstDate){ta.util.date.normalize(this.options.firstDate);c=this.options.firstDate;ta.widgets.calendar.setPageInDate(c);this.bypassSecondCal=true;var a=ta.widgets.calendar.getDateAfter(c);if(b&&b<a){b=a;ta.widgets.calendar.setPageOutDate(b)}}}if(b&&!c){c=ta.widgets.calendar.getDateBefore(b)}if(c&&!b){b=ta.widgets.calendar.getDateAfter(c)}ta.widgets.calendar.setPageInDate(c);ta.widgets.calendar.setPageOutDate(b)},focusOtherCalendar:function(){var a;if(this.isIn){a=ta.widgets.calendar.getPageOutCalendarField(this.crId,this.options.ext)}else{a=ta.widgets.calendar.getPageInCalendarField(this.crId,this.options.ext)}var b=document.getElement("#PERSISTENT_DATE_PICKER:not(.hidden)")||document;if(a===null&&ta.has("guests_rooms_picker_3.enabled")){if(this.isIn){a=b.getElement(".stayInfoHeaderDateTrigger.outDateTrigger")}else{a=b.getElement(".stayInfoHeader.inDateTrigger")}}if(a){if(a.click){ta.store("overlay.dontCloseOnClick",true);a.click();ta.store("overlay.dontCloseOnClick",false)}else{if(document.createEvent&&a.dispatchEvent){var c=document.createEvent("MouseEvent");c.initEvent("click",true,true);a.dispatchEvent(c)}}}},getCalendarLeftOffset:function(){var a=1;if(ta.util.i18n.isRtl()){a=127}if(ta.isMetaHomepageIntegration2013()){a=2;if(ta.util.i18n.isRtl()){a=121}}if(ta.retrieve("ta.calendar.isOutDateTrigger")&&ta.retrieve("ta.calendar.isPriceOverlayCalendar")){a=138}if(ta.has("hotels_left_filters_redesign")){return 0}return a},getCalendarTopOffset:function(){if(ta.has("hotels_left_filters_redesign")){return -7}if(ta.isMetaHomepageIntegration2013()){return -1}return -4},getFirstDate:function(){var b=this.getPageInDate();var a=this.getPageOutDate();if(this.options.multiCityFlight&&this.crId>1){return ta.widgets.calendar.lastDateBefore(this.options,this.crId)}if(this.isSecondCalShown()){if(!this.isIn&&b){return b}else{if(this.isIn&&a){return a}}}else{if((this.isIn)&&b){return b}else{if(!this.isIn&&a){return a}}}return this.today},getPageInDate:function(){return ta.widgets.calendar.getPageInDate()},getPageOutDate:function(){return ta.widgets.calendar.getPageOutDate()},getState:function(){var c=this.inDate,b=this.outDate,a={};if(c instanceof Date){Object.append(a,{inMonth:(c.getMonth()+1)+" "+c.getFullYear(),inDay:c.getDate()})}if(b instanceof Date){Object.append(a,{outMonth:(b.getMonth()+1)+" "+b.getFullYear(),outDay:b.getDate()})}return a},hashHack:function(){var a=ta.id(this.positionElement).get("id");if(a){a=a.substring(a.length-3,a.length);if(a=="olb"||a=="bin"||a=="som"){window.location.hash=" ";window.location.hash="#MetaPricesTab"}}},includeElemInRange:function(b,a){b.className=b.className+" "+a},isSecondCalShown:function(){if(!this.options.autoAdvance){return true}var a=ta.widgets.calendar.inOutCalendarSelected(!this.isIn);return a},isValidDateElem:function(b){if(!b||b.tagName!="TD"){return false}var a=b.className;if(a.match(/other/)||a.match(/disabled/)){return false}return true},initTracking:function(){if(!ta.remove("meta.datepicker_tracked")){var c=ta.id(this.positionElement).get("id")||this.options.ext||"_owl";var d=c.indexOf("_persist")>0;c=c.substring(c.length-3,c.length);var b=this.isIn?"CheckIn|":"CheckOut|";if(d){b+="Persistent|"}if(ta.retrieve("cal_xsell")){b+="CalXSell|"}if(c==="pdp"){b+="PERSISTENT_DATE_PICKER|"}switch(c){case"pto":b+="PHOTOS_LIGHTBOX";break;case"amo":b+="AMENITIES_LIGHTBOX";break;case"pop":b+="DHTML_FLYOUT";break;case"cro":b+="CalendarLightbox";break;case"inm":b+="DATES_INLINE|Tabs";ta.store("isPricesTabDatePicker",true);break;case"bin":b+="DATES_INLINE_FLEXIBLE";break;case"met":b+="DATES_LIGHTBOX";break;case"olb":b+="DATES_LIGHTBOX_FLEXIBLE";break;case"som":b+="DATES_State-Optimized-Modal_FLEXIBLE";break;case"cmp":b+="footer";break;case"hpt":b+="HOMEPAGE_PYPT";break;case"thc":b+="HAC_TOURISM";break;case"gnv":b+="GLOBAL_NAV";break;case"ond":b+="RoomTab";break;default:b+="DATES"}var a=this.getTrackingPrefix()+ta.widgets.calendar.getTrackingString();ta.widgets.calendar.trackCalendarEvent(a,"OPEN",b);ta.store("multiDP.trackString",false)}},singleDaySelect:function(c,g,b){if(c){new Event(c).stop()}ta.util.date.normalize(g);if(!g||!g.getTime){return}this.date=g;var a=new Date(g);a.increment("week",1);if(this.options.flights){var f=(new Date()).increment("day",ta.util.date.MAX_DAYS_BEFORE_RETURN_FLIGHT);if(a>f){a=f}}this.setPageDates(g,a);if(this.calendarOverlay){this.calendarOverlay.hide()}},multiCitySelect:function(g,i,f){if(g){new Event(g).stop()}ta.util.date.normalize(i);if(!i||!i.getTime){return}var a=ta.widgets.calendar.getDatePickerFormat("classic");var b=ta.id(f).getParent(".overlay");if(b.overlay.calendar.crId==="1"){var c=undefined;if(NE){c=new Date(i);c.increment("week",1);if(this.options.flights){var h=(new Date()).increment("day",ta.util.date.MAX_DAYS_BEFORE_RETURN_FLIGHT);if(c>h){c=h}}}this.setPageDates(i,c)}if(NE){NE.checkMultiCityFields(b.overlay.calendar.crId,i)}i=ta.widgets.calendar.dateToString(i,a);b.overlay.calendar.options.creatorElem.innerHTML=i;b.setStyles({left:"-999em",top:"-999em"}).dispose();b.overlay.visible=false},multiSelect:function(g,h,b){if(g){new Event(g).stop()}ta.util.date.normalize(h);if(!h||!h.getTime){return}this.date=h;var a=null;var i=null;a=this.getPageInDate();i=this.getPageOutDate();var f=!a&&!i;var l=true;this.closedByDocOrDateClick=true;var k=false;if((!ta.widgets.calendar.getPageInDate()&&!ta.widgets.calendar.getPageOutDate())||(ta.retrieve("enteredDatesInPreDates")&&!ta.widgets.calendar.hasPageDates())){ta.store("enteredDatesInPreDates",true)}else{ta.store("enteredDatesInPreDates",false)}var j=!ta.has("hotels_left_filters_redesign")&&ta.has("guests_rooms_picker_3.enabled")&&this.isIn;if(ta.retrieve("datepicker_autoadvance")||j&&!f){ta.widgets.calendar.cancelAllExistingHAC();this.bypassSecondCal=false;if(this.isIn){a=h;if(i&&h.getTime()>=i.getTime()){i=false;k=true;ta.widgets.calendar.clearPageOutDate(this.crId,this.options.ext);ta.widgets.calendar.removeInOutCalendarSelected(false)}if(!i){if(h.getDate()<=23){ta.store("datepicker_autoadvance_fday",this.currentMonth.date)}else{ta.remove("datepicker_autoadvance_fday")}}}else{i=h;if(a&&h.getTime()<(new Date()).getTime()){a=new Date();i=ta.widgets.calendar.getDateAfter(a)}else{if(a&&h.getTime()<=a.getTime()){a=false;k=true;ta.widgets.calendar.clearPageInDate(this.crId,this.options.ext);ta.widgets.calendar.removeInOutCalendarSelected(true)}else{if(a){ta.widgets.calendar.trackInOutCalendarSelected(true);this.bypassSecondCal=true}}}}}else{if(this.isIn){var c=i&&(h.getTime()==i.getTime()&&!this.options.flights);if(i&&(h.getTime()>i.getTime()||c)){a=this.date;i=false;k=true;ta.widgets.calendar.clearPageOutDate(this.crId,this.options.ext)}else{a=h;if(i){this.bypassSecondCal=true}}}else{var c=a&&(h.getTime()==a.getTime()&&!this.options.flights);if(a&&h.getTime()<(new Date()).getTime()){a=new Date();i=ta.widgets.calendar.getDateAfter(a)}else{if(a&&(h.getTime()<a.getTime()||c)){i=this.date;a=false;k=true;ta.widgets.calendar.clearPageInDate(this.crId,this.options.ext)}else{i=h;if(a){this.bypassSecondCal=true}}}}}this.inDate=a;this.outDate=i;if(ta.has("guests_rooms_picker_3.enabled")){this.setPredatesState()}this.setPageDates(a,i);if(ta.has("guests_rooms_picker_3.enabled")&&ta.widgets.calendar.hasPageDates()){ta.widgets.calendar.syncAllDatePickers();ta.commerce.meta.updateHeaderDates()}this.hoverDay=false;if(!ta.retrieve("datepicker_autoadvance")){if(!this.bypassSecondCal&&((!this.getPageOutDate()||!this.getPageInDate())&&!k)){this.bypassSecondCal=true}}this.updateNumNights();if(this.calendarOverlay){this.calendarOverlay.hide()}if(this.bypassSecondCal&&!f&&(!this.getPageInDate()||!this.getPageOutDate())){this.bypassSecondCal=false}ta.overlays.Factory.destroyAnimatedDateCTA();if(!this.isSecondCalShown()&&!this.bypassSecondCal||(f&&ta.retrieve("metaUI.isMetaCalendarAutoadvancePredates"))){ta.widgets.calendar.trackInOutCalendarSelected(this.isIn);this.focusOtherCalendar()}else{this.hashHack()}this.removeErrorState();if(!ta.retrieve("datepicker_autoadvance")){if(this.getPageInDate()&&this.getPageOutDate()){this.fireEvent("onRangeSelect",[this.crId,this.options.ext])}this.fireEvent("onSelect",[this,g])}},next:function(){this.parent();this.resetStartRangeElem(true);var a=(this.currentMonth&&this.currentMonth.date?this.currentMonth.date.get("month"):"");ta.trackEventOnPage("DATEPICKER","NEXT_MONTH",(this.isIn?"Checkin":"Checkout"),a)},onCalendarOverlayKeyDown:function(a){if(this.options.submitOnEnter&&"enter"===a.key&&ta.isMetaHomepageIntegration2013()){var c=this.positionElement.getParent("form "),b="function"!==typeof this.options.submitOnEnter||this.options.submitOnEnter(a,c);if(b){c&&c.submit()}else{this.calendarOverlay.hide()}}if(a.key=="esc"||(ta.isMetaHomepageIntegration2013()&&!ta.retrieve("freeform_datepicker")&&a.key=="tab")){this.calendarOverlay.hide()}},onCalendarOverlayHide:function(b){if(this.isSecondCalShown()||ta.widgets.calendar.hasPageDates()){this.ensureValidDates()}ta.widgets.calendar.syncAllDatePickers();if(this.parentOverlay&&this.tempPin){this.tempPin=false;this.parentOverlay.unpin()}if(this.options.captureKeyEvents&&this.keyEventListener){document.removeEvent("keydown",this.keyEventListener)}this.updateInputStyling(false);var h=this.getPageInDate();var e=this.getPageOutDate();var d=h&&h.getDate&&e&&e.getDate;if(this.isSecondCalShown()&&d){this.bypassSecondCal=true}var a=false;if((this.shouldFireOnSelect()||this.bypassSecondCal||(this.closedByDoc&&ta.has("guests_rooms_picker_3.enabled")))&&d&&this.closedByDocOrDateClick){var c=ta.retrieve("datepicker_autoadvance");if(this.closedByDoc&&ta.has("guests_rooms_picker_3.enabled")){ta.store("calendarClosedByDocClick",true);c=true}this.fireEvent("onChangeDates");if(c){this.fireEvent("onRangeSelect",[this.crId,this.options.ext])}this.callOnSelect();this.trackSelect(true);if(ta.retrieve("ta.calendar.isPriceOverlayCalendar")){a=true}if(ta.commerce.persistentdatepicker){ta.commerce.persistentdatepicker.update()}if(ta.has("price_finder")){var f=document.getElements(".roomGuestsInfoWrap");if(f){f.forEach(function(i){i.removeClass("hidden")})}}}else{if(!this.closedByDoc){this.trackSelect(false)}}if(this.resetFireOnSelectCriteria&&(this.isSecondCalShown()&&this.closedByDocOrDateClick||ta.retrieve("datepicker_autoadvance")&&this.calendarOverlay.closedByDocClick)){this.resetFireOnSelectCriteria()}if(a){this.parentOverlay.hide()}if(ta.has("guests_rooms_picker_3.enabled")&&!ta.has("hotels_left_filters_redesign")&&d){ta.widgets.calendar.displayStayInfoPicker()}if(ta.has("feature.date_pickers_as_text")&&ta.widgets.calendar.hasPageDates()){var g=ta.id("DEALS");if(g&&!g.hasClass("date_pickers_as_text")){ta.overlays.Factory.setDatePickersAsText()}}},onCalendarOverlayShow:function(){ta.widgets.calendar.storePriorDates();this.inDate=this.getPageInDate();this.outDate=this.getPageOutDate();this.cursorLeftInitSel=false;this.bypassSecondCal=false;this.date=this.isIn?this.getPageInDate():this.getPageOutDate();if(ta.retrieve("datepicker_autoadvance")&&this.date){ta.widgets.calendar.trackInOutCalendarSelected(this.isIn)}if(ta.has("guests_rooms_picker_3.enabled")){this.setPredatesState();ta.widgets.calendar.updateGuestsRoomsPickerUI()}if(this.parentOverlay&&this.parentOverlay.pin&&this.parentOverlay.options.pinnable==ta.overlays.PINNABLE_CLICK){this.tempPin=!this.parentOverlay.pinned;if(this.tempPin){this.parentOverlay.pin()}}this.update();this.reposition();this.closedByDocOrDateClick=false;this.closedByDoc=false;var a=ta.id(this.positionElement).getParent("#hotels_lf_header_bar_wrap");if(ta.id(this.positionElement).getParent("#PERSISTENT_DATE_PICKER, #STATIC_DATE_PICKER_BAR.sticky")){ta.commerce.persistentdatepicker&&ta.commerce.persistentdatepicker.initCalendar(this)}else{if(ta.id(this.positionElement).getParent("#PERSISTENT_CHECK_RATES")||(a&&a.hasClass("fixed"))){var b=ta.id(this.positionElement).getCoordinates().top+29;if(typeof(isIPad)=="undefined"||!isIPad){b=b-window.getScrollTop()}if(a){b=this.positionElement.getCoordinates().bottom+7-(window.isTabletOnFullSite?0:window.getScrollTop())}ta.id(this.calendarOverlay.container).setStyles({position:"fixed",top:b,zindex:9997})}else{ta.id(this.calendarOverlay.container).setStyle("position","absolute")}}if(ta.retrieve("tablet_calendar_update.enabled")&&this.container){if(ta.retrieve("tablet_calendar_update_v2.enabled")){var f=window.innerWidth/document.documentElement.clientWidth;var c=Math.max(Math.min(Math.floor(150*f),150),100);this.container.setStyle("zoom",c+"%")}else{this.container.setStyle("zoom","150%")}if(this.calendarOverlay&&this.calendarOverlay.position){this.calendarOverlay.position()}}if(this.options.captureKeyEvents){try{this.keyEventListener=this.onCalendarOverlayKeyDown.bind(this);document.addEvent("keydown",this.keyEventListener)}catch(d){}}ta.id(this.positionElement).removeClass("date_picker_error");this.positionElement.blur();this.initTracking();this.updateInputStyling(true)},onDocumentClick:function(a){this.closedByDocOrDateClick=true;this.closedByDoc=true},onOutDateCalShow:function(a){ta.store("ta.calendar.isOutDateTrigger",true);this.calendarOverlay.show(a)},prev:function(){this.parent();this.resetStartRangeElem(false);var a=(this.currentMonth&&this.currentMonth.date?this.currentMonth.date.get("month"):"");ta.trackEventOnPage("DATEPICKER","PREV_MONTH",(this.isIn?"Checkin":"Checkout"),a)},removeErrorState:function(){if(ta.id("NO_DATES_ERROR")){ta.id("NO_DATES_ERROR").hide()}if(ta.id("calPnt")){ta.id("calPnt").removeClass("errorState")}var a=ta.find("#CHECK_RATES_CONT .date_picker_calendar_wrap");if(a){a.removeClass("errorState")}},resetDatepickerOnHover:function(){var d=this.getPageInDate();var c=this.getPageOutDate();var a=this.positionElement;if(!this.isIn){a=a.id.replace("date_picker_out","date_picker_in");if(a){a=ta.id(a)}}ta.widgets.calendar.updateDateDisplay(a,d,c);this.updateHoverElem();if(d){d=d.valueOf()}if(c){c=c.valueOf()}var b=document.getElements(".date_picker_calendar.overlay .calendar .today");var e=document.getElements(".date_picker_calendar.overlay .calendar .day");e.forEach(function(f){var g=f.getAttribute("value");if(g){g=parseInt(g);f=f.getParent();f.className="";if(d&&d==g){f.addClass("start")}else{if(c&&c==g){f.addClass("end")}}if(d&&c&&d<=g&&g<=c){f.addClass("prevSel")}}}.bind(this));b.addClass("today")},resetFireOnSelectCriteria:function(){ta.widgets.calendar.removeInOutCalendarSelected(this.isIn);ta.widgets.calendar.removeInOutCalendarSelected(!this.isIn)},resetStartRangeElem:function(e){if(!this.oneSelected){return}this.startRangeElem=false;this.clearSelectedDays();if(ta.util.i18n.isRtl()){e=!e}e?this.monthOffset++:this.monthOffset--;var b=this.calendarOverlay.container.getElements(".month");if(e){b.shift()}else{b.pop()}b.some(function(g,f){if(g){var h=ta.id(g).getElement("."+this.options.inDateClass);if(h){this.startRangeElem=h;return true}}return false},this);if(!this.startRangeElem){var a=false;if(this.monthOffset>0){var d=0;a=ta.id(b[d]).getElements("td");if(ta.util.i18n.isRtl()){a.reverse()}}else{var c=b.length-1;a=ta.id(b[c]).getElements("td");if(!ta.util.i18n.isRtl()){a.reverse()}}if(a){a.some(function(g,f){if(this.isValidDateElem(g)){this.startRangeElem=g;return true}return false},this)}}},selectLeftRightButtons:function(){var a={};if(this.options.useClassicSkin){a.leftIdle="classicLeftBtn";a.leftInactive="";a.rightIdle="classicRightBtn";a.rightInactive=""}else{a.leftIdle="sprite-date_picker-btnLeftIdle";a.leftInactive="sprite-date_picker-btnLeftInactive";a.rightIdle="sprite-date_picker-btnRightIdle";a.rightInactive="sprite-date_picker-btnRightInactive"}return a},setPageDates:function(b,a){ta.widgets.calendar.storePriorDates();if(b){ta.widgets.calendar.setPageInDate(b)}if(a){ta.widgets.calendar.setPageOutDate(a)}},setPermanent:function(b){if(this.calendarOverlay){this.calendarOverlay.options.permanent=b;this.calendarOverlay.options.pinnable=(b?ta.overlays.PINNABLE_ALWAYS:ta.overlays.PINNABLE_NEVER);var a=this.positionElement;if(this.positionElement&&!this.positionElement.hasClass("isPreDatesPermanent")){a=this.positionElement.getParent(".isPreDatesPermanent")}if(a){a.removeClass("isPreDatesPermanent")}}},setPositionElement:function(){if((ta.has("guests_rooms_picker_3.enabled")&&!ta.has("guests_rooms_picker_4.enabled")&&!ta.has("hotels_rgpicker_outofcalendar")&&!ta.has("hotels_left_filters_redesign"))&&this.options.creatorElem&&!this.options.creatorElem.getParent(".geoChkRates")&&!this.options.creatorElem.getParent("#PERSISTENT_DATE_PICKER")&&(this.options.creatorElem.getParent(".filterControls")||this.options.creatorElem.getParent(".jfy_header_dates_holder")||this.options.creatorElem.getParent(".meta_chevron_module_2014")||this.options.creatorElem.getParent("#HotelDateSearch")||(this.options.creatorElem.getParent(".baseHotelInfoLeft")))){this.positionElement=$$(".miniMetaShowHdr")[0];if(!this.positionElement||!this.positionElement.isVisible()){this.positionElement=$$(".hr_pre_date_minimalist .title")[0]}if(!this.positionElement||!this.positionElement.isVisible()){this.positionElement=$$(".legend.metaDatesChosen")[0]}if(!this.positionElement||!this.positionElement.isVisible()){this.positionElement=$$(".p13n_header_tab_wrap .tab0")[0]}if(!this.positionElement||!this.positionElement.isVisible()){this.positionElement=$$("#STYLE2HEADER_V3 h1")[0]}if(!this.positionElement||!this.positionElement.isVisible()){this.positionElement=$$("#HLDatesHeader")[0]}if(!this.positionElement||!this.positionElement.isVisible()){this.positionElement=$$(".change_dates_button")[0];if(!this.positionElement||!this.positionElement.isVisible()){this.positionElement=$$(".changeStayInfoButton")[0]}}}else{var a="date_picker_in_";if(!this.isIn){a="date_picker_out_"}this.positionElement=ta.id(a+this.crId+this.options.ext);if(!this.positionElement&&this.options.creatorElem.getParent("#PERSISTENT_DATE_PICKER")){this.positionElement=$$("#PERSISTENT_DATE_PICKER .bestPricesMsg")[0]}}if(!this.positionElement){ta.util.error.record(null,"ta.widgets.SingleDateCalendar.setPositionElement - this.positionElement is undefined",null,{},"WARN")}},setPredatesState:function(){if(this.inDate&&this.outDate){this.calendarOverlay.container.removeClass("predates")}else{this.calendarOverlay.container.addClass("predates")}},shouldFireOnSelect:function(){if(!this.onSelect){return false}return this.isSecondCalShown()&&this.calendarOverlay&&this.calendarOverlay.closedByDocClick},showCalendarOverlay:function(a){if(!this.calendarOverlay){return}if(this.parentOverlay&&this.parentOverlay.container&&ta.id(this.parentOverlay.container).hasClass("persistentCR")){this.calendarOverlay.options.activate=ta.overlays.ACTIVATE_CLICK}this.calendarOverlay.show(a)},trackSelect:function(c){var e=ta.id(this.positionElement).get("id");if(!e){var d="date_picker_in_";if(!this.isIn){d="date_picker_out_"}e=d+this.crId+this.options.ext}var i=e.indexOf("_persist")>0;e=e.substring(e.length-3,e.length);var b="START";var f="DATES";var h=-1;if(e=="ond"){f="RoomTab"}if(c){b="SELECT";if(ta.retrieve("ta.calendar.isPriceOverlayCalendar")){f="PRICE_CALENDAR"}else{if(this.inDate&&this.outDate){var g=ta.util.date.getDaysInRange(this.inDate,this.outDate)-1;if(g>ta.util.date.MAX_STAY_DURATION_DAYS){f="DATES_OVER_30_DAYS"}}}}if(this.isIn&&this.today&&this.inDate){h=ta.util.date.getDaysInRange(this.today,this.inDate)-1}else{if(!this.isIn&&this.inDate&&this.outDate){h=ta.util.date.getDaysInRange(this.inDate,this.outDate)-1}}if(ta.retrieve("meta.prof_photo_lb.post_date_close.overlay")){f="CalendarLightbox"}if(ta.retrieve("cal_xsell")){f="CalXSell"}if(f){f="|"+f}if(i){f="|Persistent"+f}if(ta.retrieve("isPricesTabDatePicker")){ta.remove("isPricesTabDatePicker");f+="|Tabs"}if(this.isIn){f="CheckIn"+f}else{f="CheckOut"+f}var a=this.getTrackingPrefix()+ta.widgets.calendar.getTrackingString();ta.widgets.calendar.trackCalendarEvent(a,b,f,h)},getTrackingPrefix:function(){return this.options.isVR?"VR_":""},updateDatepickerOnHover:function(d){var f=this.getPageInDate();var e=this.getPageOutDate();var b;if(this.isIn){f=d;if(e&&d.getTime()>=e.getTime()){e=null}b=this.positionElement}else{e=d;if(f&&d.getTime()<=f.getTime()){f=null}b=this.positionElement.id.replace("date_picker_out","date_picker_in");if(b){b=ta.id(b)}}ta.widgets.calendar.updateDateDisplay(b,f,e);f=this.getPageInDate();if(f){f=f.valueOf()}e=this.getPageOutDate();if(e){e=e.valueOf()}d=d.valueOf();var a=this.isIn?"end":"start";var c=document.getElements(".date_picker_calendar.overlay .calendar .today");var g=document.getElements(".date_picker_calendar.overlay .calendar .day");g.forEach(function(h){var i=h.getAttribute("value");if(i){i=parseInt(i);h=h.getParent();if(h.hasClass(a)){h.className="";h.addClass(a);if(this.isIn&&i<d||!this.isIn&&i>d){h.addClass("invalidPrevSel")}}else{h.className=""}if((this.isIn&&e&&e>=i&&i>=d&&e!=d)||(!this.isIn&&f&&f<=i&&i<=d&&f!=d)){h.addClass("prevSel")}}}.bind(this));c.addClass("today")},updateHoverElem:function(c){if(!this.calendarOverlay){return}var b="msdp_hover";var d=this.calendarOverlay.container.getElement("."+b);var a=ta.retrieve("datepicker_autoadvance")?(this.isIn?"start":"end"):"";if(d){d.removeClass(b);d.removeClass(a)}if(c&&c.getParent()){c.getParent().addClass(b+" "+a)}},updateInputStyling:function(b){var a=this.positionElement.getParent();if(a){b?a.addClass("dualFieldOn"):a.removeClass("dualFieldOn")}},updateNumNights:function(){if(!ta.has("guests_rooms_picker_3.enabled")||!ta.widgets.calendar.hasPageDates()){return}var a=ta.widgets.calendar.getNumberOfNights(),b=$$(".grp-nights-value");if(b&&b.length>0){b.each(function(c){c.set("html",a)});ta.widgets.calendar.updateGuestsRoomsButtonLabelsPluralization(".stayInfoContainer.nights",a)}},updatePrevNext:function(){var d=this.currentMonth.date;var c=this.options.dualCalendar?this.nextMonth.date:this.currentMonth.date;var g=ta.util.date.inSameMonth(d,this.options.firstDate);var f=ta.util.date.inSameMonth(c,this.options.lastDate);var b=ta.id(getChildByClass(this.container,"prev"));var a=ta.id(getChildByClass(this.container,"next"));if(ta.util.i18n.isRtl()){b=ta.id(getChildByClass(this.container,"next"));a=ta.id(getChildByClass(this.container,"prev"));g=ta.util.date.inSameMonth(c,this.options.lastDate);f=ta.util.date.inSameMonth(d,this.options.firstDate)}var e=this.selectLeftRightButtons();if(g){b.addClass(e.leftInactive).removeClass(e.leftIdle).setStyle("cursor","default")}else{b.addClass(e.leftIdle).removeClass(e.leftInactive).setStyle("cursor","pointer")}if(f){a.addClass(e.rightInactive).removeClass(e.rightIdle).setStyle("cursor","default")}else{a.addClass(e.rightIdle).removeClass(e.rightInactive).setStyle("cursor","pointer")}},updateSelectedDays:function(c,b){this.clearSelectedDays();var a=this.startRangeElem;this.includeElemInRange(a,this.options.selectedHoverClass);if(c.getTime()>this.newInDate.getTime()){this.updateSelectedDaysHelper(a,b.parentNode,true,this.options.selectedHoverClass);this.options.selectionStartClass&&ta.id(a).addClass(this.options.selectionStartClass);this.options.selectionEndClass&&ta.id(b.parentNode).addClass(this.options.selectionEndClass)}else{this.updateSelectedDaysHelper(a,b.parentNode,false,this.options.selectedHoverClass);this.options.selectionStartClass&&ta.id(a).addClass(this.options.selectionEndClass);this.options.selectionEndClass&&ta.id(b.parentNode).addClass(this.options.selectionStartClass)}},updateSelectedDaysHelper:function(e,j,g,h){if(!e||e==j){return}var f="nextSibling";var k="firstChild";if(!g){f="previousSibling";k="lastChild"}var d=false;if(this.isValidDateElem(e[f])){d=e[f]}else{var a=e.parentNode;if(a&&a[f]){d=a[f][k]}else{if(a&&ta.id(a).getParent(".month")){var c=ta.id(a).getParent(".month");if(ta.util.i18n.isRtl()){f=(f=="previousSibling")?"nextSibling":"previousSibling"}var i=c[f];if(!i){return}var b=ta.id(i).getElements("td");if(!g){b.reverse()}b.some(function(m,l){if(this.isValidDateElem(m)){d=m;return true}return false},this)}}}this.includeElemInRange(d,h);this.updateSelectedDaysHelper(d,j,g,h)}})})();ta.widgets.tabContainer=function(d,i){var a=d.getElements(".current");if(a.length!=1){throw new Error("You must have exactly one tab with a class of 'current'.")}else{a=a[0]}var g=a.className.match(/tab(\d+)/);if(g!=null&&g.length>=2){var b=Number(g[1])}else{return}if($("HOMEPAGE")&&window.location.hash){var h=window.location.hash.match(/t(\d)/);if(h&&h.length>0){b=parseInt(h[1]);a.removeClass("current");d.getElements(".tab")[b].addClass("current")}}var c=d.getElements(".tabContainerHead .tab");if(c.length==0){return}var f=d.getElements(".tabContainerBody .tabContent");return new TabSet(c,f,{show:b,onActive:function(l,m,j){var n=m.hasClass("xhr");if(n&&!m.hasClass("xhrComplete")){var e=m.getElement("a").href;if(e){var k=m;j.addEvent("onContentReplaced",function(){k.addClass("xhrComplete")});ta.util.element.replaceContent(l,j,e)}}if(m.hasClass("recordAction")){new Request({url:"/ActionRecord?action="+m.id}).send()}m.addClass("current");if(n&&l){l.stop()}},onBackground:function(j,k,e){k.removeClass("current")}})};ta.widgets.Carousel=new Class({Implements:Options,Binds:["shiftLeft","shiftRight"],options:{width:50,height:50,padding:5,num:7,offset:0,horizontal:true},initialize:function(a,b){this.setOptions(b);this.container=a;this.viewport=this.container.getElement(".viewport");this.leftKnob=this.container.getElement(".shiftLeft");this.rightKnob=this.container.getElement(".shiftRight");this.images=this.viewport.getElements("img");this.offset=this.options.offset;if(this.options.horizontal){this.viewport.setStyles({width:this.options.width*this.options.num+this.options.padding*(this.options.num-1),height:this.options.height})}else{this.viewport.setStyles({width:this.options.width+this.options.padding*2,height:this.options.height*this.options.num+this.options.padding*(this.options.num-1)})}this.leftKnob.addEvent("click",this.shiftLeft);this.rightKnob.addEvent("click",this.shiftRight);this.render()},render:function(){var a=this.offset+this.options.num;for(var b=this.images.length-1;b>=0;b--){if(b<this.offset||b>=a){this.images[b].setStyle("left",-999)}else{if(this.options.horizontal){this.images[b].setStyle("left",(this.options.width+this.options.padding)*(b-this.offset))}else{this.images[b].setStyles({top:(this.options.height+this.options.padding)*(b-this.offset),left:0})}}}if(this.offset==0){this.leftKnob.addClass("disabled")}else{this.leftKnob.removeClass("disabled")}if(this.offset==this.images.length-this.options.num){this.rightKnob.addClass("disabled")}else{this.rightKnob.removeClass("disabled")}},shiftLeft:function(){var a=this.offset;this.offset=Math.max(0,this.offset-this.options.num);if(this.offset!=a){this.render()}},shiftRight:function(){var a=this.offset;this.offset=Math.min(this.offset+this.options.num,this.images.length-this.options.num);if(this.offset!=a){this.render()}}});(function(b){b.util.action={record:function a(i,g,e){var f=null;if(b.util.Deferred){f=new b.util.Deferred()}var h=Object.merge({url:"/ActionRecord",data:{action:i},onSuccess:function(j){if(f){f.resolve(j)}},onFailure:function(j){if(f){f.reject(j)}}},g);e&&(h.trackEvent=e);new Request(h).get();if(f){return f.promise()}},recordPlus:function c(i,g,e){var f=null;if(b.util.Deferred){f=new b.util.Deferred()}var h=Object.merge({url:"/ActionRecordPlus",data:{action:i},onSuccess:function(j){if(f){f.resolve(j)}},onFailure:function(j){if(f){f.reject(j)}}},g);e&&(h.trackEvent=e);new Request(h).get();if(f){return f.promise()}},recordPid:function d(e){new Request({url:"/ActionRecord?pid="+e}).send()}}}(ta));ta.util.partials={requestTimeout:1000,maxDataRequests:12,dataRequestCount:0,incompleteDataRegex:/<\!-- incomplete\: ([\w, ]*) -->/,failedDataRegex:/<\!-- failed\: ([\w, ]*) -->/,partialsErrorRegex:/<\!-- error -->/,noOauthTokenRegex:/<\!-- no Oauth Token -->/,finishedInitialMPASequence:false,_resetPolling:function(){ta.util.partials.dataRequestCount=0},_newSeriesArgs:[],_runNextSeries:function(){var a=ta.util.partials._newSeriesArgs.shift();if(a){ta.util.partials.requestPartials.apply(this,a)}},requestMorePartials:function(a,d,b,c){ta.util.partials._newSeriesArgs.push(arguments);if(ta.util.partials.dataRequestCount===0&&ta.util.partials.finishedInitialMPASequence){ta.util.partials._runNextSeries()}},requestPartials:function(b,e,c,d){if(ta.util.partials.dataRequestCount>ta.util.partials.maxDataRequests||b.length==0){ta.util.partials.finishMPASequence();return}ta.util.partials.dataRequestCount++;if(ta.has("fb.partial.extraJS")){ta.retrieve("fb.partial.extraJS").each(function(g){new Asset.javascript(g)})}if(ta.has("fb.partial.extraCSS")){ta.retrieve("fb.partial.extraCSS").each(function(g){new Asset.css(g)})}var a=ta.remove("facebook.authcode.param");var f=Object.merge({parts:b.join(","),requestUrl:ta.retrieve("page.urlSafe")},e);if(a!=null){f=Object.merge(f,{FBAuthCode:a})}new Request({url:"/MultiPartAjax",method:"post",data:f,keepScripts:true,onRequest:function(){},onSuccess:function(g){ta.util.partials.dataAvailable(e,b,c,d,null,null,g)}}).send()},handlePartialPaging:function(h,e,f){var g=f||{};ta.util.partials.dataRequestCount=0;if(!e||e.href==null){ta.util.error.record(null,"handlePartialPaging elmt.href null:"+e,null,null);return false}/parts=([\w,]+)/.test(e.href);var d=RegExp.$1.split(",");ta.store("partial.event.element",e);ta.store("partial.event.params",f);var c=ta.remove("facebook.authcode.param");var a=Object.merge({requestUrl:ta.retrieve("page.urlSafe")},g);var b=Object.clone(a);if(c!=null){a=Object.merge(a,{FBAuthCode:c})}new Request({url:e.href,method:"post",data:a,keepScripts:true,onSuccess:function(i){ta.store("fb.partial.isHandlePartialPaging",true);ta.util.partials.dataAvailable(b,d,"facebook",false,h,e,i)}}).send();return false},dataAvailable:function(d,j,i,f,o,c,g){if(f){var e=ta.util.partials.dataAvailable.pass([d,j,i,false,o,c,g]);f(e,g,j,d,i,f);return}if(g.match(ta.util.partials.noOauthTokenRegex)){if(ta.remove("fb.partial.isHandlePartialPaging")){ta.support.Facebook.pageDataAvailable(o,c,d,g)}return}if(g.match(ta.util.partials.partialsErrorRegex)){if(ta.has(i+".onPartialsError")){ta.remove(i+".onPartialsError").each(function(p){p()})}return}var m=[];var h=[];if(g.match(ta.util.partials.incompleteDataRegex)){m=RegExp.$1.split(",")}if(g.match(ta.util.partials.failedDataRegex)){h=RegExp.$1.split(",")}if(ta.has(i+".onDataAvail")){ta.remove(i+".onDataAvail").each(function(p){p()})}var n=[];var b=null;var l=/<style[^>]*>([\s\S]*?)<\/style>/gi;while((b=l.exec(g))){n.push(b[1])}if(n.length>0){n=n.join("\n");var k=document.createElement("style");k.type="text/css";document.getElementsByTagName("head")[0].appendChild(k);if(Browser.ie&&Browser.version<11){k.styleSheet.cssText=n}else{k.appendChild(document.createTextNode(n))}}g=g.stripScripts(true);g=g.replace(/<style[^>]*>([\s\S]*?)<\/style>/gi,"");var a=ta.id("PARTIAL_DATA")||new Element("div",{id:"PARTIAL_DATA",styles:{display:"none"}}).inject(document.body);a.adopt(Elements.from(g));setTimeout(function(){ta.util.partials.notifyListeners(j,i,m,h,a,d)},0)},notifyListeners:function(d,e,c,b,a,f){d.each(function(l){var p=e+".data.onAvail."+l;var n=c.contains(l);var k=b.contains(l);var q=ta.remove(p);if(q){for(var o=0,m=q.length;o<m;o++){if(q[o](a,n,k)===false){q[o]=null}}q=q.erase(null);if(n){if(q.length>0){ta.store(p,q)}else{c.erase(l)}}}if(!c.contains(l)&&!k){ta.keep("partials.pageProperties",l)}});var h="partials.data.onPage";var g=ta.remove(h);if(g){g.each(function(i){i()})}if(c.length>0){ta.util.partials.requestPartials.invokeLater(ta.util.partials.requestTimeout,null,[c,f,e])}else{ta.util.partials.finishMPASequence()}},finishMPASequence:function(){if(!ta.util.partials.finishedInitialMPASequence){ta.util.partials.recordGAEvent();ta.util.partials.finishedInitialMPASequence=true}ta.util.partials._resetPolling();ta.util.partials._runNextSeries()},recordGAEvent:function(){var b=ta.remove("partials.pageProperties");if(!b||b.length==0){return}var a="-"+b.sort().join("-")+"-";ta.trackEventOnPage("social","show",a)}};ta.util.partials.handleLightbox=ta.util.partials.handlePartialPaging;if(!ta.util){ta.util={}}ta.util.customEvent={_register:function(a){if(!Element.Events[a]){Element.Events[a]={}}},addListener:function(b,c,a){ta.util.customEvent._register(b);c=ta.id(c);if(c&&c.addEvent){c.addEvent(b,a)}},removeListener:function(b,c,a){c=ta.id(c);if(c&&c.addEvent){c.removeEvent(b,a)}}};ta.support.Facebook={ready:false,queue:[],enqueueForFBReady:function(a){if(ta.support.Facebook.ready){a()}else{ta.support.Facebook.queue.push(a)}},dequeueForFBReady:function(){try{ta.support.Facebook.queue.each(function(b){b()})}catch(a){ta.util.error.record(a,"Error calling dequeueForFBReady")}ta.support.Facebook.queue=[]},ipRevoke:function(a){setTimeout(function(){ta.util.pending.lock("fb.revoke.lb",function(){ta.util.pending.unlock("fb.revoke")})},a)},enqueueForFBAvailable:function(a){if(ta.retrieve("facebook.session.available")){a()}else{ta.keep("facebook.onSessionAvail",a)}},init:function(){if(ta.has("facebook.available")){return}ta.util.pending.multilock("facebook.data.canDisplay",ta.support.Facebook.showData,2);var a=ta.support.Facebook.timing=new ta.support.IPTiming();if(!ta.retrieve("facebook.invalidFBCreds")){ta.support.Facebook.initData(true)}ta.support.Facebook.markAvailable();FB.init({appId:ta.retrieve("facebook.appId"),status:true,cookie:true,xfbml:true,version:ta.retrieve("facebook.apiVersion"),frictionlessRequests:true,oauth:true});ta.support.Facebook.ready=true;ta.support.Facebook.dequeueForFBReady();if(!ta.retrieve("facebook.disableLogin")){if(ta.retrieve("facebook.skip.session.check")=="true"){ta.support.Facebook.sessionAvailable()}else{FB.getLoginStatus(ta.support.Facebook.onLoginStatus)}}else{if(!ta.has("facebookuserid")){ta.support.Facebook.sessionUnavailable()}}},transformToAuthResponse:function(c){var a=ta.retrieve("facebook.authFailed");var d=ta.retrieve("facebook.authSuccess");var b=c.authResponse;if(!b){if(a){a()}return null}if("connected"===c.status){b.uid=ta.store("fb.auth.userId",b.userID);b.token=ta.store("fb.auth.token",b.accessToken);if(d){d()}return b}if(a){a()}return null},onLoginStatus:function(b){var a=ta.support.Facebook.transformToAuthResponse(b);if(a){if(ta.has("cached.facebookuid")&&ta.retrieve("cached.facebookuid")!==""+a.uid){ta.util.error.record(null,"Mismatched Facebook uid between cached value and authResponse. cached: "+ta.retrieve("cached.facebookuid")+", response: "+a.uid);ta.store("facebook.preFailed",true);ta.store("facebook.AuthCode.onAvail.needsReload",function(){window.location.reload()});ta.support.Facebook.receiveCode(ta.support.Facebook.getCodeFromOAuthResponse(a));return}if(ta.retrieve("facebook.invalidFBCreds")&&!ta.retrieve("facebook.signout.process")){ta.store("facebook.AuthCode.onAvail",ta.support.Facebook.sessionAvailable);ta.support.Facebook.receiveCode(ta.support.Facebook.getCodeFromOAuthResponse(a))}else{ta.support.Facebook.sessionAvailable()}}else{if(!ta.retrieve("facebook.invalidFBCreds")){ta.store("facebook.preFailed",true);setOneTimeCookieOnFQDN("FacebookAuthCode2","NoFBSessionAvailable");new Request({url:"/ActionRecord?action=fb_cached_token_no_session"}).send()}ta.support.Facebook.sessionUnavailable()}},initData:function(a){if(ta.remove("facebook.data.initialRequest.failed")){ta.support.Facebook.loadData({pre:a})}else{ta.util.pending.lock("facebook.data.initialRequest",ta.support.Facebook.loadData.partial({pre:a}))}},loadData:function(b){if(!ta.has("facebook.data.request")){return}ta.support.Facebook.timing.setBeginPartials();var a=ta.retrieve("facebook.data.request");ta.util.partials.requestPartials(a,Object.merge({},b,ta.retrieve("facebook.data.params")),"facebook",ta.support.Facebook.dataAvailable)},receiveCode:function(d){var a=ta.retrieve("facebook.AuthCode.onAvail");if(a!=null){ta.store("facebook.authcode.param",d);setOneTimeCookieOnFQDN("FacebookAuthCode2",d);a()}var c=ta.retrieve("facebook.AuthCode.onAvail.needsReload");if(c!=null){setOneTimeCookieOnFQDN("FacebookAuthCode2","ConflictedFBAccount");if("function"!==typeof c){ta.util.error.record(null,"needsReload was not a function.")}c();return}var b=ta.retrieve("facebook.AuthCode.onAvail.paging");if(b!=null){ta.store("facebook.authcode.param",d);setOneTimeCookieOnFQDN("FacebookAuthCode2",d);b()}},getCodeFromOAuthResponse:function(b){var d=ta.support.Facebook.parseFBSignedRequest(b.signedRequest).code;var c=ta.remove("facebook.taServerTime");var a=c-3600;var e=null;if(d&&!isNaN(a)){e=d.split(".")}if(e!=null&&e.length>3&&!isNaN(e[3])&&e[3]<a){ta.util.error.record(null,"Facebook sending up expired Code: ",null,{code:d,serverTime:c})}return d},parseFBSignedRequest:function(c){if(!c){return null}var a=c.split(".",2);var d=a[1];if(d){var b=ta.util.decoder.base64Decoder(d);try{return JSON.decode(b)}catch(f){ta.util.error.record(null,"couldn't parse Facebook SignedRequest to JSON object after decode ",null,{signedRequest:c,decoded:b})}}else{ta.util.error.record(null,"Facebook SignedRequest TA received doesn't contain data",null,{signedRequest:c})}},preemptiveRegex:/<\!-- PREEMPTIVE RESPONSE -->/,noOauthTokenRegex:/<\!-- no Oauth Token -->/,limitOfTry:4,dataAvailable:function(a,b,c,f,d,e){if(b.match(ta.support.Facebook.preemptiveRegex)&&ta.remove("facebook.preFailed")){return}if(b.match(ta.support.Facebook.noOauthTokenRegex)){delete f.pre;var g=ta.util.partials.requestPartials.partial(c,f,d,e);ta.store("facebook.AuthCode.onAvail",g);ta.support.Facebook.tryRegetOauthToken()}ta.store("facebook.data.handler",a);if(ta.retrieve("facebook.data.isShowDataOnce")){ta.support.Facebook.showData()}else{ta.util.pending.unlock("facebook.data.canDisplay")}},tryRegetOauthToken:function(){var a=ta.retrieve("fb.noOauthToken.counter");if(a==null){a=0}if(a<ta.support.Facebook.limitOfTry){ta.store("fb.noOauthToken.counter",a+1);FB.getLoginStatus(ta.support.Facebook.checkStatusAndGetCode)}},checkStatusAndGetCode:function(b){var a=ta.support.Facebook.transformToAuthResponse(b);if(a){if(ta.has("cached.facebookuid")&&ta.retrieve("cached.facebookuid")!==""+a.uid){ta.util.error.record(null,"Mismatched Facebook uid between cached value and authResponse. cached: "+ta.retrieve("cached.facebookuid")+", response: "+a.uid);ta.store("facebook.AuthCode.onAvail.needsReload",function(){window.location.reload()})}ta.support.Facebook.receiveCode(ta.support.Facebook.getCodeFromOAuthResponse(a))}},pageDataAvailable:function(e,b,d,a){var c=ta.util.partials.handlePartialPaging.partial(e,b,d);ta.store("facebook.AuthCode.onAvail.paging",c);ta.support.Facebook.tryRegetOauthToken()},showData:function(){ta.remove("facebook.data.handler")();if(!ta.retrieve("facebook.data.isShowDataOnce")){ta.store("facebook.data.isShowDataOnce",true);ta.support.Facebook.timing.recordEndTimes()}},markAvailable:function(){ta.store("facebook.available",true);if(ta.has("facebook.onAvail")){ta.remove("facebook.onAvail").each(function(a){a()})}},sessionAvailable:function(){var a=ta.retrieve("facebook.session.available");ta.store("facebook.session.available",true);ta.support.Facebook.timing.recordLoadTime();if(ta.has("facebook.onSessionAvail")){ta.remove("facebook.onSessionAvail").each(function(b){b()})}if(!a){ta.util.pending.unlock("facebook.data.canDisplay")}ta.support.Facebook.initData(false)},sessionUnavailable:function(){ta.store("facebook.session.available",false);ta.support.Facebook.timing.recordLoadTime();if(ta.has("facebook.onSessionUnavail")){ta.remove("facebook.onSessionUnavail").each(function(a){a()})}$$("#HEAD .FB_login_button").forEach(function(a){a.addEvent("click",function(){new Request({url:"/ActionRecord?action=FBC_Masthead"}).send()})});$$("#WoF_SigninLander .fbcBtnsmall").forEach(function(a){a.addEvent("click",function(){new Request({url:"/ActionRecord?action=WoF_SigninLander"}).send()})})},havePermission:function(b,d,c){var a=ta.retrieve("facebook.permissions");if(a){if(a.indexOf(b)==-1){return c?c():null}return d?d():null}else{FB.api("/me/permissions",function(e){var f=false;e.data.each(function(g){if(g.permission==b&&g.status==="granted"){f=true}});if(f&&d){d()}else{if(!f&&c){c()}}})}},requirePermission:function(a,c,b){ta.support.Facebook.login([a],c,b)},ifLoggedIn:function(b,a){if(ta.retrieve("facebook.session.available")&&b){b()}else{if(a){a()}}},loginButton:function(b,a){ta.support.Facebook.login()},login:function(n,a,e,c,b,l,p){var l=!!l;n=Array.from(n||[]);if(b!=null&&b.length>0){ta.store("facebook.flow",b)}else{ta.store("facebook.flow","FBC")}var f=userLoggedIn?"Connect":"Login";var g=f=="Login"?"":ta.retrieve("facebook.isFBC")=="true"?"Upgrade":"New";var k=(p&&p.pid)||ta.retrieve("facebook.trackingpid");ta.util.cookie.setPIDCookie(k);function d(i,q){return Object.merge({module:i,action:q},k&&{value:k}||{})}ta.util.action.record("FacebookConnect",null,d("social",f+"Attempt"+g));var o=function(){ta.util.cookie.setPIDCookie(k);ta.util.action.record("FacebookConnect",null,d("social",f+"Success"+g));var i={action:f,userType:g};if(a){a(i)}};if(!userLoggedIn||!userFbConnected||c){ta.support.Facebook._doLogin(n,o,e,c,l,p);return}var m=[];for(var j=0;j<n.length;j++){m.push(ta.support.Facebook.havePermission.partial(n[j]))}function h(){if(o){o()}}Function.executeContinuations([ta.support.Facebook.ifLoggedIn].concat(m).concat([h]),ta.support.Facebook._doLogin.partial(n,o,e,l,p))},addEmailLogin:function(b,a){var d={};var c=document.getElement("."+b).get("value");if(!c||!c.match(/.+\@.+\..+/)){document.getElement("."+a).removeClass("hidden");return}if(c){d.email=c}ta.support.Facebook.fbcRegistration(null,null,false,d)},_doLogin:function(c,h,a,f,b,e){var g=["email","user_hometown","user_friends","user_likes","user_location","user_status","publish_actions","user_photos"];var d=f;FB.login(function(j){var i=ta.support.Facebook.transformToAuthResponse(j);if(i&&i.token){ta.support.Facebook.setResultPID();ta.store("facebook.AuthCode.onAvail",function(){ta.store("facebook.uid",i.uid);ta.support.Facebook.fbcRegistration(d,h,b,e)});ta.support.Facebook.receiveCode(ta.support.Facebook.getCodeFromOAuthResponse(i))}else{if(a){a()}}},{scope:g.join(",")})},setResultPID:function(){var a=ta.retrieve("facebook.trackingpid");if(a){ta.util.cookie.setPIDCookie(a)}},fbcRegistration:function(d,g,b,c){var e=!ta.retrieve("facebook.session.available")||!userLoggedIn||!userFbConnected;c||(c={});var a=c.pid;if(d!=null){e=e||d}if(e){var f={flow:ta.retrieve("facebook.flow"),noreload:b};a&&Object.merge(f,{pid:a});ta.store("facebook.session.available",true);ta.store("registration.action","FB_CONNECT");ta.run("ta.overlays.registration.logAndPost",{},f,"FBC-start",Object.merge(c,{action:"FB_CONNECT"}))}if(g){g()}},loginWithFlow:function(a,b){ta.store("facebook.flow",a);ta.support.Facebook.login(null,null,null,b)},logout:function(){FB.logout(function(){window.location.reload()})},logoutNoRefresh:function(a){FB.logout(function(b){userLoggedIn=false;ta.store("facebook.session.available",false);ta.store("facebook.isFBC",false);if(a){a(b)}})},restart:function(){FB.logout(function(){ta.overlays.registration.post({action:"FB_LOGIN"})})},revoke:function(){FB.api({method:"Auth.revokeAuthorization"})},postWall:function(h,f,j,e,c,m,g,d,k,a,i,l,b){FB.ui({method:"feed",message:h,picture:m,link:f,name:j,to:k,caption:e,description:c,display:a,properties:i,actions:[{name:g,link:d}]},function(n){if(n&&n.post_id){if(l){l(n)}}else{if(n&&!n.post_id){ta.util.error.record(null,"Facebook postWall error response from facebook",null,null)}else{if(b){b(n)}}}})},publishStream:function(e,a,g,h,c,f,b,d){FB.login(function(j){var i=ta.support.Facebook.transformToAuthResponse(j);if(i){if(i.token){new Request({url:"/ActionRecord?action=POSTTOWALL_GRANTED"}).send();ta.support.Facebook.postWall(e,a,g,h,c,f,b,d)}}},{scope:"publish_stream"})},loginRequestSpecificPermission:function(b,c,a){FB.login(function(e){var d=ta.support.Facebook.transformToAuthResponse(e);if(d){if(d.token){ta.store("facebook.AuthCode.onAvail",function(){ta.support.Facebook.fbcRegistration(null,c)});ta.support.Facebook.receiveCode(ta.support.Facebook.getCodeFromOAuthResponse(d))}else{if(a){a()}}}},{scope:b})},loginWithFlowAndRequest:function(b,c,d,a){ta.store("facebook.flow",b);ta.support.Facebook.loginRequestSpecificPermission(c,d,a)},signOutComplete:function(){try{ta.support.Facebook.ifLoggedIn(function(){ta.support.Facebook.logout()},function(){window.location.reload()})}catch(a){ta.util.error.record(a,"signoutAction - fb signout failed");window.location.reload()}},enqueueListenForFBAuthChange:function(a){ta.support.Facebook.enqueueForFBReady(function(){FB.Event.subscribe("auth.statusChange",a)})},googleClick:function(c,a){new Request({url:"/ActionRecord?action=Google404Test&pid="+a}).send();if(c){c.onclick=null}var b=ta.id("GOOG_SORRY");if(b){b.show()}}};ta.support.IPTiming=new Class({initialize:function(){this.active=ta.has("facebook.iptiming");if(this.active){this.timers=ta.retrieve("facebook.iptiming")}else{}},recordLoadTime:function(){if(this.active){this.sendActionRecord("LoadPage",this.timers.loaded-this.timers.started)}},setBeginPartials:function(){if(this.active&&!this.timers.partials){this.timers.partials=new Date().getTime()}},recordEndTimes:function(){if(this.active){var a=new Date().getTime();this.sendActionRecord("GetPartials",a-this.timers.partials);this.sendActionRecord("LoadAll",a-this.timers.started)}},sent:{},sendActionRecord:function(c,a){if(this.sent[c]){return}this.sent[c]=true;a=Math.round(a/1000);var b;if(a<=10){b=a.toString()}else{if(a>10&&a<=15){b="11-15"}else{if(a>15&&a<=20){b="16-20"}else{b="21+"}}}c+="_";c+=ta.retrieve("facebook.session.available")?"IP_":"NonIP_";c+=b+"_"+this.timers.servletName;if(this.timers.firstPage){c+="_FirstPage"}ta.util.action.record(c)}});(function(){window.ta||(window.ta={});window.ta.util||(window.ta.util={});var a=function(b){this.constructor=b};window.ta.util.extend=function(f){var c={};var g,h,e,d,b;for(d=1,b=arguments.length;d<b;d++){h=arguments[d];for(e in h){if(h.hasOwnProperty(e)){c[e]=h[e]}}if(h.hasOwnProperty("constructor")){c.constructor=h.constructor}}g=c.hasOwnProperty("constructor")?c.constructor:function(){return f.apply(this,arguments)};a.prototype=f.prototype;g.prototype=new a(g);g.prototype.__super__=f.prototype;for(e in c){g.prototype[e]=c[e]}return g}}());(function(d){d.fb||(d.fb={});var b=new RegExp(["User is already associated","Permissions error"].join("|"));var a=new RegExp(["Timeline is not activated","Requires extended permission","An unexpected error has occurred","An unknown error has occurred","load-error: unknown","Error validating access token","Object at URL.*requires an object of og:type","Could not retrieve data from URL","^unknown error"].join("|"));var c=/Temporarily Blocked/;d.fb.graph={api:function(i,k,j,g){var f=Array.prototype.slice.call(arguments);var e=d.util.Deferred();k||(k="get");j||(j={});g||(g={});g.recordErrors=(g.recordErrors!==false);(function h(l){FB.api(i,k,j,function(n){if(n&&!n.error){e.resolve(n)}else{var o={name:"None",message:"No FB.api response"};var m="ERROR";if(n&&n.error){o.name=n.error.type;o.message=(typeof n.error==="string")?n.error:n.error.message}if(l&&o.message.match("has og:type of '(?:tripadvisortravelmap|civ)")){j.scrape=true;h(false);return}if(a.test(o.message)){m="WARN"}if(g.recordErrors&&!b.test(o.message)){this.recordError(o,{FB_API_ARGS:f,FB_API_RESPONSE:n,FB_AUTH_RESPONSE:FB.getAuthResponse()},m)}e.reject(o)}}.bind(this))}.call(this,true));return e.promise()},remove:function(f,e){e||(e={});e.method="delete";return this.api("/"+f,"delete",e)},recordError:function(g,h,e){var f="ta.fb.graph.api";if(c.test(g.message)){f+=" blocked feature"}if(d.util.error){d.util.error.record(g,f,null,h,e)}return this}}}(ta));(function(a){a.fb.graph.Base=a.util.extend(Object,{constructor:function b(d,c){this.set(d);this.options=c||{};this.connections||(this.connections={})},set:function(d){for(var c in d){d.hasOwnProperty(c)&&(this[c]=d[c])}return this},api:function(c,f,e){if(!(this.id&&this.accessToken)){var d={name:"Missing auth credentials",message:"Facebook Graph object API calls require an id and access token"};a.fb.graph.recordError(d,{FB_ID:this.id,FB_ACCESS_TOKEN:this.accessToken,FB_API_ARGS:arguments},"WARN");return a.util.Deferred().reject(d)}c||(c="");if(/^\//.test(c)){c=c.slice(1)}e||(e={});e.access_token=this.accessToken;return a.fb.graph.api("/"+this.id+"/"+c,f,e)},getConnection:function(c){if(this.connections[c]){return new a.util.Deferred().resolve(this.connections[c])}return this.api(c).success(function(d){this.connections[c]=d.data;return a.util.Deferred().resolve(d.data)},this)},getClientConnection:function(c){if(!this.connections[c]){this.connections[c]=[];this.connections[c].all=false;this.connections[c].clientCount=0}return this.connections[c]},evictConnection:function(c){if(this.connections[c]){delete this.connections[c]}}})}(ta));ta.fb.graph.Application=ta.util.extend(ta.fb.graph.Base);(function(){ta.fb.openFeedDialog=function(b){var a=new ta.util.Deferred();b||(b={});b.method="feed";FB.ui(b,function(c){if(c&&c.post_id){a.resolve(c)}else{a.reject(c)}});return a.promise()}}());(function(a){a.fb.graph.mixin||(a.fb.graph.mixin={});var e=true;var b=true;var d=new RegExp(["Timeline is not activated","Requires extended permission"].join("|"));var c=300;a.fb.graph.mixin.OpenGraph={recordOpenGraph:function(g){var f=this.options.MapAction;if(f){Math.random()>0.2||f.record(g)}return this},getActions:function(f,g){f=this.options.appName+":"+f;var h=this.getClientConnection(f);if(h.all||(!g&&h.length>h.clientCount)){return a.util.Deferred().resolve(h)}return this.api(f,"get",{offset:h.length,limit:c}).success(function(i){Array.prototype.push.apply(h,i.data);if(!i.paging||(i.paging.previous&&!i.paging.next)){h.all=true}return a.util.Deferred(h)})},publishAction:function(g,j,i,h){if(!(a.retrieve("feature.ogPublish")&&e&&b)){return a.util.Deferred().reject("Publishing open graph actions is disabled.")}var f=this.options.appName;var k=this.options.ref;g=f+":"+g;h||(h={});h[j]=(!(/^http/).test(i)?"http://"+this.options.hostname:"")+i;if(k){h.ref=k+(h.ref?"__"+h.ref:"")}if(!a.retrieve("feature.openGraphLocationTagging")){delete h.place}var l=this.api(g,"POST",h).success(function(m){var o=this.getClientConnection(g);var n={id:m.id,data:{}};n.data[j]={url:h[j]};o.splice(o.clientCount,0,n);o.clientCount++;this.recordOpenGraph("OpenGraph_"+g)},this).failure(function(m){if(d.test(m.message)){e=false}});return l},publishLocatedAction:function(i,h,g,f){f||(f={});f.place=(!(/^http/).test(g)?"http://"+this.options.hostname:"")+g;return this.publishAction(i,h,g,f)},deleteActionsByObject:function(h,j,i){var g=this;if(+i!=i){i=(!(/^http/).test(i)?"http://"+this.options.hostname:"")+i}var k=Array.prototype.each?"each":"forEach";return(function f(l){return g.getActions(h,{next:l}).success(function(r){if(!r.all){return f(true)}var m=a.util.Deferred();var q=[];var p,n,o;for(o=0;o<r.length;o++){p=r[o];n=p.data[j];if(n&&(n.url==i||n.id==i)){q.push(p)}}if(!q.length){return m.resolve()}q[k](function(s){a.fb.graph.api(s.id,"delete").success(function(){q.splice(q.indexOf(s),1);var t=r.indexOf(s);r.splice(t,1);if(t<r.clientCount){r.clientCount--}if(!q.length){m.resolve()}}).failure(function(){m.reject()})});return m.promise()},this)}(false))},scrape:function(f){return a.fb.graph.api("/","post",{id:f,scrape:true})},setPublishState:function(f){e=!!f;b=!!f}}}(ta));(function(a){a.fb.graph.mixin||(a.fb.graph.mixin={});a.fb.graph.mixin.Feed={postLink:function(){},postStatus:function(){},postCheckin:function(){},postPhoto:function(){},postVideo:function(){},postFeed:function(b){return this.api("feed","POST",b)}}}(ta));(function(a){a.fb.graph.User=a.util.extend(a.fb.graph.Base,a.fb.graph.mixin.OpenGraph,a.fb.graph.mixin.Feed)}(ta));ta.fb.graph.User.prototype.inviteFriends=(function(b){var d=50;function a(e,f,i,h,g){var j=e.splice(0,d);g||(g=[]);FB.ui({method:"apprequests",message:f||"",title:i||"",new_style_message:true,to:j.join(",")},function(k){if(k&&k.to&&k.to.length){g.push.apply(g,k.to);if(!e.length){a(e,f,i,h,g)}else{h.resolve(g,k)}}else{h.reject(g,k)}})}return function c(f,g,h){var e=b.util.Deferred();a(f,g,h,e);return e.promise()}}(ta));ta.fb.graph.User.prototype.getAppRequests=function(a){if(!a&&this.appRequests){return ta.util.Deferred().resolve(this.appRequests)}return this.api("apprequests").success(function(b){this.appRequests=b},this)};ta.fb.graph.User.prototype.recordAndDeleteAppRequests=function(d,c,f){var a=this;d||(d=[]);if(!c){var b=window.location.search.match(/[?&](?:ref|fb_source)=([^&]*)/);c=b&&b[1]}function e(h){var j=[];var i=0;var g=ta.util.Deferred();h.each(function(l){var k="";ta.fb.graph.api("/"+l,"get").success(function(m){if(m&&m.from&&m.from.id){k=m.from.id}}).always(function(){ta.fb.graph.api("/"+l,"delete",null,{recordErrors:false});j.push((f?f+"_":"")+"AppRequestId_"+l+"_"+k);i++;if(i==h.length){if(a.options.MapAction&&j.length){a.options.MapAction.record(j.join(",")).success(function(){g.resolve()}).failure(function(){g.reject()})}else{g.resolve()}}})});return g.promise()}if(c=="bookmarks"){return this.getAppRequests().success(function(g){g.data.each(function(h){var i=h.id.split("_")[0];~d.indexOf(i)||d.push(i)})}).always(function(){return e(d)})}return e(d)};(function(a){var b=10000;a.fb.graph.TAUser=a.util.extend(a.fb.graph.User,{locationToOgType:function(c){return/^g(?:eo)?|10004/.test(c)?"city":/^a(?:ttraction)?|10021/.test(c)?"attraction":/^e(?:atery)?|10022/.test(c)?"restaurant":/^h(?:otel)?|^lodging|10023/.test(c)?"hotel":null},pin:function(c,f,m){m||(m={});var k=a.util.Deferred();var e=false;var d,h,i,l;if(c){d=this.locationToOgType(c.type);h=c.url}if(!(d&&c.url&&f&&f.length)){return k.reject()}i=!!(this.location&&this.location.latitude&&this.location.longitude);l=!!(this.hometown&&this.hometown.latitude&&this.hometown.longitude);var j=Array.prototype.each?"each":"forEach";var g=0;f[j](function(o){var q=o=="been"?"pin":o;var p={};var r=false;if(a.retrieve("feature.ogRefContainsFbid")){p.ref="fbid="+this.id}if(q=="pin"){var n={};var s;if(i){n.lat=this.location.latitude;n.lng=this.location.longitude}else{if(l){n.lat=this.hometown.latitude;n.lng=this.hometown.latitude}}s=a.travelmap.util.getDistance(c,n,this.locale);if(s){p.distance=s.value;p.distance_unit=s.unit;p.cur_loc_used=i}}else{if(q=="going"){p.end_time="5000-01-01"}}if(m.suppressFeed||(q=="pin"&&f.length>1)){p.no_feed_story=1}if(m.suppressMap||d!="city"||q=="going"||!c.redistributable||q=="pin"&&f.length>1){r=true}this[r?"publishAction":"publishLocatedAction"](q,d,h,p).failure(function(){e=true}).always(function(){if(++g==f.length){k[e?"reject":"resolve"]()}})},this);return k.promise()},visit:function(e,h,g,d){var c=a.util.Deferred();var f={};var i=h.join(",");f.tags=i;if(g){f["fb:explicitly_shared"]=true}this.publishLocatedAction("visit","city",e,f);return c.promise()},removePin:function(e,j){var c=a.util.Deferred();var d=false;var g,f;if(e){g=this.locationToOgType(e.type);f=e.url}if(!(g&&e.url&&j&&j.length)){return c.reject()}var i=Array.prototype.each?"each":"forEach";var h=0;j[i](function(k){var l=k=="been"?"pin":k;var m={};this.deleteActionsByObject(l,g,f).failure(function(){d=true}).always(function(){if(++h==j.length){c[d?"reject":"resolve"]()}})},this);return c.promise()},removeBadge:function(c){var d=false;var f,e;if(c){var f="badge";var e="/MemberTravelMap?ns=badge&badgeId="+c.id}if(!(f&&e)){return new a.util.Deferred().reject()}return this.deleteActionsByObject("earn",f,e)},rate:function(c){var g="rate";var f="attraction";var e=c.url;var d={};if(a.retrieve("feature.ogRefContainsFbid")){d.ref="fbid="+this.id}return this[c.redistributable?"publishLocatedAction":"publishAction"](g,f,e,d)},review:function(e,h,c){var g="review";var f="";if(e.indexOf("/Attraction")==0){f="attraction"}else{if(e.indexOf("/Hotel")==0){f="hotel"}else{if(e.indexOf("/Restaurant")==0){f="restaurant"}}}var d={title:h,body:c};d["fb:explicitly_shared"]=true;return this.publishAction(g,f,e,d)},earnBadge:function(c,f,i){var h="earn";var g="badge";var e="/MemberTravelMap?ns=badge&badgeId="+c;var d={};if(f){d["fb:explicitly_shared"]=true;e+="&story_type=badge_explicit_og"}if(i){d.no_feed_story=true}return this.publishAction(h,g,e,d)},endorseFriend:function(d,c){var h="endorse";var g="friend";var f="/MemberTravelMap?ns=friend&serial="+d;var e={city:"http://"+this.options.hostname+c};return this.publishAction(h,g,f,e)},updateMap:function(c){this._needToScrapeMap=true;if(this._intervalID&&!c){return a.util.Deferred().resolve()}this._intervalID||(this._intervalID=window.setInterval(this.scrapeMap.bind(this),b));return this.options.MapAction.getTravelMapMetaData().always(function(d){var h="publish";var g="map";var f="/MemberTravelMap?ns=map&uid="+this.options.guid;var e={};if(d&&d.tmTotalDistance){e={total_distance:Math.round(d.tmTotalDistance),distance_unit:d.tmDistanceUnit}}if(a.retrieve("feature.ogRefContainsFbid")){e.ref="fbid="+this.id}if(c){e["fb:explicitly_shared"]=true;f+="&story_type=map_explicit_og"}return this.publishAction(h,g,f,e)},this)},shareMapLink:function(){var c={};c.name=tm.hub.messages.myTravelMap;c.link="http://"+this.options.hostname+"/MemberTravelMap?ns=map&uid="+this.options.guid+"&story_type=map_link";c.picture="http://"+this.options.hostname+"/img2/facebook/dlRecentPinned.jpg";return this.postFeed(c)},scrapeMap:function(c){if(this._needToScrapeMap||c){this._needToScrapeMap=false;return this.scrape("http://"+this.options.hostname+"/MemberTravelMap?ns=map&uid="+this.options.guid)}return a.util.Deferred().resolve()}})}(ta));ta.common.wisdomoffriends={reloadASAP:function(){window.location.reload()},showWelcome:function(){ta.store("wof.showWelcome",true)}};if(!ta.popups){ta.popups={}}ta.popups.PopUtil={windowType:{CHECK_RATE:0,PROV_WIN:1,HOLDING:2,COMMERCE:3,VFM:4,COOKIE:5},taPopunderSlots:null,taPopupSlots:null,taHoldingWindowCap:2,taPopWindowSet:[],taWindowCount:0,maxPopunders:4,hwClosed:false,getAndUpWindowCount:function(){return this.taWindowCount++},tryHoldingWindows:function(a,b){try{var g=true;for(var c=0;c<b;c++){var f=this.launchHoldingWindow(a);if(!f.windowObject){g=false}}if(g){return true}}catch(d){ta.util.error.record(d,"try two hw")}return false},getPopunderSlots:function(){if(this.taPopunderSlots===null){this.taPopunderSlots=new ta.popups.PopunderSlotSet()}return this.taPopunderSlots},getPopupSlots:function(){if(this.taPopupSlots===null){this.taPopupSlots=new ta.popups.PopupSlotSet()}return this.taPopupSlots},createCheckRatesWindow:function(a){return this.buildNewWindow(this.windowType.CHECK_RATE,a)},createHoldingWindow:function(b){var a=this.buildNewWindow(this.windowType.HOLDING,b);if(a&&ta.has("checkrates.belligerent_hw")&&Browser.version>22){ta.store("checkrates.popunder",a)}return a},createVFMWindow:function(a){return this.buildNewWindow(this.windowType.VFM,a)},createCookieConsentWindow:function(a){return this.buildNewWindow(this.windowType.COOKIE,a)},buildNewWindow:function(b,d){var a=new ta.popups.TAPopWindow(b,d);if(!a){return false}if(!a.errorOpening&&!a.errorMoving&&a.windowObject){try{if(ta.has("checkrates.add_holding_windows")&&d.windowHook&&d.windowHook.location&&d.windowHook.location.href.test(/RuleBasedPopunder/)){this.taPopWindowSet.unshift(a)}else{this.taPopWindowSet[this.taPopWindowSet.length]=a}if(!d.windowHook&&b==this.windowType.HOLDING){this.trackPopunder(d.url,this.numPopundersCheck())}return a}catch(c){ta.util.error.record(c,"Window Popup - could not register new window")}}return false},getHoldingWindowSet:function(){var e=[];for(var b=0;b<this.taPopWindowSet.length;b++){var a=this.taPopWindowSet[b];if(a&&a.type==this.windowType.HOLDING){var c=a.windowObject;if(c&&"closed" in c){if(!c.closed){e[e.length]=a}else{if(ta.has("checkrates.add_holding_windows")&&c.closed){this.hwClosed=true;var d=window.cookieDomain;if(d){Cookie.write("CommercePopunder","SuppressAll",{domain:d,duration:0})}}}}}}return e},attemptHoldingWindowFromGeoCR:function(){},attemptHoldingWindowWNumChecked:function(){},openCloseTab:function(){var c,d;if(ta.has("popunder.popunder_by_self_closing_tab")){try{d=document.createElement("a");d.href="http://"+window.location.hostname+"/vpages/tab.html";document.body.appendChild(d);c=document.createEvent("MouseEvents");c.initMouseEvent("click",false,true,window,0,0,0,0,0,true,false,false,true,0,null);d.dispatchEvent(c);d.parentNode.removeChild(d)}catch(h){ta.util.error.record(h,"self-closing tab blur method failed")}}else{if(ta.has("checkrates.cr_popunder_by_shift_ctrl")&&Browser.version>23){try{d=document.createElement("a");d.href="about:blank";d.target="popunderwindowhelper";document.body.appendChild(d);c=document.createEvent("MouseEvents");var f=true;var b=true;c.initMouseEvent("click",f,b,window,0,0,0,0,0,true,false,false,true,0,null);d.dispatchEvent(c);d.parentNode.removeChild(d);window.open("about:blank","popunderwindowhelper").close()}catch(h){ta.util.error.record(h,"shift-ctrl blur method failed")}}else{var a=ta.retrieve("checkrates.popunder");if(ta.has("checkrates.belligerent_hw")&&a&&Browser.version>22){var g=window.open("about:blank");if(g){g.close()}ta.remove("checkrates.popunder");try{if(a.windowObject&&a.isTAWindow()){a.moveBehindMain(a.windowObject)}}catch(h){ta.util.error.record(h,"holding window blur")}}}}},attemptHoldingWindow:function(a){if(this.useShiftClick()){return}if(ta.has("checkrates.add_holding_windows")){var b=this.numPopundersCheck();if(b>=this.maxPopunders){return}else{this.launchHoldingWindow(a)}}else{if(this.taHoldingWindowCap>this.getHoldingWindowSet().length){this.launchHoldingWindow(a)}}},launchHoldingWindow:function(a){if(!a){return false}var b=ta.retrieve("checkrates.holdingWindowURI");if(ta.has("checkrates.avlb_popup_win")){b="http://"+window.location.hostname+"/AlsoViewedLB?checkRatesType=checkRates&avlbType=popup&d="+a}if(b){ta.store("checkrates.HWtracking","date");var c={url:b};return this.createHoldingWindow(c)}return false},launchAddHoldingWindow:function(c,a){var b=a||{};b.url=c;return this.createHoldingWindow(b)},popunderReminder:function(b){var a={windowHook:b};this.createHoldingWindow(a)},numPopundersCheck:function(){try{var f=this.getHoldingWindowSet();var b=0;var a=new Cookie("CommercePopunder").readRaw();var d=a?a.match(/\d+/):null;if(!a||!d){b=f.length}else{b=Math.max(f.length,parseInt(d[0],10))}return b}catch(c){ta.util.error.record(c,"CommercePopunder - numPopundersCheck")}},trackPopunder:function(i,h){try{if(!h||!i){return}var c="CommerceEnhancedPopunder";if(i.match(/AlsoViewedLB/)){c="AlsoViewedLB"}else{var a=i.match(/RuleBasedPopunder\?Rule=\d+/);if(a){var d=a[0].match(/\d+/);c="RuleBasedPopunder_"+d[0]}}var b="OpenWindow";var g=ta.retrieve("checkrates.HWtracking");if(g){b="OpenWindow_"+g;ta.remove("checkrates.HWtracking")}ta.trackEventOnPage("CommercePopunder",b,c,h,true)}catch(f){ta.util.error.record(f,"CommercePopunder - trackPopunder")}},trackPopup:function(f){try{if(!f){return}var b="DHTMLOverlay";var g=f.match(/RuleBasedPopup/);if(g){var a=f.match(/Rule=\d+/);if(a){var c=a[0].match(/\d+/);b="RuleBasedPopup_"+c[0]}}ta.trackEventOnPage("Popup","OpenPopup",b,1,true)}catch(d){ta.util.error.record(d,"Popup - trackPopup")}},hasMTPU:function(){try{var c=false;var f=this.getHoldingWindowSet();for(var a=f.length;a--;){var b=f[a].windowObject;if(b&&b.location.href.match(/RuleBasedPopunder/)){c=true;break}}return c}catch(d){ta.util.error.record(d,"CommercePopunder - hasMTPU")}},getProviderWindowDims:function(a,d){var b=null;var f=null;var e=null;var c=null;if(a=="hotels.com"){b=975}if(screen.width>=1280){b=1000;f=897;if(!d){e=0;c=0;if(Browser.chrome){f-=50}else{if(Browser.firefox){f-=87}else{if(Browser.ie){b-=12;f-=179}}}}}return{customWidth:b,customHeight:f,widthOffset:e,heightOffset:c}},useShiftClick:function(){if(ta.has("checkrates.chrome_provider_on_shift_click")){var b=this.getProviderWindowDims();var a=66;if(((window.outerHeight>b.customHeight)||(window.outerWidth>b.customWidth))&&((window.outerHeight<(screen.height-a))&&(window.outerWidth<(screen.width-a)))){ta.store("checkrates.use_chrome_provider_on_shift_click",true);return true}}if(!ta.has("checkrates.cr_provider_on_mousedown")){ta.remove("checkrates.use_chrome_provider_on_shift_click")}return false},expandSidebarWindow:function(c,a,b){if(ta.trackEventOnPage){ta.trackEventOnPage("traffic_acquisition_sidebar","any",a,1)}if(b=="true"){window.moveTo(0,0);window.resizeTo(screen.width,screen.height)}document.getElementById("SliderHolder").style.display="none";document.getElementById("PAGE").style.marginLeft="0px"},cookieSettingsPanel:function(d){if(d){d.stop()}var a={};a.en=451;a.en_UK=834;a.en_IE=835;a.en_ZA=2635;a.sv=720;a.no=721;a.da=1199;a.fr=1197;a.de=1201;a.de_AT=2719;a.el=1198;a.it=1202;a.es=1200;a.pl=1208;a.nl=1209;a.fi=2968;a.hu=3049;a.cs=3128;a.sk=3233;a["default"]=451;var b;if(posLocale in a){b="http://info.evidon.com/pub_info/"+a[posLocale]+"?v=1&nt=0"}else{b="http://info.evidon.com/pub_info/"+a["default"]+"?v=1&nt=0"}var c={customWidth:830,customHeight:620,name:"Cookie Consent Tool",url:b,scrollbars:1,menubar:0,toolbar:0,left:0,top:0};ta.popups.PopUtil.createCookieConsentWindow(c)},newWindowFromExitPop:function(b,a){var c=window.open(a,"_blank","height="+screen.height+",width="+screen.width+",toolbar=yes,menubar=yes,location=yes,resizable=yes,scrollbars=yes,status=yes");if(window.focus){c.focus()}},swapInterstitialFn:function(b,a,c){if(b&&a){if(c){a='<div class="replacementWrap">'+a+"</div>"}b.innerHTML=b.innerHTML.replace("123",a)}},updateInterstitialFormula:function(f,e,c,a,d){var b;if(f){f.removeClass("hidden");b=f.getElement(".formula_base");ta.popups.PopUtil.swapInterstitialFn(b,e,true);b=f.getElement(".formula_operand");ta.popups.PopUtil.swapInterstitialFn(b,c,true);b=f.getElement(".formula_result");ta.popups.PopUtil.swapInterstitialFn(b,a,true);b=f.getElement(".grand_total");ta.popups.PopUtil.swapInterstitialFn(b,d,true)}},displayCommerceClickInterstitial:function(s,f,g,h){var o=ta.id("meta_click_interstitial_wrap");if(o){var c="";o=o.clone(true,true);var i=o.getElement(".provider_logo");if(i){i.setProperty("src",(f||""))}if(ta.has("meta_click_interstitial_v2.enabled")){var l=ta.retrieve("metaClickData");var x=parseInt(l.dateRange,10);var n=parseInt(l.taxesValue,10);var j=parseInt(l.perNight,10);var q=n>=0?j+n:j;var w=q*x;var u=false;if(isNaN(w)||isNaN(n)){u=true}if(ta.util&&ta.util.currency&&!u){var d=ta.retrieve("currentCurrencyCode");w=ta.util.currency.formatCurrency(w,d);n=ta.util.currency.formatCurrency(n,d);j=ta.util.currency.formatCurrency(j,d);q=ta.util.currency.formatCurrency(q,d)}if(!l.locName||!l.geoName){var k=o.getElement(".hotel_name_wrap");if(k){k.addClass("hidden")}}var m=false;if(l.taxesValue>=0&&!u){m=o.getElement(".taxes_formula");ta.popups.PopUtil.updateInterstitialFormula(m,j,n,q,w)}else{if(!u){m=o.getElement(".notax_formula");ta.popups.PopUtil.updateInterstitialFormula(m,j,x,w,"")}}var b=o.getElement(".location_name");if(b){b.set("html",l.locName)}var v=o.getElement(".geo_name");if(v){v.set("html",l.geoName)}var a=o.getElement(".check_in");if(a){a.set("html",l.checkIn)}var r=o.getElement(".check_out");if(r){r.set("html",l.checkOut)}var p=o.getElement(".stay_duration");ta.popups.PopUtil.swapInterstitialFn(p,x,false);setTimeout(function(){if(!s||s.closed){return}var e=s.document.getElementById("load_bar_filler");if(e){e.className+=" loading"}},0);if(window.isTabletOnFullSite){c="<script type='text/javascript'>setTimeout(function() {window.location='"+h+"';}, 500);<\/script>"}}try{s.document.write(o.get("html")+(c||""));ta.trackEventOnPage("COMMERCE_CLICK","INTERSTITIAL_LOADED",(g||""))}catch(t){}}},pollForPartnerLoad:function(a,b,c){if(a){setTimeout(function(){var f=null;var d=new Date().getTime()-b.getTime();try{f=a.document}catch(g){}if(!f){ta.trackEventOnPage("COMMERCE_CLICK","PROVIDER_LOADED",(c||""),d)}else{if(d>20000){ta.trackEventOnPage("COMMERCE_CLICK","PROVIDER_TIMEOUT",(c||""),d)}else{if(a.closed){ta.trackEventOnPage("COMMERCE_CLICK","PROVIDER_CLOSED",(c||""),d)}else{ta.popups.PopUtil.pollForPartnerLoad(a,b,c)}}}},100)}},redirectToUrl:function(a,c){if(a){if(ta.retrieve("commerce_history_injection.enabled")&&a.history&&a.history.pushState){try{a.history.pushState({fromBackClick:true},"",window.location.href);ta.trackEventOnPage("COMMERCE_HISTORY_INJECT","history_injected","")}catch(b){ta.util.error.record(b,"commerce history injection failed",null,null,"WARN")}}a.location=c}else{window.location=c}},maximizeWindow:function(){window.moveTo(0,0);window.resizeTo(screen.availWidth,screen.availHeight)},beforePopTargetBlankIE:function(c){var b,d,a;if(!c||!c.href){return true}b=ta.id(c);if(!b||!b.getProperty||b.getProperty("target")!=="_blank"){return true}if(!ta.browser||!ta.browser.isIE10Metro()){if(ta.browser&&!ta.browser.isIE9orHigher()){a=window.getSize();if(a){d=window.open(c.href,"_blank","location=yes,resizable=yes,menubar=yes,scrollbars=yes,toolbar=yes,width="+a.x+",height="+a.y)}}else{d=window.open(c.href,"_blank")}}if(!d||d.closed||typeof d.closed==="undefined"){b.removeProperty("target");if(ta.util&&ta.util.cookie){ta.util.cookie.setPIDCookie(38821)}return true}else{return false}},attemptOpenUrlNewTab:function(b){var c;if(!ta.browser||!ta.browser.isIE10Metro()){if(ta.browser&&window.isIE&&!ta.browser.isIE9orHigher()){var a=window.getSize();if(a){c=window.open(b,"_blank","location=yes,resizable=yes,menubar=yes,scrollbars=yes,toolbar=yes,width="+a.x+",height="+a.y)}}else{c=window.open(b,"_blank")}}if(!c||c.closed||typeof c.closed==="undefined"){if(ta.util&&ta.util.cookie){ta.util.cookie.setPIDCookie(38821)}window.location=b;return false}return c}};ta.popups.TAPopWindow=new Class({Implements:Options,options:{name:"TAWin",url:"",windowHook:false,customWidth:false,customHeight:false,toolbar:1,location:1,directories:1,status:1,menubar:ta.browser.isIE9orHigher()?0:1,resizable:1,copyhistory:1,scrollbars:1,alwaysRaised:false,alwaysLowered:false,widthOffset:8,heightOffset:164,delayLoad:false},initialize:function(h,k){var d,j,b;this.setOptions(k);this.type=h;this.assignSlot();if(this.options.customWidth){this.width=this.options.customWidth}if(this.options.customHeight){this.height=this.options.customHeight}if(this.options.widthOffset!=null){this.widthOffset=this.options.widthOffset}if(this.options.heightOffset!=null){this.heightOffset=this.options.heightOffset}if(this.options.delayLoad){this.delayLoad=this.options.delayLoad}if(this.options.windowHook){this.windowObject=this.options.windowHook;if(!ta.has("checkrates.add_holding_windows")){this.windowObject.refresh()}return true}if(ta.has("checkrates.chrome_dates_entry_holding")){this.options.scrollbars=0}this.url=this.options.url;this.assignWinArgs();try{if(this.type==ta.popups.PopUtil.windowType.HOLDING){ta.util.cookie.setPIDCookie(28962)}if(Browser.chrome&&this.options.inTab){var g=Math.random().toString(36).substring(7);if(this.options.popunder){d=document.createElement("a");d.href=this.url;d.target=g;document.body.appendChild(d);j=document.createEvent("MouseEvents");j.initMouseEvent("click",false,true,window,0,0,0,0,0,true,false,false,true,0,null);d.dispatchEvent(j);d.parentNode.removeChild(d);this.windowObject=window.open(this.url,g);return}else{this.windowObject=window.open(this.url,g);return}}if(ta.has("checkrates.use_chrome_provider_on_shift_click")){d=document.createElement("a");d.href=this.url;document.body.appendChild(d);j=document.createEvent("MouseEvents");j.initMouseEvent("click",true,true,window,0,0,0,0,0,false,false,true,false,0,null);this.windowObject=d.dispatchEvent(j);d.parentNode.removeChild(d)}else{if(this.type==ta.popups.PopUtil.windowType.HOLDING&&ta.has("popunder.popunder_by_self_focus")){window.open("javascript:window.focus()","_self","")}var a=Browser.chrome&&Browser.version>31;if(a){this.windowObject=window.open("","_blank")}else{if(this.options.popunder){if(Browser.ie8||Browser.ie9||Browser.ie10||Browser.ie11){this.windowObject=window.open("pages/blank.html","_blank",this.winArgs);window.document.focus()}else{if(Browser.safari&&Browser.Platform.name!=="ios"){this.windowObject=window.open("","_blank",this.winArgs);if(this.windowObject){var i=window.open("","_blank");i.close()}window.focus()}else{if(Browser.firefox){this.windowObject=window.open("","_blank",this.winArgs);window.open("","_self","");window.focus()}else{this.windowObject=window.open("","_blank",this.winArgs)}}}}else{this.windowObject=window.open("","_blank",this.winArgs)}}b=this.windowObject;if(b&&this.isTAWindow()){if(this.type==ta.popups.PopUtil.windowType.CHECK_RATE){ta.popups.PopUtil.pollForPartnerLoad(b,new Date(),this.options.name)}if(!this.delayLoad){if(ta.retrieve("meta_click_interstitial.enabled")&&this.url.indexOf("/StartBooking")<0){ta.popups.PopUtil.displayCommerceClickInterstitial(b,this.options.providerLogo,this.options.name,this.url);var c=this.url;setTimeout(function(){try{ta.popups.PopUtil.redirectToUrl(b,c)}catch(l){}},500)}else{ta.popups.PopUtil.redirectToUrl(this.windowObject,this.url)}}}else{if(!b&&Browser.ie&&this.type===ta.popups.PopUtil.windowType.CHECK_RATE&&this.url&&ta.has("ta.ie_commerce_popup_block_fix")){if(ta.util&&ta.util.cookie){ta.util.cookie.setPIDCookie(38822)}window.location=this.url}}}}catch(f){this.errorOpening=f;ta.util.error.record(this.errorOpening,"pop window opening failure",null,{type:this.type,url:this.url})}try{b=this.windowObject;if(b&&this.isTAWindow()){if(this.type==ta.popups.PopUtil.windowType.HOLDING){this.moveBehindMain(b)}}}catch(f){this.errorMoving=f;ta.util.error.record(this.errorMoving,"popunder window moving",null,{type:this.type,url:this.url})}},repurpose:function(d,b,f){if(this.type==ta.popups.PopUtil.windowType.HOLDING){this.type=ta.popups.PopUtil.windowType.CHECK_RATE;this.slot.occupied=false;this.assignSlot();this.url=d;if(b){this.width=b;this.options.widthOffset=0}if(f){this.height=f;this.options.heightOffset=0}var a=this.windowObject;if(a&&this.isTAWindow()){try{if(!this.options.inTab){a.moveTo(0,0);a.resizeTo(this.width+this.options.widthOffset,this.height+this.options.heightOffset);a.moveTo(this.x,this.y)}if(!this.delayLoad&&!this.options.keepFocus){a.focus()}if(!this.delayLoad){a.location=this.url}}catch(c){ta.util.error.record(this.errorMoving,"repurpose popunder fail",null,{type:this.type,url:this.url})}}return this}return false},assignWinArgs:function(){this.winArgs="toolbar="+this.options.toolbar;this.winArgs+=",location="+this.options.location;this.winArgs+=",directories="+this.options.directories;this.winArgs+=",status="+this.options.status;this.winArgs+=",menubar="+this.options.menubar;this.winArgs+=",resizable="+this.options.resizable;this.winArgs+=",copyhistory="+this.options.copyhistory;this.winArgs+=",scrollbars="+this.options.scrollbars;this.winArgs+=",width="+this.width;this.winArgs+=",height="+this.height;this.winArgs+=",left="+this.x;this.winArgs+=",top="+this.y;this.winArgs+=",screenx="+this.x;this.winArgs+=",screeny="+this.y;if(this.options.alwaysRaised){this.winArgs+=",alwaysRaised"}if(this.options.alwaysLowered){this.winArgs+=",alwaysLowered"}},assignSlot:function(){if(this.type==ta.popups.PopUtil.windowType.HOLDING){this.slot=ta.popups.PopUtil.getPopunderSlots().getOpenSlot();this.width=this.slot.tw;this.height=this.slot.th;this.x=this.slot.tx;this.y=this.slot.ty}else{this.slot=ta.popups.PopUtil.getPopupSlots().getOpenSlot();this.width=this.slot.w+this.options.widthOffset;this.height=this.slot.h+this.options.heightOffset;this.x=this.slot.x;this.y=this.slot.y}this.slot.occupied=this},moveBehindMain:function(c){if(!ta.has("popunder.popunder_by_self_focus")||ta.has("popunder.popunder_by_self_focus_shift_ctrl")){if(ta.has("checkrates.cr_popunder_by_shift_ctrl")&&Browser.version>23){ta.popups.PopUtil.openCloseTab()}else{if(ta.has("checkrates.chrome_dates_entry_holding")&&!(ta.has("checkrates.belligerent_hw")&&Browser.version>22)){try{var a=window.open("about:blank");if(a){a.focus();a.close()}}catch(b){ta.util.error.record(b,"holdingWindow - Chrome blur failed")}}}}c.blur();c.opener=self;c.moveTo(this.slot.x,this.slot.y);c.resizeTo(this.slot.w,this.slot.h);if(!this.delayLoad){c.location=this.url}window.focus();if(!document.activeElement.hasClass("globalNav2011_reset")){ta.trackEventOnPage("checkrates","no_focus_on_main",Browser.version,1)}},isTAWindow:function(){var c=true;try{var a=this.windowObject.location;this.windowObject.status="";if(a===null||a===""){c=false}}catch(b){c=false}return c}});ta.popups.Slot=new Class({initialize:function(c,b,d,a){this.x=c;this.y=b;this.w=d;this.h=a;this.occupied=null}});ta.popups.SlotSet=new Class({initialize:function(){this.nW=525;this.nH=460;this.nXI=24;this.nYI=24;this.totalSlots=20;this.slots=[];try{if(screen.width>1024){this.nW=800;this.nH=600;this.nXI=80;this.nYI=40}else{if(screen.width>800){this.nW=620;this.nH=500;this.nXI=60;this.nYI=30}}}catch(a){this.error=a;ta.util.error.record(this.error,"slot set",null,{"slot set":"general"})}},getUsedCount:function(){var b=0;if(this.slots){for(var a=0;a<this.slots.length;a++){if(this.slots[a].occupied&&!this.slots[a].occupied.closed){b++}}}return b},getOpenSlot:function(f){if(!f||f<0||f>this.totalSlots){f=0}var d=function(l){try{var h=false;var j=false;try{j=this.slots[l].occupied}catch(k){}if(!j){h=true}else{try{var g=j.windowObject;if(!g||g.closed){h=true}}catch(k){h=true}}}catch(k){ta.util.error.record(k,"get open slot - get pop slot",null,{totalSlots:this.totalSlots,slotNumber:l})}if(h){this.slots[l].occupied=null;var i=this.slots[l];i.slotPos=l;return i}return false}.bind(this);try{for(var a=f-1;a>=0;a-=1){var c=d(a);if(c){return c}}for(var a=f;a<this.slots.length;a++){var c=d(a);if(c){return c}}}catch(b){ta.util.error.record(b,"get open slot",null,{totalSlots:this.totalSlots})}return false}});ta.popups.PopunderSlot=new Class({Extends:ta.popups.Slot,initialize:function(b,i,d,f,c,a,e,g){this.parent(b,i,d,f);this.tx=c;this.ty=a;this.tw=e;this.th=g}});ta.popups.PopupSlotSet=new Class({Extends:ta.popups.SlotSet,initialize:function(){this.parent();this.nX=500;var b=1160;try{if(screen.width<1660){if(screen.width>1024&&screen.width<1280){b=960}else{if(screen.width<=1024){b=740}}this.nX=screen.width-b}this.nY=!isNaN(window.screenTop)?window.screenTop:!isNaN(window.screenY)?window.screenY:0}catch(c){this.error=c;this.nY=0;ta.util.error.record(this.error,"slot set",null,{"slot set":"popup"})}for(var a=0;a<this.totalSlots;a++){this.slots[a]=new ta.popups.Slot(this.nX,this.nY,this.nW,this.nH);this.nX=this.nX+this.nXI;this.nY=this.nY+this.nYI}}});ta.popups.PopunderSlotSet=new Class({Extends:ta.popups.PopupSlotSet,initialize:function(){this.parent();try{this.nX=(window.screenLeft||window.screenX);this.nY=(window.screenTop||window.screenY)}catch(b){this.error=b;this.nX=200;this.nY=200}this.w=1;this.h=1;this.x=5000;this.y=5000;this.totalSlots=4;try{if(Browser.ie7){this.w=250;this.h=100}if(Browser.safari||Browser.chrome){this.w=85;this.h=100}if(typeof(this.nX)=="undefined"){this.nX=0;this.nY=0;this.x=this.nX+window.screen.availWidth-this.w;this.y=this.nY+window.screen.availHeight-this.h}else{this.x=this.nX+window.getWidth()-this.w;this.y=this.nY+window.getHeight()-this.h}if(Browser.ie7){this.y=this.y-95;this.x=this.x+13}else{if(Browser.safari||Browser.chrome){this.y=this.y-16}}}catch(b){this.error=b}if(this.error){ta.util.error.record(this.error,"slot set",null,{"slot set":"popunder"})}for(var a=0;a<this.totalSlots;a++){this.slots[a]=new ta.popups.PopunderSlot(this.nX,this.nY,this.nW,this.nH,this.x,this.y,this.w,this.h);this.nX=this.nX+this.nXI;this.nY=this.nY+this.nYI}}});window.setupLazyLoad=function(){var a=new LazyLoad({range:200},lazyImgs,lazyHtml);return a};var LazyLoad=new Class({Implements:[Options,Events],options:{range:200,fireScroll:true,mode:"vertical"},initialize:function(n,l,o){this.setOptions(n);this.container=window;var b=(this.options.mode=="vertical"?"y":"x");this.containerDimension=this.container.getSize()[b];this.start=0;var k=this.containerDimension+this.options.range;var j=ta.retrieve("ta.commerce.obf");if(j){try{var h=j.given.split("");var f=j.replace.split("");var d=j.token}catch(i){ta.util.error.record(i,"obfuscation object corrupted")}}var m=0;this.htmlBlocks=o.filter(function(r){var q=ta.id(r.id);if(q&&(q.getPosition()[b]>k&&r.scroll)){m++;return true}else{if(q){try{var u=r.data.indexOf(d);if(j&&u==0){var s=r.data.substr(d.length).split("");for(var p=s.length;p--;){var t=s[p];var u=f.indexOf(t);if(u!=-1){s[p]=h[u]}}q.innerHTML=s.join("")}else{q.innerHTML=r.data}}catch(v){ta.util.error.record(v,"lazy html",null,{id:r.id})}return false}else{return false}}},this);var c=0;this.images=l.filter(function(p){var e=ta.id(p.id);if(e){e.oSRC=p.src||p.data;e.priority=p.priority||1000;if(p.logerror){e.onerror=function(){ta.util.error.record(new Error("lazy img did not load from "+e.src),null,null,null,"WARN")}}if((!e.isVisible()||e.getPosition()[b]>k)&&p.scroll){c++;return true}else{ta.queueLazyImg(e);return false}}else{return false}},this);ta.processLazyImages();var a=function(){var e=this.getScroll();if(e>this.start){this.load();this.start=e}this.fireEvent("scroll");if(!this.images.length){this.container.removeEvent("scroll",a);this.fireEvent("complete")}}.bind(this);this.load=function(){this.htmlBlocks=this.htmlBlocks.filter(function(q){try{var p=ta.id(q.id);if((p&&p.getPosition&&((this.getScroll()+this.options.range+this.containerDimension)>=p.getPosition()[b]))||(p&&!p.getPosition)){p.innerHTML=q.data;return false}}catch(r){ta.util.error.record(r,"lazy",null,{id:q.id})}return true},this);this.images=this.images.filter(function(q){try{var p=ta.id(q.id);if((p&&p.getPosition&&((this.getScroll()+this.options.range+this.containerDimension)>=p.getPosition()[b]))||(p&&!p.getPosition)){ta.queueLazyImg(p);return false}}catch(r){ta.util.error.record(r,"lazy",null,{src:q.src})}return true},this);ta.processLazyImages()}.bind(this);var g=function(){var e=this.container.getSize()[b];if(e>this.containerDimension){this.containerDimension=e;this.load()}}.bind(this);this.container.addEvent("scroll",a);this.container.addEvent("resize",g);if(this.options.fireScroll){this.container.fireEvent("scroll")}},getScroll:function(){if(this.container&&this.container.getScroll){return this.container.getScroll()[this.options.mode=="vertical"?"y":"x"]}else{return 9000}}});var TypeAhead=(function(e){var L={minChars:1,search:null,itemTemplate:function(Q){return Q&&Q.value},listTemplate:function(R){var Q=R.results?R.results:R;return'<div class="typeahead-choices">'+Q.map(function(T,S){return'<div class="typeahead-choice">'+T.rendered+"</div>"}).join("")+"</div>"},errorTemplate:function(Q){return'<div class="message">'+Q+"</div>"},resolveSelection:function(Q){return Q&&Q.value},equal:function(R,Q){return R.value==Q.value},shouldSubmit:function(){return true},eligibleForHistoryInjection:function(Q){return(Q.data_type=="LOCATION")},shouldReplaceHistoryItem:function(Q){return true},getHistoryMatchingKey:function(Q){return Q.value},validator:null,containerClass:"typeahead-container",itemSelector:".typeahead-choice",errorClass:"error",defaultTextClass:false,defaultValue:null,width:true,showOnFocus:true,onUserFocus:null,autoSelectFirst:false,selectOnBlur:true,assumeOnBlur:true,onUserBlur:null,restoreOnFocus:false,cycleInput:true,autopopulateHighlighted:true,selectInputText:true,onSelect:null,onRestore:null,onSync:null,onRender:null,onShow:null,onHide:null,onError:null,nextField:null,offsetY:0,offsetX:0,syncro:null,containerParent:document.body,positionRelative:false,unselectOnEscape:false,cacheResults:false,autoHighlightFirst:false,ignoreKeysWhenInvisible:false,name:"unknown",geoId:undefined,startEventOn:"focus",queryLengthLimit:100,postResultsFnList:null,showHistory:false,integrateHistory:false,highlightHistory:false,recentHistory:[],maxHistoryItems:5,historyTypes:["geo","eatery","hotel","attraction"],historyLinkType:"url",historyPredicate:null,minHistoryChars:null,historySort:null,jpFirefoxIME:false,jpFirefoxIMEInterval:500,clearDefaultTextOnFocus:true,focusOnCreation:false,searchParams:null,errorOnSearchFailure:"error",enableQueryDelay:false},N=8,J=9,D=13,o=16,k=17,m=18,B=20,n=27,v=37,K=38,z=39,A=40,w=46,x=91,d="click",q="enter",r="tab";var F=function(R){var Q=ta.util.Deferred();var T=this.getSearchParams();var S=this;T.query=R;T.action="API";T.uiOrigin=this.options.name;T.source=this.options.name;T.startTime=this.options.startTime;new ta.util.ajax({method:"GET",url:"/TypeAheadJson",data:T}).always(function(U){if(U){Q.resolve(U)}else{Q.reject(S.options.errorOnSearchFailure)}});return Q.promise()};var h=function(S){var Q=0;for(var R=this.source.value.length-1;R>=0;R--){Q++;var T=this.source.value.charCodeAt(R);if((T>=19968&&T<=40959)||(T>=12352&&T<=12543)||(T>=44032&&T<=55295)){Q++}if(!S&&Q>=this.options.minChars){return true}}return S?Q:false};var c=function(){var Q=this.source;if(this.hasDefaultText()&&this.options.clearDefaultTextOnFocus!==true){window.setTimeout(function(){Q.setSelectionRange(0,0)},0)}};var j=function(Q){if(this.hasDefaultText()&&this.options.clearDefaultTextOnFocus!==true){e.removeClass(this.source,this.options.defaultTextClass);this.source.value=""}if(this.options.startEventOn==="type"){l.call(this)}if(this.options.ignoreKeysWhenInvisible&&!this.visible){return}switch(Q.keyCode){case D:Q.preventDefault();Q.stopPropagation();if(this.selectedIndex>=0){this.select(true,q);y.call(this)}else{if(this.options.assumeOnBlur&&this.results&&this.results.length){if(typeof this.options.assumeOnBlur=="function"){this.setSelectedIndex(this.options.assumeOnBlur(this))}else{this.setSelectedIndex(0)}M.call(this);this.select(true,q);y.call(this)}if(this.options.shouldSubmit()){if(!this.options.validator||this.options.validator(Q)){if(this.options.onSubmit){this.options.onSubmit(this)}this.source.form.submit()}}}break;case A:this.highlightNextChoice();Q.preventDefault();Q.stopPropagation();break;case K:this.hightlightPreviousChoice();Q.preventDefault();Q.stopPropagation();break;case n:this.restore();this.hide();break;case J:this.tabPressed=true;break}if(this.options.onKeyDown){this.options.onKeyDown(Q,this)}};var I=function(Q){setTimeout(G.bind(this),0)};var b=function(Q){if(Q){switch(Q.keyCode){case J:case o:case k:case m:case B:case v:case K:case z:case A:case x:case D:case n:return}}G.call(this)};var g=function(){var Q=this.source.value;if(this.intervalHandler){window.clearTimeout(this.intervalHandler)}if(!this.options.enableQueryDelay||this.lastQueryTime+500<=new Date().getTime()){this.intervalHandler=null;this.search()}else{this.intervalHandler=setTimeout(function(){if(this.source.value===Q){this.search()}}.bind(this),300)}};var u=function(){var Q=this.results&&this.results.length===0;return !this.hasDefaultText()&&h.call(this)&&this.source.value!==this.query&&(this.selectedIndex<0||!this.results||Q||this.source.value!==this.results[this.selectedIndex].value)};var G=function(){if(!u.call(this)&&h.call(this,true)<this.options.minChars){this.selected&&e.removeClass(this.selected,"selected");e.removeClass(this.source,this.options.errorClass);this.results=null;this.error=null;this.setSelectedIndex(-1);this.selected=null;this.query=null;this.historyShown=false;var Q=this.source&&(!this.source.value||E(this.source.value).trim().length==0);if(this.shouldShowHistory()&&(Q||this.hasDefaultText())){this.showHistoryIfEnabled()}else{this.hide()}}else{g.call(this,this.query)}};var H=function(Q){if(!(this.results&&this.results.length)){return}this.selectedIndex+=Q;if(this.selectedIndex>=this.results.length){this.setSelectedIndex(this.options.cycleInput?-1:0)}else{if(this.selectedIndex<(this.options.cycleInput?-1:0)){this.setSelectedIndex(this.results.length-1)}}M.call(this)};var M=function(){this.selected&&e.removeClass(this.selected,"selected");if(-1===this.selectedIndex){this.selected=null;this.options.autopopulateHighlighted&&this.query&&(this.source.value=this.query);this.options.selectInputText&&this.source.select(false)}else{this.selected=this.items[this.selectedIndex];e.addClass(this.selected,"selected");this.options.autopopulateHighlighted&&this.results&&(this.source.value=this.options.resolveSelection(this.results[this.selectedIndex]))}};var s=function(T,W,ae,ab,Z,X,ad,S,R,U,aa,ac,Q,Y,af){var V={uiOrigin:R,global:S>1?false:true,scope:S>1?S:undefined,fromHistory:ac,hadHistory:Q,type:af.type,value:W,eventType:T,source:R,startTime:U,action:"RECORD",selDepth:ae,totalNum:ab,userInteractionType:X,errors:ad,query:aa,dataType:af.data_type,url:af.url};if(Y){V=Y(V,af)}new Request({method:"GET",url:"/TypeAheadJson",data:V,onSuccess:Z,onFailure:Z}).send()};var l=function(){if(!this.startNotificationSent){this.startNotificationSent=true;var Q=new Date();this.options.startTime=Q.getTime()+(Q.getTimezoneOffset()*60*1000);var R=this.options.geoId;var S=this.options.name;new Request({method:"GET",data:{action:"RECORD",eventType:"start",uiOrigin:this.options.name,startTime:this.options.startTime,source:S,linkedTypeAhead:this.options.linkedTypeAhead?this.options.linkedTypeAhead.options.startTime:void 0,global:R?false:true,hadHistory:this.options.recentHistory.length>0,scope:R},url:"/TypeAheadJson"}).send()}};var C=function(Q){if(this.hasDefaultText()&&this.options.clearDefaultTextOnFocus===true){e.removeClass(this.source,this.options.defaultTextClass);this.source.value=""}c.call(this);if(!this.autoFocusing){if(this.options.onUserFocus){this.options.onUserFocus(this)}this.options.showOnFocus&&this.show();if(this.options.restoreOnFocus){this.restore()}if(this.options.showOnFocus&&this.query&&!this.results&&!this.error&&h.call(this)){this.search()}if(this.options.jpFirefoxIME){P.call(this)}this.showHistoryIfEnabled()}if(this.options.startEventOn==="focus"){l.call(this)}this.autoFocusing=false};var P=function(){if(this.source==document.activeElement){var Q=function(){G.call(this);if(this.jpTypeAheadTimerId){clearTimeout(this.jpTypeAheadTimerId)}this.jpTypeAheadTimerId=setTimeout(Q.bind(this),this.options.jpFirefoxIMEInterval)};Q.call(this)}};var t=function(S,Q){if(this.checkMenuInteraction()){return}this.hide();var R=this.tabPressed;this.tabPressed=false;if(!this.options.restoreOnFocus&&!this.query){this.results=null;this.error=null;this.setSelectedIndex(-1);this.selected=null;this.items=[];this.container&&this.container.empty()}this.options.selectOnBlur&&-1!==this.selectedIndex&&this.select(R,R?r:undefined);if(this.options.assumeOnBlur&&-1===this.selectedIndex&&this.results&&this.results.length){if(typeof this.options.assumeOnBlur=="function"){this.setSelectedIndex(this.options.assumeOnBlur(this))}else{this.setSelectedIndex(0)}M.call(this);this.select(R,R?r:undefined)}if(this.source&&this.source.value===""){this.source.value=this.options.defaultValue;if(this.options.defaultTextClass){e.addClass(this.source,this.options.defaultTextClass)}}if(this.options.onUserBlur){this.options.onUserBlur(this)}if(this.jpTypeAheadTimerId){clearTimeout(this.jpTypeAheadTimerId)}};var a=function(S){var R=S.target;if(R.getParent(this.options.itemSelector)){R=R.getParent(this.options.itemSelector)}if(this.selected&&this.selected===R){return}for(var Q=this.items.length-1;Q>=0;Q--){if(this.items[Q]===R){this.setSelectedIndex(Q);M.call(this);return}}};var f=function(Q){c.call(this)};var y=function(){var Q=this.source.tabIndex,S;if(false===this.options.nextField){return}if(this.options.nextField){if(typeof this.options.nextField==="string"){this.options.nextField=e.find(this.options.nextField)}else{if(typeof this.options.nextField==="function"){S=this.options.nextField(this)}else{S=this.options.nextField}}}if(false===S){return}if(!S&&Q){Q=parseInt(Q,10)+1;S=e.find("[tabindex="+Q+"]",this.source.form)}if(!S){for(var R=this.source.form.elements.length-1;R>=0;R--){var T=this.source.form.elements[R];if(this.source===T){S=this.source.form.elements[R+1];break}}}S&&S.focus()};var p=function(){this.options.syncro&&this.options.syncro.sync(this,{query:this.query,value:this.source.value,result:this.selectedIndex>=0&&this.results[this.selectedIndex]})};var O=function(){(document.activeElement===this.source&&!this.aborted&&this.show())||t.call(this)};var i=function(R,Y){this.setSource(R);this.lastQueryTime=0;var Q=false;this.checkMenuInteraction=function(){return Q};if(!L.containerParent){L.containerParent=document.body}this.options=e.extend({},L,Y);this.options.postResultsFnList=this.options.postResultsFnList||[];if(this.options.postResultsFn){this.options.postResultsFnList.unshift(this.options.postResultsFn);delete this.options.postResultsFn}if(!this.options.recentHistory){this.options.recentHistory=[]}else{this.applyOptionsToHistoryList()}this.historyShown=false;this.setSelectedIndex(-1);this.selected=null;this.visible=false;this.lastSuccessfulQuery="";this.source.autocomplete="off";if(!this.options.defaultValue&&this.options.defaultValue!=""){this.options.defaultValue=this.source.getAttribute("data-defaultValue")||this.source.defaultValue}if(!this.options.minHistoryChars){this.options.minHistoryChars=this.options.minChars}this.handlers={keyup:e.bind(b,this),focus:e.bind(C,this),blur:e.bind(t,this),click:e.bind(f,this)};this.handlers[e.checkBrowser("ie","safari","chrome")?"keydown":"keypress"]=e.bind(j,this);for(var V in this.handlers){e.addEvent(this.source,V,this.handlers[V])}this.source.addListener("paste",e.bind(I,this));this.source.addListener("cut",e.bind(I,this));var X="position: absolute";if(e.find("body").hasClass("rtl")){X+="; right: -999em"}else{X+="; left: -999em"}X+="; "+(typeof this.options.positionRelative==="string"?this.options.positionRelative:"top")+":-999px";this.container=e.createElement("div",{"class":this.options.containerClass,style:X});this.options.containerParent.appendChild(this.container);var T=function(ab){Q=false;if(!this.visible){return}var aa=e.getPosition(this.container),Z=e.getSize(this.container);if(ab.clientX>=aa.x&&ab.clientX<=aa.x+Z.x&&ab.clientY>=aa.y&&ab.clientY<=aa.y+Z.y){return}this.setSelectedIndex(-1);M.call(this)};var U=function(Z){Q=true;Z.stopPropagation();Z.preventDefault()};var W=function(Z){Q=false;Z.stopPropagation();Z.preventDefault();this.select(true,d);y.call(this)};this.containerHandlers={mouseout:e.bind(T,this),mousedown:e.bind(U,this),click:e.bind(W,this)};for(V in this.containerHandlers){e.addEvent(this.container,V,this.containerHandlers[V])}if(true===this.options.width){this.container.style.width=e.getSize(this.source).x+"px"}e.bindAll(this,"cleanUp","show","hide","processResults","renderResults","renderError");this.options.syncro&&this.options.syncro.add(this);var S=document.activeElement===this.source;if(this.options.showOnFocus&&S){if(this.hasDefaultText()){if(this.options.clearDefaultTextOnFocus===true){e.removeClass(this.source,this.options.defaultTextClass);this.source.value=""}else{e.addClass(this.source,this.options.defaultTextClass)}}if(this.source.value!==this.options.defaultValue&&h.call(this)){if(this.source.value!==this.query){this.highlightResult=this.source.value}this.query&&(this.source.value=this.query);this.search()}}if(!Browser.ie11){if(window.onpagehide||null===window.onpagehide){window.addEventListener("pagehide",this.cleanUp,false)}else{e.addEvent(window,Browser.ie?"unload":"beforeunload",this.cleanUp)}}if(this.options.jpFirefoxIME){P.call(this)}if(this.options.startEventOn==="creation"||(this.options.startEventOn==="focus"&&S)){l.call(this)}if(this.options.focusOnCreation===true){this.autoFocusing=true;this.source.focus()}};i.prototype.getInputLength=h;i.prototype.searchFn=F;i.prototype.setGeoId=function(Q){this.options.geoId=Q;this.clearCache();this.lastSuccessfulQuery=""};var E=function(Q){return Q&&Q.replace(/\s+/g," ")};i.prototype.setSource=function(Q){if(!this.source){this.source=Q}};i.prototype.getNormalizedQuery=function(){if(this.query){return E(this.query)}else{return this.query}};i.prototype.reset=function(){if(this.options.defaultTextClass){e.addClass(this.source,this.options.defaultTextClass)}e.removeClass(this.source,this.options.errorClass);this.error=null;this.container&&this.render("");this.source.value=this.options.defaultValue||""};i.prototype.getChosenResult=function(){var R=null;if(this.source&&this.source.value&&this.results){var T=this.source.value;for(var S=0;S<this.results.length;S++){var Q=this.results[S];if(T.toLowerCase()===ta.util.string.stripHTMLFromText(Q.name).toLowerCase()){R=Q;break}}}return R};i.prototype.clearResults=function(){this.query="";this.render("")};i.prototype.search=function(T,X){this.selected=null;this.lastQueryTime=new Date().getTime();this.setSelectedIndex(-1);this.query=this.source.value;var V=this.getNormalizedQuery();this.aborted=false;if(this.options.cacheResults&&this.resultsCache&&this.resultsCache[V]){this.processResults(this.resultsCache[V],true);if(false!==T){O.call(this)}X&&X()}else{var W;if(this.query.length<=this.options.queryLengthLimit){if(this.options.search){W=this.options.search(this.query,this)}else{W=F.call(this,this.query)}}else{var Q=ta.util.Deferred();var U={results:[],query:{query:this.query}};Q.resolve(U);W=Q.promise()}var R=this.options.postResultsFnList;for(var S=0;S<R.length;S++){W=W.success(R[S])}if(this.options.integrateHistory){W=W.success(this.integrateHistoryIntoResults.bind(this))}W=W.success(this.processResults).failure(this.renderError);if(false!==T){W.always(e.bind(O,this))}X&&W.always(X)}};i.prototype.processResults=function(W,S){var V=this.options.itemTemplate,R=this;S=this.options.forceProcessResults||S;var Q=!!W.results;if(!Q){W={results:W,query:{query:this.query}}}var T=W.results;if(this.options.cacheResults&&Q){var U=E(W.query&&W.query.query?W.query.query:this.getNormalizedQuery());if(!this.resultsCache){this.resultsCache={}}this.resultsCache[U]=W}if(S||this.getNormalizedQuery()!==E(this.lastSuccessfulQuery)){this.results=T;this.error=null;this.setSelectedIndex(-1);if(this.options.autoHighlightFirst){this.setSelectedIndex(0)}T.forEach(function(Y,X){Y.index=X;Y.rendered=V(Y);if(R.highlightResult&&R.highlightResult===R.options.resolveSelection(Y)){R.setSelectedIndex(X)}if(R.options.onProcessResult){R.options.onProcessResult(Y,X,R)}})}this.renderResults(W,null,S)};i.prototype.renderResults=function(W,T,S){if(S||this.getNormalizedQuery()!==E(this.lastSuccessfulQuery)){var R=this;var V=W.results?W.results:W;this.lastSuccessfulQuery=W.query&&W.query.query?W.query.query:null;e.removeClass(this.container,this.options.errorClass);e.removeClass(this.source,this.options.errorClass);var Q=this.options.listTemplate(W);if(T){var X=new Element("div");var U=[Elements.from(this.options.errorTemplate(T))];if(typeOf(Q)=="string"){Q=Elements.from(Q)}U.push(Q);U.flatten();X.adopt(U);Q=X}this.render(Q);this.items=e.select(this.options.itemSelector,this.container);this.items.forEach(function(Y){e.addEvent(Y,"mouseover",e.bind(a,R))});if(this.selectedIndex>=0){M.call(this)}else{this.options.autoSelectFirst&&this.highlightNextChoice()}this.options.onRender&&this.options.onRender(this,V)}};i.prototype.setSelectedIndex=function(Q){this.selectedIndex=Q;if(this.options&&this.options.onSetSelectedIndex){this.options.onSetSelectedIndex(Q,this)}};i.prototype.renderError=function(Q,R){if(R&&this.results){this.renderResults(this.results,Q)}else{this.results=null}this.error=Q;e.addClass(this.container,this.options.errorClass);e.addClass(this.source,this.options.errorClass);!R&&this.render(this.options.errorTemplate(Q));this.options.onError&&this.options.onError(this,Q)};i.prototype.render=function(Q){if(!this.container){return}if(typeOf(Q)=="string"){this.container.innerHTML=Q}else{if(typeOf(Q)=="element"){this.container.empty();this.container.appendChild(Q)}}};i.prototype.show=function(){if(!this.container||this.visible||!this.container.childNodes.length){return this}var R=e.getPosition(this.source),Q=e.getSize(this.source);if(this.options.positionRelative){if(e.find("body").hasClass("rtl")){this.container.style.right="auto"}else{this.container.style.left=(this.options.offsetX||0)+"px"}if(typeof this.options.positionRelative==="string"){this.container.style[this.options.positionRelative]=(Q.y+(this.options.offsetY||0))+"px"}else{this.container.style.top=(Q.y+(this.options.offsetY||0))+"px"}}else{this.container.style.right="auto";this.container.style.left=R.x+(this.options.offsetX||0)+"px";this.container.style.top=(R.y+Q.y+(this.options.offsetY||0))+"px"}this.visible=true;this.options.onShow&&this.options.onShow(this);return this};i.prototype.hide=function(){if(!this.visible||!this.container){return false}if(e.find("body").hasClass("rtl")){this.container.style.right="-999em"}else{this.container.style.left="-999em"}this.container.style[typeof this.options.positionRelative==="string"?this.options.positionRelative:"top"]=-999;this.visible=false;this.options.onHide&&this.options.onHide(this);return this};i.prototype.highlightNextChoice=function(){H.call(this,1)};i.prototype.hightlightPreviousChoice=function(){H.call(this,-1)};i.prototype.select=function(T,R){this.hide();if(this.selectedIndex<0||!this.results){return}this.source.value=this.options.resolveSelection(this.results[this.selectedIndex]);if(this.error){e.removeClass(this.container,this.options.errorClass);e.removeClass(this.source,this.options.errorClass);this.error=null;this.renderResults(this.results)}var U;if(this.options.onSelect){var U=this.options.onSelect.bind(this.options,this.results[this.selectedIndex],this.source.value,this,T,R)}if(T){var Q=this.results[this.selectedIndex];var V=0;if(this.results){V=this.results.length}var X=this.lastSuccessfulQuery?this.lastSuccessfulQuery:this.query;var S=Q.scope=="history";var W=this.options.loggingOverride;if(W){W=W.bind(this)}if(Q.type==="SEARCH"){s("search_bttn",undefined,undefined,undefined,U,R,null,this.options.geoId,this.options.name,this.options.startTime,X,S,this.historyShown,W,Q)}else{s("select",Q.value,this.selectedIndex+1,V,U,R,null,this.options.geoId,this.options.name,this.options.startTime,X,S,this.historyShown,W,Q)}}else{if(U){U()}}p.call(this);return this};i.prototype.restore=function(){this.query&&this.query.length&&(this.source.value=this.query);this.setSelectedIndex(-1);if(this.selected){e.removeClass(this.selected,"selected");this.selected=null}this.options.onRestore&&this.options.onRestore(this.query);p.call(this);return this};i.prototype.sync=function(S){var Q=this;if(this.query&&this.query!==S.query){this.results=null;this.error=null}this.query=S.query;S.value&&(this.source.value=S.value);this.setSelectedIndex(-1);this.selected&&e.removeClass(this.selected,"selected");var R=function(){if(Q.results&&Q.results.length){var T=Q.results.some(function(V,U){if(Q.options.equal(V,S.result)){Q.setSelectedIndex(U);return true}return false});if(!T&&Q.options.assumeOnBlur){Q.setSelectedIndex(0)}if(Q.selectedIndex>=0){Q.selected&&e.removeClass(Q.selected,"selected");Q.selected=Q.items[Q.selectedIndex];e.addClass(Q.selected,"selected");Q.source.value=Q.options.resolveSelection(Q.results[Q.selectedIndex]);Q.options.onSelect&&Q.options.onSelect(Q.results[Q.selectedIndex],Q.source.value,Q,false)}}Q.options.onSync&&Q.options.onSync(Q.query,Q.source.value,Q.selectedIndex>=0&&Q.results[Q.selectedIndex])};if(!this.results){this.query&&(this.source.value=this.query);this.search(false,R)}else{R()}};i.prototype.cleanUp=function(){this.container=null;this.item=null;this.selected=null;this.source=null;this.setSelectedIndex(-1);this.query=null;this.historyShown=false;this.results=null;this.error=null;this.timeoutHandler=null;this.clearCache()};i.prototype.clearCache=function(){this.resultsCache=null};i.prototype.abortSearch=function(){this.aborted=true;if(this.timeoutHandler){window.clearTimeout(this.timeoutHandler)}};i.prototype.hasDefaultText=function(){return this.source&&this.source.value===this.options.defaultValue};i.prototype.integrateHistoryIntoResults=function(V){var W=V.results||V;var Y=(V.query&&V.query.query)||this.query;var aa=false;if(V.normalized&&V.normalized.query){Y=V.normalized.query;aa=true}var af=W.getLast();if(af&&af.type=="SEARCH"){W.length-=1}else{af=null}var R=this.getHistoryMatchingQuery(Y,aa);var ac=R.length;var T={};var ab=[];for(var U=0;U<R.length;U++){var ad=R[U];T[this.options.getHistoryMatchingKey(ad)]=U}for(var U=0;U<W.length;U++){var Z=W[U];var S=this.options.getHistoryMatchingKey(Z);var Q=T[S];if(Z.isChild&&Q!==undefined){R[Q]=null;delete T[S]}if((S in T)&&this.options.eligibleForHistoryInjection(Z)){ac--;if(this.options.shouldReplaceHistoryItem(Z)){Z.scope="history";R[Q]=Z}}else{ab.push(Z)}}R=R.clean();var X=R.concat(ab);if(X.length>W.length&&X.length>this.options.maxResults){X.length=W.length}if(af){X.push(af)}if(V.results){V.results=X}else{V=X}var ae=ta.util.Deferred();ae.resolve(V);if(R.length>0){this.historyShown=true}return ae.promise()};i.prototype.getHistoryMatchingQuery=function(W,X){if(W&&W.length<this.options.minHistoryChars){return[]}var T=new RegExp("^"+String.escapeRegExp(W),"i");var V=this.options.recentHistory;var R=[];var S=function(Z){return"<b>"+Z+"</b>"};for(var U=0;U<V.length&&R.length<this.options.maxHistoryItems;U++){var Y=V[U];if(!Y){continue}var Q=Y.name;if(X&&Y.normalized_name){Q=Y.normalized_name}if(Q&&Q.match(T)){if(this.options.highlightHistory){Y=e.extend({},Y);Y.name=Y.name.replace(T,S)}R.push(Y)}}return R};i.prototype.applyOptionsToHistoryList=function(V){var W=[];var Z;var Q;var X;var Y=function(aa,ac){aa=e.extend({},aa);aa.scope="history";Q=aa.url;if(aa.urls){for(var ab=0;ab<aa.urls.length;ab++){X=aa.urls[ab];if(X.url_type==ac.options.historyLinkType){Q=X.url;break}}}aa.url=Q;return aa};for(var U=0;U<this.options.recentHistory.length;U++){Z=this.options.recentHistory[U];if(!this.options.historyTypes.contains(Z.type.toLowerCase())){continue}Z=Y(Z,this);if(this.options.historyPredicate&&!this.options.historyPredicate(Z)){continue}W.push(Z);var S=Z.children;if(S&&S.length>0){for(var T=0;T<S.length;T++){var R=S[T];R=Y(R,this);R.parent=Z;W.push(R)}}}this.options.recentHistory=W};i.prototype.shouldShowHistory=function(){var Q=this.options.showOnFocus&&this.options.showHistory;var S=!!this.query&&this.query.length>0;var R=this.options.recentHistory.length>0;return Q&&!S&&R};i.prototype.getSearchParams=function(){if(this.options.searchParams){if(typeof this.options.searchParams==="function"){return this.options.searchParams(this)}else{return this.options.searchParams}}else{return{}}};i.prototype.showHistoryIfEnabled=function(){if(!this.shouldShowHistory()){return}var Q=this.options.recentHistory.slice(0,this.options.maxHistoryItems);if(this.options.historySort){Q=Q.sort(this.options.historySort)}var R={results:Q};this.processResults(R,true);this.restore();this.show()};i.prototype.injectHistory=function(S,Q){S.scope="history";var R=this.options.recentHistory.length;if((!Q&&Q!=0)||Q<0||Q>R){Q=R}this.options.recentHistory.splice(Q,0,S);return S};i.prototype.removeHistory=function(Q){this.options.recentHistory.splice(Q,1)};i.prototype.clearHistory=function(){this.options.recentHistory=[];this.clearCache()};return i}(api));var sTAMGFooterCookieName="hideTAMGFooter";var sFooterDivId="TM_FTR";var hmOngoingHover={};var savedDomain="tripadvisor.com";if(typeof cookieDomain!="undefined"){savedDomain=cookieDomain.substring(1,cookieDomain.length)}function _closeOverlay(){var a=ta.retrieve("overlays.current");if(a){a.hide()}}function setTAMGFooterCookie(d,c){var b=new Date();b.setTime(b.getTime());var e=1000*60*60*24*7;var a=new Date(b.getTime()+(e));document.cookie=sTAMGFooterCookieName+"="+escape(d)+";expires="+a.toGMTString()+";path=/"+((savedDomain)?";domain="+savedDomain:"");hideFooter(c)}function openUrl(b){var a=window.open(b);a.opener=null}function getTAMGFooterCookie(){var e=document.cookie.split(";");var a="";var c="";var d="";var b=false;for(i=0;i<e.length;i++){a=e[i].split("=");c=a[0].replace(/^\s+|\s+$/g,"");if(c==sTAMGFooterCookieName){b=true;if(a.length>1){d=unescape(a[1].replace(/^\s+|\s+$/g,""))}return d}a=null;c=""}if(!b){return null}}function hideFooter(b){if(!b){b=sFooterDivId}var a=document.getElementById(b);if(a){a.style.display="none"}}function tamgShowFly(c,d,b,a){hmOngoingHover[d]=true;setTimeout(function(){if(hmOngoingHover[d]){tamgCreateFly(c,b,a)}},250)}function tamgHideFly(a,c,b){var d=b.toElement||b.relatedTarget;while(d&&d!=a){d=d.parentNode}if(d!=a){hmOngoingHover[c]=false;setTimeout(function(){if(hmOngoingHover[c]==false){$$("."+c)[0].hide()}},250)}}function tamgCreateFly(g,j,e){var f=$(g).getElements(".ftrFly")[0];if($(f).getElements("img")[0]){f.show()}else{var k=CDNHOST+"/img2/x.gif";var h="ftrFlyLogo "+j;var d=new Element("img",{"class":h,src:k}).inject(f,"top");d.setProperty("height","25");d.setProperty("width",e);var c=new Element("div",{"class":"triWrap"});var b=new Element("span",{"class":"cssTri"});var a=new Element("span",{"class":"cssTri"});b.inject(a);a.inject(c);c.inject(f,"bottom");f.show()}}function getTAMGFooterViaAjax(d,c,a,b,e){new Request({url:"/TAMGFooterAjax",onSuccess:function(g){var h=ta.id("TAMGFooterHolder");if(h){h.innerHTML=g}var f="RuleBasedFooter_"+e;ta.trackEventOnPage("Footer","OpenFooter",f,1,true)},data:{a:"SHOW_FOOTER",dis:d,loc:c,"new":a,serv:b},evalScripts:true,method:"get"}).send()}function getFullDisclaimerText(){new Request({url:"/TAMGFooterAjax",onSuccess:function(b){try{ta.id("PDISCLAIMER").innerHTML=b}catch(a){ta.util.error.record(a,"Fail to find element (id PDISCLAIMER)")}},data:{a:"SHOW_FULL_DISCLAIMER"},evalScripts:true,method:"get"}).send()};ta.servlet.Member={memberBenefitsSubscribe:function(a){ta.servlet.Member.processMOSubscribeRequest(a);return false},memberGuideRequest:function(a){processGuideRequest(a)},memberTOGForm:function(a){processTOGForm(a)},processMOSubscribeRequest:function(a){if(!loggedIn){new Event(a).preventDefault();return false}var d=$("MEMONLY_SUBS_FORM");d.elements.action.value="subscribe";var c={url:"/TravelGuides",data:d,onFailure:function(f){alert(f.status+"\n"+f.responseText)}};c.onSuccess=ta.servlet.Member.subscribeRequestResFunc;var b=window["validate"+d.id];new Event(a).preventDefault();new Request(c).send()},subscribeRequestResFunc:function(a){if(a!=""){for(subtype in subtypes){if(subtyperes[subtype].test(a)){if(subtype=="tw"&&ta.retrieve("tcd.refresh")){window.location.reload()}var g=document.getElementById(subtype+"Optin");g.setAttribute("checked","true");g.setAttribute("disabled","true");var c=document.getElementById(subtype+"OptinLbl");c.innerHTML="<b>"+headings[subtype]+"</b> "+tamg_thanks;var f=document.getElementById("OPTINTEXT");f.style.display="none"}}var j={};for(subtype in subtypes){var d=document.getElementById(formids[subtype]);j[subtype]=d.checked}var h=true;var i=true;for(subtype in j){if(subtyperes[subtype].test(a)){h=false}if(!j[subtype]){i=false}}if(i){var e=document.getElementById("NLSUBMITDIV");e.style.display="none"}if(h){var b=document.getElementById("OPTINTEXT");b.innerHTML='<div class="alert">'+no_selection_error+"</div>";b.style.display="block"}}},addTripWatchLocation:function(event,elmt,updateTxt){var mElmt=new Element(elmt);new Event(event).stop();new Request({url:elmt.href,onFailure:ta.util.error.ajaxFailure.partial("Member:addTripWatchLocation"),onSuccess:function(txt,xml){if(txt.match(/^{/)){var data=eval("("+txt+")");if(data.ERROR){ta.overlays.showInLightbox(data.ERROR);return}else{if(data.ALERT){ta.overlays.showInLightbox(data.ALERT);return}}}var spanElt=new Element("span");spanElt.set("html",updateTxt);mElmt.hide();spanElt.inject(mElmt,"after")}}).send()},addTripWatchLocationReload:function(a){new Request({url:a.href,onFailure:ta.util.error.ajaxFailure.partial("Member:addTripWatchLocationReload"),onSuccess:function(b,c){window.location.reload()}}).send()}};ta.servlet.Tourism=(function(){var e=window.modelGeoId||0;var j=1;var d=null;var c=200;var a=0;var l=[];var f=false;var g=function(m){var n="modules_visible_"+m;l.each(function(p,o){if(ta.util.element.isScrolledIntoView(p)){ta.trackEventOnPage("Tourism",n,p.getAttribute("data-module"),0,true);l.splice(o,1)}})};var h=function(){var m=Math.floor(window.getSize().y/c)*c;a=m;while(m>=c){i(m);m-=c}};var k=function(){var m=Math.floor(window.getScroll().y/c)*c;if(m>a){a=m;i(m)}};var i=function(m){ta.trackEventOnPage("Tourism","Engagement","scroll"+m,m,true)};var b=function(){if(!f){var m=ta.id("FORUM_CONTENT");if(m&&ta.util.element.isScrolledIntoView(m)){m.load("/TourismForumContentAjax?geo="+e);f=true}}};return{init:function(n){if(n&&n>0){e=n}l=ta.select("[data-module]");var o=ta.find(".weatherUnits .selected");d=o&&o.getAttribute("data-unit");g("load");h();window.addEvent("scroll",function(){g("scroll");k();b()});var m=ta.find(".navLinks .guides");if(m){ta.trackEventOnPage("Tourism","Nav","guide-nav-show-"+m.getAttribute("data-label"),0)}},showNextChildPage:function(){j++;var m=ta.find(".popularCities");if(m&&e>0){var n={geo:e,offset:j-1,desktop:true};new Request({url:"/TourismChildrenAjax",data:n,method:"get",evalScripts:true,onSuccess:function(p){var o=m.innerHTML+p;m.innerHTML=o;if(j>=ta.retrieve("tourism.popularCitiesMaxPage")){ta.select(".morePopularCities").destroy()}}}).send()}},linkClick:function(n,o,m){var p=new Event(m||window.event);if(p.target){var q=p.target;if(!q.href){q=q.getElement("a")||q.getParent("a")}if(q&&q.getAttribute("data-trk")){o=q.getAttribute("data-trk")}if(q&&q.href){ta.setEvtCookie("Tourism",n,o,0,q.href)}}},nonLinkClick:function(o,p,n){var q=new Event(n||window.event);if(q.target){var m=q.target;if(m&&m.getAttribute("data-trk")){p=m.getAttribute("data-trk")}ta.trackEventOnPage("Tourism",o,p,0)}},noFriendTease:function(n){if(!n||(ta.retrieve("facebook.session.available"))==false){return}var m=n.toString();if(m!="not_authorized"){this.showNoFriendTease()}else{this.showFBConnectTease()}},showNoFriendTease:function(){this.showFirstOfSelect(".travelersReviewed","block");this.showFirstOfSelect(".geoBox.wrap","none");this.showFirstOfSelect(".FBCover","none");this.showFirstOfSelect(".downloadAppSection.wrap","none");this.showFirstOfSelect(".FBThumb","block");this.showFirstOfSelect(".firstOfFriends","block");this.showFirstOfSelect(".findAPlace","block")},showFBConnectTease:function(){this.showFirstOfSelect(".geoBox.wrap","block");this.showFirstOfSelect(".FBCover","block")},showFirstOfSelect:function(n,m){var o=ta.find(n);if(o){o.style.display=m}},friendsLoaded:function(){this.showFirstOfSelect(".travelersReviewed","none");this.showFirstOfSelect(".FBThumb","none");this.showFirstOfSelect(".firstOfFriends","none");this.showFirstOfSelect(".findAPlace","none");var q=ta.select(".highlight #FRIEND_GRID .item");if(q.length==0){return}var s=document.getElement(".downloadAppSection");if(s){s.destroy()}var r=6;var p=ta.select(".highlight .geoBox .item");var n=p.length;if(q.length<=r){n=r*2}else{if(q.length<=r*2){n=r}else{n=0}}if(n==0){var o=document.getElement(".highlight .geoBox");if(o){o.destroy()}}else{if(n<p.length){for(var m=p.length-1;m>=n;m--){p[m].destroy()}}}var o=ta.id("FRIEND_GRID");if(o){o.style.display="block"}},toggleWeatherUnit:function(o,m,n){if(n==d){return}d=n;m.getSiblings().toggleClass("selected");m.toggleClass("selected");ta.select(".weatherInfo .temps").toggleClass("hidden")},showGeoDescription:function(o,m){var n=ta.retrieve("tourism.fullDescription");if(n){new ta.overlays.CenteredOverlay({backdrop:ta.overlays.BACKDROP_ALWAYS,style:"s4 dg descriptionLB",content:"<p>"+n+"</p>"})}},trackTourismFollowEventOnPage:function(m){if(!ta.has("tourism_followed")){ta.store("tourism_followed",true);ta.trackEventOnPage("tourism_follow","click")}if(window.event){window.event.cancelBubble=true}else{m.stopPropagation()}},trackTourismFollowEventOnNextPage:function(m){ta.setEvtCookie("tourism_follow","click","",0,"/twsubscriptions");if(window.event){window.event.cancelBubble=true}else{m.stopPropagation()}},showTourismBrandBubble:function(){if(window.setTimeout){window.setTimeout(function(){ta.servlet.Tourism.showTourismBrandBubbleContent()},1000)}},showTourismBrandBubbleContent:function(){var n=ta.id("tourismBrandBubble");if(n&&n.getStyle("display")=="none"){n.setStyle("opacity",0);n.setStyle("display","block");var m=new Fx.Tween(n,{duration:1000,property:"opacity"});m.start(0,1)}},hideTourismBrandBubble:function(){if(window.setTimeout){window.setTimeout(function(){ta.servlet.Tourism.hideTourismBrandBubbleContent()},8000)}},hideTourismBrandBubbleContent:function(){var n=ta.id("tourismBrandBubble");if(n&&n.getStyle("display")=="block"){var m=new Fx.Tween(n,{duration:1000,property:"opacity"});m.start(1,0);if(window.setTimeout){window.setTimeout(function(){ta.id("tourismBrandBubble").setStyle("display","none")},1000)}}}}})();ta.widgets.slider={handleSeparation:10,isRtl:function(){return ta.util.i18n.isRtl()},getValue:function(c,b){var a="";if(this.isRtl()){if(c.style.right&&c.style.right.trim()!=""){a=c.style.right}else{a=b.style.left}}else{a=c.style.left}if(a!=""){return a.toFloat()}return 0},resetHooks:function(e){var d=e.hasClass("slider_redesign")?e:e.getElement(".slider_redesign");var c=d.className;var b=parseFloat((c.match(/min_(\d+)/)[1]).replace("_","."));var a=parseFloat((c.match(/max_(\d+)/)[1]).replace("_","."));return this.setHooks(e,b,a)},setHooks:function(q,e,g,d,f){var m=q.hasClass("slider_redesign")?q:q.getElement(".slider_redesign");var h=m.className;var o=parseInt(h.match(/steps_(\d+)/)[1]);var k=parseFloat((h.match(/min_(\d+)/)[1]).replace("_","."));if(d&&k!=d){m.removeClass("min_"+k);m.addClass("min_"+d);k=d}var n=parseFloat((h.match(/max_(\d+)/)[1]).replace("_","."));if(f&&n!=f){m.removeClass("max_"+n);m.addClass("max_"+f);n=f}if(e<k){e=k}if(g>n){g=n}var i=parseInt(h.match(/width_(\d+)/)[1])-this.handleSeparation;var c=m.hasClass("maxAllInclusive");var p=i/(o-1);var a=(n-k)/(o-1);var l=(e-k)/a;var r=(g-k)/a;this.updateEnd(m.getElement(".handle-left"),this.isRtl()?r:l,p,true);this.updateEnd(m.getElement(".handle-right"),this.isRtl()?l:r,p,false);this.updateBar(m.getElement(".slider-range"),l,r,p,"set");var b=c&&(g>=n);if(m.id=="priceSelect"){this.priceUpdate(q,e,g,b)}else{if(m.id=="ratingSelect"){this.ratingUpdate(q,e,g,b)}else{if(m.id=="bedroomsSelect"){this.bedroomsUpdate(q,e,g,b)}else{this.simpleUpdate(q,e,g,b)}}}var t=q.getElement(".minMax");var s=t.value;var j=this.updateMinMax(t,l,r,a,o,k);return s!=j},updateMinMax:function(f,g,b,a,c,e){var d=(g<=0?0:g*a+e)+","+(b>=(c-1)?999999:b*a+e);f.value=d;return d},updateEnd:function(d,c,e,b){var a=c*e+(this.isRtl()^b?0:this.handleSeparation);if(this.isRtl()){d.setStyle("right",a+"px");d.setStyle("left","")}else{d.setStyle("left",a+"px");d.setStyle("right","")}return a},updateBar:function(b,g,d,f){if((g>d)){g^=d;d^=g;g^=d}var a=g*f;var c=(d*f+this.handleSeparation)-a;if(c<0){c*=-1}var e=this.isRtl()?"right":"left";if(this.isRtl()){b.setStyle("right",a)}else{b.setStyle("left",a)}b.setStyle("width",c)},initSliderInfo:function(e){var d={};var c=e.className;d.width=parseInt(c.match(/width_(\d+)/)[1])-this.handleSeparation;d.steps=parseInt(c.match(/steps_(\d+)/)[1]);d.min=parseFloat((c.match(/min_(\d+)/)[1]).replace("_","."));d.max=parseFloat((c.match(/max_(\d+)/)[1]).replace("_","."));d.stepSize=(d.max-d.min)/(d.steps-1);d.maxAllInclusive=e.hasClass("maxAllInclusive");d.snapDistance=d.width/(d.steps-1);d.rangeBar=e.getElement(".slider-range");d.minMax=e.getElement(".minMax");d.startMinMax=d.minMax.value;d.singleValue=e.hasClass("singleValue");var f=e.getParent().getElement(".handle-left");var b=e.getParent().getElement(".handle-right");var g=this.getValue(f,b);var a=this.getValue(b,f);if(this.isRtl()){g-=this.handleSeparation}else{a-=this.handleSeparation}d.leftStep=this.getClosestStep(g,d);d.rightStep=this.getClosestStep(a,d);return d},setSliderTarget:function(b,a){if(b.hasClass("handle-left")){a.target=b.getParent().getElement(".handle-left");if(this.isRtl()){a.limits=[a.rightStep+(a.singleValue?0:1),a.steps-1]}else{a.limits=[0,a.rightStep-(a.singleValue?0:1)]}a.isLeftHook=true}else{a.target=b.getParent().getElement(".handle-right");if(this.isRtl()){a.limits=[0,a.leftStep-(a.singleValue?0:1)]}else{a.limits=[a.leftStep+(a.singleValue?0:1),a.steps-1]}a.isLeftHook=false}return a},handleMouseDown:function(f,a){var d=new Event(f);if(d){d.stop();var c=ta.id(d.target);if(c){var b=this.initSliderInfo(c.getParent());b=this.setSliderTarget(c,b);b.snapCallBack=a.bind(this);b.dragHandle=this.handleMouseMove.bind(this);b.upHandle=this.handleMouseUp.bind(this);document.addListener("mousemove",b.dragHandle);document.addListener("mouseup",b.upHandle);document.addListener("touchmove",touchHandler);document.addListener("touchend",touchHandler);b.offset=c.getParent().getCoordinates().left+10+(b.isLeftHook?0:this.handleSeparation);ta.store("slider_info",b)}}},getClosestStep:function(a,b){return Math.round(a/b.snapDistance)},handleMouseMove:function(d){d=new Event(d);var b=ta.retrieve("slider_info");if(b&&b.target){var c=d.page.x-b.offset;var a=this.getClosestStep(c,b);if(this.isRtl()){a=b.steps-a-1}if(a<b.limits[0]){a=b.limits[0]}else{if(b.limits[1]<a){a=b.limits[1]}}this.sliderDrag(d,a,b,c)}d.stop()},sliderDrag:function(d,g,j,i){if(d){d.stop();var a=j.isLeftHook?g:j.leftStep;var h=j.isLeftHook?j.rightStep:g;this.updateEnd(j.target,g,j.snapDistance,j.isLeftHook);this.updateBar(j.rangeBar,a,h,j.snapDistance);this.updateMinMax(j.minMax,a,h,j.stepSize,j.steps,j.min);ta.store("slider_info",j);if(j.snapCallBack){var b=(this.isRtl()?h:a)*j.stepSize+j.min;var f=(this.isRtl()?a:h)*j.stepSize+j.min;var c=j.maxAllInclusive&&(f==(j.steps-1)*j.stepSize+j.min);j.snapCallBack(j.target,b,f,c)}}},handleMouseUp:function(b){b=new Event(b);if(b){b.stop()}var a=ta.remove("slider_info");if(a){document.removeListener("mousemove",a.dragHandle);document.removeListener("mouseup",a.upHandle);document.removeListener("touchmove",touchHandler);document.removeListener("touchend",touchHandler);a.dragHandle=null;a.upHandle=null;if(a.minMax.value!=a.startMinMax){sliderMoved()}}},currencyUpdate:function(){ta.util.error.record({name:"Deprecated",message:"ta.widgets.Slider.currencyUpdate will be going away soon and should not be used."},"Slider JS Cleanup",null,null,"WARN");var b=ta.id("l1currency");if(!b){return}var f=ta.retrieve("ta.currencyHash");if(!f){return}var h=f[parseInt(b.value)];var k=ta.id("pricePeriod_w");if((k!=null)&&k.checked){var j=ta.retrieve("ta.weekCurrencyHash");if(j){h=j[parseInt(b.value)]}}var i=ta.id("priceSelect").getParent();var a=i.getElement(".slider_redesign");var g=a.className;var d=currencyCodes[parseInt(i.getElement("select").value)];var c=ta.has("hacform.slider.price.min")?ta.remove("hacform.slider.price.min"):h.selMin;var e=ta.has("hacform.slider.price.max")?ta.remove("hacform.slider.price.max"):h.selMax;a.className=g.replace(/steps_\d+/,"steps_"+h.steps);ta.widgets.slider.setHooks(i,c,e,h.min,h.max)},priceUpdate:function(f,d,b,a){if(!f.hasClass("prcRng")){f=f.getParent(".prcRng")}var g=ta.id("l1currency");var e=currencyCodes[parseInt(g.value)];f.getElement(".s_min").innerHTML=ta.util.currency.formatCurrency(d,e);var c=ta.util.currency.formatCurrency(b,e);if(a){c+="+"}f.getElement(".s_max").innerHTML=c},ratingUpdate:function(g,e,c,b){if(!g.hasClass("tvrRtg")){g=g.getParent(".tvrRtg")}var a=e.toPrecision(2);var h=c.toPrecision(2);g.getElement(".s_min").innerHTML=a;g.getElement(".s_max").innerHTML=h;var d=g.getElement(".sLeft .lmtImg").src;g.getElement(".sLeft .lmtImg").src=d.replace(/\d.\d/,a);var f=g.getElement(".sRight .lmtImg").src;g.getElement(".sRight .lmtImg").src=f.replace(/\d.\d/,h)},bedroomsUpdate:function(d,c,b,a){if(d.tagName!="FIELDSET"){d=d.getParent("FIELDSET")}d.getElement(".s_min").innerHTML=(c==0?js_filter_studio:c);d.getElement(".s_max").innerHTML=(b==0?js_filter_studio:(b+(a?"+":"")))},simpleUpdate:function(d,c,b,a){if(d.tagName!="FIELDSET"){d=d.getParent("FIELDSET")}d.getElement(".s_min").innerHTML=c;d.getElement(".s_max").innerHTML=b+(a?"+":"")}};function touchHandler(c){var d=c.changedTouches,e=d[0],a="";switch(c.type){case"touchmove":a="mousemove";break;case"touchend":a="mouseup";break;default:return}var b=document.createEvent("MouseEvent");b.initMouseEvent(a,true,true,window,1,e.screenX,e.screenY,e.clientX,e.clientY,false,false,false,false,0,null);e.target.dispatchEvent(b);c.preventDefault()}if(!window.sliderMoved){window.sliderMoved=function(){if(!window.slidersReady){return}ta.servlet.HACSearch.adjustTopValueState();var a=window.pageServlet=="LocalMapsRedesign";filtersChanged(null,a)}};(function(){var b=new Class({Implements:[Options,Events],URL_SAVE_CONTROLLER:"/SavesAjax",parentName:null,parentFolderId:0,locationId:0,guideId:0,tripGuideId:0,savedItems:{},sessionSavedItems:[],options:{savesTree:null},initialize:function(c){this.setOptions(c);if(this.options.savesTree){this.setSavesTree(this.options.savesTree)}this.addEvent("saveComplete",this.trackSuccessfullSave)},refresh:function(c){this.setOptions(c);if(this.options.savesTree){this.setSavesTree(this.options.savesTree)}},openSavesHoverRegflow:function(d){var e=1;if(d&&d.target&&d.target.getParent(".listing")){e=d.target.getParent(".listing").get("data-rankInList")}ta.trackEventOnPage("HoverSave","saveIntent",ta.widgets.Saves.locationId,e,false);ta.store("registration.ga_module","SavesHover");if(ta.retrieve("secure_registration.enabled")){var c=ta.registration.register({product:"SAVES_HOVER",popup:true,successAction:"ta.widgets.Saves.refreshLoggedInHoverSaves",data:function(){return{type:5,entity:+ta.widgets.Saves.locationId}}});if(c){ta.widgets.Saves.refreshLoggedInHoverSaves()}}else{ta.overlays.registration.connect({flow:"SAVES_HOVER"},"SIGNUP")}},openMastheadRegflow:function(c){ta.store("registration.ga_module","Masthead");ta.overlays.registration.connect({flow:"MASTHEAD"},"SIGNUP")},trackSuccessfullSave:function(e,c,d){if(!e){return}ta.trackEventOnPage("HoverSave","saveComplete",c,1,false);new Request({url:"/ActionRecord?action=Save_Completed"}).send()},setSavesTree:function(){},getSavesTree:function(c){if(this.options.savesTree&&!c){return this.options.savesTree}else{}},saveCall:function(f,d){var h=this;this.entityType=f;this.locationId=d;for(var c in this.sessionSavedItems){if(this.locationId==this.sessionSavedItems[c]){this.showSaved();return}}var g={action:"SAVE_ITEM",entity:this.locationId,type:f};var e=new Request({url:this.URL_SAVE_CONTROLLER,data:g,onRequest:function(){h.fireEvent("saveComplete",[true,d])},onSuccess:function(i){var l=false;i=JSON.decode(i);if(!i){return}if(i.error){if(i.error=="DUPITEM"){h.fireEvent("saveComplete",[l,d])}var j={name:"saves save item",message:(i&&i.error?i.error:"Error while calling SAVE_ITEM with locationId: "+d+" and entityType: "+f+".")};ta.util.error.record(j,"saveCall");return}else{l=true}if(l&&i.id){var k=i.id;if(k<-3){ta.run("ta.overlays.Factory.openMastheadRegflow")}}h.fireEvent("saveComplete",[l,d,k,i.folderid,h.btn]);h.locationId=0;h.btn=null}}).send();return e},unsaveCall:function(f,c){var g=this;var e={action:"DELETE_ITEM",id:f};var d=new Request({url:this.URL_SAVE_CONTROLLER,data:e,onRequest:function(){g.fireEvent("unsaveComplete",[true,f,c])},onSuccess:function(h){if(h!=""){h=JSON.decode(h);if(!h||h.error){var i={name:"saves unsave item",message:(h&&h.error?h.error:"Unknown error while deleting : "+f)};ta.util.error.record(i,"unsaveCall")}}g.fireEvent("unsaveComplete",[h,f,c])}}).send();return d},saveGuideCall:function(c){var e=this;var d={action:"SAVE_GUIDE",guideid:c};new Request({url:this.URL_SAVE_CONTROLLER,data:d,onSuccess:function(g){var j=true;var i=null;var f=null;g=JSON.decode(g);if(!g||g&&g.error){j=false;var h={name:"saves save guide",message:(g&&g.error?g.error:"Unknown error while saving guide : "+c)};ta.util.error.record(h,"saveGuideCall")}else{i=g.folder;f=g.items}this.guideId=0;e.fireEvent("saveGuideComplete",[j,i,f]);ta.trackEventOnPage("GuideSave","saveComplete",c,1,false);new Request({url:"/ActionRecord?action=Guide_Save_Completed"}).send()}}).send()},saveTripGuideCall:function(c){var e=this;var d={action:"SAVE_TRIP_GUIDE",guideid:c};new Request({url:this.URL_SAVE_CONTROLLER,data:d,onSuccess:function(g){var j=true;var i=null;var f=null;g=JSON.decode(g);if(!g||g&&g.error){j=false;var h={name:"saves save tripguide",message:(g&&g.error?g.error:"Unknown error while saving tripguide : "+c)};ta.util.error.record(h,"saveTripGuideCall")}else{i=g.folder;f=g.items}this.guideId=0;e.fireEvent("saveTripGuideComplete",[j,i,f]);ta.trackEventOnPage("TripGuideSave","saveComplete",c,1,false);new Request({url:"/ActionRecord?action=Trip_Guide_Save_Completed"}).send()}}).send()},getSavesCall:function(d){var e=this;var c={action:"FETCH_ITEMS"};if(!d&&this.options.savesTree){e.fireEvent("retrievedSaves",[this.options.savesTree])}new Request({url:this.URL_SAVE_CONTROLLER,data:c,onSuccess:function(f){f=JSON.decode(f);if(!f||f&&f.error){var g={name:"saves get saves",message:(f&&f.error?f.error:"Unknown error while fetching items.")};ta.util.error.record(g,"getSavesCall")}else{e.savedItems=f}e.fireEvent("retrievedSaves",[f])}}).send()},moveCall:function(g,c,e){var h=this;var f={action:"MOVE_ITEM",id:g,folder:c};var d=new Request({url:this.URL_SAVE_CONTROLLER,data:f,onSuccess:function(i){if(i!=""){i=JSON.decode(i);if(!i||i.error){var j={name:"saves move item",message:(i&&i.error?i.error:"Unknown error while moving : "+g)};ta.util.error.record(j,"moveCall")}}h.fireEvent("moveComplete",[i,g,c,e])}}).send();return d},addNoteCall:function(f,c,h){var g=this;var e={action:"ADD_NOTE",id:f,note:c};var d=new Request({url:this.URL_SAVE_CONTROLLER,data:e,onSuccess:function(i){if(i!=""){i=JSON.decode(i);if(!i||i.error){var j={name:"saves add note",message:(i&&i.error?i.error:"Unknown error while adding note to : "+f)};ta.util.error.record(j,"addNoteCall")}}g.fireEvent("addNoteComplete",[i,f,c]);if(typeof h=="function"){h(i,f,c)}}}).send();return d},addFolderNoteCall:function(c,d,h){var g=this;var f={action:"ADD_FOLDER_NOTE",id:c,note:d};var e=new Request({url:this.URL_SAVE_CONTROLLER,data:f,onSuccess:function(i){if(i!=""){i=JSON.decode(i);if(!i||i.error){var j={name:"saves add folder note",message:(i&&i.error?i.error:"Unknown error while adding folder note to : "+c)};ta.util.error.record(j,"addFolderNoteCall")}}g.fireEvent("addFolderNoteComplete",[i,c,d]);if(typeof h=="function"){h(i,c,d)}}}).send();return e},createFolderCall:function(c,g){var f=this;var e={action:"CREATE_FOLDER",name:c};var d=new Request({url:this.URL_SAVE_CONTROLLER,data:e,onSuccess:function(i){if(i!=""){i=JSON.decode(i);if(!i||i.error){var j={name:"saves create folder",message:(i&&i.error?i.error:"Unknown error while creating folder named : "+c)};ta.util.error.record(j,"createFolderCall")}}var h=i&&i.folderid?i.folderid:"";var k=i&&i.foldername?i.foldername:"";f.fireEvent("createFolderComplete",[i,h,k]);if(typeof g=="function"){g(i,h,k)}}}).send();return d},deleteFolderCall:function(c,g){var f=this;var e={action:"DELETE_FOLDER",id:c};var d=new Request({url:this.URL_SAVE_CONTROLLER,data:e,onSuccess:function(h){if(h!=""){h=JSON.decode(h);if(!h||h.error){var i={name:"saves delete folder",message:(h&&h.error?h.error:"Unknown error while deleting folder : "+c)};ta.util.error.record(i,"deleteFolderCall")}}f.fireEvent("deleteFolderComplete",[h,c]);if(typeof g=="function"){g(h,c)}}}).send();return d},renameFolderCall:function(c,d,h){var g=this;var f={action:"RENAME_FOLDER",id:c,name:d};var e=new Request({url:this.URL_SAVE_CONTROLLER,data:f,onSuccess:function(i){if(i!=""){i=JSON.decode(i);if(!i||i.error){var j={name:"saves rename folder",message:(i&&i.error?i.error:"Unknown error while renaming folder of : "+c)};ta.util.error.record(j,"renameFolderCall")}}g.fireEvent("renameFolderComplete",[i,c,d]);if(typeof h=="function"){h(i,c,d)}}}).send();return e},refreshLoggedInHoverSaves:function(){var c=ta.widgets.Saves;if(c.guideId!=0){c.saveGuideCall(c.guideId)}else{if(c.tripGuideId!=0){c.saveTripGuideCall(c.tripGuideId);ta.widgets.Saves.tripGuideId=0}else{c.saveCall(5,c.locationId)}}}});if(!ta.widgets.Saves){ta.widgets.Saves=new b()}var a=new Class({Implements:[Options,Events],lastBtnClicked:null,options:{isGuidePage:false,listingClass:"listing"},initialize:function(c){this.setOptions(c);this.PAGE=ta.id("PAGE");ta.widgets.Saves.addEvent("saveComplete",this.setBtnSavedState.bind(this));ta.widgets.Saves.addEvent("unsaveComplete",this.setBtnUnsavedState.bind(this));ta.widgets.Saves.addEvent("retrievedSaves",this.setAllBtnStates.bind(this));ta.widgets.Saves.addEvent("saveGuideComplete",this.onGuideSaved.bind(this));ta.widgets.Saves.addEvent("saveTripGuideComplete",this.onTripGuideSaved.bind(this));ta.queueForReady(function(){var d=ta.id("SAVE_ALL_BUTTON");if(d){d.addEvent("click",function(g){var f=this.get("data-guideid");var e=this.get("data-tripguideid");if(f){ta.widgets.Saves.guideId=f;ta.widgets.Saves.btn=this;ta.call("ta.overlays.Factory.openSavesHoverRegflow",g)}else{if(e&&!this.hasClass("saved")){ta.widgets.Saves.tripGuideId=e;ta.widgets.Saves.btn=this;ta.call("ta.overlays.Factory.openSavesHoverRegflow",g)}}g.preventDefault()})}})},refresh:function(){ta.widgets.Saves.getSavesCall()},bindListingEvents:function(){var d=this;var c=$$("."+this.options.listingClass);if(!c||!c.length){return}c.removeEvents("mouseenter").removeEvents("mouseleave").addEvents({mouseenter:function(){d.overHover(this)},mouseleave:function(){d.outHover(this)}})},setBtnSavedState:function(d,f,h,c,e){var g=this.getBtnsByLocationId(f);if(g.length){this.showSaved(g,h)}if(this.lastBtnClicked&&f==this.lastBtnClicked.get("data-locationid")){this.showSaveAlert(this.lastBtnClicked)}},setBtnUnsavedState:function(c,f,d){var e=this.getBtnsByLocationId(d);if(e.length){this.showUnsaved(e,f)}},setAllBtnStates:function(c){var e=this;if(!c){c=ta.widgets.Saves?ta.widgets.Saves.savedItems:{}}Object.each(c,function(f,g){var h=e.getBtnsByLocationId(g);if(h&&h.length){e.showSaved(h,f)}});ta.select(".savesHover").each(function(f){e.bindBtnEvents(f)});var d=ta.id("HEADING_GROUP");if(d){d.getElements(".savesContainer, .savesHover").setStyles({visibility:"visible",display:"block"})}if(this.options.isGuidePage){this.setGuideSaveState()}if(!isTabletOnFullSite){this.bindListingEvents()}},setGuideSaveState:function(e){var d=ta.id("GUIDE_DETAIL");if(!d){return}var c=d.getElements(".savesHover");var f=c.filter(".saved");if(e===true||c.length==f.length){ta.id("SAVE_ALL_BUTTON")&&ta.id("SAVE_ALL_BUTTON").hide();ta.id("ALL_SAVED_BUTTON")&&ta.id("ALL_SAVED_BUTTON").show()}else{if(e===false||c.length!=f.length){ta.id("ALL_SAVED_BUTTON")&&ta.id("ALL_SAVED_BUTTON").hide();ta.id("SAVE_ALL_BUTTON")&&ta.id("SAVE_ALL_BUTTON").show()}}},onGuideSaved:function(e,d,c){var f=this;if(e){this.setGuideSaveState(true);if(c&&c.length){c.each(function(h,g){var j=f.getBtnsByLocationId(h.entityid);f.showSaved(j,h.id)})}}},onTripGuideSaved:function(e,d,c){var f=this;if(e){ta.store("tripGuideSavedFolder",d.folderid);f.swapSaveText(ta.widgets.Saves.btn);ta.widgets.Saves.btn.addClass("saved");if(c&&c.length){c.each(function(h,g){var j=f.getBtnsByLocationId(h.entityid);f.showSaved(j,h.id)})}}},bindBtnEvents:function(e){var h=this;var f=e.getParent();var k=f.getElement(".saveOptions");e.removeEvents();if(k){k.getElement(".btn-delete").removeEvents()}if(e.hasClass("saved")){var l=e.get("data-locationid");var j=e.get("data-saveitemid");if(e.hasClass("savesHover-confirm-delete")){e.addEvent("click",function(){if(!k.isDisplayed()){h.showPositionedTip(this)}else{h.hidePositionedTip(k)}});k.getElement(".btn-delete").addEvent("click",function(){ta.widgets.Saves.unsaveCall(j,l);h.hidePositionedTip(k)})}else{e.addEvent("click",function(){ta.widgets.Saves.unsaveCall(j,l)})}h.closeHoverAlert(e)}else{var c=e.getParent(".savesContainer");if(c){var g=c.getElement(".hoverAlert");if(g){var d=false;e.addEvent("mouseenter",function(){if(!d){ta.trackEventOnPage("HoverSave","saveHover",l,1,false);d=true}h.showHoverAlert(e)});e.addEvent("mouseleave",function(){h.closeHoverAlert(e)})}var i=c.getElement(".saveAlert");if(i){h.closeSaveAlert(i)}}e.addEvent("click",function(n){var m=this.get("data-locationid");if(!m){return}ta.widgets.Saves.locationId=m;ta.widgets.Saves.btn=this;h.lastBtnClicked=this;ta.widgets.Saves.openSavesHoverRegflow(n);ta.trackEventOnPage("Saves","HoverButton",m,0)})}},overHover:function(e){e=ta.id(e);if(!e.hasClass("promoted")){if(!ta.isMetaHotels2013()&&!ta.has("meta.mini_meta_on_accommodations")){e.setStyle("background-color","#f1f1f1")}else{var d=e.getElement(".metaDisclaimer");if(d){d.setStyle("visibility","visible")}}}var c=e.getElement(".savesHover");if(c&&!c.hasClass("saved")&&c.hasClass("invisible")){c.removeClass("invisible")}var f=e.getElement(".hideHover");if(f&&f.hasClass("invisible")){f.removeClass("invisible")}},outHover:function(e){e=ta.id(e);if(!e.hasClass("promoted")){if(!ta.isMetaHotels2013()&&!ta.has("meta.mini_meta_on_accommodations")){e.setStyle("background-color","#fff")}else{e.removeClass("hoverShadow");var d=e.getElement(".metaDisclaimer");if(d){d.setStyle("visibility","hidden")}}}var c=e.getElement(".savesHover");if(c&&!c.hasClass("vr-heartContainer")&&!c.hasClass("saved")&&!c.hasClass("invisible")){c.addClass("invisible")}var f=e.getElement(".hideHover");if(f&&!f.hasClass("invisible")){f.addClass("invisible")}},getBtnsByLocationId:function(c){return ta.select(".savesHover-"+c)},showUnsaved:function(c,i){var e=this;if(c){if(c.length){c.each(function(l){e.showUnsaved(l,i)});return}if(c.hasClass("saved")){this.swapSaveText(c)}c.removeClass("saved");c.removeProperty("data-saveitemid");var f=c.getElement(".sprite-star_green");if(f){var g="sprite-star_gray";var k="sprite-star_green";f.addClass(g).removeClass(k)}if(c.getElement(".vr-icon")){var h=c.getElement(".vr-icon");if(h.hasClass("saved")){h.removeClass("saved");h.addClass("save");ta.vr.actionRecord("Unsave_VRR")}}var j=c.getElement(".sprite-hoverArrow");if(j){j.hide();var d=c.getElement(".vr_button_silver_border");if(d){d.removeClass("vr_button_silver_border").addClass("vr_button_silver")}}this.bindBtnEvents(c)}},showSaved:function(c,i){var e=this;if(c){if(c.length){c.each(function(l){e.showSaved(l,i)});return}if(!c.hasClass("saved")){this.swapSaveText(c)}c.addClass("saved");c.set("data-saveitemid",i);c.removeClass("invisible");var f=c.getElement(".sprite-star_gray");if(f){var g="sprite-star_green";var k="sprite-star_gray";f.addClass(g).removeClass(k)}if(c.getElement(".vr-icon")){var h=c.getElement(".vr-icon");if(h.hasClass("save")){h.removeClass("save");h.addClass("saved");if(h.hasClass("initial")){h.removeClass("initial")}else{ta.vr.actionRecord("Save_Success_VRR")}}}var j=c.getElement(".sprite-hoverArrow");if(j){j.show();var d=c.getElement(".vr_button_silver");if(d){d.removeClass("vr_button_silver").addClass("vr_button_silver_border")}}this.bindBtnEvents(c)}},swapSaveText:function(d){var c;var e;if(d.hasClass("vr-heartContainer")){c=d.getElement(".vr-saved");e=d.getElement(".vr-unsaved")}else{c=d.getElement(".saves-hover-txt-saved");e=d.getElement(".saves-hover-txt")}if(c){this.toggleVisibility(c)}if(e){this.toggleVisibility(e)}},toggleVisibility:function(c){var d=!ta.has("fall_2013_hr_saves_right");var f=d?c.isVisible():c.getStyle("visibility")!=="hidden";if(f){if(d){c.hide()}else{c.setStyle("visibility","hidden")}}else{if(d){var e;if(c.getParentBySelector("#why_ta_saves")){e="block"}else{e="inline"}c.show(e)}else{c.setStyle("visibility","visible")}}},hidePositionedTip:function(c){if(c){c.hide()}},showPositionedTip:function(d,c){var e=d.getParent();var f=e.getElement(".saveOptions");if(!f){if(typeof c=="function"){c()}return}f.show()},showSaveAlert:function(g){var c=g.getParent(".savesWrap");var h=c?c.getElement(".saveAlert"):null;if(!h){return}if(ta.has("meta.full_meta_photos")&&!ta.has("meta.full_meta_photos_v3")){if(ta.id("SAVES")){var f=32;var d=-5;h.setStyles({top:f,left:d}).show()}}else{h.show()}var e=this;setTimeout(function(){e.closeSaveAlert(h,h)},5000)},closeSaveAlert:function(c){c=ta.id(c);if(c){c.hide()}},showHoverAlert:function(d){var c=d.getParent(".savesWrap");var e=c?c.getElement(".hoverAlert"):null;if(!e){return}e.show()},closeHoverAlert:function(d){var c=d.getParent(".savesWrap");var e=c?c.getElement(".hoverAlert"):null;e=ta.id(e);if(!e){return}if(e){e.hide()}},assetsLoaded:function(){if(ta.id("SAVES")){ta.id("SAVES").setStyle("top",ta.id("HEADING").getTop()-123);ta.id("SAVES").show()}},assetsLoadedHeader:function(){var d=ta.id("SAVES");var c=ta.id("HR_HACKATHON_CONTENT");if(d&&c&&!ta.has("meta.full_meta_photos")&&!ta.has("feature.hr_css_reduction")){d.setStyle("top",c.getCoordinates().top);d.show()}},loadSavesButton:function(d,g,e,c,f){if(!ta.retrieve("saves_button_"+d)){ta.store("saves_button_"+d,true);if(ta.id("saves_placeholder_"+d)){new Request({url:"/SavesButtonAjax",onSuccess:function(i){try{if(i&&i.trim()!="BAD_REQUEST"){ta.id("saves_placeholder_"+d).innerHTML=i;ta.select(".savesHover-"+d).each(function(j){ta.widgets.SavesButtons.bindBtnEvents(j);j.removeClass("invisible")})}else{ta.util.error.record(null,"Failed to load saves button BAD_REQUEST",null,{DBLE_ID:d},"WARN")}}catch(h){ta.util.error.record(h,"Failed to load saves button",null,{DBLE_ID:d})}},data:{pop:g,del:e,dble:d,head:c,referringServlet:f},evalScripts:true,method:"get"}).send()}}},loadAllSavesButtons:function(){if(!ta.has("SAVES_BUTTONS_LOADED")&&typeof saveLocationsOnPage!="undefined"){ta.store("SAVES_BUTTONS_LOADED",true);window.removeEvent("scroll",ta.widgets.SavesButtons.loadAllSavesButtons);new Request({url:"/SavesButtonAjax",onSuccess:function(f){try{if(f&&f.trim()!="BAD_REQUEST"){var d=JSON.decode(f);if(d){d.each(function(g){var e=ta.id("saves_placeholder_"+g.id);if(e){e.innerHTML=ta.util.escaping.escapeHTMLSafe(g.html)}});ta.select(".savesHover").each(function(e){ta.widgets.SavesButtons.bindBtnEvents(e)})}}else{ta.util.error.record(null,"Failed to load saves buttons BAD_REQUEST",null,null,"WARN")}}catch(c){ta.util.error.record(c,"Failed to load saves buttons")}},data:{locations:saveLocationsOnPage.join()},evalScripts:true,method:"post"}).send()}}});if(!ta.widgets.SavesButtons){ta.widgets.SavesButtons=new a({})}})();ta.overlays.BACKDROP_NEVER=0;ta.overlays.BACKDROP_ALWAYS=1;ta.overlays.Overlay=new Class({Implements:[Options,Events],Binds:["_hide","show","hide","destroy","hideByClickOnDocument"],options:{requestData:null,showCloseButton:false,noPadding:false,noCpu:false,closeButtonClass:"close",closeLink:"",showArrow:false,arrowClassLeft:null,arrowClassRight:null,arrowClass:"ttarrow",style:"typeO",innerDivClass:"inner",backdrop:ta.overlays.BACKDROP_NEVER,backdropZIndex:"default",permanent:false,permanent_except_same:false,type:"",isChild:false,remoteContent:null,maintainCrPageServlet:false,keepElementInDocument:false,requestMethod:"get",zIndex:1001,positionType:"absolute",draggable:false,draggingClass:"dragging",title:null,onscroll:null,noScroll:false,noScrollY:false,backdropClickClose:false,backdropColor:"#000",backdropOpacity:0.6,offsetRight:0,offsetLeft:0,offsetTop:0,offsetBottom:0,closeOnDocumentClick:false,track:false,positionByOffsets:false,useTransparentOverlayPadding:false,transparentOverlayPaddingValue:0},initialize:function(i,b){this.noScroll=i.noScroll||i.noScrollY;if(i.noScroll){this.overflowToHide="overflow"}else{if(i.noScrollY){this.overflowToHide="overflow-Y"}}if(this.noScroll){var a=i.onShow;i.onShow=function(){if(a){a()}ta.find("body").setStyle(this.overflowToHide,"hidden")};var h=i.onClose;i.onClose=function(){if(h){h()}ta.find("body").setStyle(this.overflowToHide,"")}}this.setOptions(i);this.source=ta.id(b);this.visible=false;this.backdropOn=false;this.closedByDocClick=false;var f=this.options.style+" overlay";if(this.options.backdrop==ta.overlays.BACKDROP_ALWAYS){f+=" withBackdrop"}else{f+=" noBackdrop"}this.container=new Element("div",{styles:{position:this.options.positionType,left:"-999em",top:"-999em",fontSize:this.options.fontSize||".75em",zIndex:this.options.zIndex},"class":f});if(i.blockSelect){this.container.onselectstart=function(){return false}}this.container.store("overlay",this);this.container.overlay=this;ta.store("overlays.current",this);this._useIframeShim=Browser.ie6;if(this.options.title){this.header=new Element("h1",{"class":"title",html:this.options.title}).inject(this.container);if(this.options.draggable){var g=this.options.draggingClass;var d=function(){};if(this._useIframeShim){d=this.positionShim.bind(this)}if(this.options.useTransparentOverlayPadding){d=this.transparentOverlayPadding.bind(this)}this.drag=new Drag(this.container,{handle:this.header,preventDefault:true,stopPropagation:true,onSnap:function(j){j.addClass(g)},onDrag:d,onComplete:function(j){j.removeClass(g)}})}}this.inner=new Element("div",{"class":this.options.innerDivClass}).inject(this.container);this.inner.id="overlayInnerDiv";var e=this;if(e.options.onscroll){e.inner.addEvent("scroll",function(){e.options.onscroll(e.inner)})}if(this._useIframeShim){this.shim=new IframeShim(this.container,{browsers:true})}if(this.options.useTransparentOverlayPadding){this.transparentOverlayPadding=new Element("div",{"class":"overlayPadding",styles:{position:"absolute","z-index":this.options.zIndex-1}});this.transparentOverlayPaddingValue=this.options.transparentOverlayPaddingValue}var c;if(this.options.content){this.inner.setContent(this.options.content)}else{if(this.options.remoteContent){this.loadRemoteContent(this.options.remoteContent)}else{if(this.source&&(c=this.source.getElement(".overlayContents"))){if(c){this.inner.set("html",c.innerHTML);c.dispose();this.runBehaviorOnFirstShow=true}}}}if(this.options.showCloseButton){this.addCloseButton()}else{if(this.options.setCloseButton){this.setCloseButton()}}if(this.options.showArrow){this.arrow=new Element("div",{styles:{position:"absolute"},"class":this.options.arrowClass}).inject(this.container);if(this.header){this.container.addClass("withClose")}else{this.inner.addClass("withClose")}}if(this.options.noPadding){if(this.header){this.container.addClass("noPad")}else{this.inner.addClass("noPad")}}if(this.options.noCpu){if(this.header){this.container.addClass("no_cpu")}else{this.inner.addClass("no_cpu")}}this.container.addEvent("trash",this.destroy)},addCloseButton:function(){var a=this.options.closeButtonClass;if(ta.has("checkrates.add_holding_windows")){a+=" no_cpu"}this.closeBtn=new Element("div",{styles:{position:"absolute",fontSize:"92.5%",cursor:"pointer"},html:this.options.closeLink,"class":a,events:{click:(function(){this.fireEvent("onClose",this)}).bind(this)}}).inject(this.container);if(this.header){this.container.addClass("withClose")}else{this.inner.addClass("withClose")}},setCloseButton:function(){if(this.options.closeButtonClass){this.closeBtn=this.container.getElement("."+this.options.closeButtonClass);if(this.closeBtn){this.closeBtn.addEvents({click:(function(){this.fireEvent("onClose",this);this.hide()}).bind(this)})}}},destroy:function(){this.container.overlay=null;if(this.shim){this.shim.destroy();this.shim=null}if(this.transparentOverlayPadding){this.transparentOverlayPadding.destroy();this.transparentOverlayPadding=null}},position:function(){if(this.shim){(function(){this.positionShim()}).delay(10,this)}if(this.transparentOverlayPadding){(function(){this.positionTransparentOverlayPadding()}).delay(10,this)}},positionTransparentOverlayPadding:function(){var b=this.container.getCoordinates();if(!b||!b.left){return}var a=this.transparentOverlayPaddingValue;this.transparentOverlayPadding.setStyles({left:b.left-a,top:b.top-a})},positionShim:function(){var a=this.container.getCoordinates();if(!a||!a.left){return}this.shim.shim.setStyles({left:a.left,top:a.top})},show:function(a){if(typeof(overlayCss)!="undefined"&&!ta.retrieve("ta.overlayCssAsset")){if(this.options.waitForCss){ta.store("ta.overlayCssAsset",ta.css(overlayCss,{onLoad:function(){this._show(a)}.bind(this)}))}else{ta.store("ta.overlayCssAsset",ta.css(overlayCss));this._show(a)}}else{this._show(a)}},_show:function(f){if(this.visible){return}if(f){new Event(f).preventDefault()}this.closedByDocClick=false;var a=ta.util.URL.parse(this.options.remoteContent);if(!this.options.maintainCrPageServlet&&typeof crPageServlet!=="undefined"&&a&&a.test(/\/{1}(\w*)$/)){ta.store("crPageServlet_orig",crPageServlet);crPageServlet=RegExp.$1}$$(".overlay").each(function(c){if(c.overlay){if(c.overlay==this){return}if(this.parentOverlay&&c.overlay==this.parentOverlay){return}if(c.overlay.options.permanent){return}if(c.overlay.options.permanent_except_same&&c.overlay.options.type!=this.options.type){return}c.overlay.hide(f)}},this);var d=ta.id(this.options.parentContainer||document.body);d.adopt(this.container);if(this.shim&&this.shim.shim){d.adopt(this.shim.shim);var e=this.container.getCoordinates();if(e){this.shim.shim.setStyles({display:"block",width:e.width,height:e.height})}}if(this.transparentOverlayPadding){d.adopt(this.transparentOverlayPadding);var e=this.container.getCoordinates();if(e){var b=this.transparentOverlayPaddingValue*2;this.transparentOverlayPadding.setStyles({display:"block",width:e.width+b,height:e.height+b})}}if(this.options.backdrop==ta.overlays.BACKDROP_ALWAYS){this.enableBackdrop()}this.position();if(this.options.closeOnDocumentClick){document.addEvent("click",this._hide.bind(this))}this.visible=true;this.fireEvent("onShow",this);window.fireEvent("onOverlayShow",this);if(ta.has("overlay.onShow")){ta.remove("overlay.onShow").each(function(c){c.call(this)},this)}return this},_setPosition:function(a){if(this.options.parentContainer){var c=Math.abs(this.container.getPosition().x-this.container.offsetLeft);var d=Math.abs(this.container.getPosition().y-this.container.offsetTop);var b={};if(a.left!==undefined){b.left=Math.abs(a.left-c)}if(a.top!==undefined){b.top=Math.abs(a.top-d)}if(a.bottom!==undefined){b.right=Math.abs(a.right-c)}if(a.right!==undefined){b.bottom=Math.abs(a.bottom-d)}this.container.setStyles(Object.merge(a,b))}else{this.container.setStyles(a)}},_hide:function(b){if(this.noScroll){ta.find("body").setStyle(this.overflowToHide,"")}if(!b||this.container.containsEvent(b)){return}if(this.options.pinnable==ta.overlays.PINNABLE_HOVER||this.options.pinnable==ta.overlays.PINNABLE_CLICK_WITH_DOC_CLOSE){var a=b.target;while(a){if(a==this.source){return}else{a=a.parentElement}}}document.removeEvent("click",this._hide);this.hide(b)},hideByClickOnDocument:function(a){if(ta.retrieve("overlay.dontCloseOnClick")||this.options.dontCloseOnClick){return}this.closedByDocClick=true;this.hide(a)},hide:function(a){if(window.flyout){window.flyout.hide()}if(this.backdropOn){this.disableBackdrop()}if((this.options.keepElementInDocument&&this.container.style.left=="-999em")||(!this.options.keepElementInDocument&&!this.container.inDocument())){return this}if(this.shim){this.shim.hide().dispose()}if(this.transparentOverlayPadding){this.transparentOverlayPadding.hide().dispose()}this.container.setStyles({left:"-999em",top:"-999em"});if(!this.options.keepElementInDocument){this.container.dispose()}this.visible=false;this.fireEvent("onHide",!a);window.fireEvent("onOverlayClose",this);if(!this.options.maintainCrPageServlet&&ta.has("crPageServlet_orig")){ta.run("ta.meta.linkTracking.restoreCRPageServlet")}if(this.noScroll){ta.find("body").setStyle(this.overflowToHide,"")}return this},calculateBackdropHeight:function(){return Math.max(window.innerHeight?window.innerHeight:(document.documentElement.clientHeight?document.documentElement.clientHeight:document.body.offsetHeight),document.body.scrollHeight)},configureBackdrop:function(){var b={"class":"overlayBG"};var a;if(this.options.backdropZIndex==="behindOverlay"){a=this.options.zIndex-1}else{if(ta.retrieve("tablet_calendar_update.enabled")){b.events={click:function(d){this.fireEvent("backdropClick",d)}.bind(this)};if(document.getElement(".overlayBG")){this.options.backdropOpacity=0.01}var c=document.getElements(".overlay").length;a+=c*2}else{a=this.options.isChild?10000:9997}}this.backdrop=new Element("div",b);this.backdrop.setStyles({position:"fixed",left:0,top:0,width:"100%",height:this.calculateBackdropHeight(),backgroundColor:this.options.backdropColor,zIndex:a,opacity:this.options.backdropOpacity,filter:"alpha(opacity="+Math.floor(this.options.backdropOpacity*100)+")"});if(this.options.backdropClickClose){this.backdrop.addEvent("click",function(){this.fireEvent("onClose",this);this.hide()}.bind(this))}},updateBackdrop:function(){this.backdrop.setStyles({width:"100%",height:this.calculateBackdropHeight()})},enableBackdrop:function(){try{if(this.backdropOn){return}if(!this.backdrop){this.configureBackdrop()}if(Browser.ie6){var a=this.container;$$("select").each(function(d){if(!a.contains(d)){d.setStyle("visibility","hidden")}else{d.setStyle("visibility","visible")}})}ta.store("overlays.current",this);this.updateBackdrop();if(this.container.inDocument()){this.backdrop.inject(this.container,"before")}else{this.backdrop.inject(document.body)}this.backdropOn=true;if(this.options.backdropZIndex==="behindOverlay"){}else{if(ta.retrieve("tablet_calendar_update.enabled")){var b=document.getElements(".overlay").length;this.container.setStyle("z-index",parseInt(this.backdrop.getStyle("z-index"))+1)}else{this.container.setStyle("z-index",this.options.isChild?"10002":"9998")}}if(ta.isDHTMLCRRedesign2012()&&this.container.getElement(".check_availability")){if(Browser.ie7||Browser.ie8){this.container.setStyle("border","5px solid #424242")}else{this.container.setStyle("border","5px solid rgba(64,64,64,0.8)")}}}catch(c){ta.util.error.record(c,"Error setting the border property - enableBackdrop")}},disableBackdrop:function(){try{if(!this.backdropOn){return}this.backdrop.dispose();if(ta.retrieve("overlays.current")==this){ta.remove("overlays.current");if(Browser.ie6){$$("select").setStyle("visibility","visible")}}else{if(Browser.ie6&&ta.retrieve("overlays.current")&&!ta.retrieve("overlays.current").backdropOn){$$("select").setStyle("visibility","visible")}}this.backdropOn=false;this.container.setStyle("z-index","1001");if(ta.isDHTMLCRRedesign2012()&&this.container.getElement(".check_availability")){if(Browser.ie7||Browser.ie8){this.container.setStyle("border","5px solid #b2b2b2")}else{this.container.setStyle("border","5px solid rgba(128,128,128,0.6)")}}}catch(a){ta.util.error.record(a,"Error unsetting the border property - disableBackdrop")}},loadRemoteContent:function(c,a){var b={url:ta.util.URL.parse(c),method:this.options.requestMethod,data:this.options.requestData,onSuccess:this.loadRemoteSuccess.bind(this),onFailure:this.loadRemoteFailure.bind(this),evalScripts:true};this.options.track&&(b.trackEvent=this.options.track);if(!a&&!this.options.hideSpinner){new Asset.image(CDNHOST+"/img2/generic/site/loop.gif",{onload:this.position.bind(this),"class":"anim_loop"}).inject(this.inner)}new Request(b).send();return this},loadRemoteSuccess:function(b){if(typeof b==="string"){var a=document.head||ta.select("head")[0];b=b.replace(new RegExp("<style.*?>((.|\n)*?)</style.*?>","g"),function(c,d){var e=document.createElement("style");e.type="text/css";if(e.styleSheet){e.styleSheet.cssText=d}else{e.appendChild(document.createTextNode(d))}a.appendChild(e);return""})}this.cachedWidth=null;this.inner.setContent(b);this.position();if(typeof behavior!="undefined"&&behavior&&behavior.apply){behavior.apply(this.inner)}this.fireEvent("onLoad",this);this.cachedWidth=this.container.getSize().x;if(this.backdropOn){this.updateBackdrop()}return this},loadRemoteFailure:function(a){this.inner.addClass("ajax_failed");this.inner.setStyle("width","383px");this.inner.setStyle("padding","14px 24px 14px 14px");this.inner.set("text",JS_Ajax_failed);this.fireEvent("onLoadRemoteFailure",a)}});ta.overlays.getCurrent=function(){var a=$$(".overlay").shift();return a&&a.retrieve("overlay")};ta.overlays.safeCloseCurrent=function(){var a=ta.overlays.getCurrent();return a&&a.hide()};ta.overlays.safeCloseFromDom=function(c){c=ta.id(c);var a=c&&c.getParent(".overlay");var b=a&&a.retrieve("overlay");return b&&b.hide()};ta.overlays.AbsoluteOverlay=new Class({Extends:ta.overlays.Overlay,options:{xOffset:0,yOffset:0,toWindow:true,repositionOnScroll:false,autoShow:true,stayOpen:false,hideOnDocumentClick:false},initialize:function(a,b){a=a||{};a.showCloseButton=[a.showCloseButton,true].pick();this.parent(a,b);if(this.options.showCloseButton&&!this.options.stayOpen){this.closeBtn.addEvent("click",this.hide)}if(this.options.hideOnDocumentClick){document.addEvent("click",this.hideByClickOnDocument.bind(this))}if(this.options.autoShow){this.show()}},show:function(a){this.parent(a);if(this.options.repositionOnScroll){window.addEvent("scroll",this.delayedScroll.bind(this))}},hide:function(a){this.parent(a);if(this.options.repositionOnScroll){window.removeEvent("scroll",this.delayedScroll.bind(this))}if(this.options.hideOnDocumentClick){document.removeEvent("click",this.hideByClickOnDocument.bind(this))}},hideByClickOnDocument:function(d){if(!d||!d.page){return false}d=new Event(d);var c=d.page;var b=this.inner.getCoordinates();var a=c.y>=b.top&&c.y<=b.bottom&&c.x>=b.left&&c.x<=b.right;if(!a){this.parent(d)}},delayedScroll:function(){this.position.delay(500,this)},position:function(){this.container.setStyles({left:this.options.xOffset,top:this.options.yOffset+(this.options.toWindow?window.getScrollTop():0)});this.parent()}});ta.overlays.AbsoluteBottomOverlay=new Class({Extends:ta.overlays.Overlay,initialize:function(a,b){this.parent(Object.merge({positionType:"fixed"},a),b);if(this.options.showCloseButton&&!this.options.stayOpen){this.closeBtn.addEvent("click",this.hide)}thisOverlay=this;if(this.options.horizontalScroll){window.addEvent("scroll",function(){var c=window.getScroll().x*-1;thisOverlay.container.setStyle("left",(c))})}},position:function(){this.parent();this.reposition();this.flyIn()},reposition:function(){this.container.setStyles({top:null,left:null});if(!this.options.flyFromRight){if(this.options.horizontalScroll){leftValue=window.getScroll().x*-1}else{leftValue=window.getCoordinates().width/2-this.container.getWidth()/2}this.container.setStyles({bottom:0,left:leftValue})}else{this.container.setStyles({bottom:10,right:10})}},flyIn:function(){if(this.options.flyFromRight){this.container.setStyle("right",-window.getCoordinates().width)}else{this.container.setStyle("bottom",-this.container.getHeight())}var a=new Fx.Tween(this.container,{duration:"1000",transition:"quad:out"});if(this.options.flyFromRight){a.start("right",10)}else{a.start("bottom",0)}},show:function(a){this.parent(a);if(!this.options.flyFromRight){window.addEvent("resize",this.reposition.bind(this))}this.container.removeClass("overlay");this.reposition()}});ta.overlays.CenteredOverlay=new Class({Extends:ta.overlays.Overlay,Binds:["hideByClickOnDocument","position","hide","show"],options:{delayedPosition:false,autoShow:true,attachCloseEvent:true,xOffset:-1,yOffset:-1,absoluteOffset:false,fixed:false},initialize:function(b,c){b=b||{};b.showCloseButton=[b.showCloseButton,true].pick();b.fixed&&(this.options.positionType="fixed");this.parent(b,c);if(this.source){var a=this.source.getParentBySelector(".overlay");if(a){this.container.setStyle("z-index",a.getStyle("z-index")+1);this.parentOverlay=a.overlay}}if(this.options.showCloseButton&&this.options.attachCloseEvent){this.closeBtn.addEvent("click",this.hide)}this.options.autoShow&&this.show()},position:function(d){var b=ta.retrieve("ta.overlays.CenteredOverlay.position.iters");if(!b){b=0}var f=this.container.getCoordinates();if(f.height<=14&&b<10){ta.store("ta.overlays.CenteredOverlay.position.iters",b+1);this.position.delay(100,this,true);return}var a=this.options.xOffset;var e=this.options.yOffset;if(a===-1){a=Math.max(5,(window.tabletOnFullSite?window.innerWidth:window.getWidth())-f.width)/2;!this.options.fixed&&(a+=window.getScrollLeft())}else{!this.options.absoluteOffset&&(a-=f.width/2)}if(e===-1){e=Math.max(20,(window.tabletOnFullSite?window.innerHeight:window.getHeight())-f.height)/2;!this.options.fixed&&(e+=window.getScrollTop())}else{!this.options.absoluteOffset&&(e-=f.height/2)}this.container.setStyles({left:a,top:e});this.parent()},positionShim:function(){var a=this.container.getCoordinates();if(!a||!a.left){return}this.shim.shim.setStyles({left:a.left,top:a.top,width:a.width,height:a.height})},positionTransparentOverlayPadding:function(){var d=this.container.getCoordinates();if(!d||!d.left){return}var b=this.transparentOverlayPaddingValue;var a=this.transparentOverlayPaddingValue*2;this.transparentOverlayPadding.setStyles({left:d.left-b,top:d.top-b,width:d.width+a,height:d.height+a})}});ta.overlays.showInLightbox=function(a,b){return new ta.overlays.CenteredOverlay(Object.merge({backdrop:ta.overlays.BACKDROP_ALWAYS},b)).loadRemoteSuccess(a)};ta.overlays.loadInLightbox=function(b,a){return new ta.overlays.CenteredOverlay(Object.merge({backdrop:ta.overlays.BACKDROP_ALWAYS},a)).loadRemoteContent(b)};var lightbox={deactivate:function(){var a=ta.retrieve("overlays.current");a&&a.hide()}};ta.overlays.CouponOverlay=new Class({Extends:ta.overlays.CenteredOverlay,initialize:function(a,b){this.parent(Object.merge({backdrop:ta.overlays.BACKDROP_ALWAYS,fixed:true,waitForCss:true,onClose:function(){ta.remove("suppressMetaFocus")}},a),b);this._opaqueBG=null;this._opaqueImg=null;if(Browser.name==="ie"){this._enableOpaqueBG()}window.addEvent("resize",this.position.bind(this))},hide:function(a){if(this._opaqueBG){this._opaqueBG.dispose();this._opaqueBG=null;this._opaqueImg=null}this.parent(a);return this},position:function(){this.parent();if(this._opaqueBG){var a=this.container.getCoordinates();this._opaqueBG.setStyles({top:Math.max(20,window.getHeight()-a.height)/2+window.getScrollTop(),left:Math.max(5,window.getWidth()-a.width)/2,width:a.width,height:a.height});this._opaqueImg.setStyles({width:a.width,height:a.height})}},_enableOpaqueBG:function(){if(this._opaqueBG){return}var a=this.options.isChild?9999:9996;this._opaqueBG=new Element("div",{"class":"printCouponBackground"});this._opaqueImg=new Element("img",{src:"/img2/generic/site/white_1x1.png"});var b=this.container.getCoordinates();this._opaqueBG.setStyles({top:Math.max(20,window.getHeight()-b.height)/2+window.getScrollTop(),left:Math.max(5,window.getWidth()-b.width)/2,width:b.width,height:b.height,zIndex:a,position:"fixed"});this._opaqueImg.setStyles({width:b.width,height:b.height});this._opaqueImg.inject(this._opaqueBG);if(this.container.inDocument()){this._opaqueBG.inject(this.container,"before")}else{this._opaqueBG.inject(document.body)}}});ta.overlays.showCouponInLightbox=function(b,d){var c=new ta.overlays.CouponOverlay(d);var a=c.loadRemoteSuccess(b);c.show();return a};ta.overlays.ACTIVATE_NEVER=0;ta.overlays.ACTIVATE_CLICK=1;ta.overlays.ACTIVATE_HOVER=2;ta.overlays.ACTIVATE_FOCUS=3;ta.overlays.ACTIVATE_HOVER_DELAY=4;ta.overlays.ACTIVATE_BOTH=5;ta.overlays.ACTIVATE_CLICK_ALTERNATE=6;ta.overlays.ACTIVATE_BOTH_DELAY=7;ta.overlays.ACTIVATE_CLICK_TOGGLE=8;ta.overlays.PINNABLE_NEVER=0;ta.overlays.PINNABLE_ALWAYS=1;ta.overlays.PINNABLE_CLICK=2;ta.overlays.PINNABLE_CLICK_WITH_DOC_CLOSE=3;ta.overlays.PINNABLE_HOVER=4;ta.overlays.BACKDROP_PINNED=2;ta.overlays.RelativeOverlay=new Class({Extends:ta.overlays.Overlay,Binds:["overrideHoverDelayOnce","overridePinnableOption","_hide","show","hide","disable","destroy","hideNow","showWithDelay","hideWithDelay","_pin","prolongVisibility","showOrHide","_bothEnter","_bothEnterWithDelay","_bothClick"],options:{activate:ta.overlays.ACTIVATE_NEVER,pinnable:ta.overlays.PINNABLE_NEVER,activateHoverDelayTime:300,hoverDelayTime:250,pointArrowToSource:false,autoShow:true,ignoreFirstClickAfterHover:false,ignoreFirstClick:false,closeFunction:false,showFunction:false,closeButtonFunction:false},initialize:function(b,c){this.parent(b,c);this.debug_sticky=ta.retrieve("debug.stickyOverlays");this.container.addClass("relative");var a=this.source&&this.source.getParentBySelector(".overlay");if(a){this.container.setStyle("z-index",a.getStyle("z-index")+1);this.parentOverlay=a.overlay}this.enabled=true;if(this.options.showCloseButton&&this.closeBtn){this.closeBtn.addEvent("click",(function(){try{if(this.options.closeButtonFunction&&typeof this.options.closeButtonFunction==="function"){this.options.closeButtonFunction()}}catch(f){}this.hideNow()}).bind(this));if(this.options.smartCloseButton){this.closeBtn.hide()}}switch(this.options.activate){case ta.overlays.ACTIVATE_CLICK:this.source.addEvent("click",this.show);break;case ta.overlays.ACTIVATE_CLICK_TOGGLE:this.source.addEvent("click",this.showOrHide);break;case ta.overlays.ACTIVATE_HOVER:this.source.addEvent("mouseenter",this.show);this.container.addEvent("mouseenter",this.show);this.source.addEvent("mouseleave",this.hide);this.container.addEvent("mouseleave",this.hide);break;case ta.overlays.ACTIVATE_HOVER_DELAY:this.source.addEvent("mouseenter",this.showWithDelay);this.source.addEvent("mouseleave",this.hideWithDelay);this.container.addEvent("mouseenter",this.show);this.container.addEvent("mouseleave",this.hide);break;case ta.overlays.ACTIVATE_FOCUS:this.source.addEvent("focus",this.show);break;case ta.overlays.ACTIVATE_CLICK_ALTERNATE:this.source.addEvent("mouseenter",this.prolongVisibility);this.container.addEvent("mouseenter",this.prolongVisibility);this.source.addEvent("mouseleave",this.hide);this.container.addEvent("mouseleave",this.hide);this.source.addEvent("click",this.showOrHide);break;case ta.overlays.ACTIVATE_BOTH:this.source.addEvent("mouseenter",this._bothEnter);this.container.addEvent("mouseenter",this._bothEnter);this.source.addEvent("mouseleave",this.hide);this.container.addEvent("mouseleave",this.hide);this.source.addEvent("click",this._bothClick);this.ignoreNextClick=b.ignoreFirstClickAfterHover&&b.ignoreFirstClick;break;case ta.overlays.ACTIVATE_BOTH_DELAY:this.source.addEvent("mouseenter",this._bothEnterWithDelay);this.container.addEvent("mouseenter",this._bothEnter);this.source.addEvent("mouseleave",this.hideWithDelay);this.container.addEvent("mouseleave",this.hide);this.source.addEvent("click",this._bothClick);this.ignoreNextClick=b.ignoreFirstClickAfterHover&&b.ignoreFirstClick;break}switch(this.options.pinnable){case ta.overlays.PINNABLE_CLICK:case ta.overlays.PINNABLE_CLICK_WITH_DOC_CLOSE:this.source.addEvent("click",this._pin);break}if(typeof this.options.remoteLink!="undefined"&&this.options.remoteLink!=null){this.loadRemoteContent(this.options.remoteLink)}else{if(this.source){var e=this.source.getElement(".overlaySrc");if(e){if(e.get("tag")=="a"){this.loadRemoteContent(e.href)}else{this.loadRemoteContent(e.get("text"));e.dispose()}}else{if(!this.options.content&&this.source.get("tag")=="a"){this.loadRemoteContent(this.source.href)}}}}var d=this.source&&ta.id(this.source.id+"_CONTENTS");if(d){this.inner.set("html",d.innerHTML);d.dispose();this.runBehaviorOnFirstShow=true}if(this.options.autoShow){this.show()}else{if(this.options.delayShow){this.showWithDelay()}}},enable:function(){this.enabled=true},disable:function(){this.enabled=false},overrideHoverDelayOnce:function(a){this.overriddenHoverDelayTime=a},overridePinnableOption:function(a){if(a===true){this.source.addEvent("click",this._pin);this.container.addEvent("click",this._pin)}else{if(a===false){this.source.removeEvent("click",this._pin);this.container.removeEvent("click",this._pin);this.unpin()}}},show:function(b){b=b||window.event;if(b){new Event(b).stop()}if(!this.enabled){return}var a=this.visible;this.parent(b);clearTimeout(this.showTimeout);if((this.options.activate==ta.overlays.ACTIVATE_HOVER||this.options.activate==ta.overlays.ACTIVATE_HOVER_DELAY||this.options.activate==ta.overlays.ACTIVATE_BOTH||this.options.activate==ta.overlays.ACTIVATE_BOTH_DELAY)&&this.hideTimer){clearTimeout(this.hideTimer);this.hideTimer=null}if(a){return}if(this.runBehaviorOnFirstShow){this.runBehaviorOnFirstShow=false;if(typeof behavior!="undefined"&&behavior&&behavior.apply){behavior.apply(this.inner)}}this.cachedWidth=this.container.getSize().x;switch(this.options.pinnable){case ta.overlays.PINNABLE_HOVER:this._pin();break}switch(this.options.activate){case ta.overlays.ACTIVATE_HOVER:case ta.overlays.ACTIVATE_HOVER_DELAY:break;case ta.overlays.ACTIVATE_CLICK:case ta.overlays.ACTIVATE_CLICK_TOGGLE:case ta.overlays.ACTIVATE_FOCUS:if(this.options.pinnable==ta.overlays.PINNABLE_NEVER){document.addEvent("click",this.hideByClickOnDocument.bind(this))}break}if(this.options.showFunction){this.options.showFunction()}return this},hide:function(c){if(this.debug_sticky){return this}c=c||window.event;if(!this.visible){return}if(window.flyout){window.flyout.hide()}if(c){var b=new Event(c);if(b.target&&b.target.tagName=="option"){return}if(Browser.ie&&b.target&&b.target.tagName=="select"&&this.container.getElements("select").contains(b.target)){return}}switch(this.options.activate){case ta.overlays.ACTIVATE_HOVER:case ta.overlays.ACTIVATE_HOVER_DELAY:case ta.overlays.ACTIVATE_CLICK_ALTERNATE:case ta.overlays.ACTIVATE_BOTH:case ta.overlays.ACTIVATE_BOTH_DELAY:if(!this.hideTimer){var a=this.options.hoverDelayTime;if(this.overriddenHoverDelayTime!==undefined){a=this.overriddenHoverDelayTime;delete this.overriddenHoverDelayTime}this.hideTimer=this.hide.delay(a,this);return}else{clearTimeout(this.hideTimer);this.hideTimer=null}break;case ta.overlays.ACTIVATE_CLICK:case ta.overlays.ACTIVATE_CLICK_TOGGLE:case ta.overlays.ACTIVATE_FOCUS:if(c&&this.container.containsEvent(c)){return}if(this.options.pinnable==ta.overlays.PINNABLE_NEVER){document.removeEvent("click",this.hide)}break}return this.hideNow()},hideNow:function(a){if(!this.visible){return this}if(this.backdropOn){this.disableBackdrop()}if(this.shim){this.shim.hide().dispose()}if(this.transparentOverlayPadding){this.transparentOverlayPadding.hide().dispose()}if(!this.options.positionByOffsets){this.container.setStyles({left:"-999em",top:"-999em"}).dispose()}else{this.container.dispose()}this.visible=false;if(this.options.pinnable==ta.overlays.PINNABLE_CLICK||this.options.pinnable==ta.overlays.PINNABLE_CLICK_WITH_DOC_CLOSE||this.options.pinnable==ta.overlays.PINNABLE_HOVER){this.unpin()}this.fireEvent("onHide",!a);if(this.options.closeFunction){this.options.closeFunction()}return this},_pin:function(a){this.pin();this.toggleBackdrop(true)},pin:function(){this.source=ta.id(this.source);switch(this.options.activate){case ta.overlays.ACTIVATE_HOVER:this.source.removeEvent("mouseenter",this.show);this.source.removeEvent("mouseleave",this.hide);break;case ta.overlays.ACTIVATE_BOTH:this.source.removeEvent("mouseenter",this._bothEnter);this.source.removeEvent("mouseleave",this.hide);break;case ta.overlays.ACTIVATE_HOVER_DELAY:this.source.removeEvent("mouseenter",this.showWithDelay);this.source.removeEvent("mouseleave",this.hideWithDelay);break;case ta.overlays.ACTIVATE_BOTH_DELAY:this.source.removeEvent("mouseenter",this._bothEnterWithDelay);this.source.removeEvent("mouseleave",this.hideWithDelay);break}this.container.removeEvent("mouseenter",this.show);this.container.removeEvent("mouseleave",this.hide);this.pinned=true;if(this.options.smartCloseButton&&this.closeBtn){this.closeBtn.show()}return this},toggleBackdrop:function(a){if(this.options.backdrop==ta.overlays.BACKDROP_PINNED){this.enableBackdrop()}},unpin:function(){this.source=ta.id(this.source);switch(this.options.activate){case ta.overlays.ACTIVATE_HOVER:this.source.addEvent("mouseenter",this.show);this.source.addEvent("mouseleave",this.hide);break;case ta.overlays.ACTIVATE_BOTH:this.source.addEvent("mouseenter",this._bothEnter);this.source.addEvent("mouseleave",this.hide);break;case ta.overlays.ACTIVATE_HOVER_DELAY:this.source.addEvent("mouseenter",this.showWithDelay);this.source.addEvent("mouseleave",this.hideWithDelay);break;case ta.overlays.ACTIVATE_BOTH_DELAY:this.source.addEvent("mouseenter",this._bothEnterWithDelay);this.source.addEvent("mouseleave",this.hideWithDelay);break}this.container.addEvent("mouseenter",this.show);this.container.addEvent("mouseleave",this.hide);if(this.options.backdrop==ta.overlays.BACKDROP_PINNED){this.disableBackdrop()}this.pinned=false;if(this.options.smartCloseButton&&this.closeBtn){this.closeBtn.hide()}return this},showWithDelay:function(a){a=a||window.event;clearTimeout(this.showTimeout);if(this.visible){return this.show(a)}else{this.showTimeout=this.show.delay(this.options.activateHoverDelayTime,this)}},hideWithDelay:function(a){a=a||window.event;if(!this.visible){clearTimeout(this.showTimeout)}else{return this.hide(a)}},prolongVisibility:function(){if(this.visible&&this.hideTimer){clearTimeout(this.hideTimer);this.hideTimer=null}},showOrHide:function(a){if(this.blockShowOrHide){return}if(this.visible){return this.hideNow(a)}else{return this.show(a)}},_bothEnter:function(a){this.ignoreNextClick=this.options.ignoreFirstClickAfterHover;return this.show(a)},_bothEnterWithDelay:function(a){this.ignoreNextClick=this.options.ignoreFirstClickAfterHover;return this.showWithDelay(a)},_bothClick:function(a){if(this.ignoreNextClick){a=a||window.event;if(a){new Event(a).stop()}this.ignoreNextClick=false;return this}else{return this.showOrHide(a)}}});ta.overlays.RelativeOverlayHorizontal=new Class({Extends:ta.overlays.RelativeOverlay,options:{arrowHeight:0,arrowLeftForce:0,arrowTopForce:0,allowRightArrowPos:false,allowBelowBottomEdge:false,mirrorIfRtl:false},initialize:function(a,b){if(a.onRight==null){if(IS_DEBUG){alert("ERROR: Attempting to create Horizontal Overlay without specifying direction.")}return}if(a.mirrorIfRtl&&ta.util.i18n.isRtl()){a.onRight=!a.onRight;if(a.offsetLeft){a.offsetRight=-a.offsetLeft;a.offsetLeft=0}else{if(a.offsetRight){a.offsetLeft=-a.offsetRight;a.offsetRight=0}}}this.parent(a,b)},position:function(){if(this.options.onRight){this.positionRight()}else{this.positionLeft()}this.parent()},adjustTop:function(f,i){try{this.source=ta.id(this.source);var k=f+this.options.offsetTop;if(!this.options.allowBelowBottomEdge){var g=window.getScrollTop()+window.getHeight();var j=document.getElementById("tamgFooter");if(j){if(j.offsetHeight){g=g-j.offsetHeight}else{if(j.clientHeight){g=g-j.clientHeight}}}if(k+i.height>=g){k=g-i.height-1;if((this.crDHTML_BASIC||this.crDHTML_PNG24)&&this.options.showArrow){var b=this.container.getElement(".check_availability");var d=this.container.getElement(".username");if(b||d){var a=b?b:d;var c=a.getCoordinates().height}k=g-i.height+c-9}}}return k}catch(h){ta.util.error.record(h,"adjustTop: RelativeOverlayHorizontal")}},positionLeft:function(){try{this.source=ta.id(this.source);var d=this.source.getCoordinates();var b=this.container.getStyle("margin-top").toInt();var a=ta.id("PAGE").getCoordinates();var h=this.container.getCoordinates();if(!this.flipped&&d.left-a.left-(this.cachedWidth||h.width)<0){this.flipped=true;this.options.onRight=true;if(this.arrow){this.arrow.className=this.options.arrowClassLeft}this.positionRight();return}if(ta.isDHTMLCRRedesign2012()&&this.container.getElement(".check_availability")){this.positionLeftOrRight(d,b,a,h,"left")}else{var f=this.adjustTop(d.top,h)-b;d.left=d.left-this.options.offsetLeft;this._setPosition({left:null,right:window.getWidth()-d.left+(this.options.xoffset||0),top:f});if(this.options.pointArrowToSource&&this.options.arrowHeight){this.setArrowPosition(d,b,a,h,"left",f)}}}catch(g){ta.util.error.record(g,"positionRight: RelativeOverlayHorizontal")}},positionRight:function(){try{this.source=ta.id(this.source);var d=this.source.getCoordinates();var b=this.container.getStyle("margin-top").toInt();var h=this.container.getStyle("margin-bottom").toInt();var a=ta.id("PAGE").getCoordinates();var i=this.container.getCoordinates();if(!this.flipped&&a.right-d.right-(this.cachedWidth||i.width)<0){this.flipped=true;this.options.onRight=false;if(this.arrow){this.arrow.className=this.options.arrowClassRight}this.positionLeft();return}d.right=d.right-this.options.offsetRight;if(ta.isDHTMLCRRedesign2012()&&(this.container.getElement(".check_availability")||this.container.getElement(".username"))){this.positionLeftOrRight(d,b,a,i,"right")}else{var f=this.adjustTop(d.top,i)-b;this.container.setStyles({right:null,left:d.right+(this.options.xoffset||0),top:f});if(this.options.pointArrowToSource&&this.options.arrowHeight){this.setArrowPosition(d,b+h,a,i,"right",f)}}}catch(g){ta.util.error.record(g,"positionRight: RelativeOverlayHorizontal")}},setArrowPosition:function(j,e,h,g,a,d){if(a==="left"){this.arrow.setStyle("left",this.options.arrowLeftForce);var i=(d<j.top?j.top-d:0);var b=Math.max(-1,i+(j.height/2).toInt()-(this.options.arrowHeight/2));var f=g.height-this.options.arrowHeight-e-3;this.arrow.setStyle("top",Math.min(b,f))}else{if((a==="right")&&(this.options.allowRightArrowPos)){if(this.options.arrowTopForce){this.arrow.setStyle("top",this.options.arrowTopForce)}else{if(this.options.arrowRightForce){this.arrow.setStyle("right",this.options.arrowRightForce)}var i=(d<j.top?j.top-d:0);var b=Math.max(-1,i+(j.height/2).toInt()-(this.options.arrowHeight/2));var f=g.height-this.options.arrowHeight-e-3;this.arrow.setStyle("top",Math.min(b,f))}}else{if(a==="right"){ta.util.error.record("setArrowPosition with dir === right is only supported with options.allowRightArrowPos set")}}}},positionLeftOrRight:function(q,l,y,x,r){try{var d=this.container.getElement(".check_availability");var g=this.container.getElement(".username");if(!ta.retrieve("isDaoDao")){var i=this.adjustTop(q.top,x)}else{var i=q.top}var v=d?d:g;var t=v.getCoordinates().height;var m=16;var k=i-t+m/2;var n=false;if(d){var f=window.getScrollTop();var h=ta.id("PERSISTENT_CHECK_RATES");if(h){f+=h.getCoordinates().height}if((i-0.5*x.height)<f){k=f;if((q.bottom-f)>32){k=f}else{if((q.bottom-f)<=32){k=q.bottom-32}}n=true}}var p=d?k:k+5;if(typeof(dhtml_cr_redesign_basic)!="undefined"&&!this.crDHTML_BASIC){this.crDHTML_BASIC=Asset.css(dhtml_cr_redesign_basic,{onLoad:function(){this.position()}.bind(this)})}if(typeof(dhtml_cr_redesign_png24)!="undefined"&&!this.crDHTML_PNG24){this.crDHTML_PNG24=Asset.css(dhtml_cr_redesign_png24,{onLoad:function(){this.position()}.bind(this)})}if(this.crDHTML_BASIC){var b=d?(q.right+13):(q.right-45);if(r=="left"){b=q.left+13}var a=-16}if(this.crDHTML_PNG24){var b=d?(q.right+20):(q.right-45);if(r=="left"){var b=window.getWidth()-q.left+20}var a=d?-21:-24}if(r=="left"){this._setPosition({right:b,left:null,top:p})}else{this._setPosition({right:null,left:b,top:p})}if(this.arrow){this.arrow.setStyle("display","block");var j=d?16:0;if(n){this.arrow.setStyle("top",(q.bottom-p-32))}else{this.arrow.setStyle("top",t-j)}if(r=="left"){this.arrow.setStyle("left",(x.width-13))}else{this.arrow.setStyle("left",a)}try{q=this.source.getCoordinates();x=this.container.getCoordinates();var u=window.getScrollTop()+window.getHeight();var o=q.top-x.top-m/2;var j=d?0:20;if(i+x.height>=u&&o>0){this.arrow.setStyle("top",o+j);if(q.bottom+m/2>=x.bottom){this.container.setStyle("top",p+m*2);this.arrow.setStyle("top",o-m*2+j)}}else{if(o<=0&&!n){this.container.setStyle("top",p-t+m)}}}catch(w){ta.util.error.record(w,"bottomEdge - Reposition arrow and container: RelativeOverlayHorizontal")}}}catch(w){ta.util.error.record(w,"positionLeftOrRight: RelativeOverlayHorizontal")}}});ta.overlays.RelativeOverlayRight=new Class({Extends:ta.overlays.RelativeOverlayHorizontal,initialize:function(a,b){this.parent(Object.merge({onRight:true},a),b)}});ta.overlays.RelativeOverlayLeft=new Class({Extends:ta.overlays.RelativeOverlayHorizontal,initialize:function(a,b){this.parent(Object.merge({onRight:false},a),b)}});ta.overlays.RelativeOverlayVertical=new Class({Extends:ta.overlays.RelativeOverlay,options:{flipPadding:0,allowFlip:true,arrowWidth:0},initialize:function(a,b){if(a.below==null){if(IS_DEBUG){alert("ERROR: Attempting to create Vertical Overlay without specifying direction.")}return}this.parent(a,b)},position:function(){this.options.below?this.positionBelow():this.positionAbove();this.parent()},positionBelow:function(){if(this.options.positionType=="fixed"){var p=this.source.getBoundingClientRect();var f=p.left;var q=p.bottom;if(this.options.positionAsPercent){f=(f/window.innerWidth*100)+"%";q=(q/window.innerHeight*100)+"%"}this._setPosition({left:f,top:q});return}var r=this.options.positionSource?this.options.positionSource.getCoordinates():this.source.getCoordinates();var m=this.container.getCoordinates();var n=this._styleValueToPixel(this.container.getStyle("margin-left"));var j=this._styleValueToPixel(this.container.getStyle("margin-right"));var d=this.container;var b;if(this.options.leftEdge){b=this.options.leftEdge}else{if(this.options.justify=="right"){b=r.left+r.width-m.width}else{b=this.options.centered?r.left+(r.width/2)-(m.width/2):r.left}}var k=window.getHeight()+window.getScrollTop();var i=r.bottom;if(this.options.offsetTop){i-=this.options.offsetTop}if(this.options.scrollContainer){i-=this.options.scrollContainer.scrollTop}if(this.options.allowFlip&&!this.flipped&&k-m.height-i<0&&r.top-m.height>0){this.options.below=false;this.flipped=true;d.addClass("relAbove").removeClass("relBelow");i=r.top-m.height-this.options.flipPadding;if(this.options.scrollContainer){i-=this.options.scrollContainer.scrollTop}}else{d.addClass("relBelow").removeClass("relAbove")}b-=this.options.offsetLeft;var e=this.adjustEdge(b-n,m.width);this._setPosition({left:e,top:i+(this.options.yoffset||0)});if(this.options.pointArrowToSource&&this.options.arrowWidth){var o=(e<r.left?r.left-e:0);var g=(r.width/2).toInt()-(this.options.arrowWidth/2);var h=o+g;var a=m.width-this.options.arrowWidth-n-j;this.arrow.setStyles({right:"",left:Math.min(h,a)})}},_styleValueToPixel:function(a){var b=a&&a.toInt();return !b?0:b},positionAbove:function(){var n=this.options.positionSource?this.options.positionSource.getCoordinates():this.source.getCoordinates();var j=this.container.getCoordinates();var k=this._styleValueToPixel(this.container.getStyle("margin-left"));var i=this._styleValueToPixel(this.container.getStyle("margin-right"));var d=this.container;var b;if(this.options.justify=="right"){b=n.left+n.width-j.width}else{b=this.options.centered?n.left+(n.width/2)-(j.width/2):n.left}var l=window.getScrollTop();var h=n.top-j.height-this.options.flipPadding;if(this.options.offsetTop){h-=this.options.offsetTop}if(this.options.scrollContainer){h-=this.options.scrollContainer.scrollTop}if(this.options.allowFlip&&!this.flipped&&h-l<0){this.options.below=true;this.flipped=true;d.addClass("relBelow").removeClass("relAbove");h=n.bottom;if(this.options.scrollContainer){h-=this.options.scrollContainer.scrollTop}}else{d.addClass("relAbove").removeClass("relBelow")}b-=this.options.offsetLeft;if(this.options.positionByOffsets){this._setPosition({position:this.options.positionType,top:this.options.offsetTop,right:this.options.offsetRight,bottom:this.options.offsetBottom,left:this.options.offsetLeft})}else{var e=this.adjustEdge(b-k,j.width);this._setPosition({left:e,top:h+(this.options.yoffset||0)});if(this.options.pointArrowToSource&&this.options.arrowWidth){var m=(e<n.left?n.left-e:0);var f=(n.width/2).toInt()-(this.options.arrowWidth/2);var g=m+f;var a=j.width-this.options.arrowWidth-k-i;this.arrow.setStyles({right:"",left:Math.min(g,a)})}}},adjustEdge:function(d,c){var a=ta.id("PAGE").getCoordinates();if(d+c>=a.right){var b=this._styleValueToPixel(this.container.getStyle("margin-right"));d=a.right-c-b-1}else{if(d<0){d=0}}return d},hideNow:function(a){this.parent(a);if(this.flipped){this.flipped=false;this.options.below=!this.options.below}}});ta.overlays.RelativeOverlayBelow=new Class({Extends:ta.overlays.RelativeOverlayVertical,initialize:function(a,b){this.parent(Object.merge({below:true},a),b)}});ta.overlays.RelativeOverlayAbove=new Class({Extends:ta.overlays.RelativeOverlayVertical,initialize:function(a,b){this.parent(Object.merge({below:false},a),b)}});ta.overlays.RelativeOverlayIn=(function(a){return new Class({Extends:a.overlays.RelativeOverlay,options:{xOffset:0,yOffset:0,center:false},initialize:function(b,c){this.parent(b,c)},position:function(){if(this.options.center){var d=this.source.getCoordinates();var e=this.container.getCoordinates();this._setPosition({left:d.left+(d.width/2)-(e.width/2)+this.options.xOffset,top:d.top+(d.height/2)-(e.height/2)+this.options.yOffset})}else{var b=this.source.getPosition();this._setPosition({left:b.x+this.options.xOffset,top:b.y+this.options.yOffset})}this.parent()}})}(ta));(function(){var b;function f(h){if(!h){return null}if(h.get("tag")=="a"){return h.href}var g=h.getElement("a");if(g){return g.href}g=h.getElement(".overlaySrc");if(g){return g.get("text")}return null}var e={left:ta.overlays.RelativeOverlayLeft,right:ta.overlays.RelativeOverlayRight,above:ta.overlays.RelativeOverlayAbove,below:ta.overlays.RelativeOverlayBelow};function d(n,q,j,r){if(q||window.event){new Event(q||window.event).preventDefault()}var p=n.hyphenate().split("-"),l=p.indexOf("h")>=0,i=p.indexOf("lb")>=0,g=p.indexOf("remote")>=0,o=p.indexOf("click")>=0,h=Object.merge({showCloseButton:true},r),m=null,k;switch(p.shift()){case"rel":m=e[p.shift().toLowerCase()];if(i){h.pinnable=ta.overlays.PINNABLE_ALWAYS}break;case"center":m=ta.overlays.CenteredOverlay;break}if(m===null){return null}if(l){h.activate=ta.overlays.ACTIVATE_HOVER}else{if(o){h.activate=ta.overlays.ACTIVATE_CLICK}}if(i){h.backdrop=ta.overlays.BACKDROP_ALWAYS}if(g){h.remoteContent=f(j)}k=new m(h,j);if(j){j.store("overlay",k)}return k}b=function(g){var m,q,j,l,n,o,h,k,i,p;m=g||window.event;if(!m){return}if(!m.origin||(0!==m.origin.indexOf("https"))||(-1===m.origin.indexOf("tripadvisor"))){return}if(!m.data||(-1===m.data.indexOf("action"))){return}try{q=JSON.parse(m.data)}catch(m){}j=q.hasOwnProperty("action")?q.action:null;if(!j){return}switch(j){case"successClose":ta.overlays.Factory.closeOverlayRegistration();k=ta.retrieve("overlay_registration_onsuccess");if(k&&"function"===typeof(k)){k();ta.remove("overlay_registration_onsuccess")}break;case"fwdToRegistration":l=q.hasOwnProperty("curUrl")?q.curUrl:null;n=q.hasOwnProperty("partnerKey")?q.partnerKey:null;o=q.hasOwnProperty("urlKey")?q.urlKey:null;h="/Register?product=MASTHEAD&flow=MASTHEAD&action=SIGNIN";if(l&&(0!==l.length)&&n&&(0!==n.length)&&o&&(0!==o.length)){h=h+"&url="+l+"&partnerKey="+n+"&urlKey="+o}window.location=ta.util.URL.https(h);break;case"resizeFrame":i=ta.id("overlayRegFrame");if(i){p=q.hasOwnProperty("height")?q.height:null;if(p){i.style.height=p+"px"}}break;default:return}};function a(){ta.store("member_gating_cta_shown",true)}function c(){return ta.retrieve("member_gating_cta_shown")}ta.overlays.Factory={_magic:d,relRightRemoteHLB:function(g,h){h=ta.id(h);if(h.get("tag")!="div"){h=h.getParent()}var i=f(h);if(i==null){return}new ta.overlays.RelativeOverlayRight({activate:ta.overlays.ACTIVATE_HOVER,pinnable:ta.overlays.PINNABLE_CLICK,backdrop:ta.overlays.BACKDROP_PINNED,style:"commerceOverlay rgba_flyout",showCloseButton:true},h)},relRightRemoteHLB_Commerce:function(i,g){if(i||window.event){new Event(i||window.event).preventDefault()}g=ta.id(g);var h=f(g);if(h==null){return}g.onmouseover=null;new ta.overlays.RelativeOverlayRight({activate:ta.overlays.ACTIVATE_CLICK,pinnable:ta.overlays.PINNABLE_ALWAYS,backdrop:ta.overlays.BACKDROP_ALWAYS,style:"commerceOverlay rgba_flyout",showCloseButton:true},g)},relBelowRemoteHLB_Commerce:function(i,g){g=ta.id(g);if(i||window.event){new Event(i||window.event).preventDefault()}var h=f(g);if(h==null){return}g.onclick=null;new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_CLICK,pinnable:ta.overlays.PINNABLE_ALWAYS,backdrop:ta.overlays.BACKDROP_ALWAYS,style:"commerceOverlay rgba_flyout",showCloseButton:true},g)},relBelowRemoteHLB_CommCopy:function(i,g){g=ta.id(g);if(i||window.event){new Event(i||window.event).preventDefault()}var h=f(g);if(h==null){return}g.onclick=null;new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_CLICK,pinnable:ta.overlays.PINNABLE_ALWAYS,backdrop:ta.overlays.BACKDROP_ALWAYS,style:"commerceOverlay rgba_flyout",showCloseButton:true,onLoad:function(){if(ta.meta&&ta.meta.update){ta.meta.update.updateCRForm("_pop")}else{ta.commerce.checkrates.updateCRForm("_pop")}}},g)},relBelowS4Dg:function(h,g){if(h){h.stop()}g.onclick=null;new ta.overlays.RelativeOverlayBelow({showCloseButton:true,style:"s4 dg",activate:ta.overlays.ACTIVATE_CLICK},g)},relBelowRGBA:function(k,h){if(k){k.stop()}var i="rgba_flyout";var j=true;var g="rgba_arrow";g=g+" rgba_arrow_png24";h.onclick=null;new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_CLICK,style:i,showArrow:j,arrowClass:g,showCloseButton:true},h)},relAboveH_Disclaimer:function(h,g){g=ta.id(g);h.stop();g.onmouseover=null;new ta.overlays.RelativeOverlayAbove({showCloseButton:false,activate:ta.overlays.ACTIVATE_HOVER,pointArrowToSource:true,centered:true,showArrow:true,style:"typeLD",arrowClass:"ldarrow",arrowWidth:15,flipPadding:5,waitForCss:true,fontSize:".7em"},g)},relBelow_Disclaimer:function(h,g){g=ta.id(g);h.stop();g.onclick=null;new ta.overlays.RelativeOverlayBelow({showCloseButton:false,activate:ta.overlays.ACTIVATE_CLICK,pointArrowToSource:true,justify:"right",showArrow:true,style:"typeLD",arrowClass:"ldarrow",arrowWidth:20,yoffset:5,flipPadding:15,waitForCss:true,fontSize:".7em"},g)},relBelow_Disclaimer_left:function(h,g){g=ta.id(g);h.stop();g.onclick=null;new ta.overlays.RelativeOverlayBelow({showCloseButton:false,activate:ta.overlays.ACTIVATE_CLICK,pointArrowToSource:true,justify:"left",showArrow:true,style:"typeLD",arrowClass:"ldarrow",arrowWidth:20,yoffset:5,flipPadding:15,waitForCss:true,fontSize:".7em"},g)},relAboveH_PriceSaverRibbon:function(h,g){g=ta.id(g);h.stop();g.onmouseover=null;new ta.overlays.RelativeOverlayAbove({showCloseButton:false,activate:ta.overlays.ACTIVATE_HOVER,centered:true,showArrow:true,style:"typePS aboveRibbon",arrowClass:"ldarrow",arrowWidth:20,yoffset:5,flipPadding:15,waitForCss:true,fontSize:".7em"},g)},relBelowH_PriceSaverRibbon:function(h,g){g=ta.id(g);h.stop();g.onmouseover=null;new ta.overlays.RelativeOverlayBelow({showCloseButton:false,activate:ta.overlays.ACTIVATE_HOVER,centered:true,style:"typePS belowRibbon",yoffset:5,flipPadding:15,waitForCss:true,fontSize:".7em"},g)},relAboveH_PriceSaver:function(h,g){g=ta.id(g);h.stop();g.onmouseover=null;new ta.overlays.RelativeOverlayAbove({showCloseButton:false,activate:ta.overlays.ACTIVATE_HOVER,centered:true,showArrow:true,style:"typePS",arrowClass:"ldarrow",arrowWidth:20,yoffset:5,flipPadding:15,waitForCss:true,fontSize:".7em"},g)},relRight_SavingsAlert:function(i,h){h=ta.id(h);i.stop();h.onclick=null;var g={showCloseButton:false,activate:ta.overlays.ACTIVATE_CLICK,showArrow:true,arrowClass:"arrow",style:"typeSA",waitForCss:true,fontSize:".7em",allowBelowBottomEdge:true};if(ta.util.i18n.isRtl()){new ta.overlays.RelativeOverlayLeft(g,h)}else{new ta.overlays.RelativeOverlayRight(g,h)}},relRightH_SavingsAlert:function(k,h,j){h=ta.id(h);k.stop();h.onmouseover=null;var i="typeSA";if(j){i+=" ie8"}var g={showCloseButton:false,activate:ta.overlays.ACTIVATE_HOVER,showArrow:true,arrowClass:"arrow",style:i,waitForCss:true,fontSize:".7em",allowBelowBottomEdge:true};if(ta.util.i18n.isRtl()){new ta.overlays.RelativeOverlayLeft(g,h)}else{new ta.overlays.RelativeOverlayRight(g,h)}},relRightH_AddCartInfo:function(i,h){h=ta.id(h);i.stop();h.onmouseover=null;var g={showCloseButton:false,activate:ta.overlays.ACTIVATE_HOVER,showArrow:true,arrowClass:"arrow",style:"typeAC",waitForCss:true,fontSize:".8em",allowBelowBottomEdge:true};if(ta.util.i18n.isRtl()){new ta.overlays.RelativeOverlayLeft(g,h)}else{new ta.overlays.RelativeOverlayRight(g,h)}},relBelow:function(h,g){if(h){h.stop()}g.onclick=null;new ta.overlays.RelativeOverlayBelow({showCloseButton:true,activate:ta.overlays.ACTIVATE_CLICK},g)},relAbove:function(h,g){if(h){h.stop()}g.onclick=null;new ta.overlays.RelativeOverlayAbove({showCloseButton:true,activate:ta.overlays.ACTIVATE_CLICK},g)},relRight:function(h,g){if(h){h.stop()}g.onclick=null;new ta.overlays.RelativeOverlayRight({showCloseButton:true,activate:ta.overlays.ACTIVATE_CLICK},g)},relLeft:function(h,g){if(h){h.stop()}g.onclick=null;new ta.overlays.RelativeOverlayLeft({showCloseButton:true,activate:ta.overlays.ACTIVATE_CLICK},g)},relBelowH_Media:function(h,g){if(h){h.stop()}g.onmouseover=null;new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_HOVER,style:"typeO mediaBox"},g)},relAboveH_Media:function(h,g){if(h){h.stop()}g.onmouseover=null;new ta.overlays.RelativeOverlayAbove({activate:ta.overlays.ACTIVATE_HOVER,style:"typeO mediaBox"},g)},relAboveH:function(h,g){g.onmouseover=null;new ta.overlays.RelativeOverlayAbove({activate:ta.overlays.ACTIVATE_HOVER},g)},relAboveTAMGFooter:function(i,g){g.onmouseover=null;var h=ta.id("PAGE");if(h){new ta.overlays.RelativeOverlayAbove({activate:ta.overlays.ACTIVATE_HOVER,style:"s3 vdg ovrFooter "+g.className},g)}},relRightH:function(h,g){g.onmouseover=null;new ta.overlays.RelativeOverlayRight({activate:ta.overlays.ACTIVATE_HOVER},g)},relLeftH:function(h,g){g.onmouseover=null;new ta.overlays.RelativeOverlayLeft({activate:ta.overlays.ACTIVATE_HOVER},g)},imageLightbox:function(j,g){g.onclick=null;var h="<div><img src="+g.getAttribute("href")+"></div>";var i=new ta.overlays.CenteredOverlay({showCloseButton:true,backdrop:ta.overlays.BACKDROP_ALWAYS}).loadRemoteSuccess(h);g.addEvent("click",i.show)},microMetaOverlay:function(t,j,n,i,q,v,k,u){try{j.onmouseover=null;j.onclick=null;if(t){t.stop()}var g="";if(ta.meta&&ta.meta.update){g=ta.meta.update.buildUrl("MicroMetaAjax",n,true,false,"QC_Meta_Micro|Button")}else{if(typeof(dd)!=="undefined"&&dd.commerce&&dd.commerce.checkrates){g=dd.commerce.checkrates.getMicroMetaUrl(t,n)}else{ta.util.error.record(null,"microMetaOverlay : no meta js");return}}g+="&lowContentID="+i;if(k){g+="&xSellPlacement="+k}var p=j.className.match(/noDelayFirst/);var s=j.className.match(/delayOpen/);var o=ta.retrieve("delayedFirst");var h=!s||(p&&!o);var l="Above Fold Also Viewed";if(ta.id(j).getParent("#prodp13n_single_category_recs_xsell")){l="prodp13n_single_category_recs_xsell"}else{if(ta.id(j).getParent("#similarHotelBetweenReview")){l="prodp13n_between_reviews_cross_sell"}else{if(ta.id(j).getParent("#MMXS_LIST")){l="State Opt Also Viewed"}else{if(ta.id(j).getParent("#HORIZONTAL_CROSS_SELL_LIST")){l="HorizXSell"}else{if(ta.id(j).getParent("#hotel_flyout")){l="Scooter"}else{if(ta.id(j).getParent("#HSCS_ROW")){l="prodp13n_hr_similar_xsell"}else{if(window.mapDivId&&ta.id(j).getParent("#"+window.mapDivId)){l="Maps"}}}}}}}if(l=="Scooter"){g+="&from="+l}var w={activate:(v)?ta.overlays.ACTIVATE_CLICK:ta.overlays.ACTIVATE_HOVER_DELAY,pinnable:(v)?ta.overlays.PINNABLE_CLICK_WITH_DOC_CLOSE:ta.overlays.PINNABLE_CLICK,backdrop:(v)?ta.overlays.BACKDROP_NEVER:ta.overlays.BACKDROP_PINNED,showCloseButton:!v,closeOnDocumentClick:v,positionByOffsets:false,positionType:"absolute",offsetTop:0,offsetRight:"",offsetBottom:"",offsetLeft:155};Object.merge(w,u);var m=new ta.overlays.RelativeOverlayBelow({style:"micro_meta_flyout gray",activate:w.activate,pinnable:w.pinnable,backdrop:w.backdrop,autoShow:h,delayShow:s,showCloseButton:w.showCloseButton,closeOnDocumentClick:w.closeOnDocumentClick,closeButtonClass:"roundOuterClose",onShow:function(){if(ta.util&&ta.util.element){ta.util.element.makeTextFitOneLine(".micro_meta_price_with_fee",true)}if(v){ta.trk("Meta_Micro_Providers_Displayed")}else{ta.trackEventOnPage("Meta_Micro_Providers_Displayed",l,q)}ta.overlays.Factory.logTrackingTree();if(w.onshow){w.onshow()}},onHide:w.onhide,positionByOffsets:w.positionByOffsets,positionType:w.positionType,offsetTop:w.offsetTop,offsetRight:w.offsetRight,offsetBottom:w.offsetBottom,offsetLeft:w.offsetLeft,trigger:j,onLoad:function(){window.fireEvent("MicroMetaHacComplete");if(w.onload){w.onload()}}},j);m.loadRemoteContent(g,false);ta.store("delayedFirst",true)}catch(r){ta.util.error.record(r,"micro meta overlay")}},microMetaExpandedSize:0,microMetaMore:function(l,m,h){try{var i=ta.id("micro_meta_remaining_"+m);if(!i){return}i.removeClass("hidden");function k(){var n=ta.id("micro_meta_more");if(!n){return}n.addClass("invisible")}if(h){k()}else{ta.meta.linkTracking.actionRecord("MICRO_META_EXPAND_MORE");if(i.getSize().y!=ta.overlays.Factory.microMetaExpandedSize){i.addClass("expanding");ta.overlays.Factory.microMetaExpandedSize=i.getSize().y;i.removeClass("expanding")}i.addClass("show");new Fx.Tween(i,{duration:"long",property:"height"}).start(0,ta.overlays.Factory.microMetaExpandedSize);window.setTimeout(k,1000);if(ta.retrieve("ibdm_impression_tracking")){var g=document.getElement(".micro_meta_first_block");if(g&&ta.meta&&ta.meta.treeTrack&&ta.meta.treeTrack.hasTrackingTree(g)){ta.trk("n_more_sites",false,g)}}}}catch(j){ta.util.error.record(j,"Micro meta expand failed.")}},isOverlayCreatedAlready:function(h,g){if(typeof g!="undefined"){var i=h.getElement(".overlaySrc");if(i){i.dispose();return false}else{return true}}return false},relRightRemoteHLB_optionalDelay_showArrow:function(s,q,w,v){try{q=ta.id(q);if(q.get("tag")!="div"){q=q.getParent()}var k=null;if(typeof w!="undefined"){k=w}if(null==k){k=f(q)}if(k==null&&ta.widgets.calendar.hasPageDates()){ta.widgets.calendar.clearCalendarFlyouts();k=f(q)}if(k==null){return}var r=q.getElement(".overlaySrc");var u=k.match(/-d(\d+)\?/);if(u){u=u[1]}if(ta.has("meta.session_dates")||ta.widgets.calendar.hasPageDates()){try{if(!ta.retrieve("date.picker.calendarflyout.allCleared")){ta.widgets.calendar.clearCalendarFlyouts()}if(s&&s.type=="mouseover"&&q){if(!q.hasClass("datedClickAdded")){q.addEvent("click",ta.overlays.Factory.relRightRemoteHLB_optionalDelay_showArrow.bind(this,null,q,k));q.addClass("datedClickAdded")}return}var n=ta.retrieve("scooterObj");if(n){n.slideOut()}if(u){ta.overlays.Factory.metaCheckRatesOverlay_allProviders(u,q)}return}catch(A){ta.util.error.record(A,"meta session dates parse issue")}}if(ta.overlays.Factory.isOverlayCreatedAlready(q,w)){return}var i=q.className.match(/noDelayFirst/),m=q.className.match(/delayOpen/),h=ta.retrieve("delayedFirst"),x=!m||(i&&!h),l="rgba_flyout",o=true,g="rgba_arrow",p="close",j;if(ta.has("hotels.redesignEnabled")&&(pageServlet==="Hotels"||pageServlet==="HACSearch")){l+=" gray";g="rgba_arrow_gray_lft_png24";p="roundOuterClose"}if(ta.has("daodao_noPop_single_cr_button")){l+=" no_cpu"}if(typeof(dhtml_cr_redesign_basic)!="undefined"&&!this.crDHTML_BASIC){this.crDHTML_BASIC=Asset.css(dhtml_cr_redesign_basic)}if(typeof(dhtml_cr_redesign_png24)!="undefined"&&!this.crDHTML_PNG24){this.crDHTML_PNG24=Asset.css(dhtml_cr_redesign_png24)}if(this.crDHTML_PNG24){j=g+" rgba_arrow_png24_right";g=g+" rgba_arrow_png24"}var y=ta.overlays.BACKDROP_PINNED;if(ta.has("daodao_ror_backdrop_type")){y=ta.retrieve("daodao_ror_backdrop_type")}var B=(m?ta.overlays.ACTIVATE_HOVER_DELAY:ta.overlays.ACTIVATE_HOVER);if(ta.retrieve("daodao_show_cr_flyout_only_on_click")){B=ta.overlays.ACTIVATE_CLICK}var t={};if(ta.meta&&ta.meta.update){t=ta.commerce.meta.getMetaParams()}var z=new ta.overlays.RelativeOverlayRight({activate:B,pinnable:ta.overlays.PINNABLE_CLICK,backdrop:y,style:l,showArrow:o,arrowClass:g,arrowClassLeft:g,arrowClassRight:j,closeButtonClass:p,showCloseButton:true,autoShow:x,delayShow:!x,smartCloseButton:ta.isMetaHotels2013(),remoteLink:w,requestData:t,onLoad:function(){if(u&&v){var C=this.inner.getElementById("CHECK_RATE_FLYOUT");if(C){var D=C.get("onclick");C.set("onclick",v+";"+D)}}if(!ta.has("metaDatePickerEnabled")){if(ta.meta&&ta.meta.update){ta.meta.update.updateCRForm("_pop")}else{ta.commerce.checkrates.updateCRForm("_pop")}}},onShow:function(){if(ta.has("metaDatePickerEnabled")){ta.widgets.calendar.syncAllDatePickers()}else{if(ta.meta&&ta.meta.update){ta.meta.update.updateCRForm("_pop")}else{ta.commerce.checkrates.updateCRForm("_pop");ta.commerce.checkrates.checkCRLimitsHelper(z)}}if(ta.retrieve("meta_guests_field_v2.enabled")){ta.commerce.meta.updateAdultsText()}ta.store("ta.hlb_el",q)},onHide:function(){ta.widgets.calendar.closeCalendarWidgets();if(ta.retrieve("meta_guests_field_v2.enabled")){ta.commerce.meta.disableAdultsPicker(this)}ta.store("ta.hlb_el",null)}},q);ta.store("delayedFirst",true);ta.widgets.calendar.trackCalendarFlyout(q,z,r)}catch(A){ta.util.error.record(A,"relRightRemoteHLB_optionalDelay_showArrow: Factory")}},relLeftRemoteHLB_optionalDelay_helper:function(u,i,q,v){try{i=ta.id(i);if(i.get("tag")!="div"){i=i.getParent()}var j=null;if(typeof v!="undefined"){j=v}if(null==j){j=f(i)}if(j==null&&ta.widgets.calendar.hasPageDates()){ta.widgets.calendar.clearCalendarFlyouts();j=f(i)}if(j==null){return}var t=i.getElement(".overlaySrc");var n=j.match(/-d(\d+)\?/);if(n){n=n[1]}if(ta.has("meta.session_dates")||ta.widgets.calendar.hasPageDates()){try{if(!ta.retrieve("date.picker.calendarflyout.allCleared")){ta.widgets.calendar.clearCalendarFlyouts()}if(u&&u.type=="mouseover"){if(!i.hasClass("datedClickAdded")){i.addEvent("click",ta.overlays.Factory.relLeftRemoteHLB_optionalDelay_helper.bind(this,null,i,q,j));i.addClass("datedClickAdded")}return}var h=ta.retrieve("scooterObj");if(h){h.slideOut()}if(n){ta.overlays.Factory.metaCheckRatesOverlay_allProviders(n,i)}return}catch(r){ta.util.error.record(r,"meta session dates parse issue")}}if(ta.overlays.Factory.isOverlayCreatedAlready(i,v)){return}var p=i.className.match(/noDelayFirst/);var s=i.className.match(/delayOpen/);var o=ta.retrieve("delayedFirst");var g=!s||(p&&!o);var l=ta.has("daodao_ror_backdrop_type")?ta.retrieve("daodao_ror_backdrop_type"):ta.overlays.BACKDROP_PINNED;var k=(s?ta.overlays.ACTIVATE_HOVER_DELAY:ta.overlays.ACTIVATE_HOVER);if(ta.retrieve("daodao_show_cr_flyout_only_on_click")){k=ta.overlays.ACTIVATE_CLICK}var m=new ta.overlays.RelativeOverlayLeft({activate:k,pinnable:ta.overlays.PINNABLE_CLICK,backdrop:l,style:"rgba_flyout gray",showArrow:q,arrowClass:"rgba_arrow_gray_rgt_png24",arrowClassLeft:"rgba_arrow_gray_lft_png24",showCloseButton:true,closeButtonClass:"roundOuterClose",autoShow:g,delayShow:!g,smartCloseButton:ta.isMetaHotels2013(),remoteLink:v,onLoad:function(){if(!ta.has("metaDatePickerEnabled")){if(ta.meta&&ta.meta.update){ta.meta.update.updateCRForm("_pop")}else{ta.commerce.checkrates.updateCRForm("_pop")}}},onShow:function(){ta.store("overlay.lastElmt.className",i.className);if(ta.has("metaDatePickerEnabled")){ta.widgets.calendar.syncAllDatePickers()}else{if(ta.meta&&ta.meta.update){ta.meta.update.updateCRForm("_pop")}else{ta.commerce.checkrates.updateCRForm("_pop");ta.commerce.checkrates.checkCRLimitsHelper(m)}}if(ta.retrieve("meta_guests_field_v2.enabled")){ta.commerce.meta.updateAdultsText()}},onHide:function(){ta.widgets.calendar.closeCalendarWidgets();if(ta.retrieve("meta_guests_field_v2.enabled")){ta.commerce.meta.disableAdultsPicker(this)}}},i);ta.store("delayedFirst",true);ta.widgets.calendar.trackCalendarFlyout(i,m,t)}catch(r){ta.util.error.record(r,"relLeftRemoteHLB_optionalDelay_showArrow: Factory")}},relLeftRemoteHLB_optionalDelay_showArrow:function(h,i,g){ta.overlays.Factory.relLeftRemoteHLB_optionalDelay_helper(h,i,true,g)},hotelsMapCROverlay:function(h,i,g){ta.overlays.Factory.relLeftRemoteHLB_optionalDelay_helper(h,i,false,g)},fbFriendOverlay:function(g){g.onclick=null;new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_CLICK,showCloseButton:true,style:"s2 mg"},g)},albumsLB:function(t,r,w,y,s,E,D,F,o,g,p){if(t||window.event){new Event(t||window.event).preventDefault()}if(ta.has("oyster_location_data")){ta.trackEventOnPage("OysterPhotoImpact","lightboxWouldHaveOysterPhotos",ta.retrieve("oyster_location_data").hasOyster[w])}r=ta.id(r);var q=ta.util.sessionStorage.canUseSessionStore();try{var i="";var n="/LocationPhotoAlbum?";if(!y||!w){ta.util.error.record(null,"LocationPhotoAlbum request missing arguments",null,{geoId:y,locId:w});return}var u={detail:w,geo:y};if(F){u.showProPhotos=true}if(typeof o!=="undefined"){u.defaultToOysterTab=o}if(s){u.filter=s}if(E){u.ff=E;u.albumid=101;u.albumViewMode="hero";u.albumPartialsToUpdate="full";u.thumbnailMinWidth=50;u.cnt=30;u.offset=-5;u.baseMediaId=E;u.extraAlbumCoverCount=2}if(D){u.albumid=D;u.albumViewMode="images";u.albumPartialsToUpdate="full";u.extraAlbumCoverCount=4}if(p){u.lbShowRac=true}i="QC_Meta_Mini|Photo_Lightbox";u.area=i;if(ta.meta&&ta.meta.update&&window.pageServlet){Object.merge(u,ta.commerce.meta.getMetaParams())}n=n+Object.toQueryString(u);var x=n;try{n=ta.commerce.meta.tracking.updateUrlWithTiming(n,i)}catch(B){ta.util.error.record(B,"problem updating url with timing in Factory.photosLB");n=x}function m(){if(ta.photos.albumViewer){ta.photos.albumViewer.onResize(z)}if(g&&g.onResize){g.onResize()}}function h(){ta.store("photo.viewer.albumsLB",z);ta.photos.albumViewer.onResize(z);ta.photos.albumViewer.init(y,w,ta.retrieve("album.mediaId"),ta.retrieve("album.tracking"),ta.retrieve("album.view"),ta.retrieve("album.showTabCat"),ta.retrieve("album.showProPhotos"));ta.photos.albumViewer.tracking.recordImpressionIfDmo();if(q){window.sessionStorage.isAlbumViewerLbOpen=true}this.position();window.addEvent("resize",m);if(ta.isTabletAlbumViewer()&&ta.photos&&ta.photos.albumViewer){window.addEvent("orientationchange",ta.photos.albumViewer.onOrientationChange)}m();if(ta.photos.albumViewer){ta.photos.albumViewer.resetNumHeroPhotosClicked()}var H=ta.id("meta_on_photo_viewer");if(H){window.fireEvent("photoLightBoxLoad",H)}ta.store("locationPhotoAlbumOverlayResizeHack",function(){var M=document.getElement(".overlay.metaCheckRatesOverlay");if(!M){return}var I=document.getElement(".overlay.metaCheckRatesOverlay #overlayInnerDiv");var J=parseInt(M.getStyle("top").replace("px",""),10)-window.getScrollTop();var L=window.getSize().y;var K=L-(J+90);if(!I){return}I.setStyle("overflow","auto");I.setStyle("max-height",K+"px")});if(this.inner){setTimeout(ta.fireEvent.bind(this,"refreshedDOMContent",this.inner),50)}if(g&&g.onLoad){g.onLoad()}var G=ta.retrieve("oyster_location_data");if(G&&G.hasOyster&&G.hasOyster[w]){ta.run("ta.photos.oysterTracking.trackCandidateSession",null,null,null,"LB_OPEN")}else{if(!G||!G.hasOyster||!(w in G.hasOyster)){ta.util.error.record(null,"no oyster data for this location",null,{locationId:w},"WARN")}}}var A="";function v(){if(ta.retrieve("checkrates.meta_ui_post_click_prices")&&ta.retrieve("meta.baseLocationId")){ta.commerce.meta.updateProvAreaFromLightBox(ta.retrieve("meta.baseLocationId"))}if(q){window.sessionStorage.isAlbumViewerLbOpen=true}if(g&&g.onShow){g.onShow()}if(ta.isTabletAlbumViewer()){document.body.addClass("stop-scrolling");if(ta.retrieve("tabletRacOnPhotoViewer")){ta.remove("RASCalendar");if(ta.restaurantAvailabilitySearch){A=ta.restaurantAvailabilitySearch.getContainerSelector()}}}}function l(){if(ta.isTabletAlbumViewer()){document.body.removeClass("stop-scrolling")}var G=ta.retrieve("metaCheckRatesOverlay");if(G){G.hide();ta.remove("metaCheckRatesOverlay")}z.hide();if(q){window.sessionStorage.removeItem("isAlbumViewerLbOpen")}ta.photos.albumViewer.tracking.recordTimeInLB();ta.photos.albumViewer.saveVisitedAlbumsToSession();ta.meta.linkTracking.restoreCRPageServlet();document.removeEvent("keydown",ta.remove("photo.viewer.keydownListener"));if(ta.retrieve("photo.viewer.refreshOnClose")){window.location=window.location}if(ta.has("translationOverlay")){ta.retrieve("translationOverlay").hide()}if(ta.retrieve("hotels.redesignEnabled")&&ta.retrieve("hotels.datesChanged")&&ta.isMetaHotelsRequest&&ta.isMetaHotelsRequest()){ta.commerce.minimeta.doMetaDateSearch();ta.remove("hotels.datesChanged")}else{if(ta.retrieve("hotels.redesignEnabled")&&ta.retrieve("hotels.datesChanged")){ta.commerce.minimeta.ajax.resetAjaxCall();ta.commerce.minimeta.ajax.send(false,true);ta.remove("hotels.datesChanged")}}ta.widgets.calendar.closeCalendarWidgets();window.removeEvent("resize",m);if(ta.isTabletAlbumViewer()){if(ta.photos&&ta.photos.albumViewer){window.removeEvent("orientationchange",ta.photos.albumViewer.onOrientationChange)}if(ta.retrieve("tabletRacOnPhotoViewer")){ta.remove("RASCalendar");if(ta.restaurantAvailabilitySearch){ta.restaurantAvailabilitySearch.setContainerSelector(A)}}}ta.remove("locationPhotoAlbumOverlayResizeHack");if(g&&g.onHide){g.onHide()}if(ta.isTabletAlbumViewerCTA()&&ta.photos.tabletAlbumViewer){ta.photos.tabletAlbumViewer.removeAlbumViewerCTAEvents()}window.fireEvent("photoLightBoxHidden")}function k(){if(g&&g.onClose){g.onClose()}ta.remove("meta.requestFromArea");document.removeEvent("keyup",ta.retrieve("photo.viewer.albumsLB.keyupPhotoChangeHandle"));ta.overlays.Factory.albumsLBHandleHashLocation();if(ta.retrieve("tabletAlbumPhotolbSwiping.enabled")){window.removeEvent("orientationchange",ta.photos.tabletAlbumViewer.updateHiddenHeroPhotos)}}var z;ta.overlays.Factory._albumsLBLoadAssets();var C=1;function j(){if(C>16){C=1;try{(function(){z.hide()}).delay(2000,this)}catch(I){}}else{if(!ta.retrieve("album.viewer_extended.jsAssetsLoaded")){C++;j.delay(500)}else{var H=ta.isTabletAlbumViewer()?0:20;var G={backdrop:ta.overlays.BACKDROP_ALWAYS,style:"s3 dg albumLightbox",backdropClickClose:true,noScrollY:false,innerDivClass:"inner",content:'<div class="js_footerPocket"></div>',onLoad:h,onShow:v,onHide:l,backdropOpacity:0.6,permanent:true,onClose:k,requestData:{heroMinWidth:window.getSize().x-H*2,heroMinHeight:window.getSize().y-H*2}};z=new ta.overlays.FooterPocketWithInsertOverlay(G,null,H);z.loadRemoteContent(n);ta.commerce.meta.tracking.resetTimingLockForNavArea(i);C=1}}}j()}catch(B){ta.util.error.record(B,"photo gallery overlay",null,{photoUrl:n});ta.commerce.meta.tracking.resetTimingLockForNavArea(i)}return false},addAlbumsLBHashHandler:function(){if(this._isHistorySupported()&&!ta.isTabletAlbumViewer()){var g={state:true};history.pushState(g,"title","#photos");window.onpopstate=function(){ta.overlays.Factory.albumsLBHandleHashLocation()}}},albumsLBHandleHashLocation:function(){if(this._isHistorySupported()&&!ta.isTabletAlbumViewer()){var h=ta.retrieve("photo.viewer.albumsLB");var g=ta.retrieve("albumsLBAutoOpen");ta.store("albumsLBAutoOpen",false);if(window.sessionStorage.isAlbumViewerLbOpen&&window.location.hash=="#photos"&&h&&!g){window.history.back()}else{if(window.sessionStorage.isAlbumViewerLbOpen&&window.location.hash==""&&h){h.hide()}}}},_isHistorySupported:function(){return !!(window.history&&window.history.pushState)},photosLB:function(g,k){try{if(g||window.event){new Event(g||window.event).preventDefault()}k=ta.id(k);if(k.get("tag")!="a"){if(k.hasClass("fkASDF")&&(k.get("tag")=="span"||k.get("tag")=="div"||k.get("tag")=="li")){k=ta.id(k)}else{k=k.getParent("a")}}var j="";if(k.className){j=k.className.match(/u_([^ ]*)/)[1]}else{if(k.href.match(/\/?LocationPhoto.*/)){j=k.href}}ta.overlays.Factory._mediaLBLoadAssets();var h="QC_Meta_Mini";if(ta.has("photo.viewer.jsAssetsLoaded")){j=j.replace(/\/LocationPhotos\-/,"/LocationPhotosLightbox-");j=j.replace(/\/LocationPhotoDirectLink\-/,"/LocationPhotosLightbox-");j=j.replace(/\#/,"?ff=");if(screen.availHeight<768||screen.availWidth<1024){if(j.match(/\?/)){j=j+"&small=true"}else{j=j+"?small=true"}}j=j+"&area="+h;var l=j;try{j=ta.commerce.meta.tracking.updateUrlWithTiming(j,h)}catch(m){ta.util.error.record(m,"problem updating url with timing in Factory.photosLB");j=l}if(ta.meta&&ta.meta.update&&window.pageServlet){j=j+"&metaReferer="+window.pageServlet}var i=ta.overlays.Factory._mediaLBCreateOverlay(ta.overlays.Factory.photoLBHelper,k);i.loadRemoteContent(j);ta.store("photo.viewer.lightbox",i);ta.commerce.meta.tracking.resetTimingLockForNavArea(h)}else{ta.util.error.record(null,"photo gallery - no assets to load");ta.overlays.Factory.viewerFallback.delay(2000,this,[null,k])}}catch(m){ta.util.error.record(m,"photo gallery overlay",null,{photoUrl:j});ta.commerce.meta.tracking.resetTimingLockForNavArea(h)}return false},viewerFallback:function(h){var g=ta.remove("photo.viewer.lightbox");if(g){g.hide()}if(h&&h.href&&h.href.match(/LocationPhotos/)){window.location=h.href}else{return ta.servlet.Popup.photoGallery(null,h)}},photoLBCounter:1,photoLBHelper:function(h){var g=ta.retrieve("photo.viewer.initData");if(ta.overlays.Factory.photoLBCounter>16){ta.overlays.Factory.photoLBCounter=1;try{ta.overlays.Factory.viewerFallback.delay(2000,this,h)}catch(i){}return}if(!g||!ta.photos.viewer){ta.overlays.Factory.photoLBCounter++;ta.overlays.Factory.photoLBHelper.delay(500)}else{ta.overlays.Factory.photoLBCounter=1;if(ta.retrieve("ta.photos.viewer.initializeOnSecondTab")){ta.store("photo.viewer.secondaryView",true);ta.photos.viewer.photoViewerInit(ta.retrieve("photo.viewer.secondaryViewer.data"))}else{ta.photos.viewer.photoViewerInit(g)}}},mediaLBAutoOpen:function(h){try{ta.overlays.Factory._mediaLBLoadAssets();if(!ta.has("photo.viewer.jsAssetsLoaded")){ta.util.error.record(null,"auto-open media lightbox - no assets to load")}else{h=h.replace(/\/LocationPhotos\-/,"/LocationPhotosLightbox-");h=h.replace(/\/LocationPhotoDirectLink\-/,"/LocationPhotosLightbox-");h=h.replace(/\#/,"?ff=");if(screen.availHeight<768||screen.availWidth<1024){if(h.match(/\?/)){h=h+"&small=true"}else{h=h+"?small=true"}}var g=ta.overlays.Factory._mediaLBCreateOverlay(ta.overlays.Factory.mediaLBAutoOpenHelper,h);g.loadRemoteContent(h);ta.store("photo.viewer.lightbox",g)}}catch(i){ta.util.error.record(i,"ta.overlays.factory.autoOpenMediaLB failed",null,{photoUrl:h})}return false},mediaLBAutoOpenHelper:function(i){var g=ta.retrieve("photo.viewer.initData");var h=16;if(ta.overlays.Factory.photoLBCounter>h){ta.overlays.Factory.photoLBCounter=1;ta.util.error.record(null,"ta.overlays.factory.autoOpenMediaLBHelper is giving up after "+h+" attempts.",null,{photoUrl:i});return}if(!g||!ta.photos.viewer){ta.overlays.Factory.photoLBCounter++;ta.overlays.Factory.mediaLBAutoOpenHelper.delay(500,this,i)}else{ta.overlays.Factory.photoLBCounter=1;ta.photos.viewer.photoViewerInit(g)}},_mediaLBLoadAssets:function(){if(!ta.has("photo.viewer.jsAssetsLoaded")&&typeof cssPhotoViewerAsset!="undefined"&&typeof jsPhotoViewerAsset!="undefined"){ta.store("photo.viewer.jsAssetsLoaded",true);Asset.css(cssPhotoViewerAsset,{media:"screen, print"});if(!ta.photos.viewer){Asset.javascript(jsPhotoViewerAsset)}if(typeof TALSO=="undefined"){Asset.javascript(jsPhotoViewerTALSOAsset)}if(typeof jsPhotosAsset!="undefined"&&!ta.servlet.Photos){Asset.javascript(jsPhotosAsset)}if(!ta.media.JWPlayer){Asset.javascript(jsJWPlayerHelperAsset)}}},_albumsLBLoadAssets:function(){if(!ta.has("album.viewer_extended.jsAssetsLoaded")){if(!ta.has("album.viewer.cssAssetsLoaded")&&window.cssAlbumViewerAsset){Asset.css(cssAlbumViewerAsset,{media:"screen, print"});if(ta.isTabletAlbumViewer()&&getCssAlbumPhotoLBIconAsset){var g=getCssAlbumPhotoLBIconAsset();if(g){Asset.css(g,{media:"screen, print"})}}ta.store("album.viewer.cssAssetsLoaded",true)}if(typeof cssAlbumViewerAssetHotels!="undefined"){Asset.css(cssAlbumViewerAssetHotels,{media:"screen, print"})}if(typeof jsAlbumViewerExtendedAsset!="undefined"&&!ta.retrieve("album.viewer_extended.jsAssetsLoaded")){Asset.javascript(jsAlbumViewerExtendedAsset,{onLoad:function(){ta.store("album.viewer_extended.jsAssetsLoaded",true)}})}}},_mediaLBCreateOverlay:function(h,j){var i={backdrop:ta.overlays.BACKDROP_ALWAYS,style:"s3 dg",backdropClickClose:true,onLoad:function(){this.position();if(h){h(j)}},onHide:function(){var k=ta.remove("photo.viewer.lightbox");if(k){k.hide()}ta.meta.linkTracking.restoreCRPageServlet();document.removeEvent("keydown",ta.remove("photo.viewer.keydownListener"));if(ta.retrieve("photo.viewer.refreshOnClose")){window.location=window.location}if(ta.has("translationOverlay")){ta.retrieve("translationOverlay").hide()}if(ta.retrieve("hotels.datesChanged")&&(ta.has("meta.mini_meta_on_accommodations")||(ta.retrieve("hotels.redesignEnabled")&&ta.isMetaHotelsRequest&&ta.isMetaHotelsRequest()))){ta.commerce.minimeta.doMetaDateSearch();ta.remove("hotels.datesChanged")}else{if(ta.retrieve("hotels.redesignEnabled")&&ta.retrieve("hotels.datesChanged")){ta.commerce.minimeta.ajax.resetAjaxCall();ta.commerce.minimeta.ajax.send(false,true);ta.remove("hotels.datesChanged")}}ta.widgets.calendar.closeCalendarWidgets()},permanent:true};if(ta.retrieve("checkrates.meta_ui_post_click_prices")){i.onShow=function(){var k=ta.retrieve("meta.baseLocationId");if(k){ta.commerce.meta.updateProvAreaFromLightBox(k)}}}var g=new ta.overlays.CenteredOverlay(i);return g},AccDetail:function(m,j,g){if(m){m.stop()}j=j.getParent();var l=location.pathname;if(l.length>0){if(l.charAt(0)=="/"){l=l.substring(1)}var k=l.indexOf("-");if(k>=0){l=l.substring(0,k)}}var i=g;var h=function(){var n=ta.id("overlay_description").get("text");if(n.length>1000){ta.id("overlay_description").setStyle("height",210)}};if(memoverlayCSS&&!ta.retrieve("ta.memoverlayCSS")){ta.store("ta.memoverlayCSS",new Asset.css(memoverlayCSS))}new ta.overlays.CoverOverlay({yOff:35,onLoad:h,style:"s3 dg rgba_gry",activate:ta.overlays.ACTIVATE_HOVER_DELAY,pinnable:ta.overlays.PINNABLE_CLICK,showCloseButton:true,delayShow:true,requestData:{d:i,tab:"descript",from:l},remoteContent:"/LocationTab"},j);return false},memberOverlay:function(i,h,g){ta.overlays.Factory.memberOverlayWOffset(i,h,g,0,0);return false},memberOverlayWOffset:function(w,k,u,s,t){if(w){w.stop()}k.onclick=null;k.onmouseover=null;var r="";var g="";var o="";var p=false;var j=false;var h=true;var q="rgba_arrow_png24";if(k.id&&k.id!=""){var m=k.id.split("-");for(var n=0;n<m.length;n++){var l=m[n];if(l.match(/\bUID_([0-9A-F]+)\b/)){r=RegExp.$1}else{if(l.match(/\bSRC_(\d+)\b/)){g=RegExp.$1}else{if(l.match(/\bCATID_(\d+)\b/)){o=RegExp.$1}else{if(l.match("FUS")){p=true}else{if(l.match("PATT")){j=true}}}}}}}else{ta.util.error.record(null,"memberOverlay - elmt.id check",null,{passedElement:ta.util.error.getSelectorString(k)})}var v="";if(typeof(footprintGet)!="undefined"){v=footprintGet()}if(memoverlayCSS&&!ta.retrieve("ta.memoverlayCSS")){ta.store("ta.memoverlayCSS",new Asset.css(memoverlayCSS))}new ta.overlays.RelativeOverlayRight({style:u||"typeO",activate:ta.overlays.ACTIVATE_HOVER_DELAY,pinnable:ta.overlays.PINNABLE_CLICK,showArrow:h,arrowClass:q,showCloseButton:true,autoShow:false,delayShow:true,offsetRight:t,offsetTop:s,remoteContent:"/MemberOverlay?uid="+r+"&c="+o+"&src="+g+"&fus="+p+"&partner="+j+"&LsoId="+v},k);return false},memberOverlayBelow:function(w,k,u,s,t){if(w){w.stop()}k.onclick=null;k.onmouseover=null;var r="";var g="";var o="";var p=false;var j=false;var h=true;var q="rgba_arrow_up_png24";if(k.id&&k.id!=""){var m=k.id.split("-");for(var n=0;n<m.length;n++){var l=m[n];if(l.match(/\bUID_([0-9A-F]+)\b/)){r=RegExp.$1}else{if(l.match(/\bSRC_(\d+)\b/)){g=RegExp.$1}else{if(l.match(/\bCATID_(\d+)\b/)){o=RegExp.$1}else{if(l.match("FUS")){p=true}else{if(l.match("PATT")){j=true}}}}}}}else{ta.util.error.record(null,"memberOverlay - elmt.id check",null,{passedElement:ta.util.error.getSelectorString(k)})}var v="";if(typeof(footprintGet)!="undefined"){v=footprintGet()}if(memoverlayCSS&&!ta.retrieve("ta.memoverlayCSS")){ta.store("ta.memoverlayCSS",new Asset.css(memoverlayCSS))}new ta.overlays.RelativeOverlayBelow({style:u||"typeO",activate:ta.overlays.ACTIVATE_HOVER_DELAY,pinnable:ta.overlays.PINNABLE_CLICK,showArrow:h,arrowClass:q,allowFlip:false,showCloseButton:true,autoShow:false,delayShow:true,offsetRight:t,offsetTop:s,remoteContent:"/MemberOverlay?uid="+r+"&c="+o+"&src="+g+"&fus="+p+"&partner="+j+"&LsoId="+v},k);return false},dropdownMiniMetaOverlayHotel:function(g,i,o,k){var n="hotel_"+k;var j=ta.id(n);if(j){var l=j.getElement(".chevron");if(l){i=l}var m=j.getElement(".dropdownMiniMeta");if(m){m=m.clone();m.set("class","dropdownMiniMeta");var h={offsetLeft:260,trigger:i};if(ta.util.i18n.isRtl()){h={offsetLeft:4}}ta.store("meta.dropdownHotelsActive",n);ta.overlays.Factory.dropdownMiniMetaOverlay(g,i,o,m,h)}}},dropdownMiniMetaOverlayHotelReview:function(h,g,l,k){var m=document.getElement(".skv3 .dropdownMiniMeta");if(!m){m=document.getElement(".dropdownMiniMeta")}if(!m){ta.trackEventOnPage("LP_Chevron_Dropdown_No_Data","0");var j=document.getElement(".LowestPrice.minOffer");if(j){j.click();return false}}m=m.clone();m.set("class","dropdownMiniMeta");if(!k){k=22}var i={offsetLeft:k};ta.overlays.Factory.dropdownMiniMetaOverlay(h,g,l,m,i)},dropdownMiniMetaOverlay:function(h,g,j,k,i){if(dropdownMetaCSS&&!ta.retrieve("ta.dropdownMetaCSS")){ta.store("ta.dropdownMetaCSS",new Asset.css(dropdownMetaCSS))}if(h){h.stop()}if(k){ta.overlays.Factory.createDropdownMiniMetaOverlay(h,g,j,k,i);ta.store("pcr.disabled",true);return true}return false},loadDropdownCSS:function(){if(window.dropdownMetaCSS&&!ta.retrieve("ta.dropdownMetaCSS")){ta.store("ta.dropdownMetaCSS",new Asset.css(dropdownMetaCSS))}},createDropdownMiniMetaOverlay:function(g,k,o,n,i){var h="rgba_flyout gray dropdownMiniMeta";var m=true;var j=-5;switch(ta.commerce.meta.getNavAreaContextFromDom(k)){case"PCR":m=false;h+=" pcrLightBox";j=-45;break;case"Photo_Lightbox":m=false;h+=" photoAmenitiesLightBox";break;case"Amenities_Lightbox":m=false;break;default:h+=" miniMetaLightBox"}var l=0;if(i){if(i.offsetLeft){l=i.offsetLeft}if(i.offsetTop){j=i.offsetTop}}new ta.overlays.RelativeOverlayBelow(Object.merge(i,{style:h,activate:ta.overlays.ACTIVATE_CLICK,pinnable:ta.overlays.PINNABLE_CLICK,showArrow:m,showCloseButton:o,closeButtonClass:"roundOuterClose",arrowClass:"rgba_gray_arrow_up",offsetTop:j,offsetLeft:l,allowFlip:false,closeOnDocumentClick:true,content:n}),k)},createFacebookCTACallout:function(n,h,m,l,j,i){try{h.removePropertyEvent("mouseover","ta.overlays.Factory.createFacebookCTACallout")}catch(k){h.onmouseover=function(){}}var o=(Browser.ie7||Browser.ie8)?" ie78":"";var g={activate:ta.overlays.ACTIVATE_HOVER_DELAY,style:"s4 dg rgba_gry update2012 facebookCTAFlyout"+o,showArrow:true,centered:true,pointArrowToSource:true,showCloseButton:false,delayShow:true,innerDivClass:"inner",hoverDelayTime:0,noPadding:true,content:"<div class='onsite_cta_overlay_content'><b>"+m+"</b><br />"+j+"<br /><br /><b>"+l+"</b><br />"+i+"</div>"};new ta.overlays.RelativeOverlayBelow(g,h)},tcNavDetailOverlay:function(i,h,g){if(i){i.stop()}new ta.overlays.RelativeOverlayBelow({style:g||"typeO",activate:ta.overlays.ACTIVATE_CLICK,pinnable:ta.overlays.PINNABLE_NEVER,showArrow:true,arrowClass:"rgba_arrow_png24",showCloseButton:true,content:ta.id("INLINE_NAV_DETAIL").innerHTML},h);return false},amexHotSpotOverlay:function(l,k,g,h,j){if(l){l.stop()}var i;if(ta.has(j)){i=ta.retrieve(j);i.inner.setContent(ta.id(h).innerHTML);i.show()}else{i=new ta.overlays.RelativeOverlayBelow({style:g,activate:ta.overlays.ACTIVATE_CLICK,pinnable:ta.overlays.PINNABLE_NEVER,showArrow:true,arrowClass:"rgba_arrow_png24",showCloseButton:false,content:ta.id(h).innerHTML},k);ta.store(j,i)}return false},amexSettingsOverlay:function(n,l,g,h,j,k,m){if(n){n.stop()}var i;if(ta.has(j)){i=ta.retrieve(j);i.inner.setContent(ta.id(h).innerHTML);i.show()}else{i=new ta.overlays.RelativeOverlayBelow({style:g,activate:ta.overlays.ACTIVATE_CLICK,pinnable:ta.overlays.PINNABLE_NEVER,showArrow:true,arrowClass:"rgba_arrow_png24",showCloseButton:false,content:ta.id(h).innerHTML,offsetLeft:k,offsetTop:m,allowFlip:false},l);ta.store(j,i)}return false},menuBLimps:function(h,g){var l=$(h);if(l){if(!l.getAttribute("blimped")){var k=l.getChildren();if(k){for(var j=0;j<k.length;j++){var m=k[j].getAttribute("data-imp");if(m){ta.t4b.bl_imp_tracking.queueImpression(m,g)}}ta.t4b.bl_imp_tracking.flushImpressions();l.setAttribute("blimped",true)}}}},mcNavOverlay:function(o,h,n,m,g,p,k,j,l){var i;if(o){o.stop()}if(ta.has(g)){i=ta.retrieve(g);i.inner.setContent(ta.id(m).innerHTML);i.show()}else{if(!(ta.util.i18n.isRtl()^j)){i=new ta.overlays.RelativeOverlayLeft({style:n,activate:ta.overlays.ACTIVATE_BOTH,pinnable:ta.overlays.PINNABLE_NEVER,showArrow:true,arrowClass:"rgba_arrow_png24",showCloseButton:false,hoverDelayTime:250,content:ta.id(m).innerHTML,offsetLeft:-p,offsetTop:k,allowFlip:false,showFunction:function(){ta.overlays.Factory.menuBLimps(m,l)}},h);ta.store(g,i)}else{i=new ta.overlays.RelativeOverlayRight({style:n,activate:ta.overlays.ACTIVATE_BOTH,pinnable:ta.overlays.PINNABLE_NEVER,showArrow:true,arrowClass:"rgba_arrow_png24",showCloseButton:false,hoverDelayTime:250,content:ta.id(m).innerHTML,offsetRight:p,offsetTop:k,allowFlip:false,showFunction:function(){ta.overlays.Factory.menuBLimps(m,l)}},h);ta.store(g,i)}}return false},createPairedCalendar:function(i,h,g){return ta.overlays.createPairedCalendar(i,h,g)},createPairedCalendarGeo:function(){},_injectAd:function(g){if(ta.has("ads.gptEnabled")){return}var h=ta.id(g);try{if(h){injectAdsTargeted(h)}}catch(i){ta.util.error.record(i,"AlsoViewedLB: error injecting ad into elemId="+g)}},createDatedPairedCalendar:function(j,h,g){if(!g){g={}}if(j){new Event(j).preventDefault()}h=ta.id(h);var i=h.getParent("form");g.validate=true;g.overlayOptions={onShow:function(){ta.overlays.toggleOffSearchAll(i)}};new ta.overlays.PairedCalendar(h,g);ta.overlays.toggleOffSearchAll(i)},recordVRCrossSell:function(){try{var h=ta.id("VR_CROSS_SELL");if(h){var g=h.innerHTML.indexOf("setPID");var j=h.innerHTML.substr(g+7,5);new Request({url:"/ActionRecord?action=VR_CROSS_SELL_"+j}).send()}}catch(i){ta.util.error.record(i,"VR Cross Sell - ActionRecord failed")}},launchAVLBCompleteFn:function(h){ta.overlays.Factory._loadAVCSS();var g=function(){ta.overlays.Factory._injectAd("ALSO_VIEWED_AD")};var i=function(l){var j="alsoViewedTest avStandalone";if(ta.has("ta.avlb_hero_photos")){j="avlb_hero_photos"}var k;k=new ta.overlays.CenteredOverlay({backdrop:ta.overlays.BACKDROP_ALWAYS,style:j,onShow:g.delay(100),onLoad:ta.overlays.Factory.recordVRCrossSell}).loadRemoteSuccess(l);var n=false;if(k.inner){var m=ta.id("emptyAlsoViewed");if(m){n=true}else{ta.store("alsoViewedLB",true)}}else{n=true}if(n){k.hide();ta.store("commerce.pwrOverlay",k)}if(ta.meta&&ta.meta.cr){ta.meta.cr.removePCR()}else{ta.commerce.checkrates.removePCR()}};new Request({url:h,onSuccess:i,evalScripts:true}).send()},_loadAVCSS:function(){if(typeof(avlbCss)!="undefined"&&!ta.retrieve("ta.avlbCss")){ta.store("ta.avlbCss",Asset.css(avlbCss))}if(typeof(avlbTestCss)!="undefined"&&!ta.retrieve("ta.avlbTestCss")){ta.store("ta.avlbTestCss",Asset.css(avlbTestCss))}if(typeof(VRCrossSellCss)!="undefined"&&!ta.retrieve("ta.VRCrossSellCss")){ta.store("ta.VRCrossSellCss",Asset.css(VRCrossSellCss))}if(typeof(avlb_hero_photos)!="undefined"&&!ta.retrieve("ta.avlb_hero_photos")){ta.store("ta.avlb_hero_photos",Asset.css(avlb_hero_photos))}},_loadChkMoreCSS:function(){ta.overlays.Factory._loadAVCSS();if(typeof(chkMoreCss)!="undefined"&&!ta.retrieve("ta.chkMoreCss")){ta.store("ta.chkMoreCss",Asset.css(chkMoreCss))}if(typeof(chkMoreSpritesCss)!="undefined"&&!ta.retrieve("ta.chkMoreSpriteCss")){ta.store("ta.chkMoreSpriteCss",Asset.css(chkMoreSpritesCss))}},loadGeoCrAutoBroadenOverlay:function(g,j){var i=ta.retrieve("gcrab.cssPath");if(i&&!ta.retrieve("gcrab.css")){ta.store("gcrab.css",Asset.css(i))}var h=new ta.overlays.CenteredOverlay({permanent:true,style:"gcrabLb",noPadding:true,absoluteOffset:true,yOffset:(Math.max(20,window.getHeight()-540)/2)+window.getScrollTop(),xOffset:Math.max(5,window.getWidth()-965)/2,backdrop:ta.overlays.BACKDROP_ALWAYS,closeButtonClass:"roundOuterClose",content:'<div style="background-color:#EEE;"><img style="padding:150px;display:block;width:79px;margin:auto;" src="'+ta.util.imageServer("/img2/meta_sprites/loadingAnim.gif")+'"></div>',onClose:function(){ta.trackEventOnPage("MetaGeoLightBox","unload","CloseButton",0,false)}},g);ta.commerce.meta.loadGeoCrAutoBroadenContents(h,j)},loadCheckRatesLBOverlay:function(s,i,l){try{var o={};if(ta.meta&&ta.meta.update){o=ta.commerce.meta.getMetaParams()}var j=Object.merge({d:l.detail,s:crPageServlet,a:l.area},o);if(ta.retrieve("checkrates.meta_ui_post_click_prices")){var m="QC_Meta_Mini|Photo_LB";var p;try{p=ta.commerce.meta.tracking.setTimingForNavArea(m);j.metaRequestTiming=p}catch(n){ta.util.error.record(n,"problem locking timing for QC_Meta_Mini|Photo_LB")}}var q="CalendarLightbox";if(l&&l.gaContext){q=l.gaContext}var g=ta.widgets.calendar.getCheckRatesData();if(g){j=Object.merge(j,g)}var r="s3 dg cr_lb_overlay lb_overlay_post_date_close";var h={backdrop:ta.overlays.BACKDROP_ALWAYS,style:r,requestData:j,remoteContent:"/CheckRatesLB",showCloseButton:true,permanent:true,onLoad:function(){if(!g){ta.overlays.Factory.loadDatePicker(s,this,l.detail,"_cro",ta.widgets.calendar.launchCRLBUpdate)}},onHide:function(){ta.remove("meta.prof_photo_lb.post_date_close.overlay")}};h.closeButtonClass="roundOuterClose";h.onClose=function(){ta.trackEventOnPage("CalendarLightbox","unload","CloseButton")};ta.store("meta.prof_photo_lb.post_date_close.overlay",new ta.overlays.CenteredOverlay(h,i));if(typeof(checkRatesLBCss)!="undefined"&&!ta.retrieve("ta.checkRatesLBCss")){ta.store("ta.checkRatesLBCss",Asset.css(checkRatesLBCss))}}catch(k){ta.util.error.record(k,"check rates leave behind")}},tryToHideCROverlayPostDatesClose:function(){var g=ta.retrieve("meta.prof_photo_lb.post_date_close.overlay");if(g){g.hide()}},tamgShowLightbox:function(i,h,j){var g="tripadvisor.com";if(typeof cookieDomain!="undefined"){g=cookieDomain.substring(1,cookieDomain.length)}new Asset.css(j);new Request({url:"/TAMGFooterAjax",onSuccess:function(k){ta.overlays.showInLightbox(k,{style:"s0 TAMG_All"})},data:{a:"SHOW_GROUP_OVERLAY",dom:g},evalScripts:true,method:"get"}).send()},currencyPickerPopup:function(j,h,g){if(j){j.stop()}h.onclick=null;var i="/StaticVelocityPage?t=currency_picker.vm";new Asset.css(globalCurrencyPickerCSS);if(ta.retrieve("currency_format_using_icu4j_cldr.featureEnabled")=="true"){new ta.overlays.RelativeOverlayBelow({showCloseButton:false,activate:ta.overlays.ACTIVATE_CLICK,remoteContent:i,style:"global_currency_picker_overlay currency_format_using_icu4j_cldr dropMenu_refresh"},h)}else{new ta.overlays.RelativeOverlayBelow({showCloseButton:false,activate:ta.overlays.ACTIVATE_CLICK,remoteContent:i,style:"global_currency_picker_overlay dropMenu_refresh"},h)}ta.trackEventOnPage("CurrencyPicker","Open",g);return false},intlPopup:function(m,i){if(m){m.stop()}i.onclick=null;flagsUrl=document.location.pathname;var j="/StaticVelocityPage?t=intSitesFly.vm&lt=evt&footerFlagFormat="+footerFlagFormat+"&flagsURL="+encodeURIComponent(flagsUrl);if(document.location.search!=""){j+=encodeURIComponent(document.location.search)}if(document.location.hash!=""){j+=encodeURIComponent(document.location.hash)}if(window.modelGeoId){j+="&geo="+modelGeoId}if(window.flagsSettings){for(var g=0;g<flagsSettings.length;g++){j+="&"+flagsSettings[g]+"=true"}}if(window.pageFeature){j+="&pageFeature="+pageFeature}new Asset.css(flagsFlyoutCSS);var h=ta.isFall2013MastheadRefresh()?"dropMenu_refresh":"typeO";var l=ta.overlays.ACTIVATE_CLICK;new Request({url:j,onSuccess:function(k){var n=new Element("div",{html:k});ta.overlays.Factory.fixFlagsFlyout(n);new ta.overlays.RelativeOverlayBelow({showCloseButton:true,activate:l,content:n,style:h},i)}}).send();return false},fixFlagsFlyout:function(h){if(ta.retrieve("flag_flyout_link_fixing.featureEnabled")=="true"){var g=h.getElements("a.flag_link");g.forEach(function(j){var l=document.getElement("link[hreflang="+(j.get("hreflang"))+"]");if(l!=null){var k=l.get("href");if(typeof(k)=="string"){j.href=k}else{j.parentNode.style.display="none"}}else{j.parentNode.style.display="none"}});var i=h.getElements("li.region");i.forEach(function(j){var k=j.getElements("li.flag_item");var l=j.style.display;j.style.display="none";k.forEach(function(m){if(m.style.display!="none"){j.style.display=l}})})}},showRecentLocationEmailOverlay:function(){setPID(3833);if(typeof(recentViewedCSS)!="undefined"&&!ta.retrieve("ta.recentViewedCssAsset")){ta.store("ta.recentViewedCssAsset",Asset.css(recentViewedCSS))}new Request({url:"/RecentlyViewedAjax",onSuccess:function(g){if(!g.match("emptyRecentlyViewed")){ta.overlays.showInLightbox(g,{style:"dg s4 RecentlyViewedOverlay"})}},data:{a:"share_overlay"},evalScripts:true,method:"get"}).send()},expandRecentlyViewed:function(){for(var g=4;g<7;g++){var j=ta.id("recently_viewed_"+g);if(j&&j.hasClass("hidden")){j.removeClass("hidden")}}var h=ta.id("RECENTLY_VIEWED_MORE");if(h){h.addClass("hidden")}},showRecentlyViewedCompareOverLay:function(){ta.util.cookie.setPIDCookie(4898);var h=window.location.protocol+"//"+window.location.hostname+"/CompareHotels?detail=",g=0,j;for(g=0;g<7;g++){j=ta.id("recently_viewed_"+g);if(j){h=h+j.get("locid");g+=1;break}}for(;g<7;g++){j=ta.id("recently_viewed_"+g);if(j){h=h+"&compareHotelId="+j.get("locid")}}if(typeof(compareHotelCSS)!="undefined"&&!ta.retrieve("ta.compareHotelCssAsset")){ta.store("ta.compareHotelCssAsset",Asset.css(compareHotelCSS))}new Request({url:h,onSuccess:function(i){new ta.overlays.CenteredOverlay({activate:ta.overlays.ACTIVATE_CLICK,backdrop:ta.overlays.BACKDROP_ALWAYS,style:"compareHotel",content:i})}}).send()},clearRecentLocations:function(){var h=ta.id("RECENTLY_VIEWED_LIST");if(h){var g=h.getNext(".bxDivider");h.dispose();if(g){g.dispose()}}new Request({url:"/RecentlyViewedAjax?a=clear"}).send()},removeParticularLocation:function(g,h,r){var k=ta.id("recently_viewed_"+r);if(k){var q=k.get("locid");k.dispose();new Request({url:"/RecentlyViewedAjax?a=remove&locID="+q}).send();for(;r<7;++r){k=ta.id("recently_viewed_"+r);if(k&&k.hasClass("hidden")){k.removeClass("hidden");break}}for(;r<7;++r){k=ta.id("recently_viewed_"+r);if(k&&k.hasClass("hidden")){return}}var l=ta.id("RECENTLY_VIEWED_MORE");if(l&&!l.hasClass("hidden")){l.addClass("hidden")}var p=$$("li.rv_item");var o=0;var j=false;if(p){o=p.length;for(var m=0;m<o;m++){if(!p[m].hasClass("geoItem")){j=true}}}if(!j){var n=ta.id("RV_SAVE");if(n){n.dispose()}}if(o===0){k=ta.id("RECENTLY_VIEWED_LIST");if(k){k.dispose()}}else{if(o===1){k=ta.id("COMPARE_HOTELS");if(k){k.getParent().addClass("hidden")}}}}},showSendMessage:function(m,h){var g;if(m){m.preventDefault()}if(h){h=ta.id(h)}if(h){if(ta.has("overlays.sendmessage.loading")){return}else{ta.store("overlays.sendmessage.loading",true);ta.remove.delay(500,null,"overlays.sendmessage.loading")}if(typeof(privateMsgCSS)!="undefined"&&!ta.retrieve("ta.privateMsgCssAsset")){ta.store("ta.privateMsgCssAsset",Asset.css(privateMsgCSS))}var i;if(h.get("tag")=="span"&&h.hasClass("fkASDF")){i=h.className.match(/u_([^ ]*)/)[1]}else{i=h.href}if(i){var j=ta.retrieve("overlays.sendmessage");if(j&&i.match(/notyou=1/)){window.location="/NewsletterSignOut-e__2F__MemberSignIn"}else{if(j){return}}var l=parseInt(g,10)==1?"cc":"cm";var n=l=="cm"&&typeof(footprintGet)!="undefined"?footprintGet():null;if(n){i+="&LsoId="+n}var o={popup:true,product:"SEND_MESSAGE"};g=h.get("id");if(g){o.successAction="ta.overlays.Factory.showSendMessage||"+g}if(ta.registration.register(o)){var k;if(h.hasClass("callback_ShowRecaptcha")){new Asset.javascript(window.location.protocol+"//www.google.com/recaptcha/api/js/recaptcha_ajax.js");k="callback_ShowRecaptcha"}ta.common.sendmessage.communityLightbox(i,k)}}}},showConnectOverlay:function(i,g,h,k,j){ta.overlays.registration.connect(h,k,j)},showLoginOverlay:function(i,h,j,k,g){if(typeof(regflowCss)!="undefined"&&!ta.retrieve("ta.regflowCssAsset")){ta.store("ta.regflowCssAsset",Asset.css(regflowCss))}ta.overlays.registration.request(j,k,g)},showOverlayRegistration:function(h,i,p){var j,l,o,g,n,m;window.addEventListener("message",b,false);ta.on("metaFocusShow",ta.overlays.Factory.closeOverlayRegistration());ta.on("preMetaFocusShow",ta.overlays.Factory.closeOverlayRegistration());if(p&&p.hasOwnProperty("onSuccess")&&"function"===typeof(p.onSuccess)){ta.store("overlay_registration_onsuccess",p.onSuccess)}n={source:"OverlayRegistration",flow:p.flow,action:p.action,pid:p.pid,category:p.category,detail:p.locationId,geo:p.geoId,curUrl:p.curUrl};o=ta.util.URL.https("/Registration?"+Object.toQueryString(n));g=true;function k(){ta.store("ta.overlay.overlayRegistration",new ta.overlays.CenteredOverlay({backdrop:ta.overlays.BACKDROP_ALWAYS,style:"wide",yoffset:320,showCloseButton:g,closeButtonClass:"xCloseGreen",noPadding:true,waitForCss:true,content:'<div id="overlayRegFrameWrap"></div>',onShow:function(){var r,q;r=ta.id("overlayRegFrameWrap");if(r){new Asset.image(CDNHOST+"/img2/generic/site/loop.gif",{onload:this.position.bind(this),style:"margin: 40px 0 40px 300px","class":"anim_loop"}).inject(r)}ta.trackEventOnPage(p.category,"show_overlay","",p.pid,false);ta.util.recordInterruption("gate",p.category);j=document.createElement("iframe");j.src=o;j.id="overlayRegFrame";j.className="overlayRegFrame";j.width="640";j.height="0";j.style.visibility="hidden";l=ta.id("overlayRegFrameWrap");if(!l){ta.util.error.record(null,"The registration iframe wrapper was missing.");return}l.appendChild(j);q=ta.id("overlayRegFrame");if(q){q.addEvent("load",function(){if(r&&r.getElement(".anim_loop")){r.getElement(".anim_loop").hide()}q.style.visibility="visible"})}},onClose:function(){ta.trackEventOnPage(p.category,"closed","",p.pid,false)},onHide:function(){ta.remove("ta.overlay.overlayRegistration")}}))}if(!c()){a();k()}else{m=ta.retrieve("overlay_registration_onsuccess");if(m&&"function"===typeof(m)){m();ta.remove("overlay_registration_onsuccess")}}},closeOverlayRegistration:function(){var g=ta.retrieve("ta.overlay.overlayRegistration");if(g){g.hide();ta.remove("ta.overlay.overlayRegistration")}ta.overlays.safeCloseCurrent()},showRoomTipsOverlay:function(j,i,m){try{ta.util.cookie.setPIDCookie(4840);var h="/AccommodationTips?d="+modelLocId;if(m){h=h+"&filterLang="+m}var k=false;var g=new ta.overlays.CenteredOverlay({backdrop:ta.overlays.BACKDROP_NEVER,style:"s3 dg nopadding",permanent:true,zIndex:"9997",showCloseButton:true,remoteContent:h,onLoad:function(){if(g.inner){var n=ta.id("emptyTips");if(n){k=true}}else{k=true}if(k){g.hide()}}},i)}catch(l){ta.util.error.record(l,"showRoomTipsOverlay")}},_loadSummaryCss:function(){if(typeof(conceptsCss)!="undefined"&&!ta.retrieve("ta.conceptsCssAsset")){ta.store("ta.conceptsCssAsset",Asset.css(conceptsCss))}},showReviewSummary:function(m,j,l,h){if(l&&h){ta.overlays.Factory.showSummaryTranslation(m,j,l);return}var k=null;var i=null;var g=null;if(m){m.stop()}if(j.id&&j.id!=""){k=j.id.replace("concept_","").replace(/_/g," ");ta.store("topconcepts.lastconcept",k);g="/HotelSummary?d="+modelLocId+"&geo="+modelGeoId+"&concept="+k;if(l){g+="&autotrans=true"}}else{ta.util.error.record(null,"showReviewSummary - elmt.id check");return}ta.overlays.Factory._loadSummaryCss();i=new ta.overlays.CenteredOverlay({style:"s3 dg nopadding",autoShow:false,permanent:true,showCloseButton:true,remoteContent:g,onLoad:function(){ta.store("topconcepts.overlay."+k,this);this.show()}},j);j.onclick=i.show;return false},showSummaryTranslation:function(n,j,m){ta.util.cookie.setPIDCookie(16007);if(n){n.stop()}var h="s3 dg nopadding";ta.overlays.Factory._loadSummaryCss();var l="/MachineTranslation?";var k;if(j.id&&j.id!=""){if(j.id.indexOf("trans_")!=-1){k=j.id.replace("trans_","").replace(/_/g," ")}else{k=j.id.replace("concept_","").replace(/_/g," ")}ta.store("topconcepts.lastconcept",k);l+="page=summary&";l+="d="+modelLocId+"&";l+="concept="+k;l+="&sl=en&tl="+m}var g="topconcepts.overlay."+k;var i=ta.retrieve(g);if(i){i.hide()}i=new ta.overlays.CenteredOverlay({style:h,showCloseButton:true,remoteContent:l,onLoad:function(){ta.store(g,this);this.show()}},j)},toggleConceptSnippetTranslation:function(o,j){var n=null;var l=null;var m=null;var k=null;var g=null;if(o){o.stop()}if(j){ta.util.cookie.setPIDCookie(4111);m=j.id.replace(/[^_]*_(.*)/,"$1");n=ta.id("SUMMARYOVERLAY_"+m);if(n){l=n.getElements(".snippetText");for(var h=0;h<l.length;h++){if(l[h].isDisplayed()){l[h].hide()}else{l[h].show("inline")}}}k=ta.id("trans_"+m);g=ta.id("en_"+m);if(k.hasClass("activeButton")){k.removeClass("activeButton");k.addClass("inactiveButton")}else{k.removeClass("inactiveButton");k.addClass("activeButton")}if(g.hasClass("activeButton")){g.removeClass("activeButton");g.addClass("inactiveButton")}else{g.removeClass("inactiveButton");g.addClass("activeButton")}if(ta.overlays.Factory.storeReviewSummaryContent){ta.overlays.Factory.storeReviewSummaryContent(m.replace(/_/g," "),n.getParent().get("html"))}}},confirmGetVerified:function(i,h,g){ta.load("travel-answers-unverified.js",null);ta.trackEventOnPage("answers_faq_owner_get_verified","answer_form_click",g);if(i){i.stop()}ta.load("travel-answers-unverified.js",null);new ta.overlays.CenteredOverlay({style:"typeO",isOverlay:true,backdrop:ta.overlays.BACKDROP_ALWAYS,remoteContent:"/AnswersAjax?act=sgv&detail="+g},h);return false},questionToolTip:function(i,h,g){if(i){i.stop()}if(ta.has("questionTTShown")){return false}ta.store("questionTTShown",true);new Request({url:"/AnswersAjax",data:{act:"sqtt"},onSuccess:function(j){if(j==="true"){h.onclick=null;h.onmouseover=null;var k={style:"s3 dg rgba_gry update2012",activate:ta.overlays.ACTIVATE_NEVER,pinnable:ta.overlays.PINNABLE_NEVER,showArrow:true,allowRightArrowPos:true,pointArrowToSource:true,arrowHeight:32,arrowTopForce:40,arrowClass:"rgba_arrow_png24",showCloseButton:false,autoShow:false,delayShow:true,offsetRight:0,offsetTop:11,remoteContent:"/AnswersAjax?act=fqtt&geoId="+g};var l=new ta.overlays.RelativeOverlayRight(k,h);document.addEvent("click",l.hideByClickOnDocument.bind(l))}}}).send();return false},answersGuidelines:function(i,h,g){if(i){i.stop()}new ta.overlays.RelativeOverlayAbove({style:"typeO",isOverlay:true,showCloseButton:true,centered:true,backdrop:ta.overlays.BACKDROP_ALWAYS,remoteContent:"/AnswersAjax",requestData:{act:"sp",detail:g}},h);return false},questionForm:function(k,i,j,h){if(k){k.stop}if(!h){ta.util.error.record(new TypeError("pid required for questionForm overlay"),"Question and Answers - questionForm",null,null,"WARN")}ta.store("answers.pid.overlayType",h);var g=ta.overlays.getCurrent();if(g){g.hide()}new ta.overlays.CenteredOverlay({style:"answersOverlay verywide s7trans",closeButtonClass:"roundOuterClose",showCloseButton:true,remoteContent:"/AnswersAjax",requestData:{act:"saqo",lcid:j,altsessid:ta.retrieve("altsessid")||""},waitForCss:true,onLoad:function(){this.show()},onClose:function(){ta.remove("answers.pid.overlayType")}})},askReviewerIntercept:function(g,j,l,q,p,i,h,o,k){if(g){g.stop()}if(ta.registration.isAuthorized("SAVE_QUESTION")&&ta.registration.isAuthorized("SEND_MESSAGE")){ta.store("answers.pid.overlayType",k);new ta.overlays.CenteredOverlay({style:"answersOverlay verywide s7trans",closeButtonClass:"roundOuterClose",showCloseButton:true,remoteContent:"/AnswersAjax",requestData:{act:"ari",lcid:l,altsessid:ta.retrieve("altsessid")||"",screenname:q,reviewid:h,memberid:p,lang:i,subject:o},waitForCss:true,onLoad:function(){this.show()},onClose:function(){ta.remove("answers.messageTabLoaded");ta.remove("answers.pid.overlayType")}})}else{if(!j){ta.registration.getSuccessActionCookie();return false}var n=window.fullScreen||(window.screenTop===0&&window.screenY===0);var m={popup:!n,product:"SAVE_QUESTION",successAction:["ta.overlays.Factory.askReviewerIntercept",null,null,l,q,p,i,h,o].join("|")};ta.registration.register(m)}},showConfirmation:function(i){var g=ta.overlays.safeCloseCurrent();if(g){ta.store("confirmation.current",g)}var k=i.data;var j="answers."+k.type+".confirm";if(ta.has(j)){var h=ta.retrieve(j);h.onConfirm=i.onConfirm;h.onCancel=i.onCancel;h.show()}else{new ta.overlays.CenteredOverlay({backdrop:ta.overlays.BACKDROP_ALWAYS,style:"s4 dg confirmationPrompt medium",showCloseButton:false,remoteContent:"/AnswersAjax",requestData:k,onLoad:function(){var l=this;ta.retrieveOrStore(j,this);this.onConfirm=i.onConfirm;this.onCancel=i.onCancel;this.inner.getElement(".cancelBtn").addEvent("click",function(){if(l.onCancel&&typeof l.onCancel==="function"){l.onCancel()}ta.overlays.safeCloseFromDom(this);if(ta.has("confirmation.current")){ta.retrieve("confirmation.current").show();ta.remove("confirmation.current")}return false});this.inner.getElement(".confirmBtn").addEvent("click",function(){if(l.onConfirm&&typeof l.onConfirm==="function"){l.onConfirm()}ta.overlays.safeCloseFromDom(this);return true})},onHide:function(){this.onConfirm=null;this.onCancel=null}})}},reviewTranslate:function(l,j,h){ta.util.cookie.setPIDCookie(16009);ta.overlays.Factory._loadSummaryCss();var i=ta.has("photo.viewer.lightbox");var k=1001;if(i){k=10001}var g=new ta.overlays.CenteredOverlay({style:"s4 dg",zIndex:k,showCloseButton:true,remoteContent:h,onLoad:function(){this.show()}});ta.store("translationOverlay",g)},reviewTranslateEdit:function(j,h,i){var g=new ta.overlays.CenteredOverlay({backdrop:ta.overlays.BACKDROP_ALWAYS,style:"mtedit_overlay",fontSize:".9em",noPadding:true,showCloseButton:true,closeButtonClass:"roundOuterClose",remoteContent:"/MachineTranslationEdit?r="+i,onLoad:function(){try{var k=ta.id("mtedit_mt").getElements(".mtedit_text")[0];k.style.height=ta.id("mtedit_english").clientHeight+ta.id("mtedit_mt").offsetTop-k.offsetTop+"px"}catch(l){ta.util.error.record(l,"reviewTranslateEdit:onLoad")}}});ta.store("translationEditOverlay",g)},reviewTranslateEditGuidelines:function(h,g){new ta.overlays.RelativeOverlayAbove({content:g.getParent().getElement(".overlayContents").innerHTML,activate:ta.overlays.ACTIVATE_HOVER,style:"mtedit_guidelines_overlay"},g)},showRecentLocationSaveOverlay:function(){setPID(3832);if(typeof(recentViewedCSS)!="undefined"&&!ta.retrieve("ta.recentViewedCssAsset")){ta.store("ta.recentViewedCssAsset",Asset.css(recentViewedCSS))}new Request({url:"/RecentlyViewedAjax",onSuccess:function(g){if(!g.match("emptyRecentlyViewed")){ta.overlays.showInLightbox(g,{style:"dg s4 RecentlyViewedOverlay"})}},data:{a:"save_overlay"},evalScripts:true,method:"get"}).send()},createIPPinOverlay:function(h,j){var g;new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_HOVER,style:"s2 mg",onShow:function(){if(typeof(friendStripMouseoverPageAction)=="undefined"||!friendStripMouseoverPageAction){return}g=setTimeout(function(){new Request({url:"/ActionRecord?action="+friendStripMouseoverPageAction}).send();friendStripMouseoverPageAction=null},400)},onHide:function(){clearTimeout(g)},content:j},h)},createFriendActivityOverlay:function(h,j,k){var g;return new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_HOVER,style:"s2 mg",onShow:function(){k&&ta.util.pending.lock("friendActivityOverlay.pageAction",function(){g=setTimeout(function(){new Request({url:"/ActionRecord?action="+k}).send()},400)})},onHide:function(){clearTimeout(g)},content:j},h)},createFriendActivityLightbox:function(g){return new ta.overlays.CenteredOverlay({activate:ta.overlays.ACTIVATE_CLICK,backdrop:ta.overlays.BACKDROP_ALWAYS,style:"s4 mg friendActivity",content:g})},createCouponAnnouncementOverlayRedirect:function(h,m,g,o,l,i,j,n,k){ta.overlays.Factory.createCouponAnnouncementOverlay(null,null,h,m,g,o,l,i,j,n,k)},createCouponAnnouncementOverlay:function(h,k,l,s,i,u,r,o,n,t,q,j){ta.util.cookie.setPIDCookie(o);ta.css(r);var g={};g.act=l;if(n){g.act+="-"+n}else{if(window.pageServlet){g.act+="-"+pageServlet}}var p;if(q&&q!="false"){p="amex"}else{p="couponDetail"}ta.trackEventOnPage("SpecialOffer","click",window.pageServlet);var m="/CouponAjax?"+(s?"couponId="+s+"&":"")+(i?"announcementId="+i+"&":"")+(t?"locale="+t+"&":"")+(q?"isAmex="+q+"&":"")+(j?"showLocs="+j+"&":"")+"locationId="+u+"&listing=true";new Request({url:m,data:g,onSuccess:function(w){var v=ta.overlays.showCouponInLightbox(w,{closeButtonClass:"roundOuterClose",style:p,delayedPosition:true});v.closeBtn.addEvent("click",ta.servlet.blcoupons.closeHandler)},evalScripts:true}).send()},newCreateCouponAnnouncementOverlay:function(m,l,g,j,i){ta.util.cookie.setPIDCookie(j);ta.css(g);var h="couponDetail";var n=ta.id(i);var k=ta.overlays.showCouponInLightbox(n.innerHTML,{closeButtonClass:"roundOuterClose",style:h,delayedPosition:true});k.closeBtn.addEvent("click",ta.servlet.blcoupons.closeHandler)},postVideoLogin:function(h,g,i){if(i){ta.util.cookie.setPIDCookie(i)}ta.overlays.registration.connect({flow:"POST_VIDEO"},"SIGNIN")},fbLogin:function(){ta.support.Facebook.login()},createAmenitiesLightbox:function(i){var l=location.pathname;if(l.length>0){if(l.charAt(0)=="/"){l=l.substring(1)}var k=l.indexOf("-");if(k>=0){l=l.substring(0,k)}}var g=i.id,h;if(g.indexOf("amenity_")==0){h=g.substring(8)}var j=false;if(ta.remove("amenities.suppressLinks")){j=true}new ta.overlays.RelativeOverlayBelow({autoShow:true,style:"s3 dg",showCloseButton:true,activate:ta.overlays.ACTIVATE_CLICK,requestData:{d:h,tab:"amenities",from:l,suppressLinks:j},remoteContent:"/LocationTab"},i)},createAmenitiesLightboxFull:function(s,h,l,i){var r,m;if(s){s.stop()}if(typeof(amenityLightboxCss)!="undefined"&&!ta.retrieve("ta.amenityLightboxCss")){ta.store("ta.amenityLightboxCss",Asset.css(amenityLightboxCss))}if(l&&l>0){setPID(l)}var k=h.id;if(k.indexOf("amenity_")==0){r=k.substring(8)}ta.setEvtCookie("HotelContactInfo","Amenities",r,1,"/LocationTab");var q={};if(ta.meta&&ta.meta.update){q=ta.commerce.meta.getMetaParams()}var o=Object.merge({d:r,tab:"amenities_lightbox",from:window.pageServlet},q);var g={backdrop:ta.overlays.BACKDROP_ALWAYS,style:"s3 dg",onLoad:function(){this.position();if(ta.meta&&ta.meta.update){ta.meta.update.updateCRForm("_amo")}else{ta.commerce.checkrates.updateCRForm("_amo")}if(ta.has("ads.gptEnabled")){ta.common.ads.injectAjaxAds("locationtab","#gpt-ad-728x90-locationtab",true)}else{injectAdsTargeted(ta.id("AMENITY_LIGHTBOX"))}var t=ta.id("AMENITY_LIGHTBOX");if(i){var u=ta.select(".amenities_balance")[0];var v=ta.select(t,".bottom_margin")[1];var x=ta.select(".amenitiesRDV1")[0];if(u&&v&&x){var w=x.cloneNode(true);u.insertBefore(w,v)}}this.position()},showCloseButton:true,permanent:!ta.has("isDaoDao"),requestData:o,remoteContent:"/LocationTab",maintainCrPageServlet:true,onClose:function(){ta.remove("meta.requestFromArea")}};if(ta.retrieve("checkrates.meta_ui_post_click_prices")){m="QC_Meta_Mini|Amenities_Lightbox";var p;try{p=ta.commerce.meta.tracking.setTimingForNavArea(m)}catch(n){ta.util.error.record(n,"problem locking timing in ta.commerce.meta.loadBestPriceXsell")}g.onShow=function(){var t=ta.retrieve("meta.baseLocationId");if(t){try{ta.commerce.meta.tracking.setTimingForNavArea(m)}catch(u){ta.util.error.record(u,"problem locking timing in ta.commerce.meta.loadBestPriceXsell")}ta.commerce.meta.updateProvAreaFromLightBox(t)}};if(p){g.requestData=Object.merge(g.requestData,{area:m,metaRequestTiming:p})}else{g.requestData=Object.merge(g.requestData,{area:m})}}var j=new ta.overlays.CenteredOverlay(g,h);j.show();h.onclick=function(){j.show();if(ta.has("ads.gptEnabled")){ta.common.ads.injectAjaxAds("locationtab","#gpt-ad-728x90-locationtab",true)}else{ta.common.ads.injectAdsTargeted(ta.id("AMENITY_LIGHTBOX"))}if(ta.meta&&ta.meta.update){ta.meta.update.updateCRForm("_amo")}else{ta.commerce.checkrates.updateCRForm("_amo")}};ta.commerce.meta.tracking.resetTimingLockForNavArea(m);ta.store("ta.amenityLightboxOverlay",j);return false},iapFlyout:function(j,i,h){h.elmt=i;ta.store("iapFlyoutOptions",h);var g=i.get("id")+","+h.contentId+","+h.voteContentType;if(ta.registration.register({popup:true,product:"IAP_VOTE",successAction:"ta.overlays.Factory.iapFlyoutHelper|"+g})){ta.overlays.Factory.iapFlyoutHelper(g)}},iapTooltip:function(h,g){new ta.overlays.RelativeOverlayAbove({style:"tooltip ttWhite",showArrow:true,arrowClass:"arrow arrowDown",reverseIfRtl:true,showCloseButton:false,backdropClickClose:true,backdrop:ta.overlays.BACKDROP_NEVER,content:g.getElement(".ulBlueLinks").innerHTML,offsetTop:10,offsetLeft:80,activate:ta.overlays.ACTIVATE_HOVER,permanent:false,waitForCss:true},g.getElement(".reportTxt"))},rtrTooltip:function(h,g){new ta.overlays.RelativeOverlayAbove({style:"tooltip ttWhite",showArrow:true,arrowClass:"arrow arrowDown",reverseIfRtl:true,showCloseButton:false,backdropClickClose:true,backdrop:ta.overlays.BACKDROP_NEVER,content:g.getElement(".ulBlueLinks").innerHTML,offsetTop:10,offsetLeft:140,activate:ta.overlays.ACTIVATE_HOVER,permanent:false,waitForCss:true},g.getElement(".respondTxt"))},iapAlbumFlyout:function(j,i,h){h.elmt=i;ta.store("iapFlyoutOptions",h);var g=i.get("id")+","+h.contentId+","+h.voteContentType;if(ta.registration.register({popup:true,product:"IAP_VOTE",successAction:"ta.overlays.Factory.iapAlbumFlyoutHelper|"+g})){ta.overlays.Factory.iapAlbumFlyoutHelper(g)}},iapAlbumFlyoutHelper:function(k,o){var j=k.split(",");var n=j[0];var g=parseInt(j[1],10);var i=j[2];var l=ta.retrieve("iapFlyout");if(l){l.hide()}var h=ta.id(n);if(h){if(o){window.scrollTo(0,h.getPosition().y)}var m=new ta.overlays.CenteredOverlay({showCloseButton:true,permanent:true,remoteContent:"/ReportIAP?action=reportIAP&step=START&contentId="+g+"&voteContentType="+i,backdrop:ta.overlays.BACKDROP_ALWAYS,style:"s3 dg iapFlyout"});ta.store("iapFlyout",m)}},iapFlyoutHelper:function(k,o){var j=k.split(",");var n=j[0];var g=parseInt(j[1],10);var i=j[2];var l=ta.retrieve("iapFlyout");if(l){l.hide()}var h=ta.id(n);if(h){if(o){window.scrollTo(0,h.getPosition().y)}var m=new ta.overlays.RelativeOverlayBelow({showCloseButton:true,permanent:true,remoteContent:"/ReportIAP?action=reportIAP&step=START&contentId="+g+"&voteContentType="+i,style:"s3 dg iapFlyout"},h);ta.store("iapFlyout",m)}},iapOwnerFlyout:function(j,i,h){var g=i.get("id")+","+h.reviewid+","+h.isGeo+","+h.locationid;if(ta.registration.register({popup:true,product:"IAP_VOTE",successAction:"ta.overlays.Factory.iapOwnerFlyoutHelper|"+g})){ta.overlays.Factory.iapOwnerFlyoutHelper(g)}},iapOwnerFlyoutHelper:function(j,o){var h=j.split(",");var m=h[0];var p=parseInt(h[1],10);var i=h[2];var n=parseInt(h[3],10);var k=ta.retrieve("iapOwnerFlyout");if(k){k.hide()}var g=ta.id(m);if(g){if(o){window.scrollTo(0,g.getPosition().y)}var l=new ta.overlays.RelativeOverlayBelow({showCloseButton:true,permanent:true,remoteContent:"/ReportIAP?action=explain&reason=21&reviewid="+p+"&isGeo="+i+"&locationid="+n,style:"s3 dg iapFlyout"},g);ta.store("iapOwnerFlyout",l)}},openSavesRegflow:function(){ta.widgets.Saves.openSavesRegflow()},openSavesHoverRegflow:function(){ta.widgets.Saves.openSavesHoverRegflow()},openMastheadRegflow:function(){ta.widgets.Saves.openMastheadRegflow()},createGuideOverlay:function(){ta.overlays.registration.connect({flow:"DESTINATION_GUIDE"},"SIGNUP")},createPostPhotosOverlay:function(){ta.overlays.registration.connect({flow:"POST_PHOTOS"},"SIGNUP")},relBelowOverlaySolidGreenBorder:function(h,g){g.onmouseover=null;new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_HOVER,style:"s3 dg"},g)},createDropDown:function(o,h,k){h=ta.id(h);h.onmouseover=null;var g=ta.isFall2013MastheadRefresh()?"dropMenu_refresh":"dropMenu";var l=ta.isFall2013MastheadRefresh()?"sprite-arrow_dropdown_wht_refresh_show":"sprite-arrow_dropdown_wht_show";var i,n,m=ta.id("HEAD");if(m){n=m.getStyle("z-index")||204}else{n=204}try{i=new ta.overlays.RelativeOverlayBelow({content:k,style:g,fontSize:"12px",zIndex:n,activate:ta.overlays.ACTIVATE_HOVER,pinnable:ta.overlays.PINNABLE_CLICK,noPadding:ta.isFall2013MastheadRefresh(),onShow:function(){h.addClass("tabLinkShown");h.addClass("arwLinkShown");h.getParent().addClass("tabItemShown");h.getElement("img").addClass(l)},onHide:function(){h.removeClass("tabLinkShown");h.removeClass("arwLinkShown");h.getParent().removeClass("tabItemShown");h.getElement("img").removeClass(l);var p=k.getElements(".text");Array.each(p,function(q){var r=q.retrieve("typeAhead");if(r){r.hideChoices()}})}},h)}catch(j){return}i.pinAndSetUnpin=function(){i.pin();document.addEvent("click",i.unpinAndSetPin)};i.unpinAndSetPin=function(p){p=new Event(p);if(!i.container.containsEvent(p)&&!p.target.hasClass("dropSelect")){i.hide();i.unpin();document.removeEvent("click",i.unpinAndSetPin);i.container.addEvent("click",i.pinAndSetUnpin)}};i.container.addEvent("click",function(p){i.pinAndSetUnpin(p)})},createEmptyOverlay:function(k,h,j){h=ta.id(h);var g="";if(j){g="typeO"}try{new ta.overlays.RelativeOverlayBelow({noPadding:true,style:g,activate:ta.overlays.ACTIVATE_HOVER},h)}catch(i){return}},popConditionsOverlay:function(){var g=ta.id("CONDITIONS");if(g){ta.overlays.showInLightbox(g.innerHTML)}},cancelCreateWARList:function(h){h.stopPropagation();var g=ta.retrieve("war.todolist.showOverlay");if(g){window.clearTimeout(g);ta.store("war.todolist.showOverlay",false)}},createWARToDoListOverlay:function(h){ta.trackEventOnPageOnce("WAR","GLOBAL_NAV_WAR_HOVER");var j=ta.id("WAR_TODO_LOADING");if(j){var i=h?{d:h}:{};var g=ta.id("WAR_NOTIFICATION_FLAG")||ta.id("NO_WAR_NOTIFICATION_FLAG");j.removeClass("hidden");new Request({url:"/UserReviewToDoListAjax",data:i,method:"get",onSuccess:function(n){var m=new Element("div",{html:n});var k=m.getElement("#WAR_NOTIFICATION_FLAG_NEW");var o=m.getElement("#WAR_MORE_TO_DO_ITEMS");if(o){o.replaces(j)}if(g){if(k){k.replaces(g);k.setProperty("id","WAR_NOTIFICATION_FLAG")}else{var l=m.getElement("#NO_WAR_NOTIFICATION_FLAG");if(l){g.dispose()}}}}}).send()}},showCompareOverLay:function(g,l,h){var k="/CompareHotels?detail="+h;for(var j=0;j<3;j++){var m=ta.id("compare_hotels_"+j);if(m&&m.checked==true){k=k+"&compareHotelId="+m.value}}new Asset.css(compareHotelCSS);new Request({url:k,onSuccess:function(i){new ta.overlays.CenteredOverlay({activate:ta.overlays.ACTIVATE_CLICK,backdrop:ta.overlays.BACKDROP_ALWAYS,style:"compareHotel",content:i})}}).send()},createNeighborhoodOverlay:function(l,j,g){if(ta.has("nbhdOverlay")){if(j){j.onclick=null}ta.retrieve("nbhdOverlay").show();return}var h=new ta.overlays.RelativeOverlayBelow({showCloseButton:true,permanent:true,zIndex:"997",style:"nbhdOverlay typeO",activate:ta.overlays.ACTIVATE_CLICK,pinnable:ta.overlays.PINNABLE_ALWAYS,onShow:function(){if(g){ta.servlet.HACSearch.filter.update()}},onHide:function(){if(g){ta.servlet.HACSearch.filter.update()}}},"NEIGHBORHOOD_OVERLAY");var i=h.inner;var k=ta.id("NEIGHBORHOOD_FORM");if(i&&k){k.inject(i,"top");k.removeClass("hidden");ta.store("neighborhoodOverlayForm",k)}ta.store("nbhdOverlay",h)},createHACProgressOverlay:function(){try{if(ta.has("ta.hac.progress.overlay")){return ta.retrieve("ta.hac.progress.overlay")}var j=ta.id("HAC_PROGRESS_CONTAINER").dispose();var g=j.get("html");var i=new ta.overlays.CenteredOverlay({style:"s3 dg rgba_gry",showCloseButton:false,permanent:true,content:g});ta.store("ta.hac.progress.overlay",i);return i}catch(h){ta.util.error.record(h,"createHACProgressOverlay")}},getFilterWaitOverlay:function(){var h=ta.retrieve("filters.waitDialog");if(!h){var g="mg s1 fatNotice";if(ta.isHotelsRedesign2011()||ta.has("hotels.redesignEnabled")){g=g+" fatNotice_2011"}h=new ta.overlays.CenteredOverlay({style:g,showCloseButton:false,autoShow:false,delayedPosition:true});h.inner.set("html","<b>"+JS_UpdatingYourResults+"</b>");ta.store("filters.waitDialog",h)}return h},showFilterWaitOverlay:function(h){var g=ta.overlays.Factory.getFilterWaitOverlay();if(g){if(h){g.show();g.position(false)}else{g.hide()}}},showUpdatingMessage:function(){var h=ta.overlays.Factory.getFilterWaitOverlay();h.show();if(ta.remove("filter.map")){h.container.setStyles({left:-9999,top:-9999});var i=ta.id(ta.retrieve("maps.container")).getCoordinates();var g=h.container.getCoordinates();h.container.setStyles({left:i.left+(i.width-g.width)/2,top:i.top+(i.height-g.height)/2})}if(ta.remove("filter.lockout")){h.enableBackdrop()}},createPhotoUploaderOverlay:function(g){var h=new ta.overlays.CenteredOverlay({backdrop:ta.overlays.BACKDROP_ALWAYS,autoShow:false,style:"s2 dg",innerDivClass:"noPadMarg",attachCloseEvent:true,permanent:true,onLoad:ta.media.uploader.onLoadOverlayHandler,onClose:function(){if(ta.has("tipsOverlay")&&ta.retrieve("tipsOverlay").hide){ta.retrieve("tipsOverlay").hide();ta.remove("tipsOverlay")}}});h.loadRemoteContent(g,true);ta.store("ta.media.uploader.photoUploaderOverlay",h)},createIpDeauthOverlay:function(h,g){new Request({url:"/ActionRecordPlus?action=DEAUTH_IP&id="+h,onSuccess:function(i){new ta.overlays.CenteredOverlay({backdrop:ta.overlays.BACKDROP_ALWAYS,showCloseButton:false}).loadRemoteSuccess(i);if(g){ta.support.Facebook.ipRevoke(10000)}},onFailure:ta.util.error.ajaxFailure.partial("partials:ip_disable")}).send()},createHotelStyleCategoryDescriptionOverlayAbove:function(j,h,g){var i=ta.id(g);h.onmouseover=null;if(i){new ta.overlays.RelativeOverlayRight({showCloseButton:false,activate:ta.overlays.ACTIVATE_HOVER,style:"ryokanOverlay",showArrow:true,pointArrowToSource:true,allowRightArrowPos:true,arrowHeight:29,arrowClass:"ryokanArrow",fontSize:".7em",offsetRight:-14,offsetTop:-10,waitForCss:true,content:new Element("div",{style:"width:300px; padding:12px;",html:i.getChildren()[0].get("html")})},h)}},updateAllGuestsRoomsButtons:function(){var i=ta.widgets.calendar.getGuestsRoomsPickerData(),h=$$(".roomsButton .grp-rooms-value"),g=$$(".guestsButton .grp-guests-value");if(h&&h.length>0){h.each(function(j){j.set("html",i.rooms)})}if(g&&g.length>0){g.each(function(j){j.set("html",i.guests)})}},kinderOverlay:function(j,h){try{h.onclick=null;var i={style:"s4 dg kinder",showCloseButton:true,isChild:true,activate:ta.overlays.ACTIVATE_CLICK};var g=document.getElement(".overlay");if(g){i.onShow=function(){var l=g.overlay;if(!l.pinned){l.unpinOnHide=true;l.pin()}},i.onHide=function(){var l=g.overlay;if(l.unpinOnHide){l.unpinOnHide=false;l.unpin()}}}new ta.overlays.RelativeOverlayBelow(i,h)}catch(k){ta.util.error.record(k,"Error: kinderOverlay")}},loadBLSlideshowOverlay:function(j,i,h,g){if(window.t4bSlideshowCSS&&!ta.retrieve("ta.t4bSlideshowCSS")){ta.store("ta.t4bSlideshowCSS",new Asset.css(t4bSlideshowCSS))}new Request({url:"/BusinessListingsAjax",onSuccess:function(k){ta.overlays.showInLightbox(k,{backdrop:ta.overlays.BACKDROP_ALWAYS,style:"g s10px np"})},data:{act:"slideshow",detail:h,pid:g,servletName:pageServlet,flash:(Browser.Plugins.Flash.version>=10)},evalScripts:true,method:"get"}).send()},showPartnerAttributionTip:function(i,g,h){new ta.overlays.RelativeOverlayBelow({showCloseButton:true,style:"s3 dg update2012 rgba_gry partner_attrib",content:h},g)},accountMenuFlyout:function(l,h){try{h.removePropertyEvent("onmouseover","ta.overlays.Factory.accountMenuFlyout");h.removePropertyEvent("onclick","ta.overlays.Factory.accountMenuFlyout");l.stop();var g=ta.isFall2013MastheadRefresh()?"dropMenu dropMenu_refresh accountMenuFlyout":"dropMenu accountMenuFlyout";var i=ta.isFall2013MastheadRefresh()?ta.overlays.ACTIVATE_CLICK:ta.overlays.ACTIVATE_HOVER;var k=new ta.overlays.RelativeOverlayBelow({activate:i,style:g,noPadding:true,onShow:function(){if(!ta.isFall2013MastheadRefresh()){this.container.setStyle("margin-left","19px")}},onHide:function(){this.container.setStyle("margin-left","0")}},h);ta.store("accountMenuFlyout",k)}catch(j){ta.util.error.record(j,"Error: ta.overlays.Factory.accountMenuFlyout")}},messageMenuFlyout:function(i,g){if(i){i.stop()}try{new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_CLICK,style:"messageMenuOverlay",innerDivClass:"",content:ta.id("MESSAGE_MENU").innerHTML,offsetLeft:23,offsetTop:2,showCloseButton:false},g)}catch(h){ta.util.error.record(h,"Error: ta.overlays.Factor.messageMenuFlyout")}},ratingMenuFlyout:function(j,g){g.onmouseover=null;try{var i=new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_HOVER,style:"dropMenu ja_ratingMenuFlyout"},g);ta.store("ratingMenuFlyout",i)}catch(h){ta.util.error.record(h,"Error: ta.overlays.Factory.ratingMenuFlyout")}},bizListingsMenuFlyout:function(l,h){h.onmouseover=null;try{var j=h.getNext("div"),i=ta.retrieve("accountMenuFlyout");if(j){j=j.get("html")}var g=ta.isFall2013MastheadRefresh()?"dropMenu dropMenu_refresh bizListingsMenuFlyout":"dropMenu bizListingsMenuFlyout";new ta.overlays.RelativeOverlayRight({content:j,zIndex:2000,style:g,offsetTop:ta.isFall2013MastheadRefresh()?-6:0,activate:ta.overlays.ACTIVATE_HOVER,onShow:function(){if(i){i.pin().show();var m=this;this.container.addEvent("mouseleave",function(n){if(!i.container.containsEvent(n)){i.hide();m.hide();m.container.onmouseleave=null}})}},onHide:function(){if(i){i.unpin()}}},h)}catch(k){ta.util.error.record(k,"Error: ta.overlays.Factory.bizListingsMenuFlyout")}},createDrop:function(j,g){g.onmouseover=null;try{var h=g.getNext().getElement(".subNav");ta.run("ta.overlays.Factory.createDropDown",{},j,g,h)}catch(i){ta.util.error.record(i,"Error: ta.overlays.Factory.createDrop")}},createFriendOfFriendOverlay:function(g,h){g.onclick=null;if(h){new ta.overlays.RelativeOverlayAbove({activate:ta.overlays.ACTIVATE_CLICK,style:"s2 mg",showCloseButton:true,content:h},g)}if(lazyImgs!=null){window.setupLazyLoad()}},CLOSE_BTN_RIGHT_OFFSET:15,ratingsFlyout:function(p,g,i,l){if(p){p.stop()}try{var k=g.get("class").match("rating(\\d)")[1];var m=ta.id("ratingsFlyout"+k).get("html");var o=null;var h="";if(i){o=ta.servlet.Reviews.ratingFlyoutScroll}var j="ratingOverlay dg s3 rgba_gry";if(l){h=" fixedHeight";j=j+" overlayWithScroll"}new ta.overlays.RelativeOverlayAbove({showCloseButton:true,activate:ta.overlays.ACTIVATE_CLICK,content:m,innerDivClass:"ratingFlyout inner"+h,style:j,onscroll:o},g);new Request({url:"/ActionRecord?action=ratingsFlyout&pid=4304"}).send()}catch(n){ta.util.error.record(n,"showRatingsFlyout")}},getWhiteFlyout:function(o,i,l,m,h){if(o){o.stop()}if(!i||!l){return}var j="whiteFlyOut";var g=true;var k="flyout_white_arrow";var n="flyout_icon_close";new ta.overlays.RelativeOverlayRight({style:j,pinnable:ta.overlays.PINNABLE_CLICK,showArrow:g,arrowClass:k,pointArrowToSource:true,showCloseButton:true,closeButtonClass:n,content:l,offsetRight:m,offsetLeft:-m,onRight:ta.util.i18n.isRtl()?false:true,offsetTop:h},i)},firstToReviewFlyout:function(m,g,l){try{var h=ta.id("locationId"+l);var i=h.getElement(".firstToReviewFlyout").innerHTML;var j=h.getElement(".propName");ta.overlays.Factory.getWhiteFlyout(m,j,i,-12,-20)}catch(k){ta.util.error.record(k,"ta.overlays.factory.firstToReviewFlyout")}},openTourismDescription:function(g){ta.servlet.Tourism.showGeoDescription(g)},memberPassportStampOverlay:function(i,g,h){if(!ta.has("passportStampsCSS")){ta.store("passportStampsCSS",new Asset.css(passportStampsCSS))}h.geos=h.geos.join(",");new ta.overlays.RelativeOverlayRight({style:"s3 dg rgba_gry memberPassportStamps",activate:ta.overlays.ACTIVATE_CLICK,showCloseButton:true,onLoad:function(){this.show()},remoteContent:"/MemberPassportStamps",requestData:h},g);ta.trackEventOnPage("Reviews","reviews_in_cities");new Request({url:"/ActionRecord?action="+h.actionRecord}).send()},relRightLocalContent:function(i,g,h){g.onmouseover=null;new ta.overlays.RelativeOverlayRight({activate:ta.overlays.ACTIVATE_HOVER,style:"s2 og",content:ta.id(h).innerHTML},g)},relRightLocalContentSimple:function(n,h,l,i,k){var m=true;var g="flyout_arrow";var j="flyout_icon_close";new ta.overlays.RelativeOverlayRight({pinnable:ta.overlays.PINNABLE_CLICK,noPadding:false,style:"s5",offsetRight:-8,innerDivClass:"balloon_holder",showArrow:m,arrowClass:g,arrowClassRight:g,showCloseButton:true,closeButtonClass:j,content:ta.id(l).innerHTML,onClose:function(){i(k)}},h)},centerLocalAddress:function(i,g,h){new ta.overlays.CenteredOverlay({style:"s3 dg help_center",showCloseButton:true,backdropClickClose:true,backdrop:ta.overlays.BACKDROP_ALWAYS,content:ta.id(h).innerHTML},g)},cookieSettingsPanel:function(j,g){if(j){j.stop()}if(g&&g.onclick){g.onclick=null}var h={};h.en=451;h.en_UK=834;h.en_IE=835;h.en_ZA=2635;h.sv=720;h.no=721;h.da=1199;h.fr=1197;h.de=1201;h.de_AT=2719;h.el=1198;h.it=1202;h.es=1200;h.pl=1208;h.nl=1209;h.fi=2968;h.hu=3049;h.cs=3128;h.sk=3233;h["default"]=451;var i;if(posLocale in h){i="//info.evidon.com/pub_info/"+h[posLocale]+"?v=1&nt=0"}else{i="//info.evidon.com/pub_info/"+h["default"]+"?v=1&nt=0"}new ta.overlays.RelativeOverlayBelow({showCloseButton:true,noPadding:true,activate:ta.overlays.ACTIVATE_CLICK,content:new Element("iframe",{src:i,height:562,width:731,styles:{margin:"0"}})},g)},loadJFYHotelsFilter:function(s,z,q){if(s){s.stop()}var x=ta.retrieve("ta.p13n.filterOnHover");var K=ta.retrieve("ta.p13n.prodp13nIsTablet");if(typeof(x)!=="boolean"||typeof(K)!=="boolean"){return}function B(){var i;if(document.getElement(".horizontal_filters_wrap")){var P=document.getElement(".jfy_filter_bar_top");if(P){i=P.getElement(".options_size_limiter");if(i&&i.scrollHeight>95){var R=P.getElement(".resizer_footer.hidden");if(R){R.removeClass("hidden")}}}}else{if(q==="neighborhood"){ta.overlays.Factory.fixLocationFilterFooter()}else{i=$$(".jfy_filter_bar .jfy_filter_bar_"+q+"_inner");if(i.length>0&&i[0].scrollHeight>95){var Q=$$(".jfy_filter_bar .jfy_filter_"+q+"_footer.hidden");if(Q.length>0){Q[0].removeClass("hidden")}}}}}var u={};if(ta.retrieve("ta.p13n.jfyFilterSet")&&typeof ta.retrieve("ta.p13n.jfyFilterSet")==="object"){u=ta.retrieve("ta.p13n.jfyFilterSet")}var H=null;var N=(q==="price"&&!ta.widgets.calendar.hasPageDates()&&(pageServlet!="Restaurants"));var k;if(N){k=ta.retrieve("ta.p13n.priceFilterWithCalender.content");if(!k){k=$("jfy_filter_bar_price_predates");ta.store("ta.p13n.priceFilterWithCalender.content",k);k.parentNode.removeChild(k)}}else{k=ta.id("jfy_filter_bar_"+q)}if(!k){return}var y=undefined;var F=ta.id("EATERY_FILTERS_CONT");if(F||q!=="sort"){var m=document.createElement("div");m.className="jfy_filter_bar_top_arrow";y=document.createElement("div");y.className="jfy_filter_bar_top_spacer";y.insertBefore(m,null)}var A=document.createElement("div");var t="jfy_filter_bar jfy_filter_bar_"+q;A.className=t;var v=k.getElements(".all");if(v&&v.length>0){v.removeClass("hidden")}var L=k.getElements(".less");if(L&&L.length>0){L.removeClass("hidden");L.addClass("hidden")}var D=k.getElements(".sprite-tag_list_expand");if(D&&D.length>0){D.removeClass("hidden")}var p=k.getElements(".sprite-tag_list_compress");if(p&&p.length>0){p.removeClass("hidden");p.addClass("hidden")}if(q!=="price"&&q!=="hotel_class"){var O=k.getElementsByTagName("DIV")[0];O=ta.id(O);if(q==="neighborhood"){O=k.getElements(".jfy_filter_bar_neighborhood_inner")[0]}var o=false;var w=false;var n=[];var j=0;var I;if(O){var l=O.getElements(".jfy_tag_style");if(l){for(I=0;I<l.length;I++){if(l[I].hasClass("selected")){if(w){o=true;break}}else{w=true}}if(o){for(I=0;I<l.length;I++){if(l[I].hasClass("selected")){l[I].dispose();n[j]=l[I];j++}}for(I=n.length;I>0;I--){O.insertBefore(n[I-1],O.firstChild)}}}}}A.innerHTML=k.get("html");var C=document.createElement("div");if(y){C.insertBefore(y,null)}C.insertBefore(A,null);if(!u[q]){var J=ta.overlays.ACTIVATE_CLICK_ALTERNATE;var G=true;var M=1500;if(x){J=ta.overlays.ACTIVATE_BOTH_DELAY;if(!K){G=false;M=250}else{if(q==="sort"){G=false}}}var E=(q==="price")?ta.overlays.PINNABLE_CLICK:ta.overlays.PINNABLE_NEVER;var g=function(){B();if(q==="price"){if(ta.has("metaDatePickerEnabled")){ta.widgets.calendar.syncAllDatePickers()}}else{if(q==="sort"){if(ta&&ta.p13n&&ta.p13n.wizard&&typeof(ta.p13n.wizard.justifyRightSortOption)=="function"){ta.p13n.wizard.justifyRightSortOption()}}}};var r=ta.retrieve("ta.p13n.header_placement_overlay_class")||"";var h="jfy_filter_bar_top dg jfy_filter_bar_top_"+q+" "+r;if(F){h=h+" restaurants_filter_overlay"}if(ta.retrieve("left_hotels_filters")){h=h+" left_hotels_filters"}H=new ta.overlays.RelativeOverlayBelow({pinnable:E,style:h,activate:J,showCloseButton:G,noPadding:true,content:C.innerHTML,centered:true,allowFlip:false,closeOnDocumentClick:true,activateHoverDelayTime:150,hoverDelayTime:M,autoShow:false,ignoreFirstClickAfterHover:x,ignoreFirstClick:x,onShow:g},z);H.adjustEdge=function(T,Q){var S=ta.id("JFY_hotel_filters")||ta.id("EATERY_FILTERS_CONT");if(S&&S.getCoordinates){var R=S.getCoordinates();var P=T;if(T<R.left){P=R.left}else{if(T+Q>=R.right){var i=this._styleValueToPixel(this.container.getStyle("margin-right"));P=R.right-Q-i-1}}var U=T-P;this.setJfyArrowOffset=function(){this.inner.getElements(".jfy_filter_bar_top_arrow").setStyle("left",U+"px")};this.setJfyArrowOffset();return P}};if(x){H.showWithDelay()}else{H.show()}u[q]=H}else{H=u[q];H.inner.innerHTML=C.innerHTML;H.container.removeClass("expanded");if(H.visible){B();H.setJfyArrowOffset()}if(N){if(ta.has("metaDatePickerEnabled")){ta.widgets.calendar.syncAllDatePickers()}}H.enable()}if(K){ta.id("PAGE").addEvent("click",H.hide)}ta.store("ta.p13n.jfyFilterSet",u);if(!ta.retrieve("ta.p13n.filterOnHover")){ta.trk(q,false,s.target?s.target:s.srcElement)}},fixLocationFilterFooter:function(){var l=$$(".jfy_filter_bar .location_popular .jfy_filter_bar_neighborhood_inner");if(l.length>0&&l[0].scrollHeight>95){var i=$$(".jfy_filter_bar .location_popular .jfy_filter_neighborhood_footer.hidden");if(i.length>0){i[0].removeClass("hidden");$$("#jfy_filter_bar_neighborhood .location_popular .jfy_filter_neighborhood_footer.hidden").removeClass("hidden")}}var j=$$(".jfy_filter_bar .location_neighborhood .jfy_filter_bar_neighborhood_inner");if(j.length>0){if(j[0].scrollHeight>95){var h=$$(".jfy_filter_bar .location_neighborhood .jfy_filter_neighborhood_footer.hidden");if(h.length>0){h.removeClass("hidden");$$("#jfy_filter_bar_neighborhood .location_neighborhood .jfy_filter_neighborhood_footer.hidden").removeClass("hidden")}}if(l.length>0){$$(".jfy_filter_bar .location_neighborhood").addClass("hidden")}}var g=$$(".jfy_filter_bar .location_attraction .jfy_filter_bar_neighborhood_inner");if(g.length>0){if(g[0].scrollHeight>95){var k=$$(".jfy_filter_bar .location_attraction .jfy_filter_neighborhood_footer.hidden");if(k.length>0){k.removeClass("hidden");$$("#jfy_filter_bar_neighborhood .location_attraction .jfy_filter_neighborhood_footer.hidden").removeClass("hidden")}}if(l.length>0&&j.length>0){$$(".jfy_filter_bar .location_attraction").addClass("hidden")}}},loadJFYFilterPulldown:function(j,h){if(!ta.retrieve("ta.p13n.jfyFilterPulldown")){var i="p13n_filter_pulldown";var g=new ta.overlays.RelativeOverlayBelow({content:ta.id(i).innerHTML,activate:ta.overlays.ACTIVATE_CLICK_ALTERNATE,closeOnDocumentClick:true,style:"",noPadding:true},h);ta.store("ta.p13n.jfyFilterPulldown",g)}},adjustJFYOverlayPositions:function(){var h=ta.retrieve("ta.p13n.jfyFilterSet");var g=Object.values(h||{});Object.each(g,function(i){if(i.visible){i.hideNow();i.show()}})},loadMetaHotelsFilter:function(j,g,h,i){ta.hac.filters.loadMetaHotelsFilter(j,g,h,i)},loadGuestsRoomsOverlay:function(k,i,j,l){var h=ta.retrieve("ta.overlay.guests_rooms_overlay");if(ta.has("guests_rooms_picker_3.enabled")){l.input=document.getElement(".calendar_wrapper .guests_rooms_picker_container")}else{l.input=document.getElement(".guests_rooms_picker_container")}l.findTargetFunction=function(m){if(ta.has("guests_rooms_picker_3.enabled")&&!ta.has("guests_rooms_picker_4.enabled")&&!ta.has("hotels_rgpicker_outofcalendar")){return document.getElement(".date_picker_calendar.overlay .wrapper_header .roomsGuests")}else{if(m&&m.target){return ta.id(m.target).getParent(".roomsGuests")}}};var g={style:"date_picker_calendar guests_rooms_overlay",moreOptions:l};if(!h){h=new ta.overlays.GuestsRoomsOverlay(g,i);ta.store("ta.overlay.guests_rooms_overlay",h)}h.show(k)},updateMetaHotelsFiltersFromBreadcrumbs:function(j,h,g,i){ta.hac.filters.updateMetaHotelsFiltersFromBreadcrumbs(g,i)},closeAllActiveFilters:function(){ta.hac.filters.closeAllActiveFilters()},hideFilterOverlay:function(k,g,h){var i=ta.retrieve("ta.filters.overlaySet");if(i&&i[h]){var j=i[h];if(j.visible){j.hide()}}},simulateDatePickerClick:function(l,h,k,i,j,g){if(ta.retrieve("datepicker_autoadvance")&&document.getElement(".date_picker_calendar.overlay")){return false}ta.overlays.Factory.loadDatePicker(l,h,k,i,j,g);l.stopPropagation();l.preventDefault();return false},loadVRDatePicker:function(m,h,k,i,j,g){if(!g){g={}}var l=Object.merge({calendarOptions:{isVR:true}},g);ta.overlays.Factory.loadDatePicker(m,h,k,i,j,l)},setDatePickersAsText:function(){var g=ta.id("DEALS");if(g&&g.toggleClass("date_pickers_as_text",true)){g.addClass("date_pickers_as_text")}},unsetDatePickersAsText:function(){var g=ta.id("DEALS");if(g&&g.toggleClass("date_pickers_as_text",false)){g.removeClass("date_pickers_as_text")}},loadDatePicker:function(q,h,j,g,l,r){if(!r){r={}}new Asset.image(CDNHOST+"/img2/generic/site/loading_anim_gry_sml.gif");if(ta.has("isHotelsLander")||ta.isMetaHomepageIntegration2013()||ta.has("widget.customHotel")||ta.has("isDaoDaoHomePageUnforkCalendar")){if(ta.has("isHotelsLander")||j==1||ta.has("isDaoDaoHomePageUnforkCalendar")){r=Object.merge({calendarOptions:{selectionStartClass:"start",selectionEndClass:"end",postContent:function(){var s=Elements.from('<div id="SKIP_DATES"><span class="skip_dates_text"><span class="taLnk">'+ta.retrieve("multiDP.skipDates")+"</span></span></div>")[0];s.getElement(".taLnk").addEvent("click",function(){var u=ta.overlays.getCurrent(),v=u&&u.calendar;v&&v.clear();var t=ta.id("SUBMIT_HOTELS");if(t){t.focus()}ta.widgets.calendar.clearSessionDates(null,function(){if(ta.has("widget.customHotel")){ta.widget.hotels.changeDates()}});if(ta.has("isHotelsLander")){ta.overlays.Factory.trackSkipDatesEvent("Hotels_Lander","Calendar","Skip dates",0)}else{ta.overlays.Factory.trackSkipDatesEvent("Meta_Homepage","Calendar","Skip dates",0)}});return s},onSelect:function(t){if(!t.oneSelected){var s=ta.id("SUBMIT_HOTELS");s&&s.focus()}}}},r)}if(j==1&&ta.has("widget.customHotel")){r.calendarOptions=r.calendarOptions||{};r.calendarOptions.wrapper=Elements.from('<div class="calendar_wrapper"><div class="wrapper_header">'+ta.retrieve("multiDP.header")+'</div><div class="wrapper_inner"></div><div class="wrapper_footer">'+ta.retrieve("multiDP.footer")+"</div>")[0]}if(j==1||j=="vr"){r.calendarOptions=r.calendarOptions||{};r.calendarOptions.submitOnEnter=ta.retrieve("widget.customHotel")?ta.widget.CustomHotelsWidget.validate:ta.pages.home.validate}}else{if(ta.retrieve("checkrates.meta_ui_sk_box_v3")){r=Object.merge({calendarOptions:{selectionStartClass:"start",selectionEndClass:"end"}},r)}}h=ta.id(h);if((ta.has("guests_rooms_picker_3.enabled")&&!ta.has("guests_rooms_picker_4.enabled")&&!ta.has("hotels_rgpicker_outofcalendar")&&!ta.has("hotels_left_filters_redesign"))&&h&&!h.getParent(".geoChkRates")&&(h.getParent(".jfy_header_dates_holder")||h.getParent(".filterControls")||h.getParent(".meta_chevron_module_2014")||h.getParent("#HotelDateSearch")||h.getParent(".HotelHighlight"))){try{ta.meta.update.clearDatesBumpedMessage();r.calendarOptions=r.calendarOptions||{};var n,k,i;if(ta.has("guests_rooms_picker_3.enabled")){k=ta.id(document.getElement(".guestsRoomsDatePickerHeaderForInject.hidden"));n=k?new Element("div").adopt(k.clone()).get("html"):""}k=ta.id(document.getElement(".showPricesForInject.hidden"));i=k?new Element("div").adopt(k.clone()).get("html"):"";r.calendarOptions.wrapper=Elements.from('<div class="calendar_wrapper"><div class="wrapper_header">'+n+'</div><div class="wrapper_inner"></div><div class="wrapper_footer">'+i+"</div>")[0];r.calendarOptions.isGuestsRoomsCalendar=true}catch(m){ta.util.error.record(m,"error building content for guests rooms datepicker wrapper")}}if(!r.calendarOptions){r.calendarOptions={}}if(ta.has("calendar.default.postcontent")&&!r.calendarOptions.postContent){r.calendarOptions.postContent=ta.retrieve("calendar.default.postcontent")}if(r.calendarOptions.isholidayEnable){r.calendarOptions.holidaysOnCalendar=ta.retrieve("calendar.holidays")}r.calendarOptions.classicStyling=true;r.calendarOptions.flights=r.flights;r.calendarOptions.oneWayFlight=r.oneWayFlight;r.calendarOptions.multiCityFlight=r.multiCityFlight;if(r.oneWayFlight||r.multiCityFlight){r.calendarOptions.onSelect="ta.overlays.calendar.select";r.calendarOptions.oneWayStyling=true}if(r.flights){var p=new Date();p.setDate(p.getDate()+ta.util.date.MAX_DAYS_BEFORE_RETURN_FLIGHT);r.calendarOptions.lastDate=p}window.fireEvent("onCalendarSelect",h);r.calendarOptions.onChangeDates=ta.widgets.calendar.onCalendarChangeDates;r.calendarOptions.onRangeSelect=ta.widgets.calendar.onCalendarRangeSelect;if(j=="vr"){var o=new Date();o.setMonth(o.getMonth()+18);o.setDate(1);r.calendarOptions.lastDate=o}ta.overlays.Factory.destroyAnimatedDateCTA();ta.overlays.Factory._loadAvailDateWidget(q,j,"calendar",g,l,r);if(ta.retrieve("load_date_picker_buttons")){return false}},destroyAnimatedDateCTA:function(){if(ta.isMetaHotels2013()||(ta.retrieve("hh_short_cell.enabled")&&ta.widgets.calendar.hasPageDates())){var g;if(ta.retrieve("animate_date_reformat")){g=ta.id("ANIMATED_DATE_CTA_REFORMAT")}else{g=ta.id("ANIMATED_DATE_CTA")}if(g){ta.servlet.HACSearch.destroyAnimatedDateCTA()}}},trackSkipDatesEvent:function(h,i,g,k){try{ta.trackEventOnPage(h,i,g,k,false)}catch(j){}},loadAdultsField:function(l,h,k,i,j,g){if(!g){g={}}if(!g.calendarOptions){g.calendarOptions={}}ta.overlays.Factory._loadAvailDateWidget(l,k,"adults",i,j,g)},_loadAvailDateWidget:function(o,i,h,g,k,p){var m="in",j,n;if(o){o=new Event(o)}if(o&&o.target&&ta.id(o.target).hasClass&&(ta.id(o.target).hasClass("out_date")||(ta.has("guests_rooms_picker_3.enabled")&&ta.id(o.target).hasClass("outDateTrigger")))){m="out"}p.calendarOptions.pickerOption=m;n=ta.widgets.calendar.getCalendarObjectKey(i,g,m);j=ta.retrieve(n);if(j&&j.calendar.positionElement&&ta.id(j.calendar.positionElement).getParent("#PAGE")){j.show(h)}else{try{j=new ta.commerce.AvailDataWidget(o,i,h,g,k,p)}catch(l){ta.util.error.record(l,"load availDateWidget init error")}}},onClickMetaCheckRatesOverlay_allProviders:function(j,h,i,g){ta.overlays.Factory.metaCheckRatesOverlay_allProviders(i,g)},metaCheckRatesOverlay_allProviders:function(m,h){ta.overlays.Factory._recordLBOpen();ta.commerce.meta.clearStoredMiniData();if(ta.retrieve("assisted_booking_desktop_entry.logTreePoll")&&ta.id(h).getParents){var q=ta.id(h).getParents();q.each(function(r){if(r.hasClass("premium_offers_area")){if(ta.meta&&ta.meta.treeTrack&&ta.meta.treeTrack.hasTrackingTree(r)){ta.trk("n_more_sites",false,r)}}else{if(r.hasClass("metaPriceInfo")||(r.hasClass("illisting")&&ta.retrieve("servlet.smartdeals"))){if(ta.meta&&ta.meta.treeTrack){ta.meta.treeTrack.logTreeImpression();ta.trk("n_more_sites",false,r)}}}})}if(ta.retrieve("metaCheckRatesOverlay")){ta.retrieve("metaCheckRatesOverlay").hide()}ta.remove("metaCheckRatesOverlay");if(!ta.has("metaCheckRatesCSS")){ta.store("metaCheckRatesCSS",new Asset.css(metaCheckRatesCSS))}var o=ta.retrieve("pcr.overlay");if(o&&o.visible){o.hide()}var g="";if(ta.meta&&ta.meta.update){g=ta.meta.update.buildUrl("MetaCheckRatesAjax",m,false)}else{g=ta.commerce.checkrates.buildMetaHacUrl_allProviders(m,false,"lb_allProviders",true)}var p="metaCheckRatesOverlay";if(ta.retrieve("meta_lightbox_v3.enabled")){p+=" meta_lightbox_v3"}p+=" metaLightBoxChevron marketingTextLightBox";var j=window.location.hash==="#MAPVIEW"||(ta.id("map0Div")&&ta.id("map0Div").innerHTML!=="");if(j&&ta.retrieve("meta_lightbox_v3.enabled")){p+=" wide"}var k={style:p,backdropClickClose:true,backdrop:ta.overlays.BACKDROP_ALWAYS,closeButtonClass:ta.retrieve("meta_lightbox_v3.enabled")?"closeOverlayLarge":"roundOuterClose",remoteContent:g,onLoad:function(){var w=false,s,v;ta.store("isLightboxOpen",true);try{if(!ta.meta||!ta.meta.update){var t="meta_lb_checkrates";w=new ta.commerce.CheckRatesData({type:t,evnt:null},m,m,true);ta.store("ta.commerce.MetaHacOverlay.crData."+w.vendorSetId,w);v=w.getVendorSet().getAllVendorIds();s=w.getVendorSet().getCheckedVendor();ta.commerce.checkrates.updateMetaProviders(w)}var r=document.getElement(".metaCheckRatesOverlay .roundOuterClose");if(r&&!r.hasClass("no_cpu")){r.className+=" no_cpu"}ta.util.element.makeSameWidth(".metaCheckRatesOverlay .priceBlock");if(this.inner){ta.fireEvent("refreshedDOMContent",this.inner)}}catch(u){ta.util.error.record(u,"meta all providers overlay load issue")}if(ta.meta&&ta.meta.update){ta.meta.update.overlayRequest(m)}else{ta.commerce.checkrates.metaHacRequest(w,v,s)}},evalScripts:true,onClose:function(){ta.store("isLightboxOpen",false);var x="meta_lightbox",w,t;x="meta_lightbox_chevron";ta.trackEventOnPage(x,"close","");if(ta.retrieve("checkrates.meta_ui_post_click_prices")){var A=ta.retrieve("meta.baseLocationId");if(A&&m==A){if(ta.meta&&ta.meta.update){ta.meta.update.request(m)}else{if(t){ta.commerce.meta.updateProvAreaFromLightBox(t.vendorSetId)}}if(ta.has("metaCheckRatesUpdateDivInline")){ta.commerce.meta.updateInlineMeta(m)}}else{if(A){if(ta.has("ta.meta.navArea")){w=ta.retrieve("ta.meta.navArea")}var s=ta.id("MetaPricesTab");var u=false;if(s!=null&&s.hasClass("sprite-tab-active")){u=true}var C=ta.id("LOC_PHOTOS"),B=ta.id("AMENITY_LIGHTBOX"),r=false;if(C||B){r=true}var z=false;if(ta.has("metaCheckRatesUpdateDivInline")){if(u){if(!r){ta.commerce.meta.updateNavArea("QC_Meta_Inline");ta.commerce.meta.updateInlineMeta(A);z=true}else{try{ta.commerce.meta.tracking.setTimingForNavArea("QC_Meta_Inline")}catch(y){ta.util.error.record(y,"problem locking timing in Factory.metaCheckRatesOverlay_allProviders for QC_Meta_Inline")}try{ta.commerce.meta.tracking.setTimingForNavArea("QC_Meta_Mini")}catch(y){ta.util.error.record(y,"problem locking timing in Factory.metaCheckRatesOverlay_allProviders for QC_Meta_Mini")}ta.commerce.meta.updateNavArea("QC_Meta_Mini");if(ta.meta&&ta.meta.update){ta.meta.update.request(m)}else{t=ta.retrieve("ta.commerce.MetaHacOverlay.crData."+A);if(t){ta.commerce.meta.miniMetaAjax(null,t,1000)}}z=true;ta.commerce.meta.tracking.suppressImpressionsForArea("QC_Meta_Inline");ta.commerce.meta.tracking.suppressImpressionsForArea("QC_Meta_Mini");ta.commerce.meta.updateNavArea("QC_Meta_Inline");ta.commerce.meta.updateInlineMeta(A);ta.commerce.meta.tracking.removeSuppressedArea("QC_Meta_Inline");ta.commerce.meta.tracking.removeSuppressedArea("QC_Meta_Mini");try{ta.commerce.meta.tracking.resetTimingLockForNavArea("QC_Meta_Inline")}catch(y){ta.util.error.record(y,"problem un-locking timing in Factory.metaCheckRatesOverlay_allProviders for QC_Meta_Inline")}try{ta.commerce.meta.tracking.resetTimingLockForNavArea("QC_Meta_Mini")}catch(y){ta.util.error.record(y,"problem un-locking timing in Factory.metaCheckRatesOverlay_allProviders for QC_Meta_Mini")}}}else{if(ta.meta&&ta.meta.update){ta.meta.update.request(A)}else{t=ta.retrieve("ta.commerce.MetaHacOverlay.crData."+A);if(t!=null){ta.commerce.meta.updateNavArea("QC_Meta_Mini");ta.commerce.meta.miniMetaAjax(null,t,1000);z=true}}}}if(!ta.meta||!ta.meta.update){t=ta.retrieve("ta.commerce.MetaHacOverlay.crData."+A);if(t!=null&&!z){ta.commerce.meta.updateNavArea("QC_Meta_Mini");ta.commerce.meta.miniMetaAjax(null,t,1000)}}ta.commerce.meta.updateNavArea(w)}}}if(ta.retrieve("metaCheckRatesOverlay")){ta.retrieve("metaCheckRatesOverlay").destroy()}ta.remove("metaCheckRatesOverlay");ta.widgets.calendar.removeMetaCalendarFromSync(m);ta.widgets.calendar.closeCalendarWidgets();if(!ta.retrieve("meta.isDeals")&&(!ta.servlet.hotelsMap||!ta.servlet.hotelsMap.isMapOpen())){if(ta.retrieve("hotels.redesignEnabled")&&ta.retrieve("hotels.shouldIssueAjax")){ta.remove("hotels.shouldIssueAjax");ta.commerce.minimeta.ajax.send()}if(ta.retrieve("hotels.redesignEnabled")&&ta.retrieve("hotels.datesChanged")){ta.commerce.minimeta.doMetaDateSearch()}if(ta.retrieve("hotels.redesignEnabled")&&ta.retrieve("hotels.shouldHideClassicPrices")){var v=document.getElements(".classicPrice");v.each(function(D){D.hide()})}}}};if(ta.retrieve("checkrates.meta_ui_sk_box")||ta.retrieve("checkrates.meta_ui_sk_box_v2")||ta.retrieve("checkrates.meta_ui_sk_box_v3")){k.absoluteOffset=true;if(ta.retrieve("tablet_maps_v1")&&(window.innerHeight>window.innerWidth)){var n=72;var i=ta.find(".flexCard");if(i){n=i.clientHeight+80}k.yOffset=n+window.getScrollTop()}else{k.yOffset=72+window.getScrollTop()}}k.trigger=h;var l=new ta.overlays.CenteredOverlay(k,null);ta.store("metaCheckRatesOverlay",l);if(ta.has("locationPhotoAlbumOverlayResizeHack")){ta.retrieve("locationPhotoAlbumOverlayResizeHack")()}},metaCheckRatesOverlay:function(h,g,q,l){ta.overlays.Factory._recordLBOpen();ta.commerce.meta.clearStoredMiniData();ta.store("metaCheckRatesOverlay",null);if(!ta.has("metaCheckRatesCSS")){ta.store("metaCheckRatesCSS",new Asset.css(metaCheckRatesCSS))}var n=ta.retrieve("pcr.overlay");if(n&&n.visible){n.hide()}var p="";if(ta.meta&&ta.meta.update){if(!ta.has("ta.meta.request.locId")){return}p=ta.meta.update.buildUrl("MetaCheckRatesAjax",ta.retrieve("ta.meta.request.locId"),false)}else{p=ta.commerce.checkrates.buildMetaHacUrl(h,g,q,false)}var o="metaCheckRatesOverlay";if(ta.retrieve("meta_lightbox_v3.enabled")){o+=" meta_lightbox_v3"}o+=" metaLightBoxChevron";var i=window.location.hash==="#MAPVIEW"||(ta.id("map0Div")&&ta.id("map0Div").innerHTML!=="");if(i&&ta.retrieve("meta_lightbox_v3.enabled")){o+=" wide"}var j={style:o,backdropClickClose:true,backdrop:ta.overlays.BACKDROP_ALWAYS,closeButtonClass:ta.retrieve("meta_lightbox_v3.enabled")?"closeOverlayLarge":"roundOuterClose",remoteContent:p,onLoad:function(){if(ta.meta&&ta.meta.update){if(!ta.has("ta.meta.request.locId")){return}ta.meta.update.overlayRequest(ta.retrieve("ta.meta.request.locId"))}else{ta.commerce.checkrates.updateMetaProviders(h);ta.commerce.checkrates.metaHacRequest(h,g,q)}var r=document.getElement(".metaCheckRatesOverlay .roundOuterClose");if(r){r.className+=" no_cpu"}},evalScripts:true,onClose:function(){var s=this.source&&this.source.getParent(".gcrabLb");var r="meta_lightbox_chevron";ta.trackEventOnPage(r,"close","");if(!s){ta.overlays.Factory.updateMiniMetaPlacements(h)}k.destroy();if(!s){ta.store("metaCheckRatesOverlay",null);if(ta.meta&&ta.meta.update){if(!ta.has("ta.meta.request.locId")){return}ta.widgets.calendar.removeMetaCalendarFromSync(ta.retrieve("ta.meta.request.locId"))}else{ta.widgets.calendar.removeMetaCalendarFromSync(h.vendorSetId)}ta.widgets.calendar.closeCalendarWidgets();if(ta.retrieve("hotels.redesignEnabled")&&ta.retrieve("hotels.shouldIssueAjax")){ta.remove("hotels.shouldIssueAjax");ta.commerce.minimeta.ajax.send()}if(ta.retrieve("hotels.redesignEnabled")&&ta.retrieve("hotels.datesChanged")&&!ta.id("LOC_PHOTOS")&&pageServlet!="SmartDeals"){ta.commerce.minimeta.doMetaDateSearch();ta.remove("hotels.datesChanged")}if(ta.retrieve("hotels.redesignEnabled")&&ta.retrieve("hotels.shouldHideClassicPrices")){var t=document.getElements(".classicPrice");t.each(function(u){u.hide()})}}}};if(!j.trigger){var m=ta.retrieve("ta.hlb_el");if(m){j.trigger=m}}if(ta.retrieve("checkrates.meta_ui_sk_box")||ta.retrieve("checkrates.meta_ui_sk_box_v2")||ta.retrieve("checkrates.meta_ui_sk_box_v3")){j.absoluteOffset=true;j.yOffset=72+window.getScrollTop()}var k=new ta.overlays.CenteredOverlay(j,l);ta.store("metaCheckRatesOverlay",k);if(ta.has("locationPhotoAlbumOverlayResizeHack")){ta.retrieve("locationPhotoAlbumOverlayResizeHack")()}},updateMiniMetaPlacements:function(j){var o=ta.retrieve("meta.baseLocationId"),l;if(!o&&ta.id("LOC_PHOTOS")){var s=ta.id("LOC_PHOTOS").getElement("#CHECK_RATE");if(s&&/id_(\d+)/.test(s.className)){o=RegExp.$1}}if(ta.has("ta.meta.navArea")){l=ta.retrieve("ta.meta.navArea")}if(o){var i=ta.id("MetaPricesTab");var k=false;if(i!=null&&i.hasClass("sprite-tab-active")){k=true}var t=ta.id("LOC_PHOTOS");var q=ta.id("AMENITY_LIGHTBOX");var h=ta.id("CHECK_RATES_LB");var g=false;if(t||q||h){g=true}var n=false;if(ta.has("metaCheckRatesUpdateDivInline")){if(k){if(g){try{ta.commerce.meta.tracking.setTimingForNavArea("QC_Meta_Inline")}catch(m){ta.util.error.record(m,"problem locking timing in Factory.metaCheckRatesOverlay for QC_Meta_Inline")}try{ta.commerce.meta.tracking.setTimingForNavArea("QC_Meta_Mini")}catch(m){ta.util.error.record(m,"problem locking timing in Factory.metaCheckRatesOverlay for QC_Meta_Mini")}ta.commerce.meta.updateNavArea("QC_Meta_Mini");if(ta.meta&&ta.meta.update){ta.meta.update.request(o)}else{if(typeof(dd)!=="undefined"&&dd.commerce&&dd.commerce.checkrates){dd.commerce.checkrates.checkRatesMiniMeta(null,document.getElementById("CHECK_RATE"),o,"checkrates")}}n=true;ta.commerce.meta.tracking.suppressImpressionsForArea("QC_Meta_Inline");ta.commerce.meta.tracking.suppressImpressionsForArea("QC_Meta_Mini");ta.commerce.meta.updateNavArea("QC_Meta_Inline");ta.commerce.meta.updateInlineMeta(o);ta.commerce.meta.tracking.removeSuppressedArea("QC_Meta_Inline");ta.commerce.meta.tracking.removeSuppressedArea("QC_Meta_Mini");try{ta.commerce.meta.tracking.resetTimingLockForNavArea("QC_Meta_Inline")}catch(m){ta.util.error.record(m,"problem un-locking timing in Factory.metaCheckRatesOverlay_allProviders for QC_Meta_Inline")}try{ta.commerce.meta.tracking.resetTimingLockForNavArea("QC_Meta_Mini")}catch(m){ta.util.error.record(m,"problem un-locking timing in Factory.metaCheckRatesOverlay_allProviders for QC_Meta_Mini")}}else{if(ta.retrieve("checkrates.meta_ui_post_click_prices")&&ta.widgets.calendar.datesExist()){ta.commerce.meta.updateNavArea("QC_Meta_Inline");ta.commerce.meta.updateInlineMeta(o);n=true}}}else{if(ta.retrieve("checkrates.meta_ui_post_click_prices")&&ta.widgets.calendar.datesExist()){ta.commerce.meta.updateNavArea("QC_Meta_Mini");if(ta.meta&&ta.meta.update){ta.meta.update.request(o)}else{if(typeof(dd)!=="undefined"&&dd.commerce&&dd.commerce.checkrates){dd.commerce.checkrates.checkRatesMiniMeta(null,document.getElementById("CHECK_RATE"),o,"checkrates")}}n=true}}}if((ta.retrieve("checkrates.meta_ui_post_click_prices")||t)&&ta.widgets.calendar.datesExist()&&!n){ta.commerce.meta.updateNavArea("QC_Meta_Mini");var p=document.getElementById("CHECK_RATE");if(!ta.retrieve("checkrates.meta_ui_post_click_prices")&&t){p=t.getElement("#CHECK_RATE");if(ta.retrieve("hotels.redesignEnabled")&&ta.retrieve("hotels.datesChanged")){var r=t.getParent(".overlay");if(r&&r.overlay){r.overlay.addEvent("onHide",function(){ta.commerce.minimeta.doMetaDateSearch()})}}}if(ta.meta&&ta.meta.update){ta.meta.update.request(o)}else{if(typeof(dd)!=="undefined"&&dd.commerce&&dd.commerce.checkrates){dd.commerce.checkrates.checkRatesMiniMeta(null,p,o,"checkrates",true)}}}}else{if(j){ta.commerce.meta.updateInlineMeta(j.vendorSetId)}}ta.commerce.meta.updateNavArea(l)},createPersistentFilterOverlay:function(){var h=document.getElement(".filterControls");if(!h){return}var g={toWindow:false,autoShow:false,yOffset:-60,permanent:true,showCloseButton:false,style:"persistentFilterOverlay",positionType:"fixed",innerDivClass:h.className,onShow:function(){ta.util.element.moveContent(h,this.inner)},onHide:function(){ta.util.element.moveContent(this.inner,h)}};ta.store("persistentFiltersOverlay",new ta.overlays.AbsoluteOverlay(g));window.addEvent("scroll",ta.servlet.HACSearch.showPersistentFilters)},_recordLBOpen:function(){if(!ta.remove("skipLBGARecord")){var g=ta.remove("meta.lightboxOpener")||(ta.retrieve("meta.calendarCR")?"calendar":"button");var h="meta_lightbox_chevron";ta.trackEventOnPage(h,"open",g)}},createTAListingPolicyOverlay:function(h,g,j,i){var k=ta.id(j);if(k!=null){new ta.overlays.CenteredOverlay({style:"s3 dg rgba_gry",backdrop:ta.overlays.BACKDROP_ALWAYS,content:k.get("html"),isChild:i},null)}},greenLeaderTrack:function(m){var l=window.location.href.match(/\/\/.*?\/([^-?]+)/)[1];var k=m.target.className;var g=m.target.id;if(l){var i="GreenLeaders";var j;var h;if(l==="Hotels"||l==="HACSearch"){j="HOTELS"}else{if(l==="Hotel_Review"||l==="ShowUserReviews"){j="HR"}else{if(l==="UserReviewEdit"){j="REVIEW_FORM"}}}if(k.match("seeFullLnk")){h="SEE_ALL"}else{if(k.match("greenLeaderLabelLnk")){h="GREEN_LEADERS_BADGE"}else{if(g.match("ReportIAP")){h="REPORT_PROBLEM"}}}if(i&&j&&h){ta.trackEventOnPage(i,j,h)}}},greenLeaderOverlay:function(l,j,i,k){if(l||window.event){new Event(l||window.event).preventDefault()}ta.overlays.Factory.greenLeaderTrack(new Event(l));var g="/GreenLeaderAjax?locationId="+i+"&showSummary="+k;if(ta.retrieve("greenLeaderOverlay")){ta.retrieve("greenLeaderOverlay").loadRemoteContent(g,true)}else{var h=new ta.overlays.CenteredOverlay({style:"tooltip ttWhite big",autoShow:false,delayedPosition:true,backdrop:ta.overlays.BACKDROP_ALWAYS,permanent:true,showCloseButton:true,backdropClickClose:true,zIndex:2001,onLoad:function(){if(ta.retrieve("greenLeaderOverlay")){this.show()}else{this.show.delay(200,this);ta.store("greenLeaderOverlay",this)}}},j);h.loadRemoteContent(g,true)}},certificateOfExcellenceOverlay:function(j,h,g){if(j||window.event){new Event(j||window.event).preventDefault()}ta.trackEventOnPage("CertificatOfExcellence",g,"Certificate_Of_Excellence_Badge");var i=ta.id("COE_OVERLAY_CONTENTS");if(i){return new ta.overlays.CenteredOverlay({style:"tooltip ttWhite big coeOverlay",backdrop:ta.overlays.BACKDROP_ALWAYS,delayedPosition:true,showCloseButton:true,backdropClickClose:true,zIndex:2001},h).loadRemoteSuccess(i.innerHTML)}return null},miniMetaCrossSellMicroOverlay:function(s,j,n,i){try{j.onmouseover=null;j.onclick=null;var g;if(ta.meta&&ta.meta.update){g=ta.meta.update.buildUrl("MicroMetaAjax",n,true,false,"QC_Meta_Mini|Related_XSell")}else{var l=new ta.commerce.CheckRatesData({type:"checkrates",evnt:s},j,n,true);var k=l.getVendorSet().getCheckedContentID();var u=l.getVendorSet().getCheckedVendor();var t=ta.retrieve("meta.travelData");t=ta.commerce.checkrates.getTravelDataFromDOM();g=ta.commerce.checkrates.buildVarMetaHacUrl("MicroMetaAjax",l,k,u,true,null,"QC_Meta_Mini|Related_XSell",t)}g+="&lowContentID="+i;g+="&drop=true";var p=j.className.match(/noDelayFirst/);var r=j.className.match(/delayOpen/);var o=ta.retrieve("delayedFirst");var h=!r||(p&&!o);var m=new ta.overlays.RelativeOverlayBelow({style:"",allowFlip:false,activate:ta.overlays.ACTIVATE_HOVER_DELAY,autoShow:h,delayShow:r,offsetLeft:0,offsetTop:-20,showCloseButton:false},j);m.loadRemoteContent(g,false);ta.store("delayedFirst",true)}catch(q){ta.util.error.record(q,"ta.overlays.factory.miniMetaCrossSellMicroOverlay")}},helpCenterLB:function(g,h){try{if(g||window.event){new Event(g||window.event).preventDefault()}new ta.overlays.CenteredOverlay({style:"s3 dg help_center",showCloseButton:true,backdropClickClose:true,backdrop:ta.overlays.BACKDROP_ALWAYS,remoteContent:"/uvpages/helpCenterOverlay.html"},h)}catch(i){ta.util.error.record(i,"ta.overlays.factory.helpCenterLB")}return false},installmentRateTip:function(h,g){g=ta.id(g);new ta.overlays.RelativeOverlayAbove({style:"",innerDivClass:"installmentRateTipOverlay",activate:ta.overlays.ACTIVATE_HOVER,pinnable:ta.overlays.PINNABLE_CLICK,allowFlip:true,content:"<span>"+ta.retrieve("meta.paymentsTipText")+"</span>"},g)},jfyMoreTagOverlay:function(h,g,j){if(h){new Event(h).stop()}var i=ta.id(j);i=i.clone();new ta.overlays.RelativeOverlayAbove({style:"moreTagOverlay",activate:ta.overlays.ACTIVATE_HOVER,showCloseButton:false,content:i.innerHTML},g)},starAttributionOverlay:function(h,g){ta.common.flyout.starAttribution(h,g)},tripTypeSelectOverlay:function(i,g){if(!g||!i){return}g.onclick=null;i.stop();ta.trackEventOnPage("Reviews_Controls","filter_dropdown","");var h=document.getElement(".tripTypeOverlayContents");if(!h){return}h.show();new ta.overlays.RelativeOverlayBelow({style:"tripTypeSelectOverlay",activate:ta.overlays.ACTIVATE_CLICK,showCloseButton:false,content:h,offsetTop:3},g)},languageFilterSelectOverlay:function(i,g){if(!g||!i){return}g.onclick=null;i.stop();var h=document.getElement(".languageList");if(!h){return}h.show();new ta.overlays.RelativeOverlayRight({style:"tripTypeSelectOverlay",activate:ta.overlays.ACTIVATE_HOVER,showCloseButton:false,content:h,offsetLeft:-13},g)},reviewLanguageOverlay:function(i,g){if(!g||!i){return}g.onclick=null;i.stop();var h=document.getElement(".languageList");if(!h){return}var j=g.getSize().x-16;new ta.overlays.RelativeOverlayBelow({style:"reviewLanguageOverlay",activate:ta.overlays.ACTIVATE_CLICK,showCloseButton:false,content:h,offsetTop:1,offsetLeft:j},g)},reviewSeasonOverlay:function(i,g){if(!g||!i){return}g.onclick=null;i.stop();var h=document.getElement(".seasonList");if(!h){return}new ta.overlays.RelativeOverlayBelow({style:"reviewLanguageOverlay",activate:ta.overlays.ACTIVATE_CLICK_TOGGLE,showCloseButton:false,content:h,offsetTop:1},g)},topDestinationsOverlay:function(i,g){if(!g||!i){return}g.onclick=null;i.stop();var h=document.getElement(".topDestinationsList");if(!h){return}new ta.overlays.RelativeOverlayBelow({style:"topDestinationsOverlay",activate:ta.overlays.ACTIVATE_CLICK_TOGGLE,showCloseButton:false,content:h,offsetTop:1},g)},translationRatingsOverlay:function(j,g){if(!g||!j){return}g.onclick=null;j.stop();var i=g.getParent("form");if(i){var h=i.getElement(".ratingList");if(!h){return}new ta.overlays.RelativeOverlayBelow({style:"mtRatingOverlay",noPadding:true,activate:ta.overlays.ACTIVATE_CLICK,showCloseButton:false,content:h},g)}},installExitInterrupter:function(){ta.servlet.HotelReview.installExitInterrupter()},ipLearnMoreMenu:function(h,g){if(!g||!h){return}g.onclick=null;h.stop();new ta.overlays.RelativeOverlayBelow({activate:ta.overlays.ACTIVATE_CLICK,style:"dropMenu dropMenu_refresh"},g);new Request({url:"/ActionRecord?action=FBIP-PersistentHeader-Flyout"}).send()},logTrackingTree:function(){var g=document.getElement(".micro_meta_flyout");if(g){var h=g.getElement(".impressionTrackingTree");if(h){ta.trkImpTree(h)}}},loadDatePickerOverlay:function(i,h,g){ta.call("ta.p13n.wizard.loadDatePickerOverlay",i,h,g)},racLBDelegates:function(){function g(){}function h(){}return{onLoad:g,onClose:h}},racGeoSearchDelegates:function(g){return{onLoad:function(){ta.restaurantAvailabilitySearch.init(g)}}},createSearchPageScopeSelect:function(g,h){if(!g||!h){return}return new ta.overlays.RelativeOverlayBelow({style:"geo_select_flyout",closeOnDocumentClick:true,content:h},g)},rrBaselineSurveyOverlay:function(){var h=new ta.overlays.CenteredOverlay({showCloseButton:false,backdrop:ta.overlays.BACKDROP_ALWAYS,style:"rrBaselineSurveyOverlay",onShow:function(){localStorage.setItem("rrBaselineSurveySeen",true);ta.trackEventOnPage("rrsat_survey","offered","")}});var i=new Element("h1").set("text",ta.retrieve("r_survey_title"));var n=new Element("p").set("text",ta.retrieve("rr_survey_p1"));var m=new Element("p").set("text",ta.retrieve("rr_survey_p2"));var g=new Element("div").set("text",ta.retrieve("rr_survey_yes")).addClass("rndBtn rndBtnGreen rndBtnLarge yesButton");g.addEvent("click",function(){var p="http://tripadvisor.fluidsurveys.com/s/rrsat/";var r=window.posLocale&&window.posLocale.substr(0,2);if(r==="en"||r==="el"){r="eng"}else{if(r==="iw"){r="he"}}if(r){p+="lang"+r+"/"}var q={};if(ta.has("rr_survey_session")){q.sid=ta.retrieve("rr_survey_session")}if(ta.has("rr_survey_pgps")){q.pgps=ta.retrieve("rr_survey_pgps")}p+="?"+Object.toQueryString(q);ta.trackEventOnPage("rrsat_survey","accepted","");window.open(p,"rr_baseline_survey","menubar=no,location=no,resizable=yes,scrollbars=yes,status=yes,width=800,height=500");h.hide()});var o=new Element("div").set("text",ta.retrieve("rr_survey_no")).addClass("rndBtn rndBtnLarge noButton");o.addEvent("click",function(){h.hide();ta.trackEventOnPage("rrsat_survey","declined","")});var l=new Element("div").addClass("buttons");l.adopt(g,o);var j=new Element("div");j.adopt(i,n,m,l);h.inner.setContent(j);h.show();var k=function(p){if(p.keyCode==27){h.hide();document.removeEvent("keyup",k)}};document.addEvent("keyup",k)},loadingMostRecentDraftOverlay:function(h,i){if(h){var g=new ta.overlays.CenteredOverlay({showCloseButton:false,backdrop:ta.overlays.BACKDROP_ALWAYS,content:h.innerHTML,backdropColor:"#FFF",backdropOpacity:0.8,style:"loadingMostRecentDraftOverlay"});i();setTimeout(function(){g.hide()},3000)}},taSupportOverlay:function(g){if(!g){return}new ta.overlays.CenteredOverlay({showCloseButton:true,content:g.innerHTML,backdrop:ta.overlays.BACKDROP_ALWAYS,style:"taSupportOverlay",closeButtonClass:"xCloseGreen"})}}})();(function(a){Object.append(a,{injectReviewSummaryContentFromConcept:function(c){try{var b=ta.retrieve("topconcepts.rsContent")[c];if(!b){ta.util.error.record(null,"injectReviewSummaryContentFromConcept - no content")}ta.overlays.Factory.injectReviewSummaryContent(b)}catch(d){ta.util.error.record(d,"injectReviewSummaryContentFromConcept")}},injectReviewSummaryContent:function(c){try{var b=ta.retrieve("reviewSummaryOverlay");if(b){b.inner.setContent(c);b.show()}else{ta.util.error.record(null,"injectReviewSummaryContent - no overlay")}}catch(d){ta.util.error.record(d,"injectReviewSummaryContent")}},storeReviewSummaryContent:function(d,c){var b=ta.retrieve("topconcepts.rsContent");if(!b){b={}}b[d]=c;ta.store("topconcepts.rsContent",b)},addSummaryBoxContentAndShow:function(d,g){try{var h=ta.retrieve("reviewSummaryOverlay");ta.overlays.Factory.injectReviewSummaryContent(g);var c=null;var k=ta.id("TRAV_SAY_TERMS");if(typeof(k)!=undefined&&k!=null){var b=k.clone(true,false);b.addClass("col1of2");c=new Element("div",{"class":"wrap bx02 rd_concepts"});c.adopt(b)}else{c=ta.id("SUMMARYBOX").clone(true,false)}var j=h.inner;j.getElement(".title").adopt(c);var l="concept_"+d.replace(/ /g,"_");var i=document.getElement(".overlay .rd_concepts ."+l);if(i){i.removeClass("taLnk").removeClass("hvrIE6").addClass("conceptSelected").onClick=""}Array.each(j.getElements(".rd_concepts .snippetText"),function(e){var n=ta.id(e);n.removeClass("snippetText");n.removeClass("sprite-middot");n.removeClass("trip_type_snippet");n.addClass("conceptBullet");var m=n.getElement(".taLnk");if(m){m.setProperty("onclick","ta.util.cookie.setPIDCookie(25223);ta.call('ta.overlays.Factory.showReviewSummaryV2',event, this);")}});ta.overlays.Factory.storeReviewSummaryContent(d,j.get("html"));ta.overlays.Factory.injectReviewSummaryContentFromConcept(d)}catch(f){ta.util.error.record(f,"updateReviewSummaryContent - request.onSuccess")}},updateReviewSummaryContent:function(c,b){try{if(ta.has("reviewSummaryOverlay")&&ta.has("topconcepts.rsContent")&&ta.retrieve("topconcepts.rsContent")[c]){ta.overlays.Factory.injectReviewSummaryContentFromConcept(c);return}if(ta.has("reviewSummaryOverlay")){new Request({url:b,onSuccess:function(e){ta.overlays.Factory.addSummaryBoxContentAndShow(c,e)},evalScripts:true,method:"get"}).send();return}else{ta.util.error.record(null,"updateReviewSummaryContent - no overlay")}}catch(d){ta.util.error.record(d,"updateReviewSummaryContent")}},getReviewSummaryUrl:function(f,e,i,c){ta.store("topconcepts.lastconcept",f);if(typeof modelLocId=="undefined"||typeof modelGeoId=="undefined"){var h=(typeof modelLocId=="undefined")?"undefined":modelLocId;var d=(typeof modelGeoId=="undefined")?"undefined":modelGeoId;ta.util.error.record(null,"getReviewSummaryUrl",null,{locId:h,geoId:d})}if(i&&c){ta.util.cookie.setPIDCookie(16007);var g="/MachineTranslation?";if(e.id){var f;if(e.id.indexOf("trans_")!=-1){f=e.id.replace("trans_","").replace(/_/g," ")}else{f=e.id.replace("concept_","").replace(/_/g," ")}ta.store("topconcepts.lastconcept",f);g+="page=summary&";g+="d="+modelLocId+"&";g+="concept="+f;g+="&sl=en&tl="+i}return g}var b="/HotelSummary?d="+modelLocId+"&geo="+modelGeoId+"&concept="+f;if(i){b+="&autotrans=true"}return b},getReviewSummaryConcept:function(b){try{var c=b.id?b.id:b.className.match("(concept_[a-zA-Z0-9-_]+)")[1];return c.replace("concept_","").replace(/_/g," ")}catch(d){ta.util.error.record(d,"getReviewSummaryConcept",null,{id:b.id,"class":b.className})}return""},showReviewSummaryV2:function(h,e,g,c){if(h){h.stop()}var f=ta.overlays.Factory.getReviewSummaryConcept(e);var b=ta.overlays.Factory.getReviewSummaryUrl(f,e,g,c);if(ta.has("reviewSummaryOverlay")){ta.overlays.Factory.updateReviewSummaryContent(f,b);return}ta.overlays.Factory._loadSummaryCss();var d=new ta.overlays.CenteredOverlay({style:"s3 dg nopadding rgba_gry",autoShow:false,permanent:true,showCloseButton:true,remoteContent:b,onLoad:function(i){try{ta.store("topconcepts.overlay."+f,this);ta.overlays.Factory.addSummaryBoxContentAndShow(f,this.inner.innerHTML);this.show()}catch(j){ta.util.error.record(j,"showReviewSummary - overlay onload")}}},e);ta.store("reviewSummaryOverlay",d)}})})(ta.overlays.Factory);ta.overlays.CalendarOverlay=new Class({Extends:ta.overlays.RelativeOverlayBelow,options:{showCloseButton:true,activate:ta.overlays.ACTIVATE_FOCUS,style:"typeO ocal",autoShow:false,autoShowCal:false,calendarOptions:null,flipPadding:25,zIndex:999,extraShow:null},initialize:function(a,b){this.input=a.getElement("input[type=text]");this.parent(b,this.input);this.input.overlay=this;this.dayField=a.getElement("input.day");this.monthField=a.getElement("input.month");this.source.addEvent("click",this.show);this.icn=a.getElement("span.icn");if(this.icn){this.icn.onclick="";this.icn.addEvent("click",this.show)}var c=a.className.search("first")>=0;this.calendar=new ta.widgets.Calendar(Object.merge({dualCalendar:true,choiceLink:"ta.overlays.calendarSelect",prevAction:"ta.overlays.calendarPrev",nextAction:"ta.overlays.calendarNext",onSelect:this.select.bind(this),onClear:this.clear.bind(this),isFirstCal:c},this.options.calendarOptions));this.inner.adopt(this.calendar.container);this.parentOverlay=a.getParent(".overlay");if(this.parentOverlay){this.parentOverlay=this.parentOverlay.overlay;this.options.isChild=true}if(this.options.autoShowCal){this.show()}},destroy:function(){this.parent();this.input.overlay=null},show:function(c,a){if(this.options.extraShow){this.options.extraShow(this)}this.input.addClass("selected");var b=this.visible;this.parent(c);if(b&&!a){return}if(this.parentOverlay&&this.parentOverlay.pin&&this.parentOverlay.options.pinnable==ta.overlays.PINNABLE_CLICK){this.tempPin=!this.parentOverlay.pinned;if(this.tempPin){this.parentOverlay.pin()}}this.loadFields();this.calendar.update();this.calendar.reposition();return this},hide:function(a){if(!this.visible){return}this.parent(a);if(this.parentOverlay&&this.tempPin){this.tempPin=false;this.parentOverlay.unpin()}},hideNow:function(a){this.input.removeClass("selected");if(!this.visible){return this}this.parent(a);if(this.parentOverlay&&this.tempPin){this.tempPin=false;this.parentOverlay.unpin()}},select:function(a,b){if(b){new Event(b).preventDefault()}this.updateFields();if(!a.options.dontHideOnSelect){this.hide()}this.fireEvent("onSelect",this,!!b)},hover:function(b,a){this.fireEvent("onHover",[b,this,a])},mouseout:function(a){this.fireEvent("onMouseOutOnDate",[this,a])},clear:function(a,b){b&&new Event(b).preventDefault();this.clearFields();this.hide();this.fireEvent("onClear",this)},loadFields:function(){var b=parseInt(this.dayField.value.replace(/^0/,""));var a=this.monthField.value.split(/\//);if(a.length!=2){return}var c=parseInt(a[1]);if(ta.retrieve("thai_buddhist_era_year")&&c>=(new Date().getFullYear()+ta.util.date.THAI_BUDDHIST_YEAR_OFFSET)){c-=ta.util.date.THAI_BUDDHIST_YEAR_OFFSET}a=parseInt(a[0].replace(/^0/,""));this.calendar.selectedDate=ta.util.date.create(c,a-1,b);return this},updateFields:function(){if(!this.calendar.selectedDate){this.loadFields()}if(!this.calendar.selectedDate){return}var a=this.calendar.selectedDate.getMonth()+1;if(a<10){a="0"+a}this.dayField.value=this.calendar.selectedDate.getDate();this.monthField.value=a+"/"+this.calendar.selectedDate.getFullYear();var b=this.calendar.selectedDate.getFullYear();if(ta.retrieve("thai_buddhist_era_year")){b=b+ta.util.date.THAI_BUDDHIST_YEAR_OFFSET}this.input.value=formatDate(this.calendar.selectedDate.getDate(),this.calendar.selectedDate.getMonth(),b);this.input.removeClass&&this.input.removeClass("placeholder")},clearFields:function(){if(this.options.calendarOptions&&!this.options.calendarOptions.clearToBlank){this.input.value=this.input.getAttribute("placeholderValue")||JS_DateFormat}else{if(this.input.value==this.input.defaultValue){this.input.value=""}}},clearDateFields:function(){this.calendar.selectedDate=null;this.dayField.value="";this.monthField.value="";this.clearFields()},resetFieldsIfBlank:function(){if(this.input.value==""){this.input.value=this.input.defaultValue}},validate:function(){var b=this.input.value.match(DATE_FORMAT.pattern);if(b){var c=parseInt(b[DATE_FORMAT.date].replace(/^0/,""));var a=parseInt(b[DATE_FORMAT.month].replace(/^0/,""));var d=parseInt(b[DATE_FORMAT.year].replace(/^0/,""));if(c>0&&c<32&&a>0&&a<13){if(c<10){c="0"+c}if(a<10){a="0"+a}if(d<100){d+=2000}this.dayField.value=c;this.monthField.value=a+"/"+d;this.loadFields();if(!this.calendar.isValid()){return sInvalidDates}}else{return sInvalidDates}}else{return sInvalidDates}return null}});ta.overlays.createCalendar=function(b,a){new Event(b).preventDefault();a.onfocus="";new ta.overlays.CalendarOverlay($(a).getParent(".cal"),{autoShowCal:true})};ta.overlays.createCustomCalendar=function(c,b,a){new Event(c).preventDefault();b.onfocus="";new ta.overlays.CalendarOverlay($(b).getParent(".cal"),{autoShowCal:true,calendarOptions:a})};ta.overlays.calendarSelect=function(f,e,a,c,b){if(ta.has("checkrates.calendarActionRecord")){ta.util.cookie.removePIDCookie();ta.meta.linkTracking.actionRecord(ta.retrieve("checkrates.calendarActionRecord"))}ta.id(b).getParent(".overlay").overlay.calendar.select(f,ta.util.date.create(e,a,c));if(ta.has("checkrates.meta_calendar_style_on_classic")&&(Browser.ie||Browser.chrome)){ta.popups.PopUtil.attemptHoldingWindow(ta.meta.cr.getPropIdFromCRElement(ta.id(b).getParent(".overlay").overlay.input))}};ta.overlays.calendarPrev=function(b,a){ta.id(a).getParent(".overlay").overlay.calendar.prev()};ta.overlays.calendarNext=function(b,a){ta.id(a).getParent(".overlay").overlay.calendar.next()};ta.overlays.PairedCalendar=new Class({Implements:[Options,Events],options:{validate:false,validateFun:function(){},allowSameDay:false,calendarOptions:null,defaultSpan:1,keepDelta:false,clearDatesId:"clearDates",overlayOptions:{},overlayFirstOptions:null,disallowChars:false,disableInvalidEndDates:false,showCalIfInvalid:false,clearOnRestart:false,allowReverse:false},initialize:function(b,a){this.setOptions(a);b=ta.id(b);this.form=b.get("tag")=="form"?b:b.getParent("form");var c=Object.merge({onSelect:this.adjustRange.bind(this)},this.options.overlayOptions);if(this.options.calendarOptions){c.calendarOptions=this.options.calendarOptions}this.form.getElements(".cal").each(function(d){var f;if(d.hasClass("first")&&this.options.overlayFirstOptions){f=new ta.overlays.CalendarOverlay(d,Object.merge(Object.clone(c),this.options.overlayFirstOptions))}else{f=new ta.overlays.CalendarOverlay(d,c)}f.input.onfocus="";if(this.options.disallowChars){f.input.addEvent("keypress",this.validateInput.bind(this))}if(d.hasClass("first")){this.before=f}else{this.after=f;if(ta.has("isDaoDaoCRRedesign")){var e=this.form.get("qc_area");this.after.qcArea=e;this.before.qcArea=e}}},this);if(ta.retrieve("isDaoDao")){ta.store("cal_in",this.before);ta.store("cal_out",this.after)}this.after.theOtherCal=this.before;this.before.theOtherCal=this.after;this.after.calendar.theOtherCal=this.before.calendar;this.before.calendar.theOtherCal=this.after.calendar;if(b===this.before.input||b===this.before.icn){this.after.loadFields();if(this.before.options.autoShowCal){this.before.show()}}else{if(b===this.after.input||b===this.after.icn){this.before.loadFields();if(this.after.options.autoShowCal){this.after.show()}}}if(this.form){this.form.calendar=this;if(this.options.validate){this.form.addEvent("submit",this.validate.bind(this));this.errorDiv=this.form.getElement(".error_msg")}}},getOverlayForCalendar:function(a){if(this.before.calendar==a){return this.before}if(this.after.calendar==a){return this.after}return null},adjustRange:function(c){this.requireFullLoad();if(this.form.searchAll){if(this.form.searchAll.type=="checkbox"){this.form.searchAll.checked=false}else{if(this.form.searchAll.type=="hidden"){this.form.searchAll.value="false"}}}var b=ta.id(this.options.clearDatesId);if(b){b.style.visibility="visible"}var h=false;if(this.options.clearOnRestart&&c===this.before){this.after.clearDateFields()}else{if(this.options.allowReverse&&c===this.after&&this.before.calendar.selectedDate&&this.after.calendar.selectedDate.getTime()<this.before.calendar.selectedDate.getTime()){var k=this.before.calendar.selectedDate;this.before.calendar.selectedDate=this.after.calendar.selectedDate;this.after.calendar.selectedDate=k;this.before.updateFields();this.after.updateFields()}else{if(!this.sameDayEnabled()&&!this.options.disableInvalidEndDates&&this.after.calendar.selectedDate&&this.after.calendar.selectedDate.getTime()==this.after.calendar.options.firstDate.getTime()){this.before.calendar.selectedDate=new Date(this.before.calendar.options.firstDate);if(this.options.keepDelta){this.options.defaultSpan=1}var k=new Date(this.after.calendar.options.firstDate);k.setDate(k.getDate()+this.options.defaultSpan);this.after.calendar.selectedDate=k;this.before.updateFields();this.after.updateFields()}else{if(c==this.before){if(this.options.keepDelta||!this.isBeforeValid()){var k=new Date(this.before.calendar.selectedDate);k.setDate(k.getDate()+this.options.defaultSpan);this.after.calendar.selectedDate=k;h=true}this.after.updateFields()}else{if(c==this.after){if(!this.isAfterValid()){var k=new Date(this.after.calendar.selectedDate);k.setDate(k.getDate()-this.options.defaultSpan);if(k.getTime()<this.before.calendar.options.firstDate.getTime()){k=new Date(this.before.calendar.options.firstDate.getTime())}this.before.calendar.selectedDate=k}this.before.updateFields()}}}if(this.options.keepDelta&&this.before.calendar.selectedDate){this.options.defaultSpan=ta.util.date.getDaysInRange(this.before.calendar.selectedDate,this.after.calendar.selectedDate)-1;if(this.sameDayEnabled()){if(this.options.defaultSpan<0){this.options.defaultSpan=0}}else{if(this.options.defaultSpan<1){this.options.defaultSpan=1}}}}}this.fireEvent("onUpdate",this);var g=ta.retrieve("calendar.onUpdateCallback");if(g){for(var f=0;f<g.length;f++){if(window[g[f]]){window[g[f]](this,c)}}}this.updateMinStay(this.before.calendar.selectedDate,this.after.calendar.selectedDate);try{var a="before";if(c==this.after){a="after"}}catch(j){ta.util.error.record(j,"availability check - paired cal")}if(this.options.disableInvalidEndDates){if(c==this.before){var k=new Date(this.before.calendar.selectedDate);k.setDate(k.getDate()+1);this.after.calendar.options.firstDate=k;if(h){this.after.show()}}}},updateMinStay:function(a,c){var b=ta.id("minStay");if(b&&a&&c){b.disabled=true;b.selectedIndex=this.getMinStayIndex(a,c)}},getMinStayIndex:function(a,c){var b=ta.util.date.getDaysInRange(a,c)-1;if(b<7){return b}else{if(b<28){return 7}else{return 8}}},isOneWay:function(){return this.form.oneWay&&this.form.oneWay.checked},sameDayEnabled:function(){return this.options.allowSameDay||this.isOneWay()},searchAllEnabled:function(){return this.form.searchAll&&(this.form.searchAll.checked||(this.form.searchAll.type=="hidden"&&this.form.searchAll.value=="true"))},updateFields:function(){this.before.updateFields();this.after.updateFields()},clearFields:function(){this.before.clearDateFields();this.after.clearDateFields()},resetFieldsIfBlank:function(){this.before.resetFieldsIfBlank();this.after.resetFieldsIfBlank()},requireFullLoad:function(){if(!this.before.calendar.selectedDate){this.before.loadFields()}if(!this.after.calendar.selectedDate){this.after.loadFields()}},isBeforeValid:function(){this.requireFullLoad();if(!this.after.calendar.selectedDate){return true}return(this.before.calendar.selectedDate<this.after.calendar.selectedDate)||(this.sameDayEnabled()&&this.before.calendar.selectedDate.getTime()<=this.after.calendar.selectedDate.getTime())},isAfterValid:function(){this.requireFullLoad();if(!this.before.calendar.selectedDate){return true}return(this.after.calendar.selectedDate>this.before.calendar.selectedDate)||(this.sameDayEnabled()&&this.after.calendar.selectedDate.getTime()>=this.before.calendar.selectedDate.getTime())},validateInput:function(a){if(a.key.match(/^[a-zA-Z]$/)){a.preventDefault()}},validate:function(g){if(this.searchAllEnabled()){return true}var a=this.before.validate();var b=this.after.validate();var d=true;if(this.isOneWay()){if(a!=null){d=false;this.setError(a)}}else{if(a!=null||b!=null){d=false;this.setError(a||b)}else{if(!this.isAfterValid()){d=false;this.setError(sInvalidDates)}}}if(!d&&g){new Event(g).stop()}if(this.options.showCalIfInvalid){var f;if(a!=null){f=this.before}else{if(b!=null||!d){f=this.after}}if(f){f.input.value="";f.selectedDate=new Date();f.updateFields();f.show()}}if(d&&this.options.validateFun&&typeof this.options.validateFun==="function"){try{return this.options.validateFun(g)}catch(c){ta.util.error.record(c,"post-validation callback function failed in PairedCalendar",g);return d}}else{return d}},setError:function(a){if(!this.errorDiv){return}this.errorDiv.setContent(a).show()},toggleSearchAll:function(){if(this.searchAllEnabled()){this.before.clearFields();this.after.clearFields()}else{this.requireFullLoad();this.before.updateFields();this.after.updateFields()}}});ta.overlays.createSimplePairedCalendar=function(b,a){new Event(b).stop();new ta.overlays.PairedCalendar(a)};ta.overlays.createPairedCalendar=function(f,c,b){if(!b){b={validate:true}}new Event(f).preventDefault();var e;if(ta.isMetaHomepageIntegration2013()||ta.isMetaHotel2013()||ta.isMetaHotels2013()||ta.isAirport()){var d=b.inline;var a=typeof b.skipHAC!=="undefined"&&b.skipHAC!=null&&b.skipHAC;b.clearOnRestart=true;b.allowReverse=true;b.overlayOptions={showCloseButton:false,style:"date_picker_calendar paired",noPadding:true,noCpu:true};b.calendarOptions={prevStyle:"sprite-date_picker-btnLeftIdle",nextStyle:"sprite-date_picker-btnRightIdle",showRange:true};b.onUpdate=function(g){ta.widgets.calendar.setPageInDate(g.before.calendar.selectedDate);ta.widgets.calendar.setPageOutDate(g.after.calendar.selectedDate);if(g.before.calendar.selectedDate&&g.after.calendar.selectedDate){if(ta.isMetaHotels2013()&&!a){ta.servlet.HACSearch.doMetaDateSearch()}else{if(d){ta.widgets.calendar.launchInlineMeta(f)}}}};if(b.clearDates){delete b.clearDates;b.calendarOptions.postContent=function(){var g=Elements.from('<div id="SKIP_DATES"><span class="skip_dates_text"><span class="taLnk">'+ta.retrieve("multiDP.skipDates")+"</span></span></div>")[0];g.getElement(".taLnk").addEvent("click",function(){var i=ta.overlays.getCurrent();if(i){i.clearDateFields();i.theOtherCal&&i.theOtherCal.clearDateFields();i.hide()}var h=ta.id("SUBMIT_HOTELS");if(h){h.focus()}ta.widgets.calendar.clearPageDates();ta.widgets.calendar.clearSessionDates();ta.overlays.Factory.trackSkipDatesEvent("Meta_Homepage","Calendar","Skip dates",0)});return g}}e=new ta.overlays.PairedCalendar(c,b);e.before.addEvent("onSelect",function(h,g){e.after.input.focus()})}else{e=new ta.overlays.PairedCalendar(c,b)}return e};ta.overlays.clearFields=function(a){if(a.calendar){a.calendar.clearFields()}};ta.overlays.resetFieldsIfBlank=function(a){if(a.calendar){a.calendar.resetFieldsIfBlank()}};ta.overlays.toggleOffSearchAll=function(a){if(a.calendar&&a.searchAll){if(a.searchAll.type=="checkbox"){a.searchAll.checked=false}else{if(a.searchAll.type=="hidden"){a.searchAll.value="false"}}a.calendar.toggleSearchAll()}};ta.overlays.toggleOnSearchAll=function(a){a=ta.id(a);var b=a.getParent("form");if(!b.calendar){new ta.overlays.PairedCalendar(a,{validate:true,clearDatesId:a})}if(b.calendar&&b.searchAll){if(b.searchAll.type=="checkbox"){b.searchAll.checked=true}else{if(b.searchAll.type=="hidden"){b.searchAll.value="true"}}b.calendar.toggleSearchAll()}};ta.overlays.toggleSearchAll=function(d,b,a){b=ta.id(b);b.onclick="";var c=b.getParent("form");if(!a){a={validate:true}}if(!c.calendar){new ta.overlays.PairedCalendar(b,a)}c.calendar.toggleSearchAll(b);b.addEvent("click",c.calendar.toggleSearchAll.bind(c.calendar))};ta.overlays.clearDates=function(c,a){ta.overlays.toggleOnSearchAll(a);ta.id(a).style.visibility="hidden";var b=ta.id("minStay");if(b!==null){b.disabled=false;b.selectedIndex=0;filtersChanged(c)}};ta.overlays.PermanentOverlay=new Class({Extends:ta.overlays.AbsoluteOverlay,initialize:function(a,b){this.parent(Object.merge({permanent:true},a),b)}});ta.overlays.SkinnyOverlay=new Class({Extends:ta.overlays.RelativeOverlayBelow,initialize:function(a,b){this.parent(a,b);this.container.setStyle("max-width","120px");if(Browser.ie6){this.shim.setStyle("max-width","120px")}if(this.transparentOverlayPadding){this.transparentOverlayPadding.setStyle("max-width","120px")}}});ta.overlays.Registration=new Class({Implements:[Options,Events],Binds:["response","failure"],options:{flow:null,url:"/Registration",isOverlay:true,pageTarget:null,responseCallback:null,completeCallback:null,customOverlayOptions:{},noreload:false,failureCloseHandler:null},initialize:function(a){this.setOptions(a);if(this.options.isOverlay){this.overlay=new ta.overlays.CenteredOverlay(Object.merge({backdrop:ta.overlays.BACKDROP_ALWAYS,autoShow:false,style:"s4 dg",attachCloseEvent:false},this.options.customOverlayOptions));if(this.overlay.closeBtn){this.overlay.closeBtn.addEvent("click",this.cancel.bind(this))}}},getRequestData:function(){var b={flow:this.options.flow};this.options.pid&&Object.merge(b,{pid:this.options.pid});if(ta.has("registration.data")){b=Object.merge(b,ta.retrieve("registration.data"))}if(ta.has("page.geo")){b.geo=ta.retrieve("page.geo")}b.source=pageServlet;b=[b];Array.from(arguments).each(function(c){b.push(c)});if(ta.has("rsa")){b.push({encrypted:ta.retrieve("rsaVersion")});var a=ta.retrieve("rsa");b.forEach(function(c){if(c.pass){try{b.push({epass:a.encrypt(c.pass.value)})}catch(d){ta.util.error.record(d,"Encrypted Signin - encrypting sign-in/sign-up form parameters")}}})}return b},_getUrl:function(){var a=ta.util.URL.https(this.options.url);if(0!==a.indexOf("https:")){ta.util.error.record(null,"Post URL must have https protocol.");return""}return a},request:function(d,c){var a=this._getUrl();if("https:"!==location.protocol){ta.util.error.record(null,"Registration requests should not be made from non-https pages. url: "+a+", params: "+c)}ta.store("registration.method","request");var b={url:a,method:"get",withCredentials:ta.retrieve("access_control_headers"),evalScripts:true,data:this.getRequestData(c,{action:d}),onSuccess:this.response,onFailure:this.failure};if(ta.has("registration.ga_module")){b.trackEvent={module:ta.retrieve("registration.ga_module"),action:d+"_Show",context:this.options.flow}}new Request(b).send();return this},post:function(b){var a=this;if(ta.has("registration.ga_module")){ta.trackEventOnPage(ta.retrieve("registration.ga_module"),b.action.value+"_Submit",a.options.flow,1,false)}ta.util.pending.waitFor(function(){return !ta.has("rsaLoading")},function(){if(ta.has("facebook.authcode.param")){b=Object.merge(b,{FBAuthCode:ta.remove("facebook.authcode.param")})}ta.store("registration.method","post");new Request({url:a._getUrl(),method:"post",withCredentials:ta.retrieve("access_control_headers"),evalScripts:true,data:a.getRequestData(b,{noreload:a.options.noreload}),onSuccess:a.response,onFailure:a.failure}).send()},100);return this},cancel:function(){var a=this._getUrl();if("https:"!==location.protocol){ta.util.error.record(null,"Registration requests should not be made from non-https pages. url: "+a)}ta.store("registration.method","cancel");new Request({url:this._getUrl(),method:"get",withCredentials:ta.retrieve("access_control_headers"),evalScripts:true,data:this.getRequestData({CANCEL:"y",action:ta.retrieve("registration.action"),noreload:this.options.noreload}),onSuccess:this.response,onFailure:this.failure}).send();return this},log:function(a){new Request({url:this._getUrl(),method:"get",withCredentials:ta.retrieve("access_control_headers"),evalScripts:false,data:this.getRequestData({action:"LOG",pageAction:a})}).send();return this},response:function(a){if(!ta.remove("registration.noop")){if(this.options.isOverlay){this.overlay.loadRemoteSuccess(a);if(this.overlay.visible){this.overlay.position()}else{this.overlay.show()}}else{if(this.options.pageTarget){this.options.pageTarget.setContent(a)}}}if(this.options.responseCallback){setTimeout(this.options.responseCallback,1)}if(ta.has("registration.afterUpdate")){ta.remove("registration.afterUpdate").each(function(b){setTimeout(b,1)})}},close:function(){if(this.options.isOverlay){this.overlay.hide()}this.fireEvent("onComplete");if(this.options.completeCallback){this.options.completeCallback()}},failure:function(c){var a=0;var d=ta.remove("registration.method");try{a=c.status}catch(b){}if(a==503){this.overlay.loadRemoteSuccess('<div style="padding:6px;">'+JS_maintenance+"</div>");if(!this.overlay.closeBtn&&this.options.failureCloseHandler){this.overlay.addCloseButton()}if(this.overlay.closeBtn){this.overlay.closeBtn.removeEvents("click");this.overlay.closeBtn.addEvent("click",this.options.failureCloseHandler||ta.overlays.registration.close)}if(this.overlay.visible){this.overlay.position()}else{this.overlay.show()}}else{if(d=="cancel"){ta.overlays.registration.close()}ta.util.error.ajaxFailure.partial("Registration:"+d)}}});ta.overlays.registration={getInstance:function(a){var b=ta.retrieve("registration.instance");if(!b){if(typeof(regflowCss)!="undefined"&&!ta.retrieve("ta.regflowCss")){ta.store("ta.regflowCssAsset",Asset.css(regflowCss))}b=new ta.overlays.Registration(a);ta.store("registration.instance",b)}return b},connect:function(a,d,c){if(typeof(regflowCss)!="undefined"&&!ta.retrieve("ta.regflowCss")){ta.store("ta.regflowCssAsset",Asset.css(regflowCss))}if(ta.has("facebook.available")&&ta.retrieve("facebook.available")){var e={fbAvailable:true}}else{if(ta.has("registration.forceFBAvailable")){var e={fbAvailableForce:ta.remove("registration.forceFBAvailable")}}}var b="SIGNIN";ta.remove("registration.data");if(typeof(a)=="undefined"){a={}}ta.overlays.registration.addLoadingGeeTestCaptchaOnCallBack(a);ta.overlays.registration.getInstance(a).request(d||b,Object.merge({},c,e))},post:function(b,a){var c=a||window.event;if(c){new Event(c).stop()}ta.overlays.registration.getInstance().post(b)},request:function(c,b,a){if(c=="SIGNUP"||c=="SIGNIN"){b=Object.merge({fbAvailable:ta.has("facebook.available")&&ta.retrieve("facebook.available")},b)}if(typeof(a)=="undefined"){a={}}ta.overlays.registration.addLoadingGeeTestCaptchaOnCallBack(a);ta.overlays.registration.getInstance(a).request(c,b)},deferredRequest:function(d,b,e,c,a){ta.overlays.registration.getInstance(a).request(e,c,a)},cancel:function(a){ta.overlays.registration.getInstance(a).cancel(false)},log:function(a){ta.overlays.registration.getInstance().log(a)},close:function(){var a=ta.remove("registration.instance");if(a){a.close()}},switchFlow:function(a){ta.overlays.registration.getInstance().options.flow=a},logAndPost:function(c,b,a){ta.overlays.registration.getInstance(c).log(b).post(a)},postSignupForm:function(b,a){var c=a||window.event;if(c){new Event(c).stop()}ta.overlays.registration.getInstance().post(b)},addLoadingGeeTestCaptchaOnCallBack:function(b){if(typeof(b.responseCallback)=="function"){var a=b.responseCallback;b.responseCallback=function(){ta.overlays.registration.loadGeeTestCaptcha();a()}}else{b.responseCallback=ta.overlays.registration.loadGeeTestCaptcha}},loadGeeTestCaptcha:function(){if(ta.retrieve("geetest_captcha")){var e=ta.id("geetest_recaptcha_widget");if(e){var c=e.getAttribute("data-captcha-id");var d=e.getAttribute("data-captcha-type");var b=ta.select("#geetest_recaptcha_widget .gt_holder");if(window.Geetest&&b.length==0){var a=new Geetest({gt:c,product:d,https:true}).onReady(function(){var f=ta.select("#geetest_recaptcha_widget .gt_guide_tip");if(f.length>0){f[0].innerHTML=ta.retrieve("geetest_captcha.str_slide_to_verify")}}).appendTo(e);if(ta.trackEventOnPage){ta.trackEventOnPage("reg_captcha","GEETEST","displayed")}}}}}};ta.servlet.Registration={realNameDone:function(a){if(ta.id("use_real_name")&&ta.id("use_real_name").getProperty("checked")||ta.id("chooseNameFB")||ta.id("chooseNameGoogle")){ta.overlays.registration.post(ta.id("RealName"),a)}else{ta.overlays.registration.cancel()}},screenEdit:function(a){ta.id("screen").set("value","");ta.id("screen").focus();ta.id(a).hide()},displayLoading:function(){if(window.CDNHOST!=null){ta.id("buttonArea").innerHTML='<img class="loadingGif" src="'+CDNHOST+'/img2/generic/site/loading_anim_gry_sml.gif" />'}else{ta.id("submitButton").set("disabled",true)}},trackEmailOpt:function(a,b){if(a){if(!a.checked){ta.trackEventOnPage("register","sign_up_"+b,"email_opt_out")}}},toggleProgressCircle:function(b){var a=ta.id("circleContainer_"+b);if(a){if(a.hasClass("progressCircleChecked")){a.removeClass("progressCircleChecked");a.addClass("progressCircle");a.innerHTML=b}else{a.removeClass("progressCircle");a.addClass("progressCircleChecked")}}},toggleProgressBar:function(a){var b=ta.id("barContainer_"+a);if(b){if(b.hasClass("filled")){b.removeClass("filled")}else{b.addClass("filled")}}},toggleProgressElement:function(a,b,c){if(a&&a<=b){if(c=="Bar"){this.toggleProgressBar(a)}else{if(c=="Circle"){this.toggleProgressCircle(a)}}}},toggleTagged:function(c,b,f,e){if(c&&ta.id("tagContainer_"+c)){var a=ta.select(".tagSelection:checked").length;var d=ta.id("tagContainer_"+c);if(d.hasClass("tagged")){d.removeClass("tagged");this.toggleProgressElement(a,b,e);if(ta.id("tag_"+c).checked){ta.id("tag_"+c).checked=false;this.activateMemberTagSubmit(f)}}else{d.addClass("tagged");this.toggleProgressElement(a+1,b,e);if(!ta.id("tag_"+c).checked){ta.id("tag_"+c).checked=true;this.activateMemberTagSubmit(f)}}}},activateMemberTagSubmit:function(c){var b=1;var a=ta.id("submitBtn");if(c){b=0}if(a&&ta.select(".tagSelection:checked").length>=b){a.addClass("active")}else{if(a){a.removeClass("active")}}},submitMemberTags:function(j,c){var b;var a=(b=ta.select(".tagSelection:checked"))?b.length:0;var i=(b=ta.id("memberTagsPlacementPid"))?b.value:0;var m=(b=ta.id("memberTagsIsSecure"))&&(b.value=="true");var d=(b=ta.id("memberTagsIsEditFlow"))&&(b.value=="true");var n=(b=ta.id("memberTagsForceAjax"))&&(b.value=="true");var l=(b=ta.id("memberTagsOnSuccess"))?b.value:"";var p=ta.servlet.Registration[l];var h=$(j);if(!h||!h.hasClass("active")){return}var f=h.hasClass("skipBtn");var k=ta.id("submitBtn");if(k){k.removeClass("active")}var o=ta.id("skipBtn");if(o){o.removeClass("active")}ta.trackEventOnPage("self_tags",c,i,a);if(d&&f&&("undefined"!==typeof(oxapp))&&oxapp.getSubview("modules.membercenter.MemberTag")){if(k){k.addClass("active")}if(o){o.addClass("active")}var g=oxapp.getSubview("modules.membercenter.MemberTag");if(g.context&&g.context.get("MemberCenter_MemberTags")&&g.context.get("MemberCenter_MemberTags")._items&&g.context.get("MemberCenter_MemberTags")._items.length==0){g.taggedItems=[]}g.taggingOverlay.hide();return}if(f){var q=ta.id("tagCancel");if(q){q.value=true}}if(m&&!n){ta.overlays.registration.getInstance().post(ta.id("SELF_TAG_FORM")).response(function(){if(k){k.addClass("active")}if(o){o.addClass("active")}})}else{new Request({url:"/MemberTagsAjax",method:"post",data:ta.id("SELF_TAG_FORM"),onSuccess:function(e){if(k){k.addClass("active")}if(o){o.addClass("active")}if("function"===typeof(p)){p(e)}},onFailure:function(e){if(k){k.addClass("active")}if(o){o.addClass("active")}if(("undefined"!==typeof(oxapp))&&oxapp.getSubview("modules.membercenter.MemberTag")){oxapp.getSubview("modules.membercenter.MemberTag").taggingOverlay.hide()}}}).send()}var q=ta.id("tagCancel");if(q){q.value=""}},memberTagsSuccessMemberCenter:function(c){if(("undefined"===typeof(oxapp))||!oxapp||!c){return}var a,b=(a=ta.id("memberTagsIsEditFlow"))&&(a.value=="true");if(b&&oxapp.context&&oxapp.context.get("MemberCenter_MemberTags")){oxapp.context.get("MemberCenter_MemberTags").fetch().always(function(){if(oxapp.getSubview("modules.membercenter.MemberTag")){oxapp.getSubview("modules.membercenter.MemberTag").render()}})}if(oxapp.getSubview("modules.membercenter.MemberTag")){oxapp.getSubview("modules.membercenter.MemberTag").taggingOverlay.hide()}},memberTagsRedirectCompletionUrl:function(b){var a=ta.id("memberTagsCompletionUrl");if(a&&a.value){window.location.href=a.value}}};ta.overlays.PopoutOverlay=new Class({Extends:ta.overlays.Overlay,options:{backdrop:ta.overlays.BACKDROP_ALWAYS,showCloseButton:true},initialize:function(a,b){this.parent(a,b);this.placeholder=new Element("div").inject(this.source,"before").adopt(this.source);this.placeholder.setStyles({marginBottom:this.source.style.marginBottom,marginTop:this.source.style.marginTop});this.source.setStyles({marginBottom:0,marginTop:0});if(this.options.showCloseButton){this.closeBtn.addEvent("click",this.hide)}this.show()},show:function(a){this.sourceCoords=this.source.getCoordinates();this.placeholder.setStyles({width:this.sourceCoords.width,height:this.sourceCoords.height});this.inner.adopt(this.source);this.parent(a)},hide:function(a){this.parent(a);this.placeholder.adopt(this.source).setStyles({width:"auto",height:"auto"})},position:function(){var b=parseInt(this.container.getStyle("borderTopWidth").replace(/px/,""));var a=parseInt(this.container.getStyle("borderLeftWidth").replace(/px/,""));this.container.setStyles({left:this.sourceCoords.left-a,top:this.sourceCoords.top-b,width:this.sourceCoords.width,display:"block"});this.parent()}});ta.overlays.PopoutWithOverlay=new Class({Extends:ta.overlays.Overlay,options:{position:"topleft",edge:"topright",offset:{x:-10,y:0},scrollOffset:-20,backdrop:ta.overlays.BACKDROP_ALWAYS,showCloseButton:true},initialize:function(a,b){this.parent(a,b);this.placeholder=new Element("div").inject(this.source,"before").adopt(this.source);this.popout=new Element("div",{styles:{position:"absolute",zIndex:"10002",fontSize:"0.75em",display:"none"}}).inject(document.body);if(this.options.showCloseButton){this.closeBtn.addEvent("click",this.hide)}this.show()},show:function(b){this.parent(b);var a=this.source.getCoordinates();this.placeholder.setStyles({width:a.width,height:a.height,marginBottom:this.source.style.marginBottom,marginTop:this.source.style.marginTop});this.popout.setStyles({left:a.left,top:a.top,width:a.width,display:"block"}).adopt(this.source)},hide:function(a){this.parent(a);this.placeholder.adopt(this.source).setStyles({width:"auto",height:"auto"});this.popout.setStyle("display","none")},position:function(){var a=this.source.getCoordinates();this.container.setStyles({left:null,top:a.top+this.options.offset.y,right:window.getWidth()-(a.left+this.options.offset.x)});this.parent();window.scrollTo(0,a.top+this.options.offset.y+this.options.scrollOffset)}});ta.overlays.CoverOverlay=new Class({Extends:ta.overlays.Overlay,options:{autoShow:true,xOff:0,yOff:0},initialize:function(a,b){this.parent(a,b);if(this.options.showCloseButton){this.closeBtn.addEvent("click",this.hide)}if(this.options.autoShow){this.show()}},position:function(){var b=this.source.getCoordinates();var a=this.container.getCoordinates();this.container.setStyles({left:b.left+(b.width/2-a.width/2)+this.options.xOff,top:b.top+(b.height/2-a.height/2)+this.options.yOff})},updateBackdrop:function(){var a=this.source.getCoordinates();this.backdrop.setStyles({left:a.left,top:a.top,width:a.width,height:a.height})}});ta.overlays.SpecialDropDownWithRangeOverLay=new Class({Extends:ta.overlays.RelativeOverlayBelow,options:{onClose:false,onShow:false},initialize:function(a,b){var d=["vrPriceMinDropDown","vrPriceMaxDropDown","vrPricePeriodDropDown"];var c="";if(b.id&&d.contains(b.id)){c="vrPriceDropDown"}this.parent(Object.merge({below:true,innerDivClass:"",style:c,autoShow:false},a),b);this.container.removeClass("relative");if(a.onClose){this.options.onClose=a.onClose}if(a.onShow){this.options.onShow=a.onShow}},show:function(h){if(this.visible){this.hide();return}try{this.options.onShow()}catch(g){}var b=h.srcElement?h.srcElement:h.target;if(b){this.source=b}if(this.options.sourceId){this.source=ta.id(this.options.sourceId);this.source.addClass("selected")}var d=ta.select(".overlay");for(var f=0;f<d.length;f++){var c=d[f];if(c.contains(this.source)){var a=c}}if(a){this.container.setStyle("z-index",a.getStyle("z-index")+1)}document.addEvent("click",this.hide);this.parent(h)},hide:function(b){if(this.options.onClose){try{this.options.onClose()}catch(a){}}if(this.options.rangeInputClass){try{if(this.options.closeOnlyIfClick&&!b){return}if(this.container.getElements("."+this.options.rangeInputClass)[0].contains(b.target)){return}}catch(a){}}this.hideNow()},hideNow:function(a){if(this.options.sourceId){this.source.removeClass("selected")}document.removeEvent("click",this.hide);this.parent()},position:function(){var a=this.source.getPosition();this.container.setStyles({left:a.x+this.options.xOffset?this.options.xOffset:0,top:a.y+this.options.yOffset?this.options.yOffset:0});this.parent()}});ta.overlays.FooterPocketWithInsertOverlay=new Class({Extends:ta.overlays.PermanentOverlay,Binds:["_handleResize","_hide","show","hide","destroy"],_closeButtonClass:"closeOverlayLarge",_hideOverflow:true,initialize:function(d,e,f){var c="np footerPocketWithInsert";if(ta.retrieve("mapsv2.abg_map_view")){c=c+" abg_map_view zoom_open"}if(d.style){c=c+" "+d.style}if(d.dontHideOverflow){this._hideOverflow=false}var a=Object.merge({draggable:false,permanent:true,toWindow:false,xOffset:f,yOffset:f,closeButtonClass:this._closeButtonClass,backdrop:d.tabletFullScreen?ta.overlays.BACKDROP_NEVER:ta.overlays.BACKDROP_ALWAYS},d);a.style=c;this.parent(a,e);var b=this;this.addEvent("onClose",function(){b._removeEvents()})},_loadEvents:function(){window.addEvent("resize",this._handleResize);window.addEvent("load",this._handleResize)},_removeEvents:function(){window.removeEvent("resize",this._handleResize);window.removeEvent("load",this._handleResize)},hide:function(){this._removeEvents();this.parent();if(this._hideOverflow){document.body.style.overflow="auto"}},show:function(){if(this._hideOverflow){document.body.style.overflow="hidden"}this.parent();this._loadEvents();this.footerPocket=this.container.getElement(".js_footerPocket");this._handleResize()},toggleCloseButton:function(a){var b=this.container.getElement("."+this._closeButtonClass);if(b){b.setStyle("visibility",a?"visible":"hidden")}},_handleResize:function(){var b,c;if(this.options.tabletFullScreen){b="100%";c="100%"}else{b=window.getSize().x;var e=this.options.xOffset*2;c=b-e;var a=parseInt(this.footerPocket.getStyle("min-width"))||0;var d=a-e;if(c<d){c=d}}this.container.setStyle("width",c);this.container.setStyle("top",this.options.yOffset);if(this.backdrop){this.backdrop.setStyle("width",b);this.backdrop.setStyle("min-width",a+3)}this.footerPocket.setStyle("width",b)}});ta.overlays.StaticOverlay=new Class({Extends:ta.overlays.RelativeOverlay,initialize:function(a,b){this.parent(Object.merge({autoShow:false},a),b);this.container.removeClass("relative")},position:function(a){this.container.position({position:"center",offset:{x:this.options.offsetX||0,y:this.options.offsetY||0}});this.parent()},hide:function(d){if(d==null){return}var a=d.srcElement?d.srcElement:d.target;if(this.container.contains(a)){return}if(this.options.childrenOverlays){for(var c=0;c<this.options.childrenOverlays.length;c++){var b=this.options.childrenOverlays[c];if(b.container.contains(a)){return}}}this.parent()}});if(!ta.overlays.filters){ta.overlays.filters={}}ta.overlays.filters.CheckboxOverlay=new Class({Extends:ta.overlays.RelativeOverlayBelow,Binds:["nonSourceHide","doOnInit","buildContent"],options:{showCloseButton:false,activate:ta.overlays.ACTIVATE_CLICK,style:"date_picker_calendar",multiSelect:true,autoShow:false,delayShow:true,noPadding:true,keepElementInDocument:true,filterType:"",closeOnSelect:true},initialize:function(c,b){var a=Object.merge(this.options,c);this.input=document.getElement(".hotel_filter_wrap ."+a.filterType);this.parent(a,this.input);this.source.removeEvent("click",this.show);this.setupStandardBehavior();this.doOnInit()},setupStandardBehavior:function(){this.input.overlay=this;if(this.container){this.parentOverlay=this.container.getParent(".overlay");if(this.parentOverlay){this.parentOverlay=this.parentOverlay.overlay;this.options.isChild=true}}},doOnInit:function(){this.buildContent(this.inner.getElement(".hotelFilterContent"),this.options.filterType)},buildContent:function(b,e){var a=ta.retrieve("hac.data.object");var h=document.createDocumentFragment();if(a&&a.filters){var d=a.filters[e];if(d){var f=document.createElement("ul");var g=d.options.length;f.className="hacFilterItems "+d.hacName;if(g>8){f.className=f.className+" manyItems"}h.appendChild(f);var c=this;Array.each(d.options,function(i){c.addCheckboxItem(d,e,i,f,c,a)})}b.empty().appendChild(h)}},addCheckboxItem:function(g,b,c,e,h,d){var n="";if(h.isItemDisabled(c)){n="disabled"}var p="";if(n!=""){p="disabled=''"}var l=new Element("li");l.className="hacFilterItem";var j="";var a=b=="showUnavailable";if(a){j="showUnavailable"}if(n||a){l.className=l.className+" "+n+" "+j}if(c.value==0&&!a){l.className=l.className+" default"}var i=b;if(!h.isItemDisabled(c)){l.addEvent("click",function(r){(function(){h.dataItemClick.call(h,l,g.hacName,i,ta.hac.filters.getItemValue(c,b))}).delay(10);return false})}if(a){var k=new Element("hr");e.appendChild(k)}e.appendChild(l);var f="";if(a){if(c.value==1){f="checked=checked"}}else{if(h.isCheckboxItemSelected(d.selected,g.hacName,c.value)){f="checked=checked"}}var m=h.getItemDisplayFragment(c,b);var q=g.hacName+"_"+c.value;var o="";if(!a){o="<span class='itemCount'>("+c.count+")</span>"}else{q=g.hacName}l.innerHTML="<input type='checkbox' id='"+q+"' class='"+q+" "+n+"' "+f+" "+n+" /><span class='dataItem "+n+"'>"+m+o+"</span>"},dataItemClick:function(g,b,a,f){var h;if(ta.has("hac.filter.click.timeout")){ta.remove(ta.hac.filters.getHacFilterTimeoutKey());clearTimeout(ta.remove("hac.filter.click.timeout"))}this.fixCheckboxesInFilter(g);h=ta.hac.filters.updateFilterHash(b,this.getFilterSelections(b));var c=ta.has("persistentFilters.showing")?a+"|persistent_bar":a;if(h){try{var d="click";if(g&&g.getElement("input")&&!g.getElement("input").checked){d="unclick"}if(typeof pageServlet!="undefined"&&pageServlet=="Hotels"&&!ta.isMetaHotelsRequest()){ta.setEvtCookie(ta.hac.filters.getModuleString(this.options.filterType),d,c,f,"/HACSearch")}else{ta.trackEventOnPage(ta.hac.filters.getModuleString(this.options.filterType),d,c,f)}}catch(j){}var i=this;ta.store("hac.filter.click.timeout",setTimeout(function(){ta.remove("hac.updates.running");if(window.pageServlet=="Hotels"){ta.hac.filters.closeAllActiveFilters()}i.updateHACResults.call(i);ta.remove(ta.hac.filters.getHacFilterTimeoutKey())},2000));ta.store(ta.hac.filters.getHacFilterTimeoutKey(),ta.retrieve("hac.filter.changed"))}},updateHACResults:function(){if(this.options&&this.options.closeOnSelect){this.hide()}ta.hac.filters.updateResultsFromFilters()},setCloseOnSelect:function(a){if(this.options&&this.options.closeOnSelect){this.options.closeOnSelect=a}},fixCheckboxesInFilter:function(d){var d=ta.id(d);if(!d||d.hasClass("disabled")){return}if(d.hasClass("hacFilterItem")){d.getElement("input").checked=!d.getElement("input").checked}if(d.hasClass("default")){var e=d.getParent(".hacFilterItems");if(e){Array.each(e.getElements(".hacFilterItem"),function(f){f=ta.id(f);if(!f.hasClass("default")){f.getElement("input").checked=false}else{f.getElement("input").checked=true}})}}else{var b=false;var e=d.getParent(".hacFilterItems");if(!d.getElement("input").checked){var a=e&&document.getElements(".hacFilterItems input:checked");if(!a||!a.length){b=true}}if(e){var c=e.getElement(".default");if(c){c.getElement("input").checked=b}}}},getFilterSelections:function(c){var a=[];if(c=="showUnavailable"){a=document.getElements(".hacFilterItem."+c+" input:checked")}else{if(c){a=document.getElements(".hacFilterItems."+c+" input:checked")}else{a=document.getElements(".hacFilterItems input:checked")}}var b=[];Array.each(a,function(d){if(d.id!=c+"_0"){b.push(d.id)}else{if(c=="showUnavailable"){b.push("showUnavailable")}}});return b},addExpandableItem:function(c,d){var g=document.createDocumentFragment();var e=new Element("li");e.className=c+" expandFilterItem";g.appendChild(e);var f=document.createElement("div");f.className="nameItem sprite-filter-expand";if(ta.has("filterNames."+c)){f.innerHTML=ta.retrieve("filterNames."+c)}else{if(ta.has("hotels.currencies")&&"currencies"==c){f.innerHTML=ta.retrieve("hotels.currencies")[0]}else{f.innerHTML=c}}var b=new Element("div");b.className="toggleItem";e.appendChild(f);e.appendChild(b);var a=this;e.addEvent("click",function(){a.expandableClick.call(a,c,e)});d.appendChild(g)},expandableClick:function(){return},getItemDisplayFragment:function(a,b){return ta.hac.filters.getItemDisplayFragment(a,b,this.isItemDisabled(a))},isCheckboxItemSelected:function(c,a,f){if(!c){return false}var d=a+"_"+f;var b=c.cb;if(f!=0){if(b&&b.contains(d)){return true}}else{var e=false;if(b){Array.each(b,function(g){if(g.indexOf(a)!=-1){e=true}})}if(!e){return true}}return false},isItemDisabled:function(a){if(a&&a.count>0){return false}return true},destroy:function(){this.parent();this.input.overlay=null},nonSourceHide:function(a){if(!this.source.containsEvent(a)){this.hide()}},show:function(g){var d=this.visible;this.parent(g);document.removeEvent("click",this.hide);document.addEvent("click",this.nonSourceHide);if(this.options.filterType!="more"){this.buildContent(this.inner.getElement(".hotelFilterContent"),this.options.filterType)}if(d){return}if(this.parentOverlay&&this.parentOverlay.pin&&this.parentOverlay.options.pinnable==ta.overlays.PINNABLE_CLICK){this.tempPin=!this.parentOverlay.pinned;if(this.tempPin){this.parentOverlay.pin()}}if(ta.has("persistentFilters.showing")&&tabletOnFullSite&&this.container){this.container.setStyle("position","fixed")}var c=document.getElement(".hotel_filter."+this.options.filterType);var f=document.getElement(".date_picker_calendar."+this.options.filterType);if(ta.util.i18n.isRtl()){var b=c.getCoordinates().width;var a=f.getCoordinates().width;this.options.offsetLeft=a-b}else{this.options.offsetLeft=0}this.position();return this},hide:function(a){if(!this.visible){return}document.removeEvent("click",this.nonSourceHide);this.parent(a);if(this.parentOverlay&&this.tempPin){this.tempPin=false;this.parentOverlay.unpin()}}});ta.overlays.filters.ClassOverlay=new Class({Extends:ta.overlays.filters.CheckboxOverlay,options:{filterType:"hotel_class"},initialize:function(b,a){this.parent(b,a)}});ta.overlays.filters.RatingOverlay=new Class({Extends:ta.overlays.filters.CheckboxOverlay,options:{filterType:"traveler_rating"},initialize:function(b,a){this.parent(b,a)}});ta.overlays.filters.PriceOverlay=new Class({Extends:ta.overlays.filters.CheckboxOverlay,options:{filterType:"price"},initialize:function(b,a){this.parent(b,a)},doOnInit:function(){this.buildContent(this.inner.getElement(".hotelFilterContent"),this.options.filterType);if(ta.has("hotels.currencies")){this.addExpandableItem("currencies",this.inner.getElement(".hotelFilterContent"))}this.addShowUnavailableCheckbox(this.inner.getElement(".hotelFilterContent"))},expandableClick:function(b,c){var a=c.getElement(".toggleItem");if(a&&a.innerHTML!=""){a.innerHTML="";if(ta.id(c).getElement(".nameItem")){ta.id(c).getElement(".nameItem").removeClass("sprite-filter-collapse").addClass("sprite-filter-expand")}}else{this.buildCurrencyContent(c.getElement(".toggleItem"),"currencies");var d=ta.id(c).getParent(".expandFilterItems");if(d){var e=d.getElements("li");if(e){Array.each(e,function(g){g=ta.id(g);var f=g.getElement(".nameItem");if(!g.hasClass("currencies")&&f&&f.hasClass("sprite-filter-collapse")){var h=g.getElement(".toggleItem");if(h){h.innerHTML=""}f.removeClass("sprite-filter-collapse").addClass("sprite-filter-expand")}})}}if(ta.id(c).getElement(".nameItem")){ta.id(c).getElement(".nameItem").removeClass("sprite-filter-expand").addClass("sprite-filter-collapse")}}},show:function(){if(ta.has("ta.calendar.isPriceOverlayCalendar")){return}this.parent();if(ta.has("hotels.currencies")){this.addExpandableItem("currencies",this.inner.getElement(".hotelFilterContent"))}this.addShowUnavailableCheckbox(this.inner.getElement(".hotelFilterContent"))},nonSourceHide:function(a){if(!this.source.containsEvent(a)&&!this.inner.containsEvent(a)){this.hide()}},addShowUnavailableCheckbox:function(d){var a=ta.retrieve("hac.data.object");if(a&&a.filters){var f={hacName:"showUnavailable"};var e=this;var g=a.selected.showUnavailable;var c=ta.retrieve("filterNames.showUnavailable");var b={label:c,count:1,value:g?1:0};e.addCheckboxItem(f,"showUnavailable",b,d,e,a)}},buildCurrencyContent:function(a){var d="";var g=document.createDocumentFragment();var e=document.createElement("ul");var c=ta.retrieve("hotels.currencies");if(c){var f=c.length;e.className="hacFilterItems currency";if(f>8){e.className=e.className+" manyItems"}g.appendChild(e);var b=this;Array.each(c,function(j,i){var m=new Element("li");m.className="hacFilterItem";m.addEvent("click",function(n){(function(){b.currencyItemClick.call(b,j)}).delay(10);return false});e.appendChild(m);var l="";var k=b.getItemDisplayFragment(j,"currencies");var h="currency_"+j;m.innerHTML="<span class='dataItem'>"+k+"</span>"})}a.innerHTML="";a.appendChild(g)},currencyItemClick:function(a){ta.commerce.meta.clearStoredMiniData();if(a.test(/[A-Z]{3}/)){ta.store("ta.commerce.MetaHacOverlay.currency",a);new Request({url:"/ActionRecord?action=MetaCurrencyPicker"}).send();ta.trackEventOnPage("MetaCurrencyPicker","selected",a,1);ta.hac.filters.changeCurrency()}if(this.hide){this.hide()}},showCalendarLightbox:function(d){var c=ta.hac.filters.getModuleString(this.options.filterType);var e="open_calendar";var b="price";ta.trackEventOnPage(c,e,b,0,false);var a=ta.retrieve("ta.overlays.filters.PriceOverlay.showCalendarLightbox");if(typeof(a)=="function"){a()}else{this.buildCalendarLightbox(d)}},calendarLightBoxOverlay:null,buildCalendarLightbox:function(e,a){var d;d=ta.id("PriceFilterCalendarOverlayContent");if(!d){return}d.show();var c={style:"priceFilterCalendarOverlay",innerDiv:"skv3",content:d,autoShow:false,backdrop:ta.overlays.BACKDROP_ALWAYS,closeButtonClass:"roundOuterClose",onShow:function(){ta.remove("ta.calendar.isOutDateTrigger");ta.store("ta.calendar.isPriceOverlayCalendar",true);var h=null;var g=document.getElement("date_picker_in_PriceFilterCalendar");setTimeout(function(){ta.overlays.Factory.loadDatePicker(h,g,"PriceFilterCalendar","",ta.servlet.HACSearch.doMetaDateSearch)},100);if(this.calendar){this.calendar.reposition()}},onClose:function(){ta.remove("ta.calendar.isOutDateTrigger");ta.remove("ta.calendar.isPriceOverlayCalendar")},onHide:function(){ta.remove("ta.calendar.isOutDateTrigger");ta.remove("ta.calendar.isPriceOverlayCalendar")}};var f=ta.id("HEADING");var b=new ta.overlays.CenteredOverlay(c,f);ta.store("ta.overlays.filters.PriceOverlay.showCalendarLightbox",function(){b.show()})},buildContent:function(a,b){if(ta.retrieve("meta.hotels_no_prices")&&!ta.widgets.calendar.hasPageDates()){this.showCalendarLightbox(a)}else{this.parent(a,b)}}});ta.overlays.filters.NeighborhoodOverlay=new Class({Extends:ta.overlays.filters.CheckboxOverlay,options:{filterType:"neighborhood"},initialize:function(b,a){this.parent(b,a)}});ta.overlays.filters.AmenitiesOverlay=new Class({Extends:ta.overlays.filters.CheckboxOverlay,options:{filterType:"amenities"},initialize:function(b,a){this.parent(b,a)}});ta.overlays.filters.BrandOverlay=new Class({Extends:ta.overlays.filters.CheckboxOverlay,options:{filterType:"hotel_brand"},initialize:function(b,a){this.parent(b,a)},getItemDisplayFragment:function(a){if(typeof brandMappings!="undefined"){return"<span class='itemLabel'>"+brandMappings[a.value]+"</span>"}return""}});ta.overlays.filters.MoreOverlay=new Class({Extends:ta.overlays.filters.CheckboxOverlay,options:{filterType:"more",moreOptions:""},initialize:function(b,a){if(b.moreOptions){this.displayFilters=b.moreOptions.split(" ")}this.parent(b,a)},doOnInit:function(){var b=document.createDocumentFragment();var a=new Element("ul");a.className="expandFilterItems more";b.appendChild(a);this.inner.getElement(".hotelFilterContent").innerHTML="";this.inner.getElement(".hotelFilterContent").appendChild(b);moreOvly=this;Array.each(this.displayFilters,function(c){var d=ta.retrieve("hac.data.object");if(d&&d.filters){var e=d.filters[c];if(e&&e.options.length>0){moreOvly.addExpandableItem.call(moreOvly,c,a)}}})},nonSourceHide:function(a){if(!this.source.containsEvent(a)&&!this.inner.containsEvent(a)){this.hide()}},expandableClick:function(c,b){var f=ta.has("persistentFilters.showing")?c+"|persistent_bar":c;var a=b.getElement(".toggleItem");if(a&&a.innerHTML!=""){a.innerHTML="";if(ta.id(b).getElement(".nameItem")){ta.id(b).getElement(".nameItem").removeClass("sprite-filter-collapse").addClass("sprite-filter-expand")}ta.trackEventOnPage(ta.hac.filters.getModuleString(this.options.filterType),"close",f)}else{this.buildContent(b.getElement(".toggleItem"),c);var d=ta.id(b).getParent(".expandFilterItems");if(d){var e=d.getElements("li");if(e){Array.each(e,function(h){h=ta.id(h);var g=h.getElement(".nameItem");if(!h.hasClass(c)&&g&&g.hasClass("sprite-filter-collapse")){var i=h.getElement(".toggleItem");if(i){i.innerHTML=""}g.removeClass("sprite-filter-collapse").addClass("sprite-filter-expand")}})}}if(ta.id(b).getElement(".nameItem")){ta.id(b).getElement(".nameItem").removeClass("sprite-filter-expand").addClass("sprite-filter-collapse")}ta.trackEventOnPage(ta.hac.filters.getModuleString(this.options.filterType),"open",f)}}});ta.overlays.filters.SortOverlay=new Class({Extends:ta.overlays.filters.CheckboxOverlay,options:{filterType:"sort"},initialize:function(b,a){this.parent(b,a)},addCheckboxItem:function(e,a,b,d,f,c){var h=new Element("li");h.className="hacFilterItem";if(b.value==0){h.className=h.className+" default"}var g=this;h.addEvent("click",function(k){if(window.pageServlet=="WidgetEmbed"){ta.hac.filters.changeSort(b.value);ta.trackEventOnPage(ta.hac.filters.getModuleString(g.options.filterType),"click",b.value)}else{ta.pages.hac.hacSortChangedToValue(b.value)}g.hide();return false});d.appendChild(h);var i=f.getItemDisplayFragment(b,a);var j=b.value;h.innerHTML="<span class='dataItem'>"+i+"</span>"}});(function(j,h,d,b){var f="GuestRoomSelector",i="grp-rooms",e="grp-guests",q="grp-update",c="-value",p="singular_room_da",l="plural_rooms_da",g="singular_guest_da",k="plural_guests_da",o="rooms_guests_picker_update_da",a=function(s,r,v){var u=s.replace("grp-",""),t=r+"_"+u;d.trackEventOnPage(f,t,null,v)},n=function(){d.trackEventOnPage(f,"update_click")},m=function(r){var s=r&&r.target&&$(r.target).getParent(".date_picker_calendar");return(s!=null)};d.overlays.GuestsRoomsOverlay=new Class({Extends:d.overlays.RelativeOverlayBelow,Binds:["nonSourceHide","hideByClickOnDocument"],options:{showCloseButton:false,activate:d.overlays.ACTIVATE_CLICK,multiSelect:true,autoShow:false,delayShow:true,noPadding:true,keepElementInDocument:true,closeOnSelect:false},callback:null,selectionModified:false,findTargetFunction:false,initialize:function(t,s){this.callback=t.moreOptions.callback;if(t.guestsRoomsData){this.saveData(t.guestsRoomsData)}this.buildContent(t);this.input=t.moreOptions.input;this.findTargetFunction=t.moreOptions.findTargetFunction;var r=Object.merge(this.options,t);this.parent(r,this.input);this.source.removeEvent("click",this.show);this.setupStandardBehavior()},setupStandardBehavior:function(){if(this.input.getParent(".overlay")){this.parentOverlay=this.input.getParent(".overlay").overlay;this.options.isChild=true}},getData:function(){return d.widgets.calendar.getGuestsRoomsPickerData()},saveData:function(r){d.store("guests.rooms.object",r)},resetData:function(){var r={rooms:1,guests:2};this.saveData(r);return r},updateSessionGuestsRooms:function(t){var s;if(d.widgets.calendar.hasPageDates()){s=d.widgets.calendar.getCheckRatesData()}else{var u=this.getData();s={rooms:u.rooms,adults:u.guests}}var r=this;new Request({url:"/UpdateSessionDatesAjax",data:Object.toQueryString(s),method:"post",onSuccess:function(){r.runCallback(t)}}).send()},runCallback:function(r){if(this.callback&&typeof(this.callback)==="function"&&d.widgets.calendar.hasPageDates()){this.callback(r)}},resetOverlay:function(){this.resetData();this.updateOverlay(i);this.updateOverlay(e)},getTranslationString:function(s){var t=this.getData();var r;if(s===i){r=t.rooms;if(r===1){return d.retrieve(p)}else{return d.retrieve(l)}}else{if(s===e){r=t.guests;if(r===1){return d.retrieve(g)}else{return d.retrieve(k)}}else{if(s===q){return d.retrieve(o)}}}},getCounter:function(s){var t=this.getData();var r;if(s==i){r=t.rooms}else{if(s===e){r=t.guests}}return r},buildContent:function(s){var t=new Element("ul");t.className="guests_rooms_overlay";var v=this.buildButtonLine(i);t.appendChild(v);var u=this.buildButtonLine(e);t.appendChild(u);var r=this.buildUpdateLine();t.appendChild(r);s.content=t},buildButtonLine:function(x){var t=this.getCounter(x);var v=this.getTranslationString(x);var s=new Element("li");s.className="line";s.id=x;var y=new Element("div");y.className="signButton minusButton";if(t===1){y.className+=" disabled"}y.setContent("-");var u=this;y.addEvent("click",function(z){u.processDecrementCounter(x,true)});var r=new Element("div");r.className="numberLabelText";r.setContent(t+" "+v);var w=new Element("div");w.className="signButton plusButton";if(x===i&&t>7){w.className+=" disabled"}else{if(x===e&&t>31){w.className+=" disabled"}}w.setContent("+");w.addEvent("click",function(z){u.processIncrementCounter(x,true);z.stopPropagation()});s.appendChild(y);s.appendChild(r);s.appendChild(w);return s},processDecrementCounter:function(t,r){var u=this.getData(),v;if(t===i){if(u.rooms<=1){return}u.rooms-=1;v=u.rooms;this.saveData(u);this.updateOverlay(t);while((u.guests/4)>u.rooms){this.processDecrementCounter(e)}}else{if(t===e){if(u.guests<=1){return}u.guests-=1;v=u.guests;this.saveData(u);this.updateOverlay(t);var s=(u.guests<u.rooms);if(s){this.processDecrementCounter(i)}}}if(r){a(t,"subtract",v)}},processIncrementCounter:function(s,r){var u=this.getData(),v;if(s===i){if(u.rooms>7){return}u.rooms+=1;v=u.rooms;this.saveData(u);this.updateOverlay(s);var t=(u.rooms>u.guests);if(t){this.processIncrementCounter(e)}}else{if(s===e){if(u.guests>31){return}u.guests+=1;v=u.guests;this.saveData(u);this.updateOverlay(s);var t=((u.guests/4)>u.rooms);if(t){this.processIncrementCounter(i)}}}if(r){a(s,"add",v)}},updateOverlay:function(r){var t=this.buildButtonLine(r);var s=d.id(r);s.parentNode.replaceChild(t,s);this.selectionModified=true;this.updateCounterElement(r)},updateCounterElement:function(s){var t=this.getCounter(s);var r=$$("."+s+c);r.each(function(u){u.innerHTML=t});if(s===i){d.widgets.calendar.updateGuestsRoomsButtonLabelsPluralization(".roomsGuestsButton.roomsButton",t);d.widgets.calendar.updateGuestsRoomsButtonLabelsPluralization(".stayInfoContainer.rooms",t)}else{if(s===e){d.widgets.calendar.updateGuestsRoomsButtonLabelsPluralization(".roomsGuestsButton.guestsButton",t);d.widgets.calendar.updateGuestsRoomsButtonLabelsPluralization(".stayInfoContainer.guests",t)}}},buildUpdateLine:function(){var v=this.getTranslationString(q);var r=new Element("li");r.className="line update";r.id=q;var t=new Element("div");t.className="updateButton rndBtn rndBtnGreen";var s=this;t.addEvent("click",function(x){s.processUpdate(x);s.hide();n()});var u=new Element("div");u.className="ui-btn-inner";var w=new Element("div");w.className="ui-btn-text";w.setContent(v);u.setContent(w);t.setContent(u);r.setContent(t);return r},processUpdate:function(r){if(!this.selectionModified){if(this&&this.parentOverlay&&this.parentOverlay.visible&&d.widgets.calendar.hasPageDates()){this.parentOverlay.hide()}return}this.selectionModified=false;this.updateSessionGuestsRooms(r)},destroy:function(){this.parent();this.input.overlay=null},nonSourceHide:function(r){if(!this.source.containsEvent(r)&&!(r.target.className.contains("signButton"))){this.hide(r)}},hideByClickOnDocument:function(r){if(this.parentOverlay&&this.parentOverlay.visible){return}else{this.hide(r)}},show:function(s){var t=this.visible,u;this.parent(s);j.removeEvent("click",this.hide);j.addEvent("click",this.nonSourceHide);j.removeEvent("click",this.hideByClickOnDocument);$$(".date_picker_calendar").addEvent("click",this.nonSourceHide);u=this.findTargetFunction(s);if(u){this.source=u}d.widgets.calendar.syncAllDatePickers();if(t){this.hide(s);return}if(this.parentOverlay&&this.parentOverlay.pin&&this.parentOverlay.options.pinnable==d.overlays.PINNABLE_CLICK){this.tempPin=!this.parentOverlay.pinned;if(this.tempPin){this.parentOverlay.pin()}}this.position();var r=$$(".roomsGuestsButtonWrap .roomsGuests");if(r){r.addClass("disabled")}return this},hide:function(s){if(!this.visible){return}j.removeEvent("click",this.nonSourceHide);$$(".date_picker_calendar").removeEvent("click",this.nonSourceHide);this.parent(s);if(this.parentOverlay&&this.tempPin){this.tempPin=false;this.parentOverlay.unpin()}var r=$$(".roomsGuestsButtonWrap .roomsGuests");if(r){r.removeClass("disabled")}this.processUpdate(s)}});d.overlays.GuestsRoomsOverlay.trackPickerClick=function(r){if(m(r)){d.trackEventOnPage(f,"select_guest_room_calendar")}else{d.trackEventOnPage(f,"select_guest_room")}}})(document,window,ta);(function(k,i,h,d){var e={rooms:{max:8,singularKey:"rgPicker.1Room",pluralKey:"rgPicker.nRooms",tracking:"RoomSelector"},guests:{max:32,singularKey:"rgPicker.1Guest",pluralKey:"rgPicker.nGuests",tracking:"GuestSelector"}},a=4,j=function(n,p){p=h.id(p);if(p){var o=p.clientWidth;n&&n.container&&n.container.setStyle("width",o)}},c=function(s,t,o){var r=e[o],q={type:o,singular:h.retrieve(r.singularKey),plural:h.retrieve(r.pluralKey),maxValue:r.max,target:t,tracking:r.tracking},n=l(o),p=h.retrieve(n)||new h.overlays.NumberPickerOverlay(q,t);h.store(n,p);if(t&&t.getParent("#hotels_lf_header_bar")){j(p,t)}p.show(s)},l=function(n){return"numberPickerOverlay_"+n},m=function(p,o,n){return p>1?n.replace("123",p):o},g=function(){return h.widgets.calendar.getGuestsRoomsPickerData()},f=function(n){h.store("guests.rooms.object",n)},b=function(p,r){var q=g(),n=function(t){var s=t.guests/Math.max(t.rooms,1);if(s>a){t.rooms=Math.ceil(t.guests/a)}else{if(t.rooms>t.guests){t.rooms=t.guests}}},o=function(t){var s=t.guests/Math.max(t.rooms,1);if(s>a){t.guests=t.rooms*a}else{if(t.rooms>t.guests){t.guests=t.rooms}}};if(q[p]===r){return false}q[p]=r;if(p==="rooms"){o(q)}else{if(p==="guests"){n(q)}}f(q);return true};h.overlays.NumberPickerOverlay=new Class({Extends:h.overlays.RelativeOverlayBelow,Binds:["nonSourceHide","hideByClickOnDocument"],options:{activate:h.overlays.ACTIVATE_CLICK,style:"numberPickerOverlay",multiSelect:false,autoShow:false,delayShow:false,noPadding:true,keepElementInDocument:true,closeOnSelect:true,waitForCss:true},callback:function(){if(h.retrieve("hh_short_cell.enabled")||h.retrieve("hh_two_view_deal_chevrons.enabled")){if(this.source&&this.source.className&&this.source.className.indexOf("placement_hh")!=-1&&h.commerce.metajson){h.commerce.metajson.refetchAll()}}else{if(i.pageServlet=="Hotels"){h.widgets.calendar.checkDatesMakeHacCallHotels()}else{var n=h.retrieve("meta.baseLocationId");h.widgets.calendar.checkDatesMakeHacCallHR(n)}}},initialize:function(o,p){this.input=o.target;this.buildContent(o);if(p.getParent("#hotels_lf_header_bar")){this.options.style+=" hotels_lf"}var n=Object.merge(this.options,o);this.parent(n,this.input);i.addEvent("date_bar_docked",this.position.bind(this));i.addEvent("date_bar_undocked",this.position.bind(this));i.addEvent("resize",this.position.bind(this))},buildContent:function(n){var o=new Element("div");o.appendChild(this.buildSelectorRows(n));n.content=o},buildSelectorRows:function(o){var n=this,p=new Element("ul"),r,q,s=function(u,t){u.addEvent("click",function(w){var v=b(o.type,t);n.hide();h.trackEventOnPage(o.tracking,"Select",null,t);if(v){n.callback()}})};p.className="list";for(q=1;q<=o.maxValue;q++){r=new Element("li");r.setContent(m(q,o.singular,o.plural));r.className="item";s(r,q);p.appendChild(r)}return p},resetOverlays:function(){h.remove(l("rooms"));h.remove(l("guests"))},show:function(n){if(this.visible){this.hide(n)}else{if(this.parent){this.parent(n);this.position();h.trackEventOnPage(this.options.tracking,"Open")}}return this},position:function(){var q=h.id(this.source);var n=q.getParent("#hotels_lf_header_bar_wrap");if(q&&(q.getParent("#PERSISTENT_DATE_PICKER")||(n&&n.hasClass("fixed")))){var p=q.getCoordinates().left-i.getScrollLeft()-3;var o=q.getCoordinates().top-i.getScrollTop()+33;if(n){var p=q.getCoordinates().left-(i.isTabletOnFullSite?0:i.getScrollLeft());var o=q.getCoordinates().bottom-(i.isTabletOnFullSite?0:i.getScrollTop())}h.id(this.container).setStyles({position:"fixed",left:p+"px",top:o+"px","z-index":9991})}else{if(n){h.id(this.container).setStyle("position","absolute")}this.parent()}},hide:function(n){this.resetOverlays();this.parent(n)}});h.overlays.NumberPickerOverlay.roomsPicker=function(n,o){return c(n,o,"rooms")};h.overlays.NumberPickerOverlay.guestsPicker=function(n,o){return c(n,o,"guests")};h.overlays.NumberPickerOverlay.updateHeaderMsg=function(n){var s=g(),u=$$(n+" .roomsChange"),p=m(s.rooms,h.retrieve("rgPicker.1Room"),h.retrieve("rgPicker.nRooms")),t=$$(n+" .guestsChange"),r=m(s.guests,h.retrieve("rgPicker.1Guest"),h.retrieve("rgPicker.nGuests")),o=u.getElement("img"),q=(o&&o[0]&&o[0].outerHTML)||"";u.set("html",p+" "+q);t.set("html",r+" "+q)};h.overlays.NumberPickerOverlay.unhideDropdowns=function(n){var o=$$(n);if(o&&h.widgets.calendar.hasPageDates()){o.removeClass("hidden")}}})(document,window,ta);(function(a,c,b,d){b.commerce.meta=(function(h){var g=function(){return typeof(dd)!=="undefined"&&dd.commerce&&dd.commerce.checkrates},f=function(q,n,r){var o="sprite-",m=o+n,p=o+r;if(q.hasClass(m)){q.removeClass(m);q.addClass(p)}},i=function(){var m=h.retrieve("meta.chevronTracking"),o=h.retrieve("meta.chevronAction"),n=h.retrieve("meta.chevronLabel");if(m&&o){if(!n){h.trackEventOnPage(m,o)}else{h.trackEventOnPage(m,o,n)}}h.remove("meta.chevronTracking");h.remove("meta.chevronAction");h.remove("meta.chevronLabel")},e=function(q,m){var n,p,o,r;if(m!==null&&q!==null){h.commerce.meta.suppressCRArea(q);n=q.getElement(".metaDatesNotChosen");p=q.getElement(".metaDatesChosen");if(p){if(n){n.addClass("miniMetaHideHdr");n.removeClass("miniMetaShowHdr")}p.addClass("miniMetaShowHdr");p.removeClass("miniMetaHideHdr")}q.getElements(".minimalist_datepicker_wrap.hidden").each(function(s){s.removeClass("hidden")});o=q.getElement(".postShowMetaCR");if(o!=null){o.destroy()}o=q.getElement(".postShowMetaCRLB");if(o!=null){o.destroy()}o=q.getElement(".postShowMetaCRLBPCR");if(o!=null){o.destroy()}r=q.getElement("fieldset");h.commerce.meta.adoptMiniMetaElem(r,m);h.fireEvent("refreshedDOMContent",q)}},k=function(m){if(!m){return}if(m.getElement(".hacMiniComplete")&&!m.getElement(".anyOfferCompletedSuccessfully")){m.getElements(".photos_lb_update_avail").each(function(n){n.addClass("hidden")});m.getElements(".photos_lb_update_no_avail").each(function(n){n.removeClass("hidden")})}else{m.getElements(".photos_lb_update_avail").each(function(n){n.removeClass("hidden")});m.getElements(".photos_lb_update_no_avail").each(function(n){n.addClass("hidden")})}},j=function(m){m.getElements(".textLinks").each(function(n){n.addClass("hidden")});m.getElements(".maybeCheck").each(function(n){n.addClass("hidden")});m.getElements(".disclaimer").each(function(n){n.addClass("hidden")});m.getElements(".photos_lb_update_links").each(function(n){n.removeClass("hidden")});m.getElements(".taxesAndFees").each(function(n){n.addClass("hidden")});k(m)},l=function(n,m,o){n=n?n:"";m=m?m:"";o=o?o:"";var p=[n,m,o].join("|").replace("||","|").replace(/(\|$)/g,"");h.commerce.meta.updateNavArea(p)};return{updateInlineMeta:function(o,n){if(!h.widgets.calendar.hasPageDates()){h.commerce.meta.popInlineDatePicker(n,o);return}var m=h.id("CHECK_RATE");if(!m){return}},popInlineDatePicker:function(o,p){if(!p){return}var m;var n="_inm";if(o&&o.target&&o.target.getParent("#CHECK_RATES_CONT")){m=h.id("date_picker_"+p)}m=m||h.id("date_picker_"+p+n);if(m){var q=m.getParent(".date_picker_calendar_wrap");if(q&&q.onclick){q.onclick(o,q,p,n);q.fireEvent("click",o,q,p,n);(function(){try{h.retrieve("avail.data."+p+n).calendar.calendarOverlay.position()}catch(r){}}).delay(200)}}},clickMetaShowPrices:function(n){var m;if(!h.widgets.calendar.hasPageDates()&&!(h.retrieve("datepicker_autoadvance")&&h.widgets.calendar.getPageInDate())){h.widgets.calendar.setErrorStyling(new Event(n).target);return}m=a.getElement(".cr_lb_overlay");if(m&&m.overlay){m.overlay.hide()}},showLowestPriceCTA:function(s){var n=(s)?"metaLowestPriceCTAInline":"metaLowestPriceCTA";if(h.has(n)){var r=true;if(s){var v=a.getElement(".meta_rates_content");r=v&&v.style.display=="block"}if(r){var o=h.retrieve(n);if(o.hasOwnProperty("idx")){var t=(s)?"Meta_LP_CTA_Display_Inline":"Meta_LP_CTA_Display";var q=(o.idx===0)?"Not_Displayed":"Displayed";var u=o.idx+"";h.trackEventOnPage(t,q,u)}var p=(s)?"LP_CTA_INLINE":"LP_CTA";var m=h.id(p);if(m){(function(){m.fade("in")}).delay(1000)}}}},chevronHover:function(q,o,n,p){if(o&&n&&p){var m=h.id(o).getElement("."+p);if(m){m.removeClass(p);m.addClass(n)}}},chevronBlur:function(q,o,n,p){if(o&&n&&p){var m=h.id(o).getElement("."+n);if(m){m.removeClass(n);m.addClass(p)}}},hoverTopOffer:function(){var m=a.getElement(".rgba_gray_arrow_up");if(m){m.removeClass("rgba_gray_arrow_up");m.addClass("rgba_yellow_arrow_up")}},blurTopOffer:function(){var m=a.getElement(".rgba_yellow_arrow_up");if(m){m.removeClass("rgba_yellow_arrow_up");m.addClass("rgba_gray_arrow_up")}},hoverBookBtn:function(m){var n=h.id(m);f(n,"bookBtnOrangeIdle","bookBtnOrangeOver");f(n,"bookBtnGreyIdle","bookBtnGreyOver");f(n,"bookIdle","bookOver");f(n,"goIdle","goOver");f(n,"selectIdle","selectOver");f(n,"bookSmallIdle","bookSmallOver");f(n,"goSmallIdle","goSmallOver");f(n,"selectSmallIdle","selectSmallOver");f(n,"goBtnGrey","goBtnGreyOver");f(n,"goBtnOrange","goBtnOrangeOver");f(n,"chevronOrangeIdle35","chevronOrangeOver35");f(n,"chevronGreyIdle27","chevronGreyOver27");f(n,"chevronIdle_ylw","chevronHover_ylw")},blurBookBtn:function(m){var n=h.id(m);f(n,"bookBtnOrangeOver","bookBtnOrangeIdle");f(n,"bookBtnGreyOver","bookBtnGreyIdle");f(n,"bookOver","bookIdle");f(n,"goOver","goIdle");f(n,"selectOver","selectIdle");f(n,"bookSmallOver","bookSmallIdle");f(n,"goSmallOver","goSmallIdle");f(n,"selectSmallOver","selectSmallIdle");f(n,"goBtnGreyOver","goBtnGrey");f(n,"goBtnOrangeOver","goBtnOrange");f(n,"chevronOrangeOver35","chevronOrangeIdle35");f(n,"chevronGreyOver27","chevronGreyIdle27");f(n,"chevronHover_ylw","chevronIdle_ylw")},hoverSmallBookBtn:function(n){var m=h.id(n).getElement(".bookBtn");if(m==null){return}f(m,"bookBtnOrangeIdleSmall","bookBtnOrangeIdleSmallOver");f(m,"bookSmallIdle","bookSmallOver");f(m,"goSmallIdle","goSmallOver");f(m,"selectSmallIdle","selectSmallOver")},blurSmallBookBtn:function(n){var m=h.id(n).getElement(".bookBtn");if(m==null){return}f(m,"bookBtnOrangeIdleSmallOver","bookBtnOrangeIdleSmall");f(m,"bookSmallOver","bookSmallIdle");f(m,"goSmallOver","goSmallIdle");f(m,"selectSmallOver","selectSmallIdle")},providerHoverOn:function(n,t,s){var r=h.id(n);r.addClass("partnerHvr");var m=r.getElement(".price_overlay");if(m){var q=r.getElement(".perNight");var p=q.getCoordinates().width+29;m.addClass("show");if(h.util.i18n.isRtl()){m.setStyles({position:"absolute",left:p,zindex:"101"})}else{m.setStyles({position:"absolute",right:p,zindex:"101"})}}var o=n.getElement(".bookBtn");if(o){h.commerce.meta.hoverBookBtn(o)}h.store("meta.hoverProvider",t);h.store("meta.hoverProviderPosn",s)},providerHoverOff:function(n){var p=h.id(n);p.removeClass("partnerHvr");var m=p.getElement(".price_overlay");if(m){m.removeClass("show")}var o=n.getElement(".bookBtn");if(o){h.commerce.meta.blurBookBtn(o)}h.remove("meta.hoverProvider")},restoreProviderHover:function(){var m=h.retrieve("meta.hoverProvider");var q=h.retrieve("meta.hoverProviderPosn");if(m&&q){var p=h.id("PROVIDER_BLOCK");if(p){var o=p.getElements(".metaProvider");var n=p.getElement(".provider_"+m);if(o&&n&&n.hasClass("order_"+q)){o.each(function(r){h.commerce.meta.providerHoverOff(r)});h.commerce.meta.providerHoverOn(n,m,q)}}}},updateNavArea:function(m){var n=h.retrieve("ta.meta.navArea");if(!n||n.indexOf(m)<0){h.store("ta.meta.navArea",m)}},getNavAreaContextFromDom:function(n,m){n=h.id(n);if(n.getParent(".persistentCR")){return(m)?"|PCR":"PCR"}else{if(n.getParent(".photosOverlay")||n.getParent("#LOC_PHOTO_ALBUMS")){return(m)?"|Photo_Lightbox":"Photo_Lightbox"}else{if(n.getParent(".amenities_lightbox")){return(m)?"|Amenities_Lightbox":"Amenities_Lightbox"}else{if(n.getParent("#CHECK_RATES_LB")){return(m)?"|Photo_LB":"Photo_LB"}else{return}}}}},updateNavAreaMini:function(n,o,m){o=h.id(o);var p=h.commerce.meta.getNavAreaContextFromDom(o);p=p?"|"+p:"";l(n,p,m)},loadBestPriceXsell:function(C,F,q,p){try{if(h.retrieve("checkrates.one_second_xsell")!==true){return}var E=q&&q.isInline;var y="";var r="";var K=q&&q.isMetaLighboxV3;if(h.isHRTabs2014()&&E){return}if(K){y="meta_lightbox_v3"}var D=1000;var m="loadBestPriceXsell_numTries";var s="loadBestPriceXsell_curCancelKey";if(E){m="loadBestPriceXsellInline_numTries";s="loadBestPriceXsellInline_curCancelKey"}var J="meta.xsellTravelData";if(E){J="meta.xsellTravelDataInline"}var u=h.retrieve(J);if(p==null){p=new Date().getTime();h.store(m,0);u=h.widgets.calendar.getCheckRatesData();h.store(J,u);var v=h.id(F);if(v){v.innerHTML="";v.setStyle("height",0);v.setStyle("opacity","0");var A=h.retrieve("metaCheckRatesOverlay");A=h.id(A);if(!E&&A&&A.container&&A.container.getPosition){c.scrollTo(0,A.container.getPosition().y)}}if(E){h.commerce.meta.metaInYourMeta_resetInline()}else{h.commerce.meta.metaInYourMeta_resetLB()}}var t="loadBestPriceXsell_"+p+"_cancel";if(E){t="loadBestPriceXsellInline_"+p+"_cancel"}if(h.retrieve(t)){return}if(h.has(s)){var I=h.retrieve(s);if(I!=t){h.store(I,true)}}if(!h.has(t)){h.store(t,false);h.store(s,t)}var w=h.retrieve(m);var M=w+1;h.store(m,M);if(!u){return}var L="";if(typeof(pageServlet)!==d&&pageServlet){L=pageServlet}var B={};if(h.meta&&h.meta.update){B=h.commerce.meta.getMetaParams()}var x=Object.merge(u,{detail:C,"try":h.retrieve(m),reqNum:q.secondTry?"2":"1",type:y,isInlineRequest:E?"1":"0",openedVendors:r,origServlet:L},B);var o=Object.toQueryString(x);if(!o||!o.trim()){h.util.error.record(null,"ta.commerce.meta.loadBestPriceXsell  - toQueryString failure",null,x);return}var n=h.retrieve("ta.meta.navArea");var z;try{z=h.commerce.meta.tracking.setTimingForNavArea(n)}catch(H){h.util.error.record(H,"problem locking timing in ta.commerce.meta.loadBestPriceXsell")}if(z){x.metaRequestTiming=z}if(h.commerce.meta.tracking.hasAnySuppressedAreas()){var G=h.commerce.meta.tracking.getSuppressedAreasAsString();if(G){x.suppressImpressionsOnComplete=G}}new Request({url:"/MetaBestPriceCrossSellAjax?"+o,evalScripts:true,onSuccess:function(O){if(h.retrieve(t)){return}var N=O.contains("xsellHacStatusReady")||O.contains("xsellHacStatusSOL")||q.secondTry;if(!N){setTimeout(function(){var Q={secondTry:true,xsell:true,isInline:E,isHrRedesignTest:false,openedVendors:r};h.commerce.meta.loadBestPriceXsell(C,F,Q,p)},D)}else{var P=h.id(F);if(P){P.setStyle("height",0);P.setStyle("opacity","0");P.setContent(O);h.commerce.meta.metaInYourMeta(F,{xsell:true,inline:E})}h.store(m,0)}},onFailure:function(){h.store(m,0);h.util.error.record(null,"ta.commerce.meta.loadBestPriceXsell - MetaBestPriceCrossSellAjax request failed")}}).send()}catch(H){h.util.error.record(H,"ta.commerce.meta.loadBestPriceXsell")}},loadGeoCrAutoBroadenContents:function(r,t){var z=5;var p=1000;var o="QC_Meta_Mini|GeoCheckRatesLightBox";try{var m=function(){u=false};var x=function(){r.fireEvent("close",r);r.hide()};var u=true;var w=h.id(r.inner);if(!w){throw new Error("Cannot find parent: "+r)}var q=function(D){var C=0;D.each(function(F){var E=F.getHeight();if(E>C){C=E}});D.each(function(E){E.setStyle("height",C)})};var A=h.commerce.meta.tracking.setTimingForNavArea(o);r.addEvent("close",m);var y={d:t,area:o,metaRequestTiming:A};var B=h.widgets.calendar.getCheckRatesData();if(!B){throw new Error("Cannot find dates and/or adults")}Object.merge(y,B);if(h.meta&&h.meta.update){Object.merge(y,h.commerce.meta.getMetaParams())}var s=0;var n=function(){if(!u){return}++s;y.attempt=s;new Request({url:"/GeoCrAutoBroadenAjax",data:y,method:"get",evalScripts:true,onSuccess:function(C){try{if(!u){return}var E=Elements.from(C,true);var F=E.getElement(".progress").filter(function(I){return I})[0];if(!F){h.util.error.record(null,"geo check rate malform response missing progress",null,y);x()}else{if(/\bfallbackUrl-(\S+)\b/.exec(F.className)){var H=RegExp.$1;var D=h.util.URL.getServletNameFromUrl(H);if(!D){h.util.error.record(null,"geo check rate cannot get servlet name from "+H,null,y);D="UNKNOWN"}h.setEvtCookie("MetaGeoLightBox","unload","Redirect",0,"/"+D);a.location.href=H}else{w.setStyles({overflow:"hidden",height:"auto"});w.innerHTML="";w.adopt(E);q(w.getElements("#GEO_CR_AUTO_BROADEN .recs .rec .info .distance"));q(w.getElements("#GEO_CR_AUTO_BROADEN .recs .rec .info .amenity"));if(!F.hasClass("isHacComplete")&&s<z){setTimeout(n,p)}else{w.getElements(".showUntilLast").dispose();w.getElements(".hideUntilLast").removeClass("hidden")}}}}catch(G){h.util.error.record(G,"cannot process geo check rate response",null,y);x()}},onFailure:function(C){h.util.error.record(null,"geo check rate request failed: status="+(C&&C.status),null,y);x()}}).send()};n()}catch(v){h.util.error.record(v,"cannot send geo check rate initial request");if(x){x()}}},xSellResponses:{lb_hac:false,lb_xsell:false,inline_hac:false,inline_xsell:false},metaInYourMeta_resetLB:function(){h.commerce.meta.xSellResponses.lb_hac=false;h.commerce.meta.xSellResponses.lb_xsell=false},metaInYourMeta_resetInline:function(){h.commerce.meta.xSellResponses.inline_hac=false;h.commerce.meta.xSellResponses.inline_xsell=false},hacIsBlockingXSell:function(m){var n=h.commerce.meta.xSellResponses;if(m){return n.inline_xsell}else{return n.lb_xsell}},metaInYourMeta:function(p,x){var o=x&&x.inline;var n=x&&x.xsell;var s=h.commerce.meta.xSellResponses;if(o){if(n){s.inline_xsell=true}else{s.inline_hac=true}}else{if(n){s.lb_xsell=true}else{s.lb_hac=true}}if((o&&s.inline_xsell)||(!o&&s.lb_xsell&&s.lb_hac)){var v=h.id("META_PRICE_XSELL");var u=h.id("STATE_OPT_RESPONSE");if(o){v=h.id("META_PRICE_XSELL_INLINE");u=h.id("STATE_OPT_RESPONSE_INLINE")}if(v&&v.hasClass&&!v.hasClass("hidden")){return}if(u&&u.hasClass&&!u.hasClass("hidden")){return}var w=v;var r=0;if(h.meta&&h.meta.update){r=h.meta.update.getMetaPricesCount(o)}else{if(g()){r=dd.commerce.checkrates.getMetaPricesCount(o)}}if(r==null){r=0}if(r<1&&u){w=u}var t=h.id(p);if(t){if(w){h.commerce.meta.revealBestPriceXsell(t,w,o,false)}else{var m="lA";if(o){m=m+"_Inline"}var q=h.id(m);if(q&&q.removeClass){q.removeClass("hidden")}}}}},revealBestPriceXsell:function(s,x,n,A){if(s){s=h.id(s)}if(x){x=h.id(x)}if(!s||!x){h.util.error.record(null,"revealBestPriceXsell - required elements missing");return}if(x.removeClass){x.removeClass("hidden")}var r=new Fx.Tween(s,{property:"opacity"});if(A){var p=h.retrieve("metaLeaveBehindOverlay");if(p&&p.container){var m=p.container;if(m.hasClass&&m.hasClass("hidden")&&m.removeClass){m.removeClass("hidden")}if(h.meta&&h.meta.cr){h.meta.cr.removePCR()}else{if(g()){dd.commerce.checkrates.removePCR()}}}}else{var t="META_MINI_META_MAYBE";if(n){t="META_MINI_META_MAYBE_INLINE"}var z=h.id(t);var w=true;if(z){w=false}var v="Displayed_Lightbox";if(n){v="Displayed_Inline"}var u=x.getElements(".hotelListing").length;if(u===0){u="0";v="Not_"+v}h.trackEventOnPage("Meta_State-Optimized_XSell",v,u)}var q=x.getSize().y;var y=new Fx.Tween(s,{property:"height",onComplete:function(){if(!A){r.start(0,1)}}});y.start(q);var o=h.retrieve("metaCheckRatesOverlay");if(o&&o.container&&o.closeBtn&&h.id(c).getScroll().y>o.container.getPosition().y){h.util.element.scrollIntoView(o.closeBtn)}},hideBestPriceXsell:function(q){var p=h.id(q);var n=h.id("META_PRICE_XSELL");if(!p||!n){return}var m=new Fx.Tween(p,{property:"height"});var o=new Fx.Tween(p,{property:"opacity",onComplete:function(){m.start(0);if(n.addClass){n.addClass("hidden")}}});o.start(1,0)},loadMetaAF:function(q,r,s){try{if(h.retrieve("checkrates.meta_af")!==true||h.retrieve("ta.redirectingPage")){return}var o="meta_af_last_request";var n=new Date().getTime();h.store(o,n);var p=1000;var w=false;var u=false;if(h.meta&&h.meta.update){w=h.widgets.calendar.getCheckRatesData();if(!w){return}var v={};if(h.meta&&h.meta.update){v=h.commerce.meta.getMetaParams()}u=Object.merge(w,{detail:q,reqNum:s?"2":"1",type:"af"},v)}else{if(g()){return dd.commerce.checkrates.loadMetaAF(q,r,s)}else{return}}var m=Object.toQueryString(u);if(!m||!m.trim()){h.util.error.record(null,"ta.commerce.meta.loadMetaAF - toQueryString failure",null,u);return}new Request({url:"/MetaBestPriceCrossSellAjax",data:u,evalScripts:true,onSuccess:function(C){if(h.retrieve(o)!=n){return}var D=C.contains("xsellHacStatusReady")||C.contains("xsellHacStatusSOL")||s;if(!D){setTimeout(function(){h.commerce.meta.loadMetaAF(q,r,true)},p)}else{var A=h.id(r);var x=a.getElement(".clearDates");if(A){A.show();A.setStyle("height",0);A.setStyle("opacity","0");A.setContent(C);h.prwidgets.initWidgets(A);var B=a.getElement(".tablet_desktop .mapsv2-more .clearDates");if(x&&x!=B){x.style.display="none"}var E=A.getElement(".mainList");if(E){var y=new Fx.Tween(A,{property:"opacity"});var z=E.getSize().y;var F=new Fx.Tween(A,{property:"height",onComplete:function(){A.setStyle("height","auto");y.start(0,1)}});F.start(0,z);h.fireEvent("avaf.loaded")}}}},onFailure:function(){if(h.retrieve("ta.redirectingPage")){return}h.util.error.record(null,"ta.commerce.meta.loadMetaAF - MetaBestPriceCrossSellAjax request failed")}}).send()}catch(t){h.util.error.record(t,"ta.commerce.meta.loadMetaAF")}},updateProvAreaFromLightBox:function(q){var n=h.retrieve("meta.baseLocationId");if(n&&q==n){var p=h.retrieve("meta.postShowMetaCR");var o=h.retrieve("meta.postShowMetaCRLB");var m=h.retrieve("meta.postShowMetaCRLBPCR");if(p&&o&&m){h.commerce.meta.updateProvArea(p,o,m);return}}if(h.widgets.calendar.datesExist()){if(h.meta&&h.meta.update){h.meta.update.request(n)}else{if(g()){dd.commerce.checkrates.checkRatesMiniMeta(null,a.getElementById("CHECK_RATE"),n,"checkrates")}}}},updateProvArea:function(w){var q=a.getElement("#CHECK_RATES_CONT.chkRates");var y=a.getElement(".ShowUserReviews #CHECK_RATES_CONT.chkRates");var p=a.getElement("#LOC_PHOTO_ALBUMS.photos_lb_update .metaCrosssell .chkRates");var u=a.getElement("#LOC_PHOTO_ALBUMS.photos_lb_update .sidebar .chkRates");var r=a.getElement("#AMENITY_LIGHTBOX.photos_lb_update .chkRates");var A=a.getElement(".similarCarousel");var z=a.getElement(".premiumTimeout");if(A&&z){var m=q.getElement("div.bc_text_content");if(m){var n=w.getChildren()[1];if(n){var v=n.clone(false);v.innerHTML=n.innerHTML;m.innerHTML="";m.adopt(v)}}}else{e(y,w)}if(p){e(p,w);j(p);var x=a.getElement(".featuredImageWrap.metaCrosssell");if(x){var s=x.getElement(".premium_offers_area");if(s){var o=s.getElements(".offer.wrap.premium");var t=x.getElement(".chkRates");if(o&&t){t.toggleClass("noOffers",o.length===0)}}}}if(u){e(u,w);j(u)}if(r){e(r,w);k(r)}if(h.has("meta.isHackathonBC")){h.commerce.meta.alignPriceBlocks();if(h.has("meta.bc.isRevisedUnavailability")){h.commerce.meta.truncateProviderNames()}}c.fireEvent("postAjaxMetaUpdate");if(w&&w.getElement(".hacMiniComplete")){i(w)}},updatePCRAreaWithMiniMeta:function(o,m){if(m==null||o==null){return}var r=o.inner;if(!r){return}h.commerce.meta.suppressCRArea(r);var p=r.getElement(".postShowMetaCRLBPCR");if(p!=null){p.destroy()}var q=r.getElement("fieldset.miniMetaContainer");var n=m.getElement(".disclaimer");if(n!=null){n.destroy()}h.commerce.meta.adoptMiniMetaElem(q,m);if(!h.widgets.calendar.datesInRange()){h.commerce.meta.showCRArea(r)}},adoptMiniMetaElem:function(o,m){if(o!=null){var p=o.getElement(".disclaimer");if(p!=null&&!p.getParentBySelector("#hover_table_display_area")){p.destroy()}var n=m.clone(false);n.innerHTML=m.innerHTML;o.adopt(n)}},miniMetaAjax:function(m,n){if(g()){dd.commerce.checkrates.miniMetaAjax(m,n)}},suppressCRArea:function(m){var n=m.getElements(".miniMetaShow");Array.each(n,function(o){o.removeClass("miniMetaShow");o.addClass("miniMetaHide")})},showCRArea:function(m){var o=m.getElement(".postShowMetaCR");if(o!=null){o.destroy()}var n=m.getElements(".miniMetaHide");Array.each(n,function(p){p.removeClass("miniMetaHide");p.addClass("miniMetaShow")})},showCurrencyPicker:function(){},selectCurrency:function(){},clearStoredMiniData:function(){if(h.retrieve("checkrates.meta_ui_post_click_prices")){h.store("meta.postShowMetaCRLBPCR",null);h.store("meta.postShowMetaCR",null);h.store("meta.postShowMetaCRLB",null)}},storeMiniData:function(n){if(h.retrieve("checkrates.meta_ui_post_click_prices")){var p=n.getElement(".postShowMetaCR");var m=n.getElement(".postShowMetaCRLBPCR");var o=n.getElement(".postShowMetaCRLB");if(p&&o&&m){h.store("meta.postShowMetaCRLBPCR",m);h.store("meta.postShowMetaCR",p);h.store("meta.postShowMetaCRLB",o)}}},providerButtonClicked:function(n){if(n&&!h.has("hotels.hasTimeoutDates")){var m="CheckIn|provider_logo";h.trackEventOnPage("DATEPICKER","OPEN",m,n);h.store("meta.datepicker_tracked",true)}},moreSitesLinkClicked:function(m){if(m&&!h.has("hotels.hasTimeoutDates")){h.trackEventOnPage("DATEPICKER","OPEN","more_sites_link",m);h.store("meta.datepicker_tracked",true)}},buildMetaHacParamObj:function(){var n={};try{var m=a.getElement("#HAC_FORM input[name=geo]");if(m&&m.value){n.geo=m.value}if(!n.geo){var s=a.getElement("#SEARCH_LHN input[name=geo]");if(s){n.geo=s.value}}var t=a.getElementById("searchAll");if(t&&t.value!="true"){var q=h.widgets.calendar.getPageInDate();if(q){n.inDay=q.getDate();n.inMonth=(q.getMonth()+1)+"/"+q.getFullYear()}var p=h.widgets.calendar.getPageOutDate();if(p){n.outDay=p.getDate();n.outMonth=(p.getMonth()+1)+"/"+p.getFullYear()}var o=h.widgets.calendar.getPageAdultsCount();if(o!=2){n.adults=o}n.searchAll="false"}}catch(r){h.util.error.record(r,"buildHACUrlParams")}return Object.toQueryString(n)},getHACCategory:function(){var n=a.getElements(".tab.selected");var o="1";if(n&&n.length&&n.length>0){var m=n[0].className.match(/cat_(\d+)/);if(m){o=m[1]}}return o},buildHACSearchData:function(){var q=h.widgets.calendar.getPageInDate();var u=h.widgets.calendar.getPageOutDate();var v=h.widgets.calendar.getPageAdultsCount();var w=a.getElementById("geo");var n;if(w==null){n=a.getElementsByName("geo");if(n&&n.length>0){w=n[0]}}var t;if(w&&w.value){t=w.value}else{if(c.modelGeoId){t=c.modelGeoId}}var p=false;var x=h.commerce.meta._padZero;var s=q?x(q.getDate()):null;var o=u?x(u.getDate()):null;var r=q?x(q.getMonth()+1)+"/"+q.getFullYear():null;var y=u?x(u.getMonth()+1)+"/"+u.getFullYear():null;var m={};m.adults=v;m.geo=t;m.searchAll=p;m.inDateOfMonth=s;m.outDateOfMonth=o;m.inMonthYear=r;m.outMonthYear=y;m.category=h.commerce.meta.getHACCategory();return m},buildMetaHACUrl:function(){var m=h.commerce.meta.buildHACSearchData();var n="/HACSearch?adults="+m.adults+"&geo="+m.geo+"&searchAll="+m.searchAll;if(m.category){n=n+"&cat="+m.category}if(m.inDateOfMonth){n=n+"&inDay="+m.inDateOfMonth}if(m.outDateOfMonth){n=n+"&outDay="+m.outDateOfMonth}if(m.inMonthYear){n=n+"&inMonth="+m.inMonthYear}if(m.outMonthYear){n=n+"&outMonth="+m.outMonthYear}var o=n+c.location.hash;return o},redirectHACSearch:function(){h.setEvtCookie("Mini_meta_LP_chevron_display","Clicked","Unavailable","","/HACSearch");c.location=h.commerce.meta.buildMetaHACUrl()},_padZero:function(m){return String("0"+m).slice(-2)},anchorToOpenTab:function(){if(h.id("ReviewsTab").hasClass("selected")){h.commerce.meta.scrollToReviews()}else{if(h.id("MetaPricesTab").hasClass("selected")){var m=h.id("ReviewsTab");m.click();h.commerce.meta.scrollToReviews()}}},scrollToReviews:function(){var m=h.id("REVIEWS");if(m!=null){h.util.element.scrollIntoView(m)}else{h.util.error.record(null,"couldnt find reviews element on page!")}},scrollToId:function(m){if(m&&h.id(m)){h.util.element.scrollIntoView(h.id(m))}},initNoAvailCarousel:function(){try{var m=h.id("ALSO_VIEWED_LIST"),t;if(!m){return}var q=m.getElement("ul");if(!q){return}var w=q.getElements("li").length;var u=new Fx.Tween(q,{property:"left"});var n=353;var r=1;var v=m.getElement(".prev");var o=m.getElement(".next");if(!o||!v){return}var s=function(x){var A,y,z,B;if((r===1&&x<0)||(r===w&&x>0)){return}if(x<0){h.trackEventOnPage("Pager_Arrows","Scroll_Left","Mini_Carousel_Xsell")}else{if(x>0){h.trackEventOnPage("Pager_Arrows","Scroll_Right","Mini_Carousel_Xsell")}}r+=x;A=parseInt(q.getStyle("left"),10);y=n*x*-1;z=A+y;u.start(z);B=m.getElement(".paginator");if(B){if(r===1&&x<0){t="front"}else{if(r===w&&x>0){t="end"}else{t="middle"}}B.className="paginator "+t}};v.addEvent("click",function(){s(-1)});o.addEvent("click",function(){s(1)})}catch(p){h.util.error.record(p,"ta.commerce.meta.initNoAvailCarousel")}},showRemainingProviders:function(n,m){m=h.id(m);if(m){m.destroy()}h.store("checkrates.hr_bc_see_all_click",true);if(h.retrieve("ibdm_impression_tracking")){h.trk("n_more_sites",false,a.getElement(".premium_offers_area"))}a.getElements(".remaining").removeClass("remaining");c.fireEvent("remainingMetaProvidersShown")},showRemainingProviders_Flyout:function(n,m){m=h.id(m);var p=h.id("SHOW_REMAINING_PROVIDERS_FLYOUT");var q=a.getElements(".remaining");try{if(p&&q){a.body.addEvent("click",function(r){if(m&&!r.target||!r.target.getParents().contains(m)||p.isDisplayed()){p.hide();a.body.removeEvents("click")}else{p.adopt(q);p.show()}})}}catch(o){h.util.error.record(o,"showRemainingProviders_Flyout")}},alignPriceBlocks:function(){h.util.element.makeTextFitOneLine(".chevron_redesign .offer.premium .priceBlock .price",true);h.util.element.makeTextFitOneLine(".chevron_redesign .offer.premium .priceBlock .featuredText",true);h.util.element.makeTextFitOneLine(".chevron_redesign .offer.premium .priceOutsideChevron .price",true);h.util.element.makeTextFitOneLine(".chevron_redesign .offer.premium .priceOutsideChevron .featuredText",true);h.util.element.makeTextFitOneLine(".offer.premium .priceBlock.flag_bump .price",true);h.util.element.fitToContentsHorizontally(".offer.premium .lowest_price_folded .text",0,65);h.select(".chevron_redesign .offer.premium.unsized .loading").setStyle("display","none");h.select(".chevron_redesign .offer.premium.unsized").removeClass("unsized");h.util.element.makeSameWidth("#CHECK_RATES_CONT > #HotelDateSearch .postShowMetaCR .priceBlock");h.util.element.makeSameWidth("#HR_HACKATHON_CONTENT > #HotelDateSearch .postShowMetaCR .priceBlock")},toggleBlueChevronLowestPriceCTA:function(n){if(h.retrieve("meta_guests_field_v2.CTAActivated")&&!a.getElements(".overlay").length){if(h.has("meta_guests_field_v2.CTATimer")){clearTimeout(h.remove("meta_guests_field_v2.CTATimer"))}var m=h.id("BC_LP_CTA");if(m&&m.fade){if(n){m.fade("in")}else{m.fade("out")}}}},displayBlueChevronLowestPriceCTA:function(){var o="bcMetaLowestPriceCTA",w,u,y,n,v,t,m,x,r;if(h.has(o)&&!h.has("hr_chevron_redesign")){w=h.retrieve(o);if(w.hasOwnProperty("idx")){u=(w.idx===0)?"Not_Displayed":"Displayed";y=w.idx+"";h.trackEventOnPage("BlueChevron_LP_CTA_Display",u,y)}n=h.id("BC_LP_CTA");if(n&&n.fade){(function(){n.fade("in");if(h.retrieve("meta_guests_field_v2.enabled")){h.store("meta_guests_field_v2.CTATimer",(function(){n.fade("out")}).delay(5000));h.store("meta_guests_field_v2.CTAActivated",true)}}).delay(700)}v=h.id("bc_lp_cta_text");if(v){t=v.getSize().y;if(t==12){while(v.getSize().y<=t){v.style.width=""+(v.getSize().x-1)+"px"}v.style.width=""+(v.getSize().x+1)+"px"}if(w.displayTop){m=n.parentNode.getElement(".priceBlock");n.style.position="relative";n.style.left=(345-v.getSize().x)+"px";n.style.top=""+(-m.getSize().y-22)+"px"}else{x=n.getElement(".bc_lp_cta_triangle");n.style.left="-"+(v.getSize().x+20)+"px";x.style.left=""+(v.getSize().x+10)+"px"}v.style.marginTop=""+Math.round((25-v.getSize().y)/2)+"px"}r=5800;if(h.retrieve("check_width_for_CTA_fade")){var A=a.getElement(".bc_lp_cta");var p=a.getElement(".priceBlock");if(A&&p){var q=A.getSize().x+p.getSize().x;var s=250;if((q>s)&&!w.displayTop){(function(){n.fade("out")}).delay(r)}}}else{var z=h.retrieve("fadeBcLpCTAout");if(z&&z==1&&!w.displayTop){(function(){n.fade("out")}).delay(r)}}}},truncateProviderNames:function(){var r=a.getElement(".textLink");if(r){var o=r.getSize().x;var q=r.getElement(".price");if(q){var n=q.getSize().x;var m=o-n-28;if(h.retrieve("meta.paymentsTipText")){m=m-20}var p=$$(".textLinks .providerName");if(m>0){Array.each(p,function(s){if(s.getNext(".price")){s.setStyle("width",m)}})}}}},expandProvidersInline:function(o){o=h.id(o);if(!o){return}var n=o.getParent(".metaPriceInfo");if(!n){return}var p=n.getElements(".provider");if(!p){return}p.show();o.hide();if(h.retrieve("assisted_booking_desktop_entry")){var m=o.getParents();m.forEach(function(q){if(q.hasClass("metaPriceInfo")){if(h.meta&&h.meta.treeTrack&&h.meta.treeTrack.hasTrackingTree(q)){h.trk("n_more_sites",false,q)}}})}},flipHoverClass:function(n,m){if(n){n=h.id(n);var o=m+"Idle";var p=m+"Over";n&&n.toggleClass(o).toggleClass(p)}},trackHotelRatingsInfoClickInHR:function(m){m.target=m.target||m.srcElement;if(m.target&&m.target.href){h.setEvtCookie("Ratings_Info","all_hotels","",0,m.target.href)}},cleanupForMapView:function(){var m=h.retrieve("maps.floaterDiv");if(m){m.hide()}},navigateToHotelDetail:function(p,o,n,m){var q=h.id(p.target);if(q&&!q.match("img")&&!q.match("a")&&!q.hasClass("taLnk")&&!q.hasClass("greenLeaderTaLnk")&&!q.getParent(".metaPriceInfo")&&!q.getParent("a")&&!q.getParent(".p13n_inline_info")){if(h.retrieve("open_hotels_in_new_tab.enabled")){h.util.cookie.openWindowWithPID(n,m)}else{if(m){h.util.cookie.setPIDCookie(m)}c.location.href=n}}},updateHeaderMsg:function(n,o){var m=a.getElement(n);if(o&&m){m.innerHTML=o}},updateHeaderDates:function(){try{if(h.widgets.calendar.hasPageDates()){var o=$$(".dateHeader.inDate");var n=$$(".dateHeader.outDate");var m=h.widgets.calendar.getDatePickerFormat("short");var r=h.widgets.calendar.getDatePickerFormat("classic");if(o){var q=h.widgets.calendar.dateToString(h.widgets.calendar.getPageInDate(),m);Array.each(o,function(t){var u=h.id(t);if(u.getParent("#meta_on_photo_viewer")){return}if(u){u.innerHTML=q}})}if(n){var p=h.widgets.calendar.dateToString(h.widgets.calendar.getPageOutDate(),r);Array.each(n,function(t){var u=h.id(t);if(u){u.innerHTML=p}})}}}catch(s){h.util.error.record(s,"ta.commerce.meta.updateHeaderDates")}},enableAdultsPicker:function(){var p=a.getElement(".adultsText");if(p){p.addClass("hide")}var n=a.getElement(".changeAdults");if(n){n.addClass("hide")}var o=a.getElement(".overlay .date_picker_adults_wrap");if(o){o.removeClass("hide")}var m=a.getElement(".overlay .showPriceButtonHide");if(m){m.removeClass("showPriceButtonHide")}h.store("meta_guests_field_v2.originalAdults",h.retrieve("date.picker.adultsCount"))},disableAdultsPicker:function(n){if(!(n&&n.container)){return}var q=n.container.getElement(".adultsText");if(q){q.removeClass("hide")}var o=n.container.getElement(".changeAdults");if(o){o.removeClass("hide")}var p=n.container.getElement(".date_picker_adults_wrap");if(p){p.addClass("hide")}var m=n.container.getElement(".showPriceButton");if(m){m.addClass("showPriceButtonHide")}},adultsGoButtonClick:function(m,p,s,o,u){var q=h.widgets.calendar.getPageInDate();var v=h.widgets.calendar.getPageOutDate();var n=q&&q.getDate&&v&&v.getDate;if(n){var w=h.widgets.calendar.getCalendarObjectKey(s,o,"out");var t=h.retrieve(w);if(t){var r=t.calendar;if(r){r.onCalendarOverlayHide();r.fireEvent("onRangeSelect",[r.crId,r.options.ext]);r.fireEvent("onSelect",[r,m])}}}else{h.overlays.Factory.simulateDatePickerClick(m,p,s,o,u)}},updateAdultsText:function(){var m=a.getElement(".adultsText");if(m){h.widgets.calendar.updateAdultsDisplay(m)}},hhRedirectIfNoOffers:function(){var m=a.getElements("#HotelDateSearch .offer");if(m&&!h.commerce.meta._overlayOnPage()){h.store("ta.redirectingPage",true);h.setEvtCookie("NoOffersHH","redirect","",0,"/HotelHighlight");var n=/-r\d+-/;c.location.href=c.location.href.replace("Hotel_Review-","Hotel_Review-s1-").replace("ShowUserReviews-","Hotel_Review-s1-").replace(n,"-")}},getResponseAvailability:function(m){if(!m){return false}return{anyAvailable:!!m.match(/\shacComplete\s.*\sanyOfferCompletedSuccessfully\s/g),allUnavailable:!!m.match(/\shacComplete\s.*\shacMiniOfferNotAvailable\s/g),maybeAvailable:!!m.match(/\shacComplete\s.*\shasDisplayUnavailability\s/g)}},_overlayOnPage:function(){return h.overlays&&h.overlays.getCurrent&&h.overlays.getCurrent()},hhRemoveDatePickerForErrorMessaging:function(o){if(!h.widgets.calendar.hasPageDates()){h.commerce.meta.clickMetaShowPrices(o);return}var n=h.id("GEO_CHECK_RATES_BALANCE");if(n){n.hide()}var m=a.getElement("#HLBASE .unavailHdr");if(m){m.removeClass("hidden")}},setupMiniMetaOnAccomPolling:function(m){if(!h.pages.hac.updateHACData||!h.hac.filters.updateResults){h.util.error.record(null,"setupMiniMetaOnAccomPolling bad linkage")}h.pages.hac.startHACUpdate();if(m){h.hac.filters.updateResults()}},checkRatesCreateGeoCrAutoBroadenLb:function(o,n,m){try{if(h.has("hr_to_hh_redirect_no_offers")&&c.pageServlet&&c.pageServlet!=="HotelHighlight"){if(h.widgets.calendar.hasPageDates()){h.widgets.calendar.justUpdateSessionDates(function(){h.commerce.meta.hhRedirectIfNoOffers&&h.commerce.meta.hhRedirectIfNoOffers.delay(300)})}else{h.widgets.calendar.setErrorStyling(new Event(o).target)}return}if(!h.widgets.calendar.hasPageDates()){h.commerce.meta.clickMetaShowPrices(o);return}if(n.getParent(".meta_date_wrapper")){h.trackEventOnPage("MetaGeoLightBox","open","DatePicker",0,false)}else{h.trackEventOnPage("MetaGeoLightBox","open","ShowPrices",0,false)}h.run("ta.overlays.Factory.loadGeoCrAutoBroadenOverlay",{},n,m)}catch(p){h.util.error.record(p,"ta.commerce.meta.checkRatesCreateGeoCrAutoBroadenLb cannot track/create lightbox")}},metaListingClickReporting:function(m){if(!m||!m.target){return}if(m.target.hasClass("photo_image")){h.trackEventOnPage("PRICE_SAVER","CLICK","THUMBNAIL")}else{if(m.target.nodeName==="A"&&m.target.parentNode.hasClass("review_stubs_item")){h.trackEventOnPage("PRICE_SAVER","CLICK","REVIEW")}else{if(m.target.hasClass("property_title")){h.trackEventOnPage("PRICE_SAVER","CLICK","PROPERTY_TITLE")}else{if(m.target.getParent(".metaPriceInfo")!=null){h.trackEventOnPage("PRICE_SAVER","CLICK","META")}}}}},getMetaParams:function(){return{metaReferer:c.pageServlet}},trackAdBlock:function(){if(h.id(a.body)){var m=1;var n=new Element("div",{"class":"adInner",styles:{height:m,visibility:"hidden"}});h.id(a.body).adopt(n);if(n.getSize().y!=m){h.trackEventOnPage("ADBLOCK","ENABLED",null,null,true)}else{h.trackEventOnPage("ADBLOCK","DISABLED",null,null,true)}n.dispose()}},updateSessionDatesRedirect:function(m){if(h.widgets.calendar.hasPageDates()){h.widgets.calendar.justUpdateSessionDates(function(){c.location.href=m},false,true)}else{c.location.href=m}}}}(b))}(document,window,ta));ta.commerce.minimeta={ajax:{MAX_POLL_ATTEMPT:13,ALL_HAC_COMPLETE:"hotelsMeta.allHacComplete",LOCS_ON_PAGE:"hotelsMeta.locsOnPage",ATTEMPT_STORE_KEY:"hotelsMeta.ajaxNum",TIME_EXPIRED:"hotelsMeta.timeExpired",MINI_META_APPEAR_LOADING_TIMEOUT:5000,MINI_META_STOP_LOADING_TIMEOUT:60000,send:function(c,a){var b=ta.commerce.minimeta.ajax;setTimeout(function(){new Request({method:"post",url:b.getUrl(),data:b.buildPostData(a),onSuccess:function(d){var e=new Element("div",{html:d});b.updateDOM(e);if(!c&&b.shouldResubmit()){ta.commerce.minimeta.ajax.send()}b.updateAttemptNum()}}).send()},ta.commerce.meta.polling.getPollWaitTimeForPollingAttempt(ta.retrieve(ta.commerce.minimeta.ATTEMPT_STORE_KEY)))},getUrl:function(){return"/BulkMiniMetaCRAjax"},buildPostData:function(b){var a={};a.area="QC_Meta_Mini";a.returnAllOffers=true;a.detail=ta.commerce.minimeta.ajax._getLocOnPageString(b);a.action="getMiniMetaForLocations";return a},updateDOM:function(d){var a=d.getElement(".isAllHacComplete");if(a||ta.retrieve(ta.commerce.minimeta.ajax.ALL_HAC_COMPLETE)){ta.store(ta.commerce.minimeta.ajax.ALL_HAC_COMPLETE,true);var c=$$(".metaDisclaimer");if(c&&c.hasClass("hidden")){c.removeClass("hidden")}}var b=document.getElements(".listing");b.each(function(j){var i=j.id;var h=i.substring(i.indexOf("_")+1);var g=d.getElement("."+h);ta.commerce.minimeta.ajax.updateLoadingState(d);if(g){var e=g.getElement(".metaPriceInfo");var f=j.getElement(".metaPriceInfo");ta.commerce.minimeta.ajax._setPrice(e,h);ta.commerce.minimeta.ajax._setAccomType(e,h);e.replaces(f)}})},resetAjaxCall:function(){ta.remove(ta.commerce.minimeta.ajax.ALL_HAC_COMPLETE);ta.remove(ta.commerce.minimeta.ajax.LOCS_ON_PAGE);ta.remove(ta.commerce.minimeta.ajax.ATTEMPT_STORE_KEY);ta.remove(ta.commerce.minimeta.ajax.TIME_EXPIRED)},shouldResubmit:function(){if(ta.retrieve(ta.commerce.minimeta.ajax.ALL_HAC_COMPLETE)){return false}else{var a=ta.retrieve(ta.commerce.minimeta.ATTEMPT_STORE_KEY);if(!a||a<ta.commerce.minimeta.ajax.MAX_POLL_ATTEMPT-1){return true}else{return false}}},updateAttemptNum:function(){var a=ta.retrieve(ta.commerce.minimeta.ATTEMPT_STORE_KEY);if(!a){ta.store(ta.commerce.minimeta.ATTEMPT_STORE_KEY,1)}else{ta.store(ta.commerce.minimeta.ATTEMPT_STORE_KEY,a+1)}},_getLocOnPageString:function(b){var c=document.getElements(".listing");var a="";c.each(function(f){var d,e;if(ta.commerce.minimeta.ajax._isHacComplete(f)&&!b){return}e=f.id;d=e.substring(e.indexOf("_")+1);a=a+d+","});if(a===""){ta.store(ta.commerce.minimeta.ajax.ALL_HAC_COMPLETE,true)}return a},_isHacComplete:function(a){return a.getElement(".metaPriceInfo.hacComplete")},_setPrice:function(b,f){var a=b.getElement(".classicPrice");if(a){var d="classicPrice_"+f;var c=ta.retrieve(d);if(ta.retrieve("hotels.shouldHideClassicPrices")){a.hide()}else{if(c&&c!==0){var e=a.getElement(".price");e.set("html",c);a.toggleClass("hidden",false)}else{a.hide()}}}},_setAccomType:function(a,d){var c=a.getElement(".contactStr");if(c){var b="accomType_"+d;var e=ta.retrieve(b);if(!e||e=="T_HOTEL"){c.set("html",ta.retrieve("hotels.contactHotel"))}else{c.set("html",ta.retrieve("hotels.contactAccom"))}}},updateLoadingState:function(b){if(ta.retrieve(ta.commerce.minimeta.ajax.TIME_EXPIRED)){var d=b.getElements(".loading_bubbles_gry");var c=new Element("span",{"class":"sprite-visitSite"});d.each(function(f){c.clone().replaces(f)});var a=b.getElements(".loadingHeader");var e=ta.retrieve("hotels.checkSites");a.each(function(f){f.set("html",e)})}}},storeAccomDetails:function(){var b=document.getElements(".classicPrices");b.each(function(d){ta.store(d.id,d.value)});var a=document.getElements(".accomTypes");a.each(function(d){ta.store(d.id,d.value)});var c=$$(".metaDisclaimer");if(c){c.addClass("hidden")}},doMetaDateSearch:function(){if(!ta.widgets.calendar.hasPageDates()){var c=document.getElement(".metaDatePicker .date_picker_calendar_wrap");c.fireEvent("click")}else{if(ta.has("hac.filter.changed")||ta.has("meta.mini_meta_on_accommodations")){ta.hac.filters.updateResults()}else{if(!ta.retrieve("hotels.datesChanged")){ta.hac.filters.updateResults();ta.servlet.HACSearch.destroyAnimatedDateCTA()}else{var b=ta.hac.filters.buildHACUrlParamString();var a="/HACSearch?"+b+window.location.hash;window.location=a}}}},lowestPriceBookBtnHover:function(b){try{var a=document.getElement(".LowestPrice .bookBtn");if(!a){ta.util.error.record(null,"lowestPriceBookBtnHover - no button for .LowestPrice .bookBtn",null,{out:b});return}if(b){a.className=a.className.replace(/Over\b/,"Idle")}else{a.className=a.className.replace(/Idle\b/,"Over")}}catch(c){ta.util.error.record(c,"lowestPriceBookBtnHover - cannot change button hover appearance",null,{out:b})}}};ta.commerce.AvailDataWidget=new Class({Implements:[Options],options:{calendarOptions:{},argArray:[]},initialize:function(h,d,c,b,e,k){this.setOptions(k);if(h||window.event){h=new Event(h||window.event);if(h){h.stop()}}this.locId=d;this.ext=b;var j=null;if(this.ext){j="date_picker_adults_"+this.locId+this.ext}else{j="date_picker_adults_"+this.locId}this.adultField=ta.id(j);this.options.calendarOptions=Object.merge(this.options.calendarOptions,{ext:this.ext?this.ext:"",creatorElem:h&&h.target});var i=true;if(h){var g=ta.id(h.target);if(g&&(g.hasClass("out_date")||(ta.has("guests_rooms_picker_3.enabled")&&g.hasClass("outDateTrigger")))){i=false}}this.calendar=new ta.widgets.SingleDateCalendar(this.options.calendarOptions,this.locId,e,this.options.argArray,i);var a=ta.retrieve("adultFieldsMap");if(!a){a={}}if(this.adultField){this.adultsField=a[j];var f=this.adultField.getParent(".overlay");if(!this.adultsField||(f&&this.adultsField.parentOverlay!=f.overlay)){this.adultsField=new ta.widgets.AdultsField(this.adultField,this.locId,e,h);a[j]=this.adultsField;ta.store("adultFieldsMap",a)}}this.show(c);if(ta.widgets.calendar.trackCalendarObject){ta.widgets.calendar.trackCalendarObject(this)}},show:function(a){if(a=="calendar"&&this.calendar&&this.calendar.calendarOverlay){this.calendar.showCalendarOverlay()}else{if(a=="adults"&&this.adultsField){this.adultsField.adultsOverlay.show()}}if(ta.has("persistentFilters.showing")&&tabletOnFullSite&&this.calendar.calendarOverlay.container){this.calendar.calendarOverlay.container.setStyle("position","fixed")}},clear:function(){if(this.adultField){if(!ta.retrieve("meta_guests_field_v2.enabled")){ta.widgets.calendar.setPageAdultsCount(2)}ta.widgets.calendar.syncAllDatePickers()}this.calendar.clear()},getState:function(d){var b=this.calendar.getState();var a={adults:"2"};if(this.adultsField){a=this.adultsField.getState()}else{if(ta.widgets.calendar.getPageAdultsCount()){a={adults:ta.widgets.calendar.getPageAdultsCount()+""}}}var c=Object.merge(b,a);if(d){return c}return Object.toQueryString(c)}});ta.widgets.AdultsField=new Class({adultsSelRegex:/.*_(\d)\s*$/,adultsExRegex:/.*_\d+_(.*)$/,initialize:function(j,c,f){this.adultsField=j;this.crId=c;this.selectionFunction=f;var k=this.adultsField.getParent(".overlay");if(k){this.parentOverlay=k.overlay}var g=ta.overlays.ACTIVATE_CLICK;if(this.parentOverlay&&this.parentOverlay.container&&ta.id(this.parentOverlay.container).hasClass("persistentCR")){g=ta.overlays.ACTIVATE_NEVER}this.guestFieldLabel=this.generateGuestFieldLabel(this.adultsField.id);this.adultsOverlay=new ta.overlays.RelativeOverlayBelow({style:"dp",showCloseButton:false,noPadding:true,autoShow:false,offsetLeft:1,activate:g,onShow:this.onAdultsShow.bind(this),onHide:this.onAdultsHide.bind(this)},this.adultsField);this.adultsField.onclick=function(){};ta.id(this.adultsField).addEvent("click",this.adultsOverlay.show);var i=ta.id(this.adultsOverlay.container).getElement(".adults_pre_selected");try{this.count=ta.retrieve("date.picker.adultsCount");if(!this.count){this.count=this.adultsSelRegex.exec(i.id)[1]}}catch(h){}if(!this.count){this.count="2"}ta.widgets.calendar.setPageAdultsCount(this.count);var a=ta.id(this.adultsOverlay.container).getElements(".option");var d=this.adultSelect.bind(this);a.each(function(m,e){var l=function(n){d.pass([e+1,m,n.event])()};ta.id(m).addEvent("click",l)});var b=this.adultsField.clientWidth;b=b+"px";ta.id(this.adultsOverlay.container).setStyles({width:b});this.optionElems=a},generateGuestFieldLabel:function(c){var b=this.adultsExRegex.exec(c);var a=ta.retrieve("open_guest_field.servletName");if(!a){a=window.pageServlet}if(!b){if(!a){return""}else{if(a=="Hotel_Review"){return"Guest_HR"}else{if(a=="Hotels"){return"Guest_Hotels"}else{if(a=="ShowUserReviews"){return"Guest_Hotels"}else{return""}}}}return"Guests"}else{if(b[1]=="pop"){return"Guest_Flyout"}else{if(b[1]=="met"){return"Guest_MetaLightbox"}else{if(b[1]=="pto"){return"Guest_HR_PhotoLightbox"}else{if(b[1]=="amo"){return"Guest_HR_AmenitiesLightbox"}else{return""}}}}}},trackGuestFieldEvent:function(b,a){try{ta.trackEventOnPage("GuestPicker",b,a)}catch(c){ta.util.error.record(c,"ta.widgets.AdultsField.trackGuestFieldEvent")}},onAdultsShow:function(){try{if(this.parentOverlay&&this.parentOverlay.pin&&this.parentOverlay.options.pinnable==ta.overlays.PINNABLE_CLICK){this.tempPin=!this.parentOverlay.pinned;if(this.tempPin){this.parentOverlay.pin()}}if(ta.id("PERSISTENT_DATE_PICKER")&&this.optionElems[0]&&this.optionElems[0].getParent("div.relative")){this.optionElems[0].getParent("div.relative").setStyles({"z-index":10001})}this.keyEventListener=this.onAdultsOverlayKeyDown.bind(this);document.addEvent("keydown",this.keyEventListener);this.adultsField.blur();var a=document.getElements(".date_picker_adults_option");if(a){Array.each(a,function(d){ta.id(d).removeClass("adults_selected");ta.id(d).removeClass("adults_pre_selected")})}if(ta.id(this.adultsField).getParent("#PERSISTENT_CHECK_RATES")){var b=ta.id(this.adultsField).getCoordinates().top;if(typeof(isIPad)=="undefined"||!isIPad){b=b-window.getScrollTop()}ta.id(this.adultsOverlay.container).setStyles({position:"fixed",top:b+29,zindex:9997})}this.count=ta.retrieve("date.picker.adultsCount");if(ta.retrieve("meta_guests_field_v2.enabled")){this.optionElems[this.count-1].addClass("adults_pre_selected");this.preSelectElem=this.optionElems[this.count-1]}if(ta.retrieve("meta_guests_field_v2.trackingEnabled")){this.trackGuestFieldEvent("Open",this.guestFieldLabel)}}catch(c){ta.util.error.record(c,"ta.widgets.AdultsField.onAdultsShow")}},onAdultsHide:function(){try{if(this.parentOverlay&&this.tempPin){this.tempPin=false;this.parentOverlay.unpin()}if(this.keyEventListener){document.removeEvent("keydown",this.keyEventListener)}}catch(a){}},onAdultsOverlayKeyDown:function(a){if(a.key=="esc"){this.adultsOverlay.hide()}},adultSelect:function(e,d,c){ta.commerce.meta.tracking.resetAllTimingLocks();ta.commerce.meta.tracking.clearSuppressedAreas();ta.commerce.meta.polling.clearAllPollingInfo();this.updateValue(e,d.innerHTML);this.adultsOverlay.hide();var b=this.guestFieldLabel+"|"+this.count;if(ta.retrieve("meta_guests_field_v2.trackingEnabled")){this.trackGuestFieldEvent("Select",b)}if(!ta.widgets.calendar.hasPageDates()){return}if(this.selectionFunction){if(this.selectionFunction===ta.widgets.calendar.launchInlineMeta){this.selectionFunction.call(this,c)}else{this.selectionFunction.call(this,this.crId,this.adultsField)}}if(ta.commerce.metajson){ta.commerce.metajson.refetchAll()}if(typeof oxapp!="undefined"&&oxapp&&oxapp.context){var a=oxapp.context.get("TravelDates");if(a){a.save()}}if(ta.has("checkrates.meta_af")){ta.commerce.meta.loadMetaAF(this.crId,"AV_ABOVE_FOLD_META",false)}ta.widgets.calendar.trackCalendarEvent("DATEPICKER","CHANGE","GUESTS",e)},updateValue:function(a,b){this.count=a;this.adultsField.innerHTML=b;ta.widgets.calendar.setPageAdultsCount(this.count);ta.widgets.calendar.syncAllDatePickers();ta.widgets.calendar.justUpdateSessionAdults();var c=document.getElements(".adults");c.each(function(d){d.innerHTML=b})},getAdultsCount:function(){return this.count},getState:function(){return{adults:this.count+""}}});ta.commerce.meta.tracking={getTimingForNavArea:function(a){if(!a){return}var b=ta.commerce.meta.tracking.processNavArea(a);return ta.retrieve(b)},setTimingLockForNavArea:function(b,a){ta.store(b+"-LOCK",a)},isTimingLocked:function(b){var c=ta.commerce.meta.tracking.processNavArea(b);var d=ta.retrieve(c);if(!d){return false}var a=Date.now();if(a-d>=2000){ta.commerce.meta.tracking.resetTimingLockForNavArea(c);return false}return true},resetTimingLockForNavArea:function(a){var b=ta.commerce.meta.tracking.processNavArea(a);if(ta.retrieve(b+"-LOCK")){ta.remove(b+"-LOCK")}},resetAllTimingLocks:function(){var a=["QC_Meta_Inline","QC_Meta_Mini","QC_Meta_Metro","QC_Meta_Micro","QC_Meta_Lightbox"];for(var b=0;b<a.length;b++){ta.commerce.meta.tracking.resetTimingLockForNavArea(a[b])}},processNavArea:function(a){if(!a){return}if(a.indexOf("QC_Meta_Inline")===0){return"QC_Meta_Inline"}if(a.indexOf("QC_Meta_Mini")===0){return"QC_Meta_Mini"}if(a.indexOf("QC_Meta_Metro")===0){return"QC_Meta_Metro"}if(a.indexOf("QC_Meta_Micro")===0){return"QC_Meta_Micro"}if(a.indexOf("QC_Meta_Lightbox")===0){return"QC_Meta_Lightbox"}},setTimingForNavArea:function(c,b){if(!c){return}if(!b){b=Date.now()}var a=ta.commerce.meta.tracking.processNavArea(c);if(ta.commerce.meta.tracking.isTimingLocked(a)){return ta.commerce.meta.tracking.getTimingForNavArea(a)}ta.store(a,b);ta.commerce.meta.tracking.setTimingLockForNavArea(a,b);if(a=="QC_Meta_Inline"&&!ta.commerce.meta.tracking.containsSuppressedArea("QC_Meta_Mini")){ta.commerce.meta.tracking.setTimingLockForNavArea("QC_Meta_Mini",b)}return b},updateUrlWithTiming:function(b,a){if(!b||!a){return b}var c=ta.commerce.meta.tracking.setTimingForNavArea(a);if(!c){return b}if(b.contains("&metaRequestTiming=")){var d=new RegExp("(&|\\?)metaRequestTiming=[^&]*");b=b.replace(d,"&metaRequestTiming="+c)}else{b+="&metaRequestTiming="+c}return b},suppressImpressionsForArea:function(c){if(!c){return}var b=ta.commerce.meta.tracking.processNavArea(c);if(ta.commerce.meta.tracking.containsSuppressedArea(b)){return}var a=ta.retrieve("suppressed.areas");a.push(b);ta.store("suppressed.areas",a)},getSuppressedAreas:function(){var a=ta.retrieve("suppressed.areas");if(!a){a=[];ta.store("suppressed.areas",a)}return a},getSuppressedAreasAsString:function(){var b=ta.commerce.meta.tracking.getSuppressedAreas();var a="";if(b.length>0){for(var c=0;c<b.length;c++){a+=b[c]+";"}}return a},hasAnySuppressedAreas:function(){var a=ta.commerce.meta.tracking.getSuppressedAreas();return a.length>0},containsSuppressedArea:function(d){if(!d){return false}var b=ta.commerce.meta.tracking.processNavArea(d);var a=ta.commerce.meta.tracking.getSuppressedAreas();for(var c=0;c<a.length;c++){if(a[c]==b){return true}}return false},removeSuppressedArea:function(e){if(!e){return}var b=ta.commerce.meta.tracking.processNavArea(e);var f;var c;if(ta.commerce.meta.tracking.containsSuppressedArea(b)){var a=ta.commerce.meta.tracking.getSuppressedAreas();for(var d=0;d<a.length;d++){if(a[d]==b){c=d;f=true}if(f){a=ta.commerce.meta.tracking.removeElementByIndex(a,c);ta.store("suppressed.areas",a)}}}},removeElementByIndex:function(b,a){if(b&&a>=0&&a<b.length){b.splice(a,1)}return b},clearSuppressedAreas:function(){ta.store("suppressed.areas",[])},getTrackFunctionForSuggestedAccommodations:function(){var a=function(){var g=ta.widgets.calendar.getPageOutDate();var c="hotelsAccommodationGroupTracking";var f=ta.id(c);if(f){var e=f.getBoundingClientRect();if(e&&e.top>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)){var d="Hotels on Tourism";var h="Impression";var b="dated";if(g===false){b="undated"}var i=ta.has("suggestedAccommodationsIsDmoSponsored")?1:0;ta.trackEventOnPage(d,h,b,i);window.removeEvent("scroll",a)}}};return a},getTrackFunctionForSuggestedVRs:function(){var a=function(){var g=ta.widgets.calendar.getPageOutDate();var c="vrsAccommodationGroupTracking";var f=ta.id(c);if(f){var e=f.getBoundingClientRect();if(e&&e.top>=0&&e.bottom<=(window.innerHeight||document.documentElement.clientHeight)){var d="VRs on Tourism";var h="Impression";var b="dated";if(g===false){b="undated"}var i=ta.has("suggestedAccommodationsIsDmoSponsored")?1:0;ta.trackEventOnPage(d,h,b,i);window.removeEvent("scroll",a)}}};return a}};ta.commerce.meta.polling={setPollingAttemptForRequest:function(a,b){var c=ta.commerce.meta.polling.getPollingMap();if(!b){b=1}c[a]=b;ta.commerce.meta.polling.setPollingMap(c)},getPollingAttemptForRequest:function(a){if(ta.commerce.meta.polling.isRequestBeingPolled(a)){var c=ta.commerce.meta.polling.getPollingMap();var b=c[a];if(b){return b}}},getPollingWaitTimeForRequest:function(a){var b=ta.commerce.meta.polling.getPollingAttemptForRequest(a);return ta.commerce.meta.polling.getPollWaitTimeForPollingAttempt(b)},isRequestBeingPolled:function(a){var c=ta.commerce.meta.polling.getPollingMap();var b=a&&c[a];if(b){return true}return false},incrementPollingAttemptForRequest:function(a){var c=ta.commerce.meta.polling.getPollingMap();var b=c[a];if(b){b=b+1;c[a]=b}ta.commerce.meta.polling.setPollingMap(c);return b},clearAllPollingInfo:function(){ta.store("ta.meta.polling.map")},removePollingInfoForRequest:function(a){if(ta.commerce.meta.polling.isRequestBeingPolled(a)){var b=ta.commerce.meta.polling.getPollingMap();delete b[a];ta.commerce.meta.polling.setPollingMap(b)}},getPollingMap:function(){var a=ta.retrieve("ta.meta.polling.map");if(!a){a={};ta.store("ta.meta.polling.map",a)}return a},setPollingMap:function(a){if(a){ta.store("ta.meta.polling.map",a)}},getPollWaitTimeForPollingAttempt:function(a){if(typeOf(a)!=="number"||a<0){return 1000}switch(a){case 1:case 2:case 3:case 4:return 1000;case 5:case 6:case 7:return 1500;case 8:case 9:case 10:return 2000;case 11:return 5000;case 12:return 15000;default:return 30000}},getMaxPollingAttemptNumber:function(){return 13}};ta.commerce.meta.horizontalXSell=(function(){var k=10;var g=1000;var h=false;var c=null;var n=null;var l=null;var p=0;var f=function(q){if(q.contains("hacComplete")&&(q.contains("hacMiniOfferNotAvailable")||q.contains("hacMiniOfferUnavailable"))){return true}return false};var j=function(q){if(!a()){return false}if(!q.contains("hacMiniOfferUnavailable")){return true}return false};var e=function(t,w){try{if(ta.retrieve("ta.redirectingPage")||ta.retrieve("non_comm_hr_xsell_2014")){return}if(!w){p=0}c=new Date().getTime();var v=c;var u=ta.widgets.calendar.getCheckRatesData();if(!u){return}var r={};if(ta.meta&&ta.meta.update){r=ta.commerce.meta.getMetaParams()}var q=Object.merge(u,{detail:t,reqNum:w?"2":"1",type:"horizontal_hr"},r);var x=Object.toQueryString(q);if(!x||!x.trim()){ta.util.error.record(null,"ta.commerce.meta.horizontalXSell.loadHorizontalXSell - toQueryString failure",null,q);return}new Request({url:"/MetaBestPriceCrossSellAjax",data:q,evalScripts:true,onSuccess:function(D){if(v!=c){return}var A=new Element("div",{html:D});var C=A.getElement(".xsellHacStatusReady")||A.getElement(".xsellHacStatusSOL")||w;if(ta.has("meta.full_meta_photos_v3")){D+='<div class="gap_spacer"></div>'}if(!C&&p<k){setTimeout(function(){p=p+1;e(t,true)},g)}else{var F=ta.id("HORIZONTAL_CROSS_SELL");var z=A.getElement(".metaMicro");if(F&&z){if(F.getElement(".metaMicro")){F.setContent(D)}else{F.setStyle("opacity","0");var E=new Fx.Tween(F,{property:"opacity"});F.setStyle("height",0);var B=122;var y=new Fx.Tween(F,{property:"height",onComplete:function(){F.setStyle("height","auto");F.setContent(D);E.start(0,1)}});y.start(0,B)}if(n){n()}d(true)}}},onFailure:function(){if(ta.retrieve("ta.redirectingPage")){return}ta.util.error.record(null,"ta.commerce.meta.horizontalXSell.loadHorizontalXSell - MetaBestPriceCrossSellAjax request failed")}}).send()}catch(s){ta.util.error.record(s,"ta.commerce.meta.horizontalXSell.loadHorizontalXSell")}};var i=function(q,r){if(!q||!q.getElement(".bc_flags")){return}var s=q.getElement(".bc_flags").className;if(j(s)){m()}else{if(f(s)){e(r,false)}}};var m=function(){var q=ta.id("HORIZONTAL_CROSS_SELL");var s=ta.id("HORIZONTAL_CROSS_SELL_LIST");var t=document.getElement("#HORIZONTAL_CROSS_SELL_LIST .lodging");if(q&&s&&t){var u=s.getSize().y;q.setStyle("height",u);var v=new Fx.Tween(s,{duration:200,property:"opacity",onComplete:function(){s.addClass("hidden");r.start(u,0).chain(function(){q.setStyle("height",0);q.innerHTML=""})}});v.start(1,0);var r=new Fx.Tween(q,{duration:"long",property:"height"});if(l){l()}d(false)}};var a=function(){return h};var d=function(q){h=q};var o=function(q){n=q};var b=function(q){l=q};return{updateHorizontalXSell:i,removeHorizontalXSell:m,isLoaded:a,setLoaded:d,setOnloadFunction:o,setOnRemoveFunction:b}}());ta.commerce.meta.horizontalXSellExtensions={putAvafBelowMap:function(){if(ta.commerce.meta.horizontalXSell.isLoaded()){return}var d=ta.id("AV_ABOVE_FOLD_META");var c=ta.id("RHS_MAP");var b=d.parentNode;if(d&&c&&b){var a=b.getElement(".bxDivider.map");if(a){b.insertBefore(a,d);b.insertBefore(c,a)}else{b.insertBefore(c,d)}}},putAvafAboveMap:function(){if(!ta.commerce.meta.horizontalXSell.isLoaded()){return}var c=ta.id("AV_ABOVE_FOLD_META"),b=ta.id("RHS_MAP"),a=c.parentNode;if(c&&b&&a){a.insertBefore(c,b)}}};if(!ta.meta){ta.meta={}}if(!ta.meta.link){ta.meta.link={}}(function(b){b.OPEN_IN_NEW_TAB="new_tab";b.OPEN_IN_SAME_TAB="same_tab";b.OPEN_IN_NEW_WINDOW="new_window";b.getUrlFromClickElem=function(q){if(!q){return null}var r=q.get("data-commerceClickData");if(!r||!r.trim||r.trim()===""||typeof asdf!=="function"){return null}r=asdf(r).replace(/&amp;/g,"&");return r};b.animateAndClick=function(s,q){var r=q.hasClass("bookableOffer"),t=function(){b.click(s,q);var u=function(){k();ta.off("commerceClickAnimated",u)};ta.on("commerceClickAnimated",u)};ta.CommerceClickAnimation.addAnimation(t,{animateOnFocus:!r,squelchAnimation:true})};b.addToCartAndClick=function(r,q){b.click(r,q);k()};var g=function(s){if(s&&s.getDate&&window.jsGlobalDaysFull&&window.jsGlobalMonths){var q=document.body?document.body.className.contains("lang_ar"):false;var t=ta.widgets.calendar.getDatePickerFormat();var r=t.replace(q?"EEEE":"EEE",window.jsGlobalDaysFull[s.getDay()]);r=r.replace(q?"MMMM":"MMM",window.jsGlobalMonths[s.getMonth()]);r=r.replace(/\bd\b/,s.getDate());return r}};b.click=function(H,r){var C=ta.id(r),L,F,E,s,I,u,K,D,q,v;try{C=i(C);L=b.getUrlFromClickElem(C);if(!L){return}F=C.get("data-vendorName");E=C.get("data-locationId");s=C.get("data-navArea");I=C.get("data-contentId");u=C.get("data-openBehavior");K=C.get("data-imageUrl");D=C.get("data-mcid");if(ta.has("meta_click_interstitial_v2.enabled")){var A=C.get("data-perNight");var z=C.get("data-taxesValue");var w=C.get("data-locationName");var x=C.get("data-locationGeoName");var B="";var t="";var G=1;if(ta.widgets&&ta.widgets.calendar){B=g(ta.widgets.calendar.getPageInDate());t=g(ta.widgets.calendar.getPageOutDate());G=ta.widgets.calendar.getNumberOfNights()}ta.store("metaClickData",{perNight:A,taxesValue:z,locName:w,geoName:x,checkIn:B,checkOut:t,dateRange:G,imageUrl:K})}if(!s){q=C.get("data-navAreaPre");v=C.get("data-navAreaPost");s=p(q,r,v)}if(s){s=s.replace("+","|")}if(ta.browser.isIE10Metro()){s="QC_Meta_Metro_Lightbox"}if(r.getParent("#LOC_PHOTO_ALBUMS")){if(r.getParent(".featuredImageWrap")){s=s+"|PHOTOS_LB|Featured_Reel"}else{s=s+"|PHOTOS_LB"}}else{if(r.getParent("#AMENITY_LIGHTBOX")){s=s+"|AMENITIES_LB"}}a(s);var y=s;s=l(C);if(s==null||s.indexOf("null")!=-1||s.indexOf("Unknown")!=-1){s=y}if(L&&F&&E){j(L,s,F,E,u,C,K,D)}else{n(null,"Invalid commerce click",L,s)}}catch(J){n(J,"Invalid commerce click",L,s)}setTimeout(function(){try{window.fireEvent("metaLinkClick",[C,F,s,E,I,u])}catch(M){n(M,"Commerce click tracking failed",L,s)}},300)};b.photoClick=function(r,u,s,q,t){if(s.hasOwnProperty("area")){s.area=b.getPhotoNavArea(r)}ta.util.Doer.aimdoit(u,s,q,t)};b.getPhotoNavArea=function(q){return l(q,{"data-navArea-metaType":"Pro_Photo","data-navArea-availability":"NA"})};function j(x,v,F,E,y,t,J,C){var K=x;var L=new RegExp("(&|\\?)area=[^&]*");K=K.replace(L,"$1area="+v);if(crPageServlet){var w=new RegExp("(&|\\?)from=[^&]*");K=K.replace(w,"$1from=HotelDateSearch_"+crPageServlet)}var s=ta.commerce.meta.tracking.setTimingForNavArea(v);if(s&&t&&!t.hasClass("bookableOffer")){if(K.contains("&metaRequestTiming=")){var u=new RegExp("(&|\\?)metaRequestTiming=[^&]*");K=K.replace(u,"&metaRequestTiming="+s)}else{K+="&metaRequestTiming="+s}}if(C){K+="&m="+C}var z=ta.analytics.getCommentTrackingPath(t);if(z&&z.length>0){var B=z.getLast();if(B&&B.indexOf(":")===-1){K+="&tp="+B;var q=d(z,K,v);if(q){K+="&gn="+q}}else{n(null,"ibdm_cc: no placement found",K,v,"WARN")}}else{n(null,"ibdm_cc: no tracking path found",K,v,"WARN")}var I=K.indexOf("/StartBooking")>=0;if(I){m()}if(ta.retrieve("commerce_history_injection_v2")&&!I){K="/NewWindowRedirect?url="+encodeURIComponent(K)}if(ta.has("assisted_booking_clicks_new_tab")&&y===b.OPEN_IN_NEW_TAB&&I&&ta.browser&&ta.browser.isIE10Metro()){y=b.OPEN_IN_SAME_TAB}var H=false;if(window.pageServlet==="Hotel_Review"){H=!ta.retrieve("persistent_meta_hr")}H=H&&!ta.has("reverse_test_flyouts");if(t.getAttribute("data-suppressFlyout")==="true"){H=false}if(H){var D=t.getParent("#CHECK_RATES_CONT")&&t.getParent("#CHECK_RATES_CONT").getParent("#MAIN.Hotel_Review")&&!t.getParentBySelector(".non_comm_xsell");if(I&&(ta.retrieve("hr_room_list_with_ib")&&document.getElement(".p13n_hr_room_list"))&&D){ta.fireEvent("bookingChevronClicked");new Fx.Scroll(window).toElement(document.getElement(".p13n_hr_room_list"))}else{if(ta.widgets.ChooseRoomFlyout&&I&&D){ta.widgets.ChooseRoomFlyout.expand(K)}else{if(ta.widgets.HotelsChooseRoomFlyout&&I&&t.getParent(".listing")&&t.getParent(".listing").getParent("#MAIN.Hotels")){ta.widgets.HotelsChooseRoomFlyout.expand(K,t)}else{if(ta.widgets.SDChooseRoomFlyout&&I&&t.getParent(".illisting")&&window.pageServlet=="SmartDeals"){ta.widgets.SDChooseRoomFlyout.expand(K,t)}else{if(ta.widgets.SDChooseRoomFlyout&&I&&(t.getParent(".baseHotel")||t.getParent(".illisting"))&&window.pageServlet=="HotelHighlight"&&!ta.retrieve("no_ib_flyout_for_short_cell.enabled")){ta.widgets.SDChooseRoomFlyout.expand(K,t)}else{if(y===b.OPEN_IN_NEW_TAB){e(K,J,F,t)}else{if(y===b.OPEN_IN_SAME_TAB){c(K,t)}else{o(F,K,J)}}}}}}}}else{if(t.hasClass("exclDeal")&&!ta.retrieve("isUserLoggedIn")&&ta.widgets.HotelsChooseRoomFlyout){ta.widgets.HotelsChooseRoomFlyout.showMemberOnlyCTA(t)}else{if(ta.retrieve("ib_bot_redirect_hr_flyout")&&I&&E){var G=/ik=[a-zA-Z0-9]*/g;var A=K.match(G);var r=(A&&A[0])?A[0].substring("ik=".length):"";K=K.substring(0,K.indexOf("/StartBooking"))+"/Hotel_Review-d"+E+"?ibf=true&ik="+r}if(y===b.OPEN_IN_NEW_TAB){e(K,J,F,t)}else{if(y===b.OPEN_IN_SAME_TAB){c(K,t)}else{o(F,K,J)}}}}if(window.pageServlet==="Hotel_Review"&&ta.widgets.ChooseRoomFlyout&&!I&&t.getParent("#CHECK_RATES_CONT")&&t.getParent("#CHECK_RATES_CONT").getParent("#MAIN.Hotel_Review")&&!t.getParentBySelector(".non_comm_xsell")&&y!==b.OPEN_IN_SAME_TAB){ta.metaFocus.hr.onMetaOfferClick()}if(window.IS_DEBUG){ta.store("ta.lastCommerceClickUrl",K)}}function d(r,u,A){var q="groups";var E="_NavCart";var C="MyCartTab";var s="V:HG-1.1";var D=-1;var z=0;var t;var y;var w=r.getLast();var B=r[r.length-2];var v;var x;if(!r){return}if(r.length<5){return}if((w.indexOf(E)!==(w.length-E.length))&&w!==C){return}if(B.indexOf(s)!==0){return}for(y=r.length-1;y>=0;y--){if(!r[y]){continue}z=0;t=r[y];if(t===q&&D===-1){v=y;for(v=y-1;v>=0;v--){t=r[v];if(t.indexOf("N:")===0){z++;if(D===-1){D=v}}}}if(D!==-1){break}}if(z>=3&&D>0){t=r[D];x=t.split(":");if(x.length===2){return x[1]}else{n(null,"ibdm_cc: no group node found",u,A,"WARN")}}}function m(){if(!ta.has("ib_qualaroo_surveys")||(window.pageServlet!=="Hotels"&&window.pageServlet!=="Hotel_Review")||!ta.qualaroo){return}try{var q=window.pageServlet!=="Hotels"?"HOTEL_REVIEW":"HOTELS",r="IB_QUALAROO_SURVEYS_"+q;ta.qualaroo.forceDisplaySurvey("force",r,false)}catch(s){ta.util.error.record(s,"Unable to display Qualaroo survey")}}b.showQualarooSurvey=m;function e(u,r,t,s){var q=window.open("","_blank");if(!q&&typeof(Browser)!=="undefined"&&Browser.ie&&ta.has("ta.ie_commerce_popup_block_fix")&&ta.has("assisted_booking_clicks_new_tab")&&u.indexOf("/StartBooking")>=0){if(ta.util&&ta.util.cookie){ta.util.cookie.setPIDCookie(38822)}c(u,s);return}if(ta.retrieve("meta_click_interstitial.enabled")&&u.indexOf("/StartBooking")<0){ta.popups.PopUtil.displayCommerceClickInterstitial(q,r,t,u);setTimeout(function(){try{ta.popups.PopUtil.redirectToUrl(q,u)}catch(v){}},500)}else{ta.popups.PopUtil.redirectToUrl(q,u)}ta.popups.PopUtil.pollForPartnerLoad(q,new Date(),t)}function c(t,r){ta.meta.treeTrack.logTrackingTreeClickEvtCookie(t,r);if(ta.meta&&ta.meta.treeTrack){var s=function(){f(t)};if(r&&r.getParentBySelector(".metaCheckRatesOverlay")!=null){ta.meta.treeTrack.logLightboxTreeImpression(s)}else{if(ta.meta.treeTrack.isInitialized()){try{ta.meta.treeTrack.logTreeImpression(s)}catch(q){ta.util.error.record(q," Error in openMetaProviderSameTab");f(t)}}}}else{f(t)}}function f(q){if(ta.retrieve("ta.isIE11orHigher")){window.open(q,"_self",null,false)}else{window.location.href=q}}function o(w,v,s){var q=w,u=ta.popups.PopUtil.getProviderWindowDims(q,true),r=1,t;if(window&&window.chrome){r=0}t={customWidth:u.customWidth,customHeight:u.customHeight,widthOffset:u.widthOffset,heightOffset:u.heightOffset,name:q,url:v,scrollbars:r,providerLogo:s};ta.popups.PopUtil.createCheckRatesWindow(t)}function a(q){var r=ta.retrieve("ta.meta.navArea");if(!r||r.indexOf(q)<0){ta.store("ta.meta.navArea",q)}}function p(q,u,r,t){var v="";if(u.getParent(".persistentCR")){v=(t)?"|PCR":"PCR"}else{if(u.getParent(".photosOverlay")||u.getParent("#LOC_PHOTO_ALBUMS")){v=(t)?"|Photo_Lightbox":"Photo_Lightbox"}else{if(u.getParent(".amenities_lightbox")){v=(t)?"|Amenities_Lightbox":"Amenities_Lightbox"}else{if(u.getParent("#CHECK_RATES_LB")){v=(t)?"|Photo_LB":"Photo_LB"}}}}v=v?"|"+v:"";q=q?q:"";v=v?v:"";r=r?r:"";var s=[q,v,r].join("|").replace("||","|").replace(/(\|$)/g,"");return s}function n(t,s,u,r,q){ta.util.error.record(t,s,null,{servlet:window.pageServlet,url:u,area:r},q)}function l(r,s){var v;var u={"data-navArea-metaType":null,"data-navArea-linkType":null,"data-navArea-availability":null,"data-navArea-placement":null};var t=4;if(s){for(v in u){if(s.hasOwnProperty(v)){u[v]=s[v];t--}}}var w=null;while(r&&t>0){for(v in u){if(u[v]===null){u[v]=r.get(v);if(u[v]!==null){if(u[v]==="@trigger"){w=r}t--}}}r=r.getParent()}while(u["data-navArea-placement"]==="@trigger"&&w){while(w&&!w.overlay){w=w.getParent()}if(w&&w.overlay.options&&w.overlay.options.trigger){w=w.overlay.options.trigger}else{w=null;u["data-navArea-placement"]="null"}while(w){u["data-navArea-placement"]=w.get&&w.get("data-navArea-placement");if(u["data-navArea-placement"]!==null){break}w=w.getParent()}}var q=[];for(v in u){q.push(u[v]?u[v]:"null")}if(window.isTabletOnFullSite){q.push(h()?"Portrait":"Landscape")}else{q.push("Desktop")}return q.join("|")}function h(){if(ta.common&&ta.common.tablet){return ta.common.tablet.isPortrait()}return window.matchMedia&&window.matchMedia("(orientation: portrait)")&&window.matchMedia("(orientation: portrait)").matches}function i(r){if(!r||r.isVisible()){return r}var t=r.get("data-locationid");var u=r.get("data-contentid");var q=".offer";if(r.hasClass("bookableOffer")){q=q+'.bookableOffer[data-locationid="'+t+'"]'}else{q=q+'[data-locationid="'+t+'"][data-contentid="'+u+'"]'}var s=document.getElement(q);if(s){return s}return r}function k(){if(!ta.NavAbandonedCart){return}ta.NavAbandonedCart.udpate()}})(ta.meta.link);if(!ta.meta){ta.meta={}}if(!ta.meta.linkTracking){ta.meta.linkTracking={}}(function(e){e.setup=function(){try{ta.util.customEvent.addListener("metaLinkClick",window,j)}catch(k){ta.util.error.record(k,"trouble building event - metaLinkClick")}};e.actionRecord=function(k){new Request({url:"/ActionRecord?action="+k}).send()};e.restoreCRPageServlet=function(){var k=ta.retrieve("crPageServlet_orig");if(k){window.crPageServlet=k}};function j(l,q,k,o,p,n){g(q,k,o,n);b(l,p);d(l);i(l,p);a(o,true,p);if(l&&ta.retrieve("hotels_lists_engagement_tracking.enabled")){var m=l.hasClass("bookableOffer")?"Sherpa":"Meta";ta.fireEvent("hotels_lists_engagement_tracking.fired",{type:m,element:l})}if(n!=ta.meta.link.OPEN_IN_SAME_TAB){h(l)}}function h(k){if(ta.meta&&ta.meta.treeTrack){if(k&&k.getParentBySelector(".metaCheckRatesOverlay")!=null){ta.meta.treeTrack.logLightboxTreeImpression()}else{if(ta.meta.treeTrack.isInitialized()){ta.meta.treeTrack.logTreeImpression()}}ta.meta.treeTrack.logTrackingTreeClickTrk(k)}}function a(n,l,o){try{var k={locId:n,isMetaCheckRates:l,contentId:o};ta.common.ads.loadClickoutMonikers(k)}catch(m){ta.util.error.record(m,"click out monikers failure (meta="+l+")")}}function g(p,l,o,n){var m="CheckRates";var q=1;ta.trackPhysicalCommerce(m,l,q,o);ta.trackAttemptedCommerce(m,l,p,q);var k=n?(n===ta.meta.link.OPEN_IN_NEW_TAB?"TAB_OPENED":(n===ta.meta.link.OPEN_IN_NEW_WINDOW?"WINDOW_OPENED":"SAME_TAB")):"";ta.trackEventOnPage("COMMERCE_CLICK",k,(p||""))}function i(m,n){var o=m.getParent("#HotelDateSearch");if(o){var l="bcMetaLowestPriceCTA";var p="BlueChevron_LP_CTA_Click";if(ta.has(l)){var t=ta.retrieve(l);if(t.hasOwnProperty("idx")&&t.hasOwnProperty("provider")){try{var r=f(o);var k=null;for(var q=0;q<r.length;q++){if(n==r[q]){k=q}}if(k){ta.trackEventOnPage(p,t.idx,k,0,false)}}catch(s){ta.util.error.record(s,"error logging blue chevron lowest price click info")}}}}}function b(l,m){var n=l.getParent("div#PROVIDER_BLOCK")||l.getParent("div#PROVIDER_BLOCK_INLINE");if(n){var u=(n.id=="PROVIDER_BLOCK_INLINE")?true:false;var q=(u)?"metaLowestPriceCTAInline":"metaLowestPriceCTA";var o=(u)?"Meta_LP_CTA_Click_Inline":"Meta_LP_CTA_Click";if(ta.has(q)){var s=ta.retrieve(q);if(s.hasOwnProperty("idx")&&s.hasOwnProperty("provider")){try{var r=c(n);var k=null;for(var p=0;p<r.length;p++){if(m==r[p]){k=p}}if(k){ta.trackEventOnPage(o,s.idx,k,0,false)}}catch(t){ta.util.error.record(t,"error logging lowest price click info")}}}}}function c(p){var m=[];m[0]=-1;try{if(p){var l=p.getElements(".jsPrvdr");for(var k=0;k<l.length;k++){var o=l[k]&&ta.id(l[k]).get("data-contentid");if(o){m.push(o)}}}}catch(n){ta.util.error.record(n,"error scraping meta providers")}return m}function f(p){var m=[];m[0]=-1;try{if(p){var l=p.getElements(".offer");for(var k=0;k<l.length;k++){var o=l[k]&&ta.id(l[k]).get("data-contentid");if(o){m.push(o)}}}}catch(n){ta.util.error.record(n,"error scraping blue chevron providers")}return m}function d(l){var r=ta.id(l);try{var q=r.get("data-offer-author");if(!q){return}var t=null,k=null;var n=r.getParent(".overlay .skv3");var s=r.getParent(".mapsv2-listitem")||r.getParent(".mapsv2-dropdownlist");if(s&&s.get("data-sponsor")){t=s.get("data-sponsor");k=s.get("data-sponsor-provider")}else{if(n&&n.hasAttribute("data-sponsor")&&pageServlet){t=n.get("data-sponsor");k=n.get("data-sponsor-provider")}else{var m=ta.id("mapsv2-sponsordetail");if(m&&m.get("data-sponsor")){t=m.get("data-sponsor");k=m.get("data-sponsor-provider")}}}if(k&&q==k){var p=(pageServlet=="LocalMapsRedesign")?"LocalMap":(pageServlet=="HACSearch"||pageServlet=="Hotels")?"HACMap":"FloatingMap";ta.trackEventOnPage(p,"sponsor_cr_sent",t)}}catch(o){ta.util.error.record(o,"Error while trying to log map sponsored provider clicks")}}})(ta.meta.linkTracking);if(!ta.meta.treeTrack){ta.meta.treeTrack={}}(function(e){var d=false;var b={hotelListSelector:null,singleHotelSelector:null,placementName:null,getImpressionString:null};var c="ibdm_impression_tracking";e.init=function(h){if(d){ta.util.error.record(null,"ta.meta.treeTrack should be initialized only once");return false}b=h;d=true};e.isInitialized=function(){return d};e.hasTrackingTree=function(h){if(!h||typeof h.previousSibling==="undefined"){return false}var i=h.previousSibling||h.nextSibling;if(i){if(f(i)){return true}return f(i.previousSibling)}return false};var f=function(i){if(i){var h=i.nodeValue;return h&&(h.contains("trk")||h.contains("etk"))}return false};e.logImpressionTreeOnPageLoad=function(){if(ta.retrieve("assisted_booking_desktop_entry.logTreePoll")&&ta.widgets.calendar.hasPageDates()&&!ta.retrieve("vrTabOnHotels")){var i=1;var k=4;var h;if(!ta.retrieve("treeTrackImpressionInProgess")){ta.store("treeTrackImpressionInProgess",true);var j=setInterval(function(){if(ta.retrieve("isTrackTreeFresh")){h=e.logTreeImpression(null,(i<k))}if(!h&&i<k){i++}else{ta.store("isTrackTreeFresh",false);ta.store("treeTrackImpressionInProgess",false);clearInterval(j)}},2000)}}};e.logTreeImpression=function(k,j){if(!ta.retrieve(c)||ta.retrieve("vrTabOnHotels")){if(k){k()}return false}if(!d){ta.util.error.record(null,"ta.meta.treeTrack.logTreeImpression called before being initialized");if(k){k()}return false}var h=a();var i=b.getImpressionString(h);if(!i&&h<=0){if(k){k()}return false}if(i&&i.indexOf("I:IllegalContext")===-1){ta.recordImpression(i,k);return true}else{if(!j){ta.util.error.record(null,"ta.meta.treeTrack.logTreeImpression called but no tracking tree html found!",null,{},"WARN")}}if(k){k()}return false};e.logLightboxTreeImpression=function(i){if(!ta.retrieve(c)){if(i){i()}return false}var h=g();if(h){ta.recordImpression(h,i);return true}if(i){i()}};var g=function(){var h=$$(".metaCheckRatesOverlay .impressionTrackingTree");if(h){return h[0].innerHTML}};e.getElmtPriceData=function(h){var i=[];if(!h){return i}var j="PP:";if(h.getAttribute("data-pernight")){j+=h.getAttribute("data-pernight")}else{j+="-1"}i.push(j);var k="PN:";if(h.getAttribute("data-offer-author")){k+=h.getAttribute("data-offer-author")}else{k+="None"}i.push(k);return i};e.logTrackingTreeClickTrk=function(h){if(!ta.retrieve(c)){return}if(e.hasTrackingTree(h)){if(h.hasClass("bookableOffer")){ta.trk("sherpa_click",false,h)}else{var i=e.getElmtPriceData(h);ta.trk("meta_click",false,h,i)}}};e.logTrackingTreeClickEvtCookie=function(i,h){if(!ta.retrieve(c)){return}if(e.hasTrackingTree(h)){if(h.hasClass("bookableOffer")){ta.setEvtCookieAndPath("sherpa_click",i,h)}else{ta.setEvtCookieAndPath("meta_click",i,h)}}};e.getElmtHeight=function(h){if(h){return h.offsetHeight}};function a(){if(!b.hotelListSelector||!b.singleHotelSelector){return 0}var i=0;var h=0;var j=document.getElements(b.hotelListSelector);j.each(function(k){k.getElements(b.singleHotelSelector).each(function(l){if(l.match(b.singleHotelSelector)){i++;if(l.isFullyVisible()){h=i}}})});return h}})(ta.meta.treeTrack);if(!ta.meta.update){ta.meta.update={}}ta.util.customEvent.addListener("newInlinePageDates",window,function(b,a){ta.meta.update.request(b,a)});(function(n){var b="miniMetaHacRequest_longTimeoutKey";var f="miniMetaHacRequest_appearLoadedTimeoutKey";n.request=function(y,x){l(y);w(y,x)};n.completeOnInitialPage=function(x){a(true,"",x)};n.buildUrl=function(E,O,L,D,W,I,G,B,C,x){var y=e(W),H=ta.widgets.calendar.getCheckRatesData(),X="",N="",R="",K="",J="";if(H){X=Object.toQueryString(H)}if(D){N="&metaVersion="+D}if(ta.has("meta.baseLocationId")){R="&baseLocId="+ta.retrieve("meta.baseLocationId")}if(ta.retrieve("checkrates.mini_meta_by_percent_cpc_see_all_click")||ta.retrieve("checkrates.hr_bc_see_all_click")||(ta.retrieve("checkrates.hr_bc_see_all_click.lb")&&E==="MetaCheckRatesAjax")){K="&seeAllClick=true"}if(window.pageServlet){J="&imp=true&metaReferer="+window.pageServlet}var S=ta.retrieve("meta.requestFromArea");if(!S){S="";if(document.getElement("#LOC_PHOTO_ALBUMS")){S="&requestFromArea=pal"}else{if(document.getElement("#AMENITY_LIGHTBOX")){S="&requestFromArea=amo"}}ta.store("meta.requestFromArea",S)}var A="/"+E+"?detail="+O+"&"+X+"&area="+y+"&returnAllOffers=true"+J+N+R+K+S,P=A;try{A=ta.commerce.meta.tracking.updateUrlWithTiming(A,y)}catch(V){ta.util.error.record(V,"problem updating url with timing in CheckRates.buildVarMetaHacUrl");A=P}if(ta.commerce.meta.tracking.hasAnySuppressedAreas()){var T=ta.commerce.meta.tracking.getSuppressedAreasAsString();if(T){A+="&suppressImpressionsOnComplete="+T}}if(ta.retrieve("ta.commerce.suppress_commerce_impressions.enabled")){P=A;try{A=m(A,C);if(!A){A=P}}catch(V){ta.util.error.record(V,"problem updating url with isFirstPageLoad in CheckRates.buildVarMetaHacUrl");A=P}}if(L){A+="&finalRequest=true"}if(I){A+="&numTries="+I}if(B){A+="&loadingTimeoutPassed="+B}if(x){A+="&isDateChangedRequest="+x}if(ta.maps&&ta.maps.mapsponsor){var z=ta.maps.mapsponsor.getSponsorForLocation(O);if(z){A+="&mapSponsorship="+z}}var F="meta.premiumIdsForNextPoll";if(B&&ta.has(F)){A+="&premiumContentId="+ta.retrieve(F)}else{if(G){var M=G[0];if(M){A+="&premiumContentId="+M;for(var Q=1;Q<G.length;Q++){M=G[Q];A+=","+M}}}}if(B&&ta.has("meta.displacedChevronOfferContentId")){A+="&displacedChevronOffer="+ta.retrieve("meta.displacedChevronOfferContentId")}var U="ta.commerce.MetaHacOverlay.currency";if(ta.has(U)){A+="&currency="+ta.retrieve(U);ta.remove(U)}return A};n.overlayRequest=function(R,T,Z,O,G){var Q,D="metaHacRequest_curCancelKey",I,L,E,X,A,P,M,V,y=13,U,x,C,K,F,N,H;try{if(!R){return}ta.commerce.meta.clearStoredMiniData();I=ta.widgets.calendar.getCheckRatesData();if(T==null){ta.store("meta.travelData",I);T=new Date().getTime();L=false;if(Z){if(ta.has("metaCheckRatesUpdateDivInline")){L=ta.id(ta.retrieve("metaCheckRatesUpdateDivInline"))}}else{if(ta.has("metaCheckRatesUpdateDiv")){L=ta.id(ta.retrieve("metaCheckRatesUpdateDiv"))}}if(L&&L.removeClass){L.removeClass("hidden")}}E="metaHacRequest_"+T+"_cancel";if(ta.has(D)){X=ta.retrieve(D);if(X!=E){ta.store(X,true);ta.commerce.meta.polling.removePollingInfoForRequest(X)}}if(Z){A=document.getElement(".meta_rates_content .postShowMetaCR");if(ta.has("checkrates.mini_meta_by_percent_cpc")&&ta.retrieve("checkrates.mini_meta_by_percent_cpc_see_all_click")){P=A.getElement(".seeMore.threshold");if(P){M=A.getElements(".postClickPrice.hide");M.each(function(aa){aa.removeClass("hide")});P.hide()}}ta.commerce.meta.updateProvArea(A)}if(!ta.has(E)){ta.store(E,false);ta.store(D,E)}if(ta.retrieve(E)===true){return}V=ta.retrieve("metaCheckRatesOverlay");if(!V&&!Z){return}Q=false;if(V){Q=V.inner}if(ta.has("metaCheckRatesUpdateDiv")){Q=ta.id(ta.retrieve("metaCheckRatesUpdateDiv"))}if(Z&&ta.has("metaCheckRatesUpdateDivInline")){Q=ta.id(ta.retrieve("metaCheckRatesUpdateDivInline"))}}catch(W){ta.util.error.record(W,"overlayRequest setup")}if(!Q){return}try{if(ta.commerce.meta.polling.isRequestBeingPolled(E)){U=ta.commerce.meta.polling.getPollingAttemptForRequest(E);if(!U||U>y){ta.commerce.meta.polling.removePollingInfoForRequest(E);return}}else{U=1;ta.commerce.meta.polling.setPollingAttemptForRequest(E,U)}if(!Q.innerHTML.contains("hacComplete")){x=false;if(Z){x="QC_Meta_Inline"}if(!O){O=1}var J=ta.meta.update.buildUrl("MetaCheckRatesAjax",R,true,G,x,O);setTimeout(function(){new Request({url:J,onSuccess:function(aa){if(ta.retrieve(E)){return}if(ta.retrieve("metaCheckRatesOverlay")||ta.retrieve("metaCheckRatesUpdateDivInline")){Q.innerHTML=aa;ta.fireEvent("refreshedDOMContent",Q);if(ta.retrieve("checkrates.meta_ui_sk_box")){ta.commerce.meta.restoreProviderHover()}}if((ta.meta.update.getMetaPricesCount(Z)>0||U>9)&&ta.commerce.meta.hacIsBlockingXSell(Z)){if(Z){ta.commerce.meta.metaInYourMeta("REC_CONT_INLINE",{xsell:false,inline:true})}else{ta.commerce.meta.metaInYourMeta("REC_CONT",{xsell:false,inline:false})}}ta.commerce.meta.polling.incrementPollingAttemptForRequest(E);ta.meta.update.overlayRequest(R,T,Z,O+1,G)},evalScripts:true}).send()},ta.commerce.meta.polling.getPollingWaitTimeForRequest(E))}else{try{ta.commerce.meta.polling.removePollingInfoForRequest(E);C=ta.id("META_HAC_DATE_HEADLINE");if(C){var Y=C.getElements(".headlineLegend");if(Y.length>=2){Y.forEach(function(aa){aa.addClass("hidden")});if(Q.getElement(".anyOfferCompletedSuccessfully")){Y[0].removeClass("hidden");if(ta.retrieve("lightbox_improvements")){ta.commerce.meta.hideBestPriceXsell("REC_CONT")}}else{if(Q.getElement(".partnersAllNotAvailable")&&ta.retrieve("lightbox_improvements")&&Y.length>2){Y[2].removeClass("hidden");if(Z){ta.commerce.meta.loadBestPriceXsell(R,"REC_CONT_INLINE",{isInline:true});ta.commerce.meta.metaInYourMeta("REC_CONT_INLINE",{xsell:false,inline:true})}else{var B={isMetaLighboxV3:ta.retrieve("meta_lightbox_v3.enabled")};if(!ta.id("META_PRICE_XSELL")){ta.commerce.meta.loadBestPriceXsell(R,"REC_CONT",Object.merge(B,{isInline:false}))}ta.commerce.meta.metaInYourMeta("REC_CONT",{xsell:false,inline:false})}}else{Y[1].removeClass("hidden");if(ta.retrieve("lightbox_improvements")){ta.commerce.meta.hideBestPriceXsell("REC_CONT")}}}}if(!ta.retrieve("lightbox_improvements")){if(Z){ta.commerce.meta.loadBestPriceXsell(R,"REC_CONT_INLINE",{isInline:true});ta.commerce.meta.metaInYourMeta("REC_CONT_INLINE",{xsell:false,inline:true})}else{ta.commerce.meta.loadBestPriceXsell(R,"REC_CONT",{isInline:false});ta.commerce.meta.metaInYourMeta("REC_CONT",{xsell:false,inline:false})}}}if(V){ta.commerce.meta.storeMiniData(V.inner)}if(ta.retrieve("assisted_booking_desktop_entry.logTreePoll")&&Q){var S=Q.getElement(".impressionTrackingTree");if(S){ta.trkImpTree(S)}}K=i(Q);N="complete";if(Z){if(ta.id("COMHVY")){F="Mini-Meta";if(ta.find(".NotShowing .postClickPrice")){N+="_may_be_available"}else{if(ta.find("#HotelDateSearch .price .minCost")){if(ta.find(".strikeHigh")){N+="_available_lp_chevron"}else{N+="_available"}}else{N+="_unavailable"}}}else{F="Metainline"}}else{F="meta_lightbox"}if(Q.innerHTML.contains("doneNoAvailability")){ta.widgets.calendar.trackCalendarEvent("DATEPICKER","RESULTS_EMPTY",ta.widgets.calendar.getPageAdultsCount(),ta.widgets.calendar.getPageAdultsCount());if((ta.id("MAYBE_BUTTONS_INLINE")&&Z)||(ta.id("MAYBE_BUTTONS")&&!Z)&&F!="Mini-Meta"){N+="|may_be_availabile"}else{if(F!="Mini-Meta"){N+="|unavailable"}}}else{ta.widgets.calendar.trackCalendarEvent("DATEPICKER","RESULTS_PRESENT",ta.widgets.calendar.getPageAdultsCount(),ta.widgets.calendar.getPageAdultsCount())}ta.trackEventOnPage(F,N,K.toString());ta.commerce.meta.showLowestPriceCTA(Z);window.fireEvent("MetaLightboxHacComplete");H=ta.find(".overlay .skv3");if(H&&H.hasAttribute("data-sponsor")){var z=H.getAttribute("data-sponsor");ta.maps.ads.injectMetaLightBoxAd(z)}}catch(W){ta.util.error.record(W,"overlayRequest - failure in complete results block")}}}catch(W){ta.util.error.record(W,"meta HAC - ajax requests")}};n.displayRemainingProviders=function(A){try{var z=ta.id("CHECK_RATES_CONT");var y=z.getElements("li");for(var x=y.length;x--;){y[x].removeClass("hide")}A.hide();ta.store("checkrates.mini_meta_by_percent_cpc_see_all_click",true)}catch(B){ta.util.error.record(B,"displayRemainingProviders")}};n.updateCRForm=function(x){try{if(ta.has("metaDatePickerEnabled")){ta.widgets.calendar.syncAllDatePickers();return}var J=ta.id("HotelDateSearch"+x);var I=ta.id("HotelDateSearch");var B=["select","input[type=checkbox]","input[type=hidden]","input[type=text]"];if(J&&I){for(var E=B.length;E--;){var z=B[E];var L=I.getElements(z);var A=J.getElements(z);for(var D=A.length;D--;){var K=A[D];var H=K.id.split("_")[0];for(var C=L.length;C--;){var G=L[C];if(G.id.contains(H)){if(z=="input[type=checkbox]"){var M=G.getParent("li");if(M&&!M.hasClass("unavailable")){var y=K.getParent("li");if(y){y.removeClass("unavailable")}}}if(z=="select"){K.selectedIndex=G.selectedIndex}else{if(z=="input[type=checkbox]"&&x!="_pop"){K.checked=G.checked}else{if(!K.id.contains("hacPid")){K.value=G.value}}}}}}}}}catch(F){ta.util.error.record(F,"updateCRForm")}};n.getMetaPricesCount=function(x){var z=0,B;var y=ta.retrieve("metaCheckRatesOverlay");var A=false;if(y){A=y.inner}if(ta.has("metaCheckRatesUpdateDiv")){A=ta.id(ta.retrieve("metaCheckRatesUpdateDiv"))}if(x&&ta.has("metaCheckRatesUpdateDivInline")){A=ta.id(ta.retrieve("metaCheckRatesUpdateDivInline"))}if(!A){return}B=A.getChildren("#HR_HACKATHON_CONTENT .roomPrice");if(B){z=B.length}return z};function c(C){var B=ta.id("PROVIDER_BLOCK");if(!B){return}if(typeof CDNHOST!="undefined"){var A='<img class="provLoading" src="'+CDNHOST+'/img2/meta_sprites/loadingAnim.gif">';B.getElements(".rightBox").each(function(D){D.setContent(A)})}var y=B.get("html");var x=1000;var z="metaHacRequest_"+x+"_cancel";ta.remove(z);new Request({url:ta.meta.update.buildUrl("MetaCheckRatesAjax",C,true),onSuccess:function(D){B.setContent(D);ta.fireEvent("refreshedDOMContent",B);ta.meta.update.overlayRequest(C)},onFailure:function(){B.setContent(y)}}).send()}function w(y,x){if(x=="pop"){ta.store("ta.meta.request.locId",y);ta.store("ta.meta.request.placement",x);ta.run("ta.overlays.Factory.metaCheckRatesOverlay")}else{if(x=="met"||x=="solb"){if(!ta.has("meta.widget")){c(y)}}}}function i(z){var A;var B;var x=0;var y=0;z=ta.id(z);B=z.getChildren("#HR_HACKATHON_CONTENT .roomPrice");A=z.getChildren("#HR_HACKATHON_CONTENT .textLinks .offer .price");if(B){x=B.length}if(A){y=A.length}return x+y}function l(B,E,J,I){if(ta.retrieve("tablet_maps_v1")&&ta.retrieve("maps_v2_open")){return}if(!J){J=0}if(!I){I=false}var F="miniMetaHacRequest_curCancelKey";var D=13;if(E==null){E=new Date().getTime()}var C="miniMetaHacRequest_"+E+"_cancel";if(ta.retrieve(C)===true){return}if(ta.has(F)){var L=ta.retrieve(F);if(L!=C){ta.store(L,true);ta.commerce.meta.polling.removePollingInfoForRequest(L)}}if(!ta.has(C)){ta.store(C,false);ta.store(F,C)}var K;if(ta.commerce.meta.polling.isRequestBeingPolled(C)){K=ta.commerce.meta.polling.getPollingAttemptForRequest(C);if(!K||K>D){ta.commerce.meta.polling.removePollingInfoForRequest(C);return}}else{K=1;ta.commerce.meta.polling.setPollingAttemptForRequest(C,K)}var y=[];if(I){var H=$$("#CHECK_RATES_CONT div.premium:not(.tripConnectDemo)");for(var A=0;A<H.length;A++){var z=H[A].get("data-contentid");y.push(parseInt(z,10))}}if(J<1){var G;if(ta.has(b)){G=ta.retrieve(b);clearTimeout(Number.from(G))}if(ta.has(f)){G=ta.retrieve(f);clearTimeout(Number.from(G))}G=setTimeout(function(){u()},ta.commerce.minimeta.ajax.MINI_META_STOP_LOADING_TIMEOUT);ta.store(b,Number.from(G))}var x=ta.retrieve("hotels.datesChanged");if(x&&ta.has("hac_timezone_awareness")){n.clearDatesBumpedMessage()}new Request({url:ta.meta.update.buildUrl("MiniMetaCRAjax",B,true,null,"QC_Meta_Mini",J,y,I,C,x),onSuccess:function(M){a(false,M,B,E,J,I,C,x)},evalScripts:true}).send()}n.clearDatesBumpedMessage=function(){var y=ta.id("HAC_DATES_MOVED_FORWARD");var x=document.getElement("#CHECK_RATES_CONT .legend.metaDatesChosen");if(y&&x){y.dispose();x.removeClass("hidden")}};function d(x){x.getChildren().each(function(y){var z=y.getAttribute("data-targetEvent");if(z){ta.fireEvent(z,y)}})}function a(G,H,N,Q,J,y,C,x){if(ta.retrieve(C)===true){return}var E,U,L,I;if(G){var T=ta.select("#CHECK_RATES_CONT fieldset")[0];H=T.get("html");E=new Element("div",{html:H});U=true;L=document.getElement(".similarCarousel");I=E.getChildren()}else{E=new Element("div",{html:H});d(E);U=H.contains("hacMiniComplete");L=document.getElement(".similarCarousel");I=Elements.from(H)}if(!L||J<1){ta.commerce.meta.updateProvArea(E.getElement(".postShowMetaCR"));window.fireEvent("miniMetaOnHRUpdate",H)}if(!document.getElement(".dropdownMiniMeta")){var A=document.getElement(".postShowMetaCR");if(A){h(H,A)}}v(H);if(ta.retrieve("hotel_review_low_price_message")&&E.getElement(".price_alert_update")){var V=document.getElement("#PRICE_ALERT_RIBBON_CONTAINER");if(V){var W=V.getElementById("PRICE_ALERT_RIBBON");if(W){W.destroy()}W=E.getElement(".price_alert_update").getElement(".price_alert_ribbon");if(W){V.innerHTML=W.outerHTML;ta.util.element.makeTextFitOneLine("#PRICE_ALERT_RIBBON",false);var K=W.getElement(".priceAlertText b");if(U&&K&&K.innerHTML&&K.innerHTML.length>0){ta.trackEventOnPage("hotel_review_low_price_message","Display",K.innerHTML)}}}}if(U&&!H.contains("bookableOffer")){window.fireEvent("hacComplete_noBookingOffersFound")}if(U||y){if(H.contains("bookableOffer")){window.fireEvent("hacComplete_bookingOffersFound")}}var M=ta.id("HR_META_INTERSTITIAL");if(M){var S=document.getElement("#HR_HACKATHON_CONTENT fieldset");if(S){if(J<1&&!G){ta.store("show_hr_meta_interstitial",true);window.setTimeout(function(){ta.store("show_hr_meta_interstitial",false);M.addClass("hidden");S.removeClass("hr_meta_loading_hidden")},2000);S.addClass("hr_meta_loading_hidden");var F=document.getElement("#HR_HACKATHON_CONTENT .metaExplanation");if(F){F.addClass("hidden")}M.removeClass("hidden")}else{if(!M.hasClass("hidden")&&(!ta.retrieve("show_hr_meta_interstitial")||U)){M.addClass("hidden");S.removeClass("hr_meta_loading_hidden")}}}}if(ta.has("meta.isHackathonBC")&&!ta.has("hr_unavail_xsell_flyout")){ta.commerce.meta.horizontalXSell.updateHorizontalXSell(E,N)}if(!U&&ta.has("meta.isHackathonBC")&&H.contains("firstRequest")){var D=setTimeout(function(){r(N,Q,J)},ta.commerce.minimeta.ajax.MINI_META_APPEAR_LOADING_TIMEOUT);ta.store(f,Number.from(D))}if(U&&ta.has(f)){var B=ta.retrieve(f);clearTimeout(Number.from(B))}if(!U){if(ta.has("meta.isHackathonBC")&&H.contains("anyOfferCompletedSuccessfully")){ta.commerce.meta.updateHeaderMsg(".metaDatesChosen",ta.retrieve("meta.bc.bestPricesForYourStay"));if(ta.has("guests_rooms_picker_3.enabled")){ta.commerce.meta.updateHeaderDates()}}if(ta.has("guests_rooms_picker_4.enabled")&&ta.overlays.NumberPickerOverlay){ta.overlays.NumberPickerOverlay.updateHeaderMsg(".metaDatesChosen")}ta.commerce.meta.polling.incrementPollingAttemptForRequest(C);setTimeout(function(){l(N,Q,J+1,y)},ta.commerce.meta.polling.getPollingWaitTimeForRequest(C))}else{if(ta.has("meta.isHackathonBC")){var R=ta.retrieve("meta.bc.bestPricesForYourStay");if(H.contains("allNotAvailable")){var O=ta.id("priceNotAvailMsg");if(O){R=O.innerHTML}else{R=ta.retrieve("meta.bc.pricesTravelSitesNotAvailDates")}}ta.commerce.meta.updateHeaderMsg(".metaDatesChosen",R);if(ta.has("guests_rooms_picker_3.enabled")){ta.commerce.meta.updateHeaderDates()}if(ta.has("guests_rooms_picker_4.enabled")&&ta.overlays.NumberPickerOverlay){ta.overlays.NumberPickerOverlay.updateHeaderMsg(".metaDatesChosen")}if(ta.retrieve("meta.full_meta_photos")){var z=document.getElement(".metaDatesChosen");if(z){if(H.contains("allNotAvailable")){if(ta.has("ibex_lead_with_supplier_direct_logo")){document.getElement(".headerWrapper").addClass("no_offers_available");document.getElement(".changeStayInfoButton").addClass("no_offers_available")}z.addClass("no_offers_available")}else{if(ta.has("ibex_lead_with_supplier_direct_logo")){document.getElement(".headerWrapper").removeClass("no_offers_available");document.getElement(".changeStayInfoButton").removeClass("no_offers_available")}z.removeClass("no_offers_available")}}}ta.commerce.meta.polling.removePollingInfoForRequest(C);ta.commerce.meta.displayBlueChevronLowestPriceCTA();window.fireEvent("HRHacComplete");if(!y){o(Q,false)}var P=document.getElement(".similarCarousel");if(y&&P){g(H)}if(!G){setTimeout(function(){t()},1000)}}}ta.fireEvent("onHACUpdate",H);if(U&&!ta.retrieve("hotels_to_seo_hotels_redirect")&&x&&!y&&!ta.retrieve("meta.persist.visible")&&!(H.contains("cancelRedirect"))){if(H&&H.match(/\shacComplete\s.*\shacMiniOfferNotAvailable\s/g)){ta.trackEventOnPage("NoAvailability","redirect","",0,"/HotelHighlight")}if(H&&H.match(/\shacComplete\s.*\shasDisplayUnavailability\s/g)){ta.trackEventOnPage("MaybeAvailable","redirect","",0,"/HotelHighlight")}}if(U){ta.fireEvent("HRHacAvailabilityDetermined",{availability:ta.commerce.meta.getResponseAvailability(H),loadingTimeoutPassed:y,cancelRedirect:H.contains("cancelRedirect"),datesChanged:x,hasBookableOffer:H.contains("bookableOffer")})}k(U,E);s(Q,U,y)}function h(z,x){var A=new Element("div",{html:z}),y=A.getElement(".dropdownMiniMeta");if(y){y.inject(x)}}function v(z){var x=document.getElement(".rgba_flyout.dropdownMiniMeta"),A,B,y;if(x){A=new Element("div",{html:z});y=A.getElement(".dropdownMiniMeta");if(y){B=x.getElement(".inner");B.innerHTML="";y.set("class","dropdownMiniMeta");B.adopt(y)}p()}}function p(){if(ta.retrieve("dropdownMiniMeta.hover")){ta.commerce.meta.hoverTopOffer()}else{if(ta.retrieve("dropdownMiniMeta.blur")){ta.commerce.meta.blurTopOffer()}}}function r(A,y,x){var z="miniMetaHacRequest_"+y+"_cancel";if(ta.retrieve("datepicker_autoadvance")&&ta.retrieve(z)){return}j();o(y,true);l(A,new Date().getTime(),x+1,true)}function e(x){var y="";if(ta.browser.isIE10Metro()){if(x=="QC_Meta_Book_Inline"){y="QC_Meta_Metro_Inline"}else{y="QC_Meta_Metro_Lightbox"}}else{if(!x){if(ta.has("ta.meta.navArea")){y=ta.retrieve("ta.meta.navArea")}else{ta.util.element.trackIfMapView();y="QC_Meta_Lightbox"}}else{y=x}}return y}function u(){var z=document.getElement("#CHECK_RATES_CONT div.hacMiniComplete");var x=document.getElement("#CHECK_RATES_CONT div.hacMiniCompleteTimeOut");if(z||x){return}var y=document.getElement("div.bc_flags");if(y){y.addClass("hacMiniCompleteTimeOut")}j();t()}function j(y){var x=y?"metaHacRequest_curCancelKey":"miniMetaHacRequest_curCancelKey";if(ta.has(x)){var z=ta.retrieve(x);ta.store(z,true);ta.commerce.meta.polling.removePollingInfoForRequest(z)}}n.cancelAllMetaCurrentQuery=function(){j(false);j(true)};function q(){var z=document.getElements("#CHECK_RATES_CONT span.textLinkLoading");var y=document.getElements("#CHECK_RATES_CONT div.loading");var x=0;if(z){x+=z.length}if(y){x+=y.length}return x}function m(x,A){var y,z;if(!x||!A){return}y=A+"_suppressCommerceImpressionState";z=ta.commerce.meta.polling.getPollingAttemptForRequest(A);if(z){if(z===1){if(ta.retrieve("meta.isFromDatesChange")){ta.remove("meta.isFromDatesChange");ta.store(y,true);x+="&isFirstPageLoad=false";return x}}else{if(ta.retrieve(y)){x+="&isFirstPageLoad=false";return x}}}return x}function o(D,G){var z=0;var E="unknown";if(G){z=ta.commerce.minimeta.ajax.MINI_META_APPEAR_LOADING_TIMEOUT;var F=q();var y=document.getElements("#CHECK_RATES_CONT div.premium");var A=document.getElements("#CHECK_RATES_CONT span.textLink");var C=0;if(y){C+=y.length}if(A){C+=A.length}var x=C-F;if(C>0){var B=Math.round((x/C)*10)*10;if(B%10===0&&B>-1&&B<101){E=""+B+"percent"}}}else{z=new Date().getTime()-D;E="100percent"}ta.trackEventOnPage("HAC","HACComplete",E,z,true)}function g(B){var A=Elements.from(B)[0];if(!A){return}var z=A.getElementsByClassName("price");var y=A.getElementsByClassName("priceBlock");var x=0;if(z){x+=z.length}if(y){x+=y.length}ta.trackEventOnPage("HAC","StateCarouselDisplayed","",x,true)}function t(){var x=q();if(x>0){ta.trackEventOnPage("HAC","HACError","LoadingAfterHACComplete",x,true)}}function k(z,x){if(z&&ta.retrieve("ibdm_impression_tracking")){var A=x.getElements(".impressionTrackingTree");if(A){var y;for(y=0;y<A.length;++y){ta.trkImpTree(A[y])}}}}function s(A,z,x){if(z||x){var B="meta.lowestPricePromotionTracking.tracked"+A;if(ta.has("meta.lowestPricePromotionTracking")&&!ta.has(B)){var y=ta.retrieve("meta.lowestPricePromotionTracking");if(y&&y.bidDifference&&y.priceDifference&&y.bidDifference>=0.43&&y.priceDifference>=10){ta.store(B,true);ta.trackEventOnPage("lowest_price_promoted_impression",y.providers,y.bidDifference+"|"+y.priceDifference)}}}}})(ta.meta.update);if(!ta.meta){ta.meta={}}if(!ta.meta.cross_sell){ta.meta.cross_sell={}}(function(e){var f=0;var b=false;var c=0;e.relatedHoverOver=function(i,g){try{if(f!==0){return}if(g===0){a()}else{d((i)?(i.target||i.srcElement):null,g)}}catch(h){ta.util.error.record(h,"also viewed - avafIn")}};e.relatedHoverOut=function(j){try{if(f!=1||!b){return}if(!j){j=window.event}if(!j){return}var g=(j.relatedTarget)?j.relatedTarget:j.toElement;var i=ta.id("ALSO_VIEWED_LIST");while(g&&g!=i&&g.nodeName!="BODY"){g=g.parentNode}if(g==i){return}clearTimeout(b);b=false;f=0}catch(h){ta.util.error.record(h,"also viewed - avafOut")}};e.relatedExpand=function(g,i){var h,k;try{ta.trk("AVAF_EXPAND_"+(i?"MORE":"LESS"),false,(g)?(g.target||g.srcElement):null);if(i){h=ta.id("hideableMore");if(!h){return}h.addClass("hidden");h=ta.id("expand_av_on_more");if(!h){return}h.removeClass("hidden");if(c===0){h.addClass("expanding");c=h.getSize().y;h.removeClass("expanding")}h.addClass("show");new Fx.Tween(h,{duration:"long",property:"height"}).start(0,c)}else{h=ta.id("expand_av_on_more");if(!h){return}new Fx.Tween(h,{duration:"long",property:"height"}).start(h.getSize().y,0).chain(function(){h.removeClass("show");h.addClass("hidden");k=ta.id("hideableMore");if(!k){return}k.removeClass("hidden")})}}catch(j){ta.util.error.record(j,"also viewed - avafMore")}};e.relatedResetStateFlag=function(){f=0};function d(h,g){try{f=1;b=setTimeout(function(){a(h)},g)}catch(i){ta.util.error.record(i,"also viewed - avafWait")}}function a(h){try{ta.trk("AVAF_HOVER_EXPAND",false,h);f=2;var g=ta.id("expand_av_on_hover");if(!g){return}g.removeClass("hidden");g.addClass("expanding");var l=g.getSize().y;g.removeClass("expanding");g.addClass("show");var k=g.getParent("#AV_ABOVE_FOLD_META");if(k){k.setStyle("height","auto")}var j=new Fx.Tween(g,{duration:"long",property:"height"});j.start(0,l)}catch(i){ta.util.error.record(i,"also viewed - avafExpand")}}})(ta.meta.cross_sell);if(!ta.meta.cr){ta.meta.cr={}}(function(b){b.updateCRCalendar=function(c){if(c.form){a(c.form)}b.updateCRFormElement(this);if(ta.id("META_UI_INLINE")){ta.meta.update.updateCRForm("_imt")}};b.findInlineCRLocationId=function(){var g=null;var h=ta.id("HotelDateSearch");if(h){var c=h.getElements("input[type=text]");for(var f=c.length;f--;){var d=c[f];var e=d.id.match(/_(\d+)/);if(e.length){g=e[1];break}}}return g};b.updateCRFormElement=function(g){try{g=ta.id(g);var o=g.get("tag").toLowerCase();if(o=="li"){g=g.getElement("input[type=checkbox]")}var h=g.id.split("_")[0],k=this.findInlineCRLocationId(),n=h+"_"+k,f=g.id,c=f.substring(f.length-4),r=[n,n+"_icr",n+"_per",n+"_imt"],j,q,d,m,p;if(this.crSyncExtensions.contains(c)){for(j=r.length;j--;){n=r[j];if(n!=f){p=ta.id(n);if(p){if(o=="li"&&c!="_pop"){p.checked=g.checked;q=g.getParent("li");if(q&&!q.hasClass("unavailable")){d=p.getParent("li");if(d){d.removeClass("unavailable")}}}else{if(o=="select"){p.selectedIndex=g.selectedIndex}else{if(o=="input"){m=n.substring(n.length-4);if(!this.crSyncExtensions.contains(m)){m=""}this.updateCRFormElement_In(k,g,c,m)}}}}}}}}catch(l){ta.util.error.record(l,"updateCRFormElement")}};b.getPropIdFromCRElement=function(d){if(d){var c=null;if(c=d.className.match(/id_(\d+)/)){return c[1]}}return null};b.removePCR=function(){var c=ta.retrieve("pcr.overlay");if(c){c.hide()}};b.availCheck=function(d){var c=ta.id("availability")&&ta.id("availability").value=="1";var f=ta.id(d).getElement(".overlaySrc");if(c&&f){var e=f.innerHTML;f.innerHTML=e.replace(/cid=(\w+_)?&amp;/,"")}};b.crSyncExtensions=["_pop","_icr","_pto","_per","_amo","_cro","_met","_imt","_pal","_inm"];function a(c){if(ta.retrieve("checkrates.datesChanged")){return}try{var d=ta.id(c);d.getElements(".unavailable").each(function(e){e.removeClass("unavailable");if(e.hasClass("js_ua_checked")){e.getElements("input").set("checked",true)}ta.meta.update.updateCRFormElement(e)});ta.store("checkrates.datesChanged",true)}catch(g){ta.util.error.record(g,"_showSuppressedProviders")}}})(ta.meta.cr);(function(a){a.GoogleCSA={addCallback:function(c,b){b.adLoadedCallback=function(h,d){var f=ta.id(c);if(f&&!d){try{f.dispose()}catch(g){ta.util.error.record(g,"Google CSA")}}};return b}}}(ta.commerce));if(!ta.sales){ta.sales={}}ta.sales.metaImpressionTag=(function(h,f,e){var g=null,j=null,c=null,d=false,i=function(o){if(e.find(o)){var m=e.select(o);for(var l=0;l<m.length;l++){var n=m[l];if(((n.get("data-provider")&&n.get("data-provider")==j)||(n.get("data-offer-author")&&n.get("data-offer-author")==j)||(n.get("data-vendorname")&&n.get("data-vendorname")==c))&&!n.hasClass("hidden")){b();return true}}}return false},b=function(){var l=g+Math.floor(Math.random()*100000);h.body.appendChild(new Element("img",{"class":"tracking",src:l,height:"0",width:"0"}));d=true;a()},k=function(){f.addEvent("HotelsHacComplete",e.sales.metaImpressionTag.chkHotels);f.addEvent("HRHacComplete",e.sales.metaImpressionTag.chkHR);f.addEvent("MicroMetaHacComplete",e.sales.metaImpressionTag.chkMicroMeta);f.addEvent("MetaLightboxHacComplete",e.sales.metaImpressionTag.chkLightbox);f.addEvent("MetaFetchComplete",e.sales.metaImpressionTag.chkMapDetailCard);f.addEvent("MetaFetchComplete",e.sales.metaImpressionTag.chkSmartDeals);f.addEvent("MapListMetaComplete",e.sales.metaImpressionTag.chkMapListCard)},a=function(){f.removeEvent("HotelsHacComplete",e.sales.metaImpressionTag.chkHotels);f.removeEvent("HRHacComplete",e.sales.metaImpressionTag.chkHR);f.removeEvent("MicroMetaHacComplete",e.sales.metaImpressionTag.chkMicroMeta);f.removeEvent("MetaLightboxHacComplete",e.sales.metaImpressionTag.chkLightbox);f.removeEvent("MetaFetchComplete",e.sales.metaImpressionTag.chkMapDetailCard);f.removeEvent("MetaFetchComplete",e.sales.metaImpressionTag.chkSmartDeals);f.removeEvent("MapListMetaComplete",e.sales.metaImpressionTag.chkMapListCard)};return{chkLightbox:function(){if(d){return}i(".overlay #PROVIDER_BLOCK .metaLbOffers .offer.premium")},chkMicroMeta:function(){if(d){return}i("#micro_meta_ajax .provider")},chkHotels:function(){if(d){return}i("#PAGE .metaPriceInfo .header")},chkMapDetailCard:function(){if(d){return}i(".mapsv2-detail-info .mapsv2-chevron")},chkMapListCard:function(){if(d){return}i(".mapsv2-listcard .mapsv2-listitem .mapsv2-dropdownfirstitem")},chkSmartDeals:function(){if(d){return}i("#AVAILABLEHOTELDEALS .lpContainer .offer")},chkHR:function(){if(d){return}i("#CHECK_RATES_CONT .offer.premium:not(.remaining):not(.noLink)")},setProviderName:function(l){j=l},setTrackingPixel:function(l){g=l},setVendorName:function(l){c=l},registerEvents:function(){if(!j||!c||!g){return}k()}}}(document,window,ta));(function(a){a.util||(a.util={});a.util.typeOf=function(b){return Object.prototype.toString.call(b).match(/(\w+)\]$/)[1].toLowerCase()};a.util.merge=function(g){for(var c=1;c<arguments.length;c++){var e=arguments[c];if(!e){continue}g||(g=(a.util.typeOf(e)==="array")?[]:{});for(var b in e){var f=e[b];if(e.hasOwnProperty(b)&&a.util.typeOf(f)!=="undefined"){var d=a.util.typeOf(f);if(d==="string"||d==="number"||d==="boolean"||d==="function"||f===null){g[b]=f;continue}g[b]=a.util.merge(g[b],f)}}}return g}}(ta));(function(a,b){var c=function(e){var d=false;new Request({url:"/AuthCheck",data:{product:e},async:false,method:"get",onSuccess:function(f){if("true"===f.trim()){d=true}}}).send();return d};b.isAuthorized=function(d){return c(d)};b.register=function(f,e){if(f.popup){return a.registration.popup.open(f,e)}var g={servlet:"Register",action:"SIGNIN",data:function(){return{}}};var d=a.retrieve("ta.registration.currentUrlDefaults");f=a.util.merge(g,d,f||{},e||{});if(!f.product){return false}if(c(f.product)){return true}if(f.successAction){a.registration.setSuccessActionCookie(f.successAction)}a.util.post({url:"/"+f.servlet,https:true,data:{product:f.product,action:f.action,url:f.url,urlKey:f.urlKey,partnerKey:f.partnerKey,data:JSON.encode(f.data())}});return false};b.popup={defaultWidth:547,defaultHeight:435,options:null,urloptions:null,isPopup:null,open:function(o,p){a.registration.popup.options=o;a.registration.popup.urloptions=p;var i={servlet:"Register",action:"SIGNIN",data:function(){return{}}};var f=a.retrieve("ta.registration.currentUrlDefaults");o=a.util.merge(i,f,o||{},p||{});if(!o.product){return false}if(c(o.product)){return true}var l=document.location;var k=l.protocol+"//"+l.host;if(l.port){k+=":"+l.port}var e=k.replace("http://","https://")+"/"+o.servlet;var m=[];m.push("popup=true");m.push("product="+o.product);m.push("action="+o.action);m.push("url="+o.url);m.push("urlKey="+o.urlKey);m.push("partnerKey="+o.partnerKey);m.push("data="+JSON.encode(o.data()));e=e+"?"+m.join("&");var g=a.registration.popup.defaultWidth;var n=a.registration.popup.defaultHeight;var h=(screen.width-g)/2;var j=(screen.height-n)/2;var d=window.open(e.toString(),"registration","width="+g+", height="+n+", top="+j+", left="+h+", resizable=yes, scrollbars=yes");if(!d&&!isTabletOnFullSite){a.registration.popup.fallback()}return false},init:function(){if(a.registration.popup.isPopup==null){a.registration.popup.isPopup=isTabletOnFullSite||(window.opener&&window.getSize().x<(a.registration.popup.defaultWidth+150))}if(a.registration.popup.isPopup){var f=a.id("REG_CON");if(f){var e=f.getElement("div.regDlg");if(!e){e=f.getElement("div.whyDlg")}if(e){a.registration.popup.resize(e)}}var d=a.id("SS_SSO");if(d){var g=d.getElement("input[type=button]");if(g){g.addEvent("click",function(){a.registration.popup.resizeTo(980,560,true)})}}}else{window.location="/RegisterDone?fallback=true"}},done:function(e,g){if(window.opener){var f=window.opener;if(f.ta){if(g){a.registration.popup.fallback(true)}else{var d;if(f.ta.registration&&f.ta.registration.popup.options){d=f.ta.registration.popup.options.successAction}if(d){f.ta.registration.runSuccessAction(d)}else{if(e){f.location=e}}a.registration.popup.updateMasthead(a.registration.popup.close)}}else{a.registration.popup.close()}}else{if(e){a.registration.returnTo(e)}}},close:function(){if(window.opener&&window.opener!=window){window.opener=window;window.close()}},updateMasthead:function(i){var f=0;var h=setInterval(function(){f++;var j=a.id("avatarImage");if(h>20||!j||j.get("src")){clearInterval(h);try{if(window.opener&&window.opener.ta){e();g()}}catch(k){a.util.error.record(k,"secure popup - unable to update masthead",null,{},"WARN")}if(i){i()}}},250);var d=function(k){if(k&&window.opener){var j=new Element("div").adopt(k).innerHTML;if(j){k=window.opener.Elements.from(j)}}return k};var e=function(){var k=window.opener.document.getElement("head");var j=a.id("IP_HEADER_CSS");if(k&&j){j=d(j);if(j){k.adopt(j)}}};var g=function(){var j=a.id("USER_PREFS");var k=window.opener.ta.id("USER_PREFS");if(j&&k){j=d(j);if(j){j.replaces(k)}}}},fallback:function(e){var f=window;if(e&&window.opener){f=window.opener}f.focus();if(f.ta&&f.ta.registration){var d=f.ta.registration.popup;if(d.options){d.options.popup=false;f.ta.registration.register(d.options,d.urloptions)}}if(e){a.registration.popup.close()}},resize:function(f){if(f){a.registration.popup.disableScrollBars();var e=f.getScrollSize().x;var d=f.getScrollSize().y;window.onresize=function(){window.onresize=null;var h=e-window.getSize().x+1;var g=d-window.getSize().y+1;if(h!=0||g!=0){window.onresize=function(){window.onresize=null;a.registration.popup.center(e+h,d+g);a.registration.popup.enableScrollBars()};a.registration.popup.resizeBy(h,g)}else{a.registration.popup.enableScrollBars();a.registration.popup.center()}};a.registration.popup.resizeTo(e,d)}},resizeTo:function(f,e,d){if(d){window.onresize=function(){window.onresize=null;a.registration.popup.center()}}window.resizeTo(f,e)},resizeBy:function(f,e,d){if(d){window.onresize=function(){window.onresize=null;a.registration.popup.center()}}window.resizeBy(f,e)},center:function(g,d){if(!g){g=window.getSize().x}if(!d){window.getSize().y}var f=(screen.width-g)/2;var e=(screen.height-d)/2;window.moveTo(f,e);window.focus()},disableScrollBars:function(){window.document.getElement("body").setStyle("overflow","hidden")},enableScrollBars:function(){window.document.getElement("body").setStyle("overflow")}};(function(e,g){var j="1070328450902.apps.googleusercontent.com";var d={cookiepolicy:"single_host_origin",requestvisibleactions:"http://schemas.google.com/AddActivity",clientid:j,client_id:j,immediate:false,apppackagename:"com.tripadvisor.tripadvisor"};var f=0;function i(){e.store("registration.google.avail",true);var k=e.remove("registration.google.onAvail");k&&k.each(function(l){l()})}function h(){if(typeof d.scope==="undefined"){var k=["https://www.googleapis.com/auth/plus.login","https://www.googleapis.com/auth/userinfo.email"];if(e.retrieve("google_wallet_permission_desktop_signin.enabled")){k.push("https://www.googleapis.com/auth/payments.make_payments")}d.scope=k.join(" ")}return d}g.google={init:function(k){if(k){g.google.onAvail(k)}new Asset.javascript("https://plus.google.com/js/client:plusone.js",{onLoad:function(){if(gapi&&gapi.auth){gapi.auth.init(i)}else{var l=setInterval(function(){if(gapi&&gapi.auth){clearInterval(l);gapi.auth.init(i)}},100)}}})},onAvail:function(k){if(e.retrieve("registration.google.avail")){k()}else{e.keep("registration.google.onAvail",k)}},connect:function(l,k,n){k=k||"MASTHEAD";var m={flow:k};if(0===k.indexOf("EMAIL_ONLY_SIGNUP")){Object.merge(m,{isOverlay:false});if(typeof n==="function"){Object.merge(m,{responseCallback:n})}}if(l){f=l}if(typeof gapi=="undefined"){e.registration.google.init(e.registration.google.connect)}else{if(!e.has("google.sso.sending")){e.store("google.sso.sending",true);gapi.auth.signIn(Object.merge({callback:function(p){if(p&&p.status&&p.status.signed_in&&p.access_token){if(!e.has("google.sso.receiving")){e.remove("google.sso.sending");e.store("google.sso.receiving",true);var o="/GoogleRegistration?google_token="+p.access_token+"&pid="+f;new Request.JSON({url:o,method:"get",onSuccess:function(q){e.remove("google.sso.receiving");if(q.success){if(q.created){e.overlays.registration.connect(m,"GOOGLE_SIGNUP")}else{if(q.connected){e.overlays.registration.request("GOOGLE_THANKS",{google_token:p.access_token},m)}else{e.overlays.registration.cancel(m)}}}},onError:function(){e.remove("google.sso.receiving")},onFailure:function(){e.remove("google.sso.receiving")}}).send()}}}},h()))}}},ifConnected:function(l,k){if(gapi&&gapi.auth){gapi.auth.authorize({client_id:j,immediate:true,scope:h().scope.split(" ")},function(n){if(n&&n.status&&n.status.signed_in){var m="/GoogleRegistration?google_token="+n.access_token+"&verify=true";var o=e.retrieve("google.sso.returnTo");if(o){m+="&returnTo="+o}new Request.JSON({url:m,method:"get",onSuccess:function(p){if(p.success&&l){l()}else{if(k){k()}}},onFailure:k}).send()}else{if(k){k()}}})}else{k()}},ifLoggedIn:function(m,k){if(typeof gapi!="undefined"&&gapi.auth){var l={client_id:j,session_state:null};gapi.auth.checkSessionState(l,function(n){if(n===false){m()}else{if(k){k()}}})}},disconnect:function(){if(typeof gapi=="undefined"){e.registration.google.init(e.registration.google.disconnect)}else{gapi.auth.authorize(h(),function(k){if(k&&k.access_token){new Request.JSONP({url:"https://accounts.google.com/o/oauth2/revoke?token="+k.access_token,method:"get",onSuccess:function(){e.overlays.registration.post({action:"GOOGLE_DISCONNECT"})}}).send()}})}}}})(a,b);(function(f,h){var e=4194307;var i=656;var g=382;var d=null;h.vkontakte={connect:function(k,p,l){if(k){new Request({url:"/ActionRecord?action=vkAuthAttempt&pid="+k}).send()}if(f.retrieve("vk.sso.clicked")&&d&&d.window){d.window.close();f.store("vk.sso.clicked",false)}if(!f.retrieve("vk.sso.clicked")){f.store("vk.sso.clicked",true);var o=(screen.height-g)/2;var j=(screen.width-i)/2;var n="https://oauth.vk.com/authorize?client_id="+l+"&scope="+e+"&redirect_uri=https%3A%2F%2F"+location.hostname+"%2FVKRegistration";if(p){n+="Masthead"}d=window.open(n,"registration","width="+i+", height="+g+", top="+o+", left="+j+", resizable=yes, scrollbars=yes");if(!d){f.store("vk.sso.clicked",false);new Request({url:"/Actionrecord?action=vkAuthPopupBlocked&pid=39094"}).send();if(!p){this.showSSOError(f.retrieve("popupBlockerSSOError"))}}else{var m=setInterval(function(){if(d.closed){clearInterval(m);if(p){document.window.location.reload()}f.store("vk.sso.clicked",false)}},500)}}},registrationSuccess:function(){f.overlays.registration.connect({flow:"MASTHEAD"},"VK_SIGNUP")},loginSuccess:function(){f.overlays.registration.request("SIGNIN")},showSSOError:function(j){f.store("vk.sso.clicked",false);var k=f.id("ssoErrorMessage");if(k){k.removeClass("hidden");k.set("html",j)}},done:function(k,j){try{if(window.opener.ta&&window.opener.ta.retrieve("vk.sso.clicked")){this.performPostAuthAction(k,j)}}catch(l){window.close()}window.close()},doneMasthead:function(){window.close()},performPostAuthAction:function(j,k){var l=window.opener;l.ta.store("vk.sso.clicked",false);if(j){if(l.ta.registration.vkontakte){if(j==="vkLogin"){l.ta.registration.vkontakte.loginSuccess()}else{if(j==="vkSignup"){l.ta.registration.vkontakte.registrationSuccess()}else{if(j==="error"){if(k){l.ta.registration.vkontakte.showSSOError(k)}}}}}}},disconnect:function(){f.overlays.registration.post({action:"VK_DISCONNECT"})}}})(a,b);b.done=function(d,e){if(window.opener){a.registration.popup.done(d,e)}else{a.registration.returnTo(d)}};b.returnTo=function(d){if(window.opener){window.opener.location=d;a.registration.popup.close()}else{window.location=d}};b.runSuccessAction=function(f,h){var i=f.split("|");try{var d=i.slice(1);d.unshift({});d.unshift(i[0]);if(h){d.push(h)}a.run.apply(null,d)}catch(g){a.util.error.record(g,"successAction",null,{funcName:i[0]})}};b.runSuccessActionCookie=function(){var d=a.registration.getSuccessActionCookie();if(d){a.registration.runSuccessAction(d,true)}};b.setSuccessActionCookie=function(d){Cookie.write("successAction",window.pageServlet+"|"+d,{domain:cookieDomain,path:"/"})};b.getSuccessActionCookie=function(){if(window==window.top){var f=Cookie.read("successAction");if(f){var d=f.split("|");var e=d[0];d=d.slice(1);if(window.pageServlet==e){Cookie.dispose("successAction",{domain:cookieDomain,path:"/"});return d.join("|")}}}return};a.queueForLoad(function(){a.registration.runSuccessActionCookie()})}(ta,ta.registration));(function(a){a.util||(a.util={});a.util.post=function(c){if(!c||!c.url||!c.data){return false}c.url=a.util.URL.getAbsoluteUrl(c.url);if(!!c.https){if(c.url.indexOf("http:")===0){c.url=c.url.substring(4,c.url.length);c.url="https"+c.url}}var e=document.createElement("form");e.setAttribute("method","post");e.setAttribute("action",c.url);if(c.url&&c.url.indexOf("https")===0){a.store("httpsDestination",true)}for(var d in c.data){if(c.data.hasOwnProperty(d)){var b=document.createElement("input");b.setAttribute("type","hidden");b.setAttribute("name",d);b.setAttribute("value",c.data[d]);e.appendChild(b)}}document.body.appendChild(e);e.submit()}}(ta));ta.util.keys={onEnterKey:function(d,b,c){var a;if(window.event){a=window.event.keyCode}else{if(d){a=d.which}}if(a==13){if(typeof(b)==="function"){b()}return false}else{if(typeof(c)==="function"){c()}return true}},onEnterKeyClickSibling:function(b,a){return ta.util.keys.onEnterKey(b,function(){var c=b.target&&ta.id(b.target);if(c){var d=c.getSiblings(a);if(d&&d.length){d[0].click()}}})}};(function(a){var b,c;a.servlet=a.servlet||{};b=function(e,f,d){new Request({method:"POST",url:a.util.URL.https("/Registration"),onSuccess:f,onFailure:d,data:e,withCredentials:a.retrieve("access_control_headers")}).send()};c=function(d){if(!d||"object"!==typeof d){a.util.error.record(null,"Options object is invalid.");return false}if(!d.hasOwnProperty("flow")||!d.flow){a.util.error.record(null,"Options object missing required flow field.");return false}if(!d.hasOwnProperty("action")||!d.action){a.util.error.record(null,"Options object missing required action field.");return false}if(!d.hasOwnProperty("pid")||!d.pid){a.util.error.record(null,"Options object missing required pid field.");return false}if(!d.hasOwnProperty("token")||!d.token){a.util.error.record(null,"Options object missing required token field.");return false}if(!d.hasOwnProperty("category")||!d.category){a.util.error.record(null,"Options object missing required category field.");return false}return true};a.servlet.OverlayRegistration={submitEmailOnlySignup:function(d,p,t){var h,n,s,q,g,o,l,j,k,i,r,f,m;m=d||window.event;if(m){new Event(m).preventDefault()}if(!p){a.util.error.record(null,"Invalid form element.");return}if(!c(t)){return}h=p.getElement(".emailAddr");n=p.getElement(".g-recaptcha-response");s=p.getElement(".emailOptIn input");q=p.getElement(".submitBtn");g=p.getElement(".signupError");o=h?h.value:"";l=n?n.value:"";j=s&&s.checked;if(q){q.set("disabled","disabled")}else{a.util.error.record(null,"Form missing submit element.");return}if(!g){a.util.error.record(null,"Form missing error element.");return}i=(t.additional&&("object"===typeof t.additional))?t.additional:{};k=Object.merge(i,{flow:t.flow,action:t.action,pid:t.pid,category:t.category,token:t.token,email:o,"g-recaptcha-response":l,opt_in:j});r=function(u){var x;try{x=JSON.decode(u);if(x.error){g.setContent(x.error).show();var v={height:document.body.getScrollHeight()};a.servlet.OverlayRegistration.resizeFrame(v);q.set("disabled","");return}else{g.setContent("").hide()}a.trackEventOnPage(t.category,x.isLogin?"signup_success_logged_in":"signup_success","",t.pid,false);if(!t.keepOverlay){a.servlet.OverlayRegistration.closeOverlayRegistration()}if(t.hasOwnProperty("onSuccess")&&"function"===typeof t.onSuccess){t.onSuccess(x)}}catch(w){a.util.error.record(w,"Ajax request handling error");q.set("disabled","");if(t.hasOwnProperty("onFailure")&&"function"===typeof t.onFailure){t.onFailure()}}};f=function(e){a.util.error.record(null,"Ajax signup request failure: "+e.status);q.set("disabled","");if(t.hasOwnProperty("onFailure")&&"function"===typeof t.onFailure){t.onFailure(e)}};b(k,r,f)},closeOverlayRegistration:function(){var d,e;d=window.parent;if(d){e='{ "action": "successClose" }';d.postMessage(e,"*")}},fwdToRegistration:function(g){var e,i,d,j,h,f;a.trackEventOnPage(g.category,"already_member","",g.pid,false);e=window.parent;if(e){setTimeout(function(){d=(g.additional&&("object"===typeof g.additional))?g.additional:{};j=d.hasOwnProperty("curUrl")?d.curUrl:"";h=d.hasOwnProperty("partnerKey")?d.partnerKey:"";f=d.hasOwnProperty("urlKey")?d.urlKey:"";i='{ "action": "fwdToRegistration", "curUrl": "'+d.curUrl+'", "partnerKey": "'+d.partnerKey+'", "urlKey": "'+d.urlKey+'" }';e.postMessage(i,"*")},100)}},resizeFrame:function(f){if(!f||"object"!==typeof f){return}var d=f.hasOwnProperty("height")?f.height:null;if(+d!==parseInt(d)){d=340}var e=window.parent;if(e&&d){var g='{ "action": "resizeFrame", "height": "'+d+'" }';e.postMessage(g,"*")}},renderThanks:function(e){var d={source:"OverlayRegistration",flow:e,action:"GET_OVERLAY_REGISTRATION_THANKS"};window.location="https://"+window.location.hostname+"/Registration?"+Object.toQueryString(d)},cancelRegistration:function(h,f){var j,i,d,g;j=h||window.event;if(j){new Event(j).preventDefault()}if(!c(f)){return}i={flow:f.flow,action:f.action,pid:f.pid,category:f.category,token:f.token};d=function(k){var m;try{m=JSON.decode(k);a.trackEventOnPage(f.category,"signup_cancel",f.pid,0,false);if(f.hasOwnProperty("onSuccess")&&"function"===typeof f.onSuccess){f.onSuccess(m)}}catch(l){a.util.error.record(l,"Ajax request handling error");if(f.hasOwnProperty("onFailure")&&"function"===typeof f.onFailure){f.onFailure(m)}}};g=function(e){a.util.error.record(null,"Ajax cancel request failure: "+e.status);if(f.hasOwnProperty("onFailure")&&"function"===typeof f.onFailure){f.onFailure(e)}};b(i,d,g)}}}(ta));if("undefined"===typeof userLoggedIn){var userLoggedIn=false};ta.common.flyout.memberOverlay=ta.overlays.Factory.memberOverlay;ta.common.flyout.intlPopup=ta.overlays.Factory.intlPopup;ta.common.flyout.showRecentLocationEmailOverlay=ta.overlays.Factory.showRecentLocationEmailOverlay;ta.common.flyout.clearRecentLocations=ta.overlays.Factory.clearRecentLocations;ta.common.sendmessage.showSendMessage=ta.overlays.Factory.showSendMessage;ta.servlet.Hotel.showRoomTipsOverlay=ta.overlays.Factory.showRoomTipsOverlay;ta.servlet.Hotel.showReviewSummary=ta.overlays.Factory.showReviewSummary;ta.servlet.Hotel.showTranslationReviewSummary=ta.overlays.Factory.showTranslationReviewSummary;tamgShowLightbox=ta.overlays.Factory.tamgShowLightbox;ta.util.taLnk={mouseover:function(b){$(b).addClass("underline")},mouseout:function(b){$(b).removeClass("underline")},redirect:function(a){window.location.href=a}};var StringBuffer=new Class({initialize:function(a){this.strings=new Array();if(a){this.append(a)}},append:function(a){this.strings.push(a);return this},toString:function(){return this.strings.join("")},isEmpty:function(){return this.strings.length==0}});var Table=new Class({Implements:[Options],options:{properties:{cellpadding:0,cellspacing:0,border:0},rows:[]},initialize:function(a){this.setOptions(a);this.table=new Element("table").setProperties(this.options.properties);this.tbody=new Element("tbody").inject(this.table);this.options.rows.each(this.push.bind(this))},push:function(d,c,a){var b=new Element("tr").inject(c||this.tbody);d.each(function(e){var f=new Element(a?"th":"td").inject(b);if(e.properties){f.setProperties(e.properties)}if(e.content){f.setContent(e.content)}else{f.setContent(e)}});return this},pushHead:function(a){if(!this.thead){this.thead=new Element("thead").inject(this.table,"top")}this.push(a,this.thead,true);return this},pushFoot:function(a){if(!this.tfoot){this.tfoot=new Element("tfoot").inject(this.table)}this.push(a,this.tfoot);return this},pushCaption:function(a){new Element("caption").setContent(a).inject(this.table,"top");return this}});var TabSet=new Class({Implements:[Options,Events],options:{onActive:function(){},onBackground:function(){},show:0,collapsable:false},initialize:function(){var a,b,c;Array.each(arguments,function(f,e){switch(typeOf(f)){case"object":a=f;break;default:var d=$$(f);if(!b){b=d}else{c=d}}});this.togglers=b||[];this.elements=c||[];this.setOptions(a);this.elements.each(function(e,d){this.togglers[d].addEvent("click",this.display.bind(this).partial(Function._,d));if(this.options.show===d){e.show();this.previous=d;this.fireEvent("onActive",[null,this.togglers[d],e])}else{e.hide()}},this)},display:function(b,a){if(this.options.collapsable&&a==this.previous){if(this.elements[a].isHidden()){this.fireEvent("onActive",[b,this.togglers[a],this.elements[a]]);this.elements[a].show()}else{this.fireEvent("onBackground",[b,this.togglers[a],this.elements[a]]);this.elements[a].hide()}return this}if(this.previous||this.previous===0){this.elements[this.previous].hide();this.fireEvent("onBackground",[b,this.togglers[this.previous],this.elements[this.previous]])}this.previous=a;this.elements[a].show();this.fireEvent("onActive",[b,this.togglers[a],this.elements[a]]);return this}});var ToggleSet=new Class({initialize:function(b,c,a){this.index=a||0;this.togglers=b||[];this.elements=c||[];this.togglers.each(function(e,d){this.togglers[d].addEvent("click",this.display.bind(this,d));this.elements[d].hide()},this)},add:function(c,b){var a=this.togglers.length;this.togglers.push(c);this.elements.push(b);c.addEvent("click",this.display.bind(this,a));b.hide()},expand:function(a){this.togglers[a].addClass("open");this.elements[a].show();return this},collapse:function(a){this.elements[a].hide();this.togglers[a].removeClass("open");return this},display:function(a){if(this.previous==a){if(this.elements[a].isHidden()){this.expand(a)}else{this.collapse(a)}}else{if(this.previous||this.previous===0){this.collapse(this.previous)}this.previous=a;this.expand(a)}return this}});var Slider=new Class({Implements:[Options,Events],Binds:["clickedElement","draggedKnob"],options:{onChange:function(){},onComplete:function(){},onTick:function(a){this.knob.setStyle(this.p,a)},mode:"horizontal",steps:100,offset:0},initialize:function(d,a,b){this.element=$(d);this.knob=$(a);this.setOptions(b);this.previousChange=-1;this.previousEnd=-1;this.step=-1;this.element.addEvent("mousedown",this.clickedElement);var c,f;switch(this.options.mode){case"horizontal":this.z="x";this.p="left";c={x:"left",y:false};f="offsetWidth";break;case"vertical":this.z="y";this.p="top";c={x:false,y:"top"};f="offsetHeight"}this.max=this.element[f]-this.knob[f]+(this.options.offset*2);this.half=this.knob[f]/2;this.getPos=this.element["get"+this.p.capitalize()].bind(this.element);this.knob.setStyle("position","relative").setStyle(this.p,-this.options.offset);var e={};e[this.z]=[-this.options.offset,this.max-this.options.offset];this.drag=new Drag(this.knob,{limit:e,modifiers:c,snap:0,onStart:this.draggedKnob(),onDrag:this.draggedKnob(),onComplete:function(){this.draggedKnob();this.end()}.bind(this)});if(this.options.initialize){this.options.initialize.call(this)}},set:function(a){this.step=a.limit(0,this.options.steps);this.checkStep();this.end();this.fireEvent("onTick",this.toPosition(this.step));return this},setDefault:function(a){if(a>this.options.steps){a=this.options.steps}else{if(a<0){a=0}}this.step=a;this.end();this.knob.setStyle(this.p,this.toPosition(this.step)+"px");return this},scrolledElement:function(a){if(a.wheel<0){this.set(this.step+1)}else{if(a.wheel>0){this.set(this.step-1)}}a.stop()},clickedElement:function(b){var a=b.page[this.z]-this.getPos()-this.half;a=a.limit(-this.options.offset,this.max-this.options.offset);this.step=this.toStep(a);this.checkStep();this.end();this.set(this.step)},draggedKnob:function(){if(!this.drag){return}this.step=this.toStep(this.drag.value.now[this.z]);this.checkStep();this.setDefault(this.step)},checkStep:function(){if(this.previousChange!=this.step){this.previousChange=this.step;this.fireEvent("onChange",this.step)}},end:function(){if(this.previousEnd!==this.step){this.previousEnd=this.step;this.fireEvent("onComplete",this.step+"")}},toStep:function(a){return Math.round((a+this.options.offset)/this.max*this.options.steps)},toPosition:function(a){return this.max*a/this.options.steps}});var rules={};var rulesN={};var ajaxRules={};var Behavior=new Class({register:function(b){this.rules=b;for(var a in this.rules){this.reload(a)}for(var c in rulesN){this.reloadN(c)}return this},reload:function(c){var a=$$(c);for(var d=0;d<a.length;d++){try{this.rules[c](a[d])}catch(b){ta.util.error.record(b,"rules",null,{element:ta.util.error.getSelectorString(a[d]),ruleCount:d})}}return a.length},reloadN:function(b){var a=0;while(n=ta.id(b+(a++))){rulesN[b](n)}return a-1},apply:function(a){processLinks(a);for(var b in this.rules){window.applyLastRule=b;a.getElements(b).each(function(c){this.rules[b](c)},this)}for(var b in ajaxRules){window.applyLastRule=b;a.getElements(b).each(function(c){ajaxRules[b](c)},this)}}});window.behavior=new Behavior();TAReadyEvent=window.TAReadyEvent||"domready";if(Browser.ie&&(typeof semHotelBoxFocus!="undefined")&&semHotelBoxFocus){ta.queueForLoad(behaviorFunction,"Behavior")}else{window.addEvent(TAReadyEvent,behaviorFunction)}var bfCount=0;function behaviorFunction(){if(typeof performancePingbackInit!="undefined"){performancePingbackInit.behaviorStart=new Date().getTime()}if(Browser.ie&&(!$("FOOT")||!$("FOOT").readyState||$("FOOT").readyState!="complete")&&bfCount<10){bfCount++;behaviorFunction.delay(30);return}if(window.hideOnLoad){Array.from(hideOnLoad).each(function(c){var b=$(c);if(b){b.hide()}})}if(!Browser.ie6){searchFocus()}processLinks(document);behavior.register(rules);var a=$("MAIN");if((window.location.hash=="#Calculator")&&($("HOMEPAGE")||(a&&a.hasClass("VacationRentals"))||$("HOTEL_LANDER"))){showDHTMLOverlayOnLoad=function(){};if(typeof vrCalculator!="undefined"){vrCalculator()}}if(typeof performancePingbackInit!="undefined"){performancePingbackInit.behaviorEnd=new Date().getTime()}}function searchFocus(){var a=ta.id("mainSearch");if(a&&a.className.match(/\b(focusOnLoad)\b/)){try{a.focus()}catch(b){}}}rulesN.EOBF=function(a){var b=a.innerHTML+"@tripadvisor"+a.title;new Element("a",{href:"mailto:"+b}).setContent(b).replaces(a)};var linkMap={};var popupIndex=0;function popup(r,t,o,l,h,g,b,d,c,q){try{new Event(r).preventDefault();var a="",k=this.className.match(/sz(\d+)x(\d+)/),j=ta.id(document.body),i,s,f;if(k){o=k[1];l=k[2]}if(this.href.indexOf("p=HotelsCom")>-1){o=Math.max(o,960);l=Math.max(l,window.getHeight(),600)}if(o){a+=",width="+o}if(l){a+=",height="+l}if(h){a+=",screenX="+h+",left="+h}if(g){a+=",screenY="+g+",top="+g}if(a!==""){if(c){a="toolbar=1,resizable=1,menubar=1,location=1,status=1,scrollbars=1"+a}else{a="toolbar=0,resizable=1,menubar=0,location=0,status=0,scrollbars="+(b?0:1)+a}}if(!d){d=this.href}s=t||("p"+(popupIndex++));if(q&&Browser.ie){f=new Element("a",{target:s,href:d});f.inject(j,"bottom");i=window.open("",s,a);f.click();f.destroy()}else{i=window.open(d,s,a)}if(i!==null){try{i.opener=self}catch(m){}i.focus()}}catch(p){ta.util.error.record(p,"behavior popup",r);throw p}}linkMap.js_popup=function(a,b){popup.attempt(b,a)};linkMap.js_popComm=function(a,b){popup.attempt([b,null,950,610,null,null,null,null,true],a)};linkMap.js_popMap=function(a,b){Cookie.write("mapPopup","1",{domain:cookieDomain});popup.attempt([b,"map",820,960],a)};linkMap.js_popNoScroll=function(a,b){popup.attempt([b,null,null,null,null,null,true],a)};linkMap.js_popCR=function(a,b){popup.attempt([b,"cr",245,610,5,5],a)};linkMap.js_email=function(a,b){popup.attempt([b,"email",580,460,30,25],a)};linkMap.js_popReview=function(a,b){popup.attempt([b,"review",550,395,30,25],a)};linkMap.js_popPhoto=function(a,b){popup.attempt([b,"photo",650,350],a)};linkMap.js_popGallery=function(a,b){Cookie.write("PhotoPop","1",{domain:cookieDomain});popup.attempt([b,"media",782,820],a)};linkMap.js_popGalleryComm=function(a,b){Cookie.write("PhotoPop","1",{domain:cookieDomain});popup.attempt([b,"media",780,950],a)};linkMap.js_popDMO=function(a,b){popup.attempt([b,"dmo",400,400],a)};linkMap.js_popNxTall=function(a,b){popup.attempt([b,330,680],a)};linkMap.js_popNxWide=function(a,b){popup.attempt([b,730,380],a)};linkMap.js_popNxLogin=function(a,b){popup.attempt([b,"login",795,645],a)};linkMap.js_popFraud=function(a,b){popup.attempt([b,"fraud",640,460],a)};linkMap.js_popDestGd=function(a,b){popup.attempt([b,"dest_guide",565,700,(screen.width-700)/2,(screen.height-600)/2],a)};linkMap.js_popSmall=function(a,b){if(screen.width>1024){popup.attempt([b,null,800,600,240,5,false,false,true],a)}else{if(screen.width>800){popup.attempt([b,null,620,500,240,5,false,false,true],a)}else{popup.attempt([b,null,475,390,210,5,false,false,true],a)}}return a};linkMap.js_popProfPhoto=function(a,b){if(screen.width>1024){popup.attempt([b,null,800,500,240,5,false,false,true],a)}else{if(screen.width>800){popup.attempt([b,null,620,450,240,5,false,false,true],a)}else{popup.attempt([b,null,475,390,210,5,false,false,true],a)}}return a};linkMap.js_popPartner=function(a,b){if(screen.width>1024){popup.attempt([b,null,980,500,240,5,false,false,true],a)}else{if(screen.width>800){popup.attempt([b,null,800,500,240,5,false,false,true],a)}else{popup.attempt([b,null,620,450,210,5,false,false,true],a)}}return a};linkMap.js_noTAPD=function(a,b){Cookie.dispose("TAPD",{domain:cookieDomain})};rules["a#TERMS"]=function(a){a.addEvent("click",popup.bind(a).partial(Function._,"terms",300,300,30,25))};linkMap.js_ajaxSubmit=function(a,f){if(!a.className.match(/\bform_(\w+)\b/)){return}var d=$(RegExp.$1);var c={url:a.href,data:d,onFailure:function(e){if(d){d.removeClass("ajaxInFlight")}ta.util.error.ajaxFailure("behavior:js_ajaxSubmit",e)}};var g=window["callback"+d.id];if(a.className.match(/method_(\w+)\b/)){c.method=RegExp["$1"]}if(a.className.match(/\btgt_(\w+)\b/)){c.update=RegExp["$1"]}else{c.onSuccess=function(e){if(d){d.removeClass("ajaxInFlight")}ta.overlays.showInLightbox(e);if(g&&typeOf(g)=="function"){g()}}}new Event(f).preventDefault();var b=window["validate"+d.id];if(b&&typeOf(b)=="function"&&b.apply(d)==false){return}d.addClass("ajaxInFlight");if(a.className.match(/\bevalScripts\b/)){c.evalScripts=true}(c.update?new Request.HTML(c):new Request(c)).send()};linkMap.js_ajax=function(a,b){new Event(b).preventDefault();if(!(tgt=a.className.match(/\btgt_(\w+)\b/))){return}tgt=$(tgt[1]);new Request.HTML({url:a.href,update:tgt,onFailure:ta.util.error.ajaxFailure.partial("behavior:js_ajax")}).send()};linkMap.js_ajaxlogin=function(b,c){new Event(c).preventDefault();if(!(tgt=b.className.match(/\btgt_(\w+)\b/))){return}var a=b.href;tgt=$(tgt[1]);new Request({url:b.href,onSuccess:function(d,f){var e=(d.indexOf("<!--nologin-->")<0);if(!e){login(["tt","ajax","returnTo",a+"&rd=1","greeting","showuserreviews_vote_25ee"])}else{tgt.innerHTML=d}},onFailure:ta.util.error.ajaxFailure.partial("behavior:js_ajaxLogin")}).send()};linkMap.js_ajaxReport=function(a,b){ajaxReport.attempt(b,a)};var ajaxReport=function(a){new Event(a).preventDefault();ta.overlays.loadInLightbox(this.href)};function toggle(a){new Event(a).preventDefault();this.toggleClass("off")}var toggleMeRule=function(a){if(false==a.hasClass("defaultOpen")){a.addClass("off")}a.getElements(".show").addEvent("click",toggle.bind(a));a.getElements(".hide").addEvent("click",toggle.bind(a))};rules["#TOGGLEME"]=toggleMeRule;rules["#TOGGLEME2"]=toggleMeRule;ajaxRules["div.js_swapBlocks"]=function(b){var a=b.getElement(".js_swapOut");var c=b.getElement(".js_swapIn");var d=b.getElement("a.js_swapTrigger");var e=b.getElement("a.js_swapBackTrigger");if(a&&c&&d){d.addEvent("click",function(f){new Event(f).preventDefault();window.removedBit=a.dispose();c.show()});d.removeClass("js_swapTrigger")}if(a&&c&&e){e.addEvent("click",function(f){new Event(f).preventDefault();c.hide();$("parentOfSwapOut").appendChild(window.removedBit)});e.removeClass("js_swapBackTrigger")}};ajaxRules["#PM_UNBLOCK"]=function(a){a.addEvent("submit",function(c){new Event(c).stop();var b=$("PM_UNBLOCK");if(b.unblock.value=="1"){new Request({url:"/SendMessageRD",data:b,onSuccess:ta.overlays.showInLightbox,onFailure:ta.util.error.ajaxFailure.partial("behavior:#PM_UNBLOCK")}).request()}else{$("unblock-intercept").hide();$("blockedreply").show();b.unblock.value="1"}})};function enableCommunity(c,a){var b=c;if(!a){b=function(d){enableCommunityResponse(d,c)}}if(typeof(JS_SECURITY_TOKEN)=="undefined"){JS_SECURITY_TOKEN=""}new Request({url:"/MemberSubscriptionsController",data:{Action:"ChangeM2M",set:"on",token:JS_SECURITY_TOKEN},onSuccess:b,onFailure:ta.util.error.ajaxFailure.partial("behavior:enableCommunity")}).send()}function enableCommunityResponse(res,callback){var isf=document.getElementById("inviteStatusField");if(txt.match(/^{/)){var data=eval("("+txt+")");if(data.ERROR){isf.innerHTML=data.ERROR;isf.style.display="block"}}else{isf.innerHTML=JS_community_on;isf.style.display="block"}}function getRelativeURL(){return window.location.pathname+window.location.search+window.location.hash}var follow=function(a){return function(){window.location=$(a).href}};function showToggleBlock(a){$$(".js_toggleBlocks .js_toggleBlock").each(function(c,b){c.hide();if(c.hasClass(a)){c.show()}})}linkMap.js_toggleBlockTrigger=function(b,c){var a=b.getProperty("class");a.replace(/toggleBlock[0-9]+/g,function(d){a=d});showToggleBlock(a)};rules["#SWAPBLOCK .js_toggleBlock"]=function(b){if(b.hasClass("js_toggleBlockSelected")){var a=b.getProperty("class");a.replace(/toggleBlock[0-9]+/g,function(c){a=c});showToggleBlock(a)}};var showLastSavesRD=function(){var a=$("LAST_SAVES_PLACEHOLDER");if(typeof savesIncluded!="undefined"){if(!a){return renderLastSaves(SAVES_RECENT_SAVES)}else{a.innerHTML=renderLastSaves(SAVES_RECENT_SAVES);flyout.positionCorners()}}else{if(!a){new Asset.javascript(savesJS);showLastSavesRD.delay(125);return new Element("div",{id:"LAST_SAVES_PLACEHOLDER"})}}};var showSavesWidget=function(d,f,c,b,g,e,a){if(typeof savesIncluded!="undefined"){showSavesWidget2(d,f,c,b,g,e,a)}else{new Asset.javascript(savesJS);showSavesWidget.delay(125,null,[d,f,c,b,g,e,a])}};var savesInlineLoginOnClickHandler=function(c,a,b){if(typeof savesIncluded!="undefined"){savesInlineLoginOnClickHandler2(c,a,b)}else{new Asset.javascript(savesJS);savesInlineLoginOnClickHandler.delay(125,null,[c,a,b])}};linkMap.js_trackDirPop=function(a,b){if(actionToRecord=a.className.match(/ar_(\w+)/)){actionToRecord=actionToRecord[1];new Request({url:"/ActionRecord?action="+actionToRecord}).send()}};function clearPopupForm(){$$("#POPUP_FORM #pass").setProperty("value","");$$("#DHTMLPOPUP .error-message").empty()}linkMap.js_clearPopupForm=function(a,b){clearPopupForm()};function setPopupFormAction(a){$$("#POPUP_FORM #action").setProperty("value",a)}linkMap.js_popupFormAction1=function(a,b){setPopupFormAction("1")};linkMap.js_popupFormAction2=function(a,b){setPopupFormAction("2")};var replaceContent=ta.util.element.replaceContent;linkMap.js_replaceContent=function(d,f){var b=d.className.match(/id_([^\s"]*)?/);if(!b||b.length!=2){throw new Error("Links with behavior js_replaceContent must also have a style class id_??? to indicate which element's contents should be replaced")}b=b[1];var c=$(b);var a=d.href;if(a){replaceContent(f,c,a)}f.stop()};var doBehavior=function(b){var b=new Event(b||window.event);var a=ta.id(b.target);if(a.get("tag")!="a"){a=a.getParent("a")}if(/pid(\d+)/.test(a.className)){ta.util.cookie.setPIDCookie(RegExp.$1)}(a.className.match(/(js_\w+)/g)||[]).each(function(e){if(window.linkMap){var d=linkMap[e];if(typeof d==="function"){d(a,b)}}})};function _processLink(a){if(a.className.indexOf("js_")>=0||a.className.indexOf("pid")>=0){if(a.addEventListener){a.addEventListener("click",doBehavior,false)}else{a.attachEvent("onclick",doBehavior)}try{if(a.className.match(/\b(js_pop)/)&&window.noPopClass){a.className=a.className+" "+window.noPopClass}}catch(b){ta.util.error.record(b,"_processLink - add no pop class")}}}function processLinks(a){var b=Array.from(a.getElementsByTagName("a"));b.each(_processLink);return b.length}if(typeof behavior=="undefined"){ta.queueForLoad(function(){processLinks(document)},"ProcessLinkBehavior")}(function(){function a(){if(window==window.top){var j=Cookie.read("ajaxAction");if(j){j=j.split("|");if(/^target:(\/[\w\d_-]+)/.test(j[0])){if(window.location.pathname.indexOf(RegExp.$1)!==0){return}j=j.slice(1)}else{if(window.opener){return}}Cookie.dispose("ajaxAction",{domain:cookieDomain,path:"/"});if((j[0]=="focus"||j[0]=="click")&&j.length>1){for(var f=0;f<j.length;f+=2){var d=ta.select(j[f+1]);if(d&&d.length){try{d[0][j[f]]()}catch(g){ta.util.error.record(g,"ajaxAction",null,{funcName:j[f],elmt:j[f+1]})}}}}else{try{var b=j.slice(1);b.unshift({});b.unshift(j[0]);ta.run.apply(null,b)}catch(h){ta.util.error.record(h,"ajaxAction",null,{funcName:j[0]})}}}}}ta.queueForLoad(function(){Cookie.dispose("TATypeAhead");a();if(Browser.firefox||Browser.safari||Browser.chrome){var c=window.location.hash;if(c.length>1){c=c.substring(1)}var b=ta.id(c);if(b&&b.getTop()!=window.getScrollTop()){window.scrollTo(0,b.getTop())}}if(/^#save/.test(location.hash)){doSavesPostLoginPopup()}freshVSCookieCheck()},1,"On_Load_Popups")}());ta.queueForLoad(function(){if(typeof cpu_run!="undefined"){cpu_run()}},"Commerce Popunder");function freshVSCookieCheck(){if(typeof freshVSTrackingCookie!="undefined"&&freshVSTrackingCookie){var a=new Cookie("v1st").readRaw();if(a){new Request({url:"/VSCookieRequest"}).send()}}}function royBatty(){if(typeof taSecureToken=="undefined"||!taSecureToken){return}try{var d=Cookie.read("roybatty");if(!window.taEarlyRoyBattyStatus){if(!d){Cookie.write("roybatty",taSecureToken+",1",{domain:cookieDomain});if(ta.browser&&ta.browser.isIEMetro&&ta.browser.isIEMetro()){new Request({url:"/CookiePingback?metroBrowser=true"}).send()}else{new Request({url:"/CookiePingback"}).send()}}else{var b=d.split(",");if(b&&b.length==2){var a=parseInt(b[1],10);Cookie.write("roybatty",taSecureToken+","+a,{domain:cookieDomain})}else{if(b&&b.length==1){Cookie.write("roybatty",taSecureToken)}else{ta.util.error.record(null,"royBatty -- Bad value in cookie: "+d)}}}}ta.store("roybatty.checked",true)}catch(c){ta.util.error.record(c,"javascript exection bot detection error")}}ta.queueForLoad(function(){if(typeof royBatty!="undefined"){royBatty()}},"RoyBatty");var doSavesPostLoginPopup=function(){if(typeof savesIncluded!="undefined"){handleSavesPostLoginPopup()}else{new Asset.javascript(savesJS);doSavesPostLoginPopup.delay(125)}};if(window.showPopup){showPopup()}function setDHTMLPopupShown(){if(window.ta&&window.ta.store){window.ta.store("DHTML_POPUP_SHOWN",true)}}function checkDHTMLPopupShown(){return window.ta&&window.ta.has&&window.ta.has("DHTML_POPUP_SHOWN")}var popupConfig={};function DHTMLOverlayRequest(f,e,c,d){var b="?";if(popupConfig.servletUrl.contains(b)){b="&"}if(popupConfig.servletUrl.contains("fromServlet=")){var a=popupConfig.servletUrl+b+"Action="+f}else{var a=popupConfig.servletUrl+b+"Action="+f+"&fromServlet="+pageServlet}new Request({url:a,onSuccess:e,onFailure:c,data:d,evalScripts:true}).send()}function showDHTMLPopup(b,g,d,a,f){try{popupConfig.servlet=b;popupConfig.servletUrl=g;popupConfig.lightbox=d||(a&&a.lightbox)||false;popupConfig.options=a;if(a&&a.loading&&f){f=new Event(f);ta.id(a.loading).show().inject(document.body).setStyles({left:f.page.x+20,top:f.page.y})}DHTMLOverlayRequest("Open",DHTMLOverlayResponse,null,a?a.data:null);if(a&&a.trackInterrupt&&ta.util&&ta.util.recordInterruption){ta.util.recordInterruption("popup",a.popupName)}}catch(c){ta.util.error.record(c,"showDHTMLPopup - "+b,f)}}var DHTMLOverlayResponse=function(g){if(!g){return}if(!ta.overlays||!ta.overlays.Factory){ta.load("ta-overlays",function(){DHTMLOverlayResponse(g)});return}if(popupConfig.options&&popupConfig.options.forward&&window.popupForward){window.location=window.popupForward}$$("#FLYOUT").each(function(j,i){j.dispose()});window.lightbox.deactivate();$$(".overlay").each(function(j,i){if(j.overlay&&j.overlay.hide){j.overlay.hide()}else{if(j.hide){j.hide()}else{j.dispose()}}});if(popupConfig.options&&popupConfig.options.loading){ta.id(popupConfig.options.loading).hide()}var d;var c={};if(popupConfig.lightbox){c.backdrop=ta.overlays.BACKDROP_ALWAYS}if(popupConfig.options&&popupConfig.options.delayedPosition){c.delayedPosition=popupConfig.options.delayedPosition}if(popupConfig.options&&popupConfig.options.permanent){c.permanent=popupConfig.options.permanent}if(popupConfig.options&&popupConfig.options.closeOnDocumentClick){c.closeOnDocumentClick=popupConfig.options.closeOnDocumentClick}if(popupConfig.options&&popupConfig.options.center){c.autoShow=false;d=new ta.overlays.CenteredOverlay(c)}else{if(popupConfig.options&&popupConfig.options.permanent){c.xOffset=ta.id("PAGE").getLeft()+100;c.yOffset=ta.id("PAGE").getTop()+220;d=new ta.overlays.PermanentOverlay(c)}else{if(popupConfig.options&&popupConfig.options.daodaoPopup){c.xOffset=ta.id("PAGE").getLeft()+240;c.yOffset=ta.id("PAGE").getTop()+220;d=new ta.overlays.AbsoluteOverlay(c)}else{c.xOffset=ta.id("PAGE").getLeft()+100;c.yOffset=ta.id("PAGE").getTop()+220;d=new ta.overlays.AbsoluteOverlay(c)}}}d.loadRemoteSuccess(g);d.show();setDHTMLPopupShown();ta.popups.PopUtil.trackPopup(popupConfig.servletUrl);var h=function(){if(typeof dhtmlRedirectLink!="undefined"){window.location=dhtmlRedirectLink;return}if(this.inner.getElement(".refreshOnClose")){document.location.reload();return}if(typeof addPopupCloseClass!="undefined"&&!this.inner.getElement(".silentClose")){DHTMLOverlayRequest("Close")}if(this.inner.getElement(".popupBackOnClose")){if(/(?:^|;)\\s*TAReturnTo=\%1\%([^;]*)/.test(document.cookie)){window.location=decodeURIComponent(RegExp.$1)}else{window.location="/"}}};d.addEvent("onHide",h);if(popupConfig.servlet){d.container.addClass(popupConfig.servlet);d.container.addClass("np");if(popupConfig.servlet=="RuleBasedPopup"&&popupConfig.options&&popupConfig.options.cmsDisplayName){d.container.addClass(popupConfig.options.cmsDisplayName)}d.inner.getElements(".popupConvert").each(function(j,i){j.addEvent("click",function(){DHTMLOverlayRequest("Convert")})});d.inner.getElements(".popupDecline").each(function(j,i){j.addEvent("click",function(){DHTMLOverlayRequest("Decline")})});d.inner.getElements(".dhtmlclose").each(function(j,i){j.addEvent("click",function(){var k=d;k.hide()})});var b=function(j){var i=(j.charCode)?j.charCode:((j.which)?j.which:j.keyCode);if(i==13||i==10){e(j)}};var f=function(j){var i=(j.charCode)?j.charCode:((j.which)?j.which:j.keyCode);if(i==13||i==10){new Event(j).preventDefault()}};d.inner.getElements(".popupSubmitOnEnter").each(function(j,i){j.addEvent("keydown",b)});var a=function(i){$$("#POPUP_FORM #sendpass").setProperty("value","true");e(i)};d.inner.getElements(".popupSendForgotEmail").each(function(j,i){j.addEvent("click",a)});var e=function(i){new Event(i).preventDefault();d.inner.getElements(".popupSubmit").each(function(k,j){k.removeEvent("click",e)});d.inner.getElements(".popupSendForgotEmail").each(function(k,j){k.removeEvent("click",a)});d.inner.getElements(".popupSubmitOnEnter").each(function(k,j){k.removeEvent("keydown",b);k.addEvent("keydown",f)});d.inner.getElements(".focusClear").each(function(k,j){k.setProperty("value","")});if(popupConfig.options&&popupConfig.options.disableOnHideForSubmit){d.removeEvent("onHide",h)}DHTMLOverlayRequest("Submit",DHTMLOverlayResponse,null,d.inner.getElementById("POPUP_FORM"))};d.inner.getElements(".popupSubmit").each(function(j,i){j.addEvent("click",e)})}if(popupConfig.options&&popupConfig.options.callback){popupConfig.options.callback(d.container)}};function showOwnersDHTMLPopup(b,c){var a={callback:enableAffilBox};showDHTMLPopup(b,c,true,a)}function enableAffilBox(c){if(typeof c=="undefined"||c==null){return}for(var a=0;a<3;a++){var d="affil_"+a;var b=c.getElementById(d);if(b!=null&&b!=false&&b!=""){b.style.visibility="visible"}}};var cpu_win;function doCookieCheck(){Cookie.write("SessionTest","true",{duration:0});if(Cookie.read("SessionTest")){Cookie.dispose("SessionTest");return true}return false}var blurPopunder=function(){try{var a=window.open("about:blank");if(a){a.focus();a.close()}}catch(b){ta.util.error.record(b,"commercePopunder - FF/Chrome blur failed")}};var suppressPopOnClick=function(g){var d=new Event(g||window.event);var c=ta.id(d.target);if(c){if(window.noPopClass&&(c.hasClass&&c.hasClass(window.noPopClass))||(c.getParent&&c.getParent("."+window.noPopClass))){return"no_cpu_class"}var a=c.onclick;if(a&&a.toString&&a.toString().match(/window\.open/g)){return"onclick_script"}if(ta.has("checkrates.belligerent_hw")&&Browser.version>22){var f=c;while(f){var b=f.onclick?f.onclick.toString():false;if(b&&(b.match(/ta\.call/g)||b.match(/ta\.util\.Doer\.aimdoit/g))){return"onclick_ta_call"}f=f.parentNode}if(d.target&&d.target.nodeName&&d.target.nodeName.toLowerCase()=="html"){return"onclick_invalid_target"}if(d.type=="mousedown"&&d.event&&d.event.button!=0){return"onclick_not_left_button"}}if(c.target&&"a"===c.get("tag")){return"has_target"}}if(ta.browser.isIE10Metro()){return"ie10metro"}return false};var flashMouseUp=function(c){try{if(flashObj){if(c==1){var m=flashObj.options;var d=[];for(var b in m){d.push(b+"="+m[b])}var l=window.open(flashObj.uri,flashObj.name,d.join(","));if(l){Cookie.write("CommercePopunder","SuppressAll*"+new Date().getTime(),{domain:flashObj.cDomain,duration:flashObj.cookieDuration})}}else{var a=ta.id("FLASH_CHIP");if(a){a.dispose()}if(Browser.chrome){if(!ta.has("popunder.popunder_by_flash_v2")){var k=("TA"+Math.random()+"").replace(".","");var f=window.open("http://"+window.location.hostname+"/vpages/tab.html",k);if(f){f.close()}}}else{var j=window.name;window.name=("TA"+Math.random()+"").replace(".","");window.open("",window.name);window.name=j}}}}catch(h){ta.util.error.record(h,"flashMouseUp")}};var flashPopunderReady=function(){ta.store("flashPopunderReady",true)};var flashPopunderClick=function(){var a=ta.id("FLASH_CHIP");if(a){a.dispose()}};var isFlashEligible=function(c){try{while(c){var a=c.tagName!=null?c.tagName.toUpperCase():"";if(c&&(a=="A"||a=="BUTTON"||a=="OBJECT"||a=="LI"||a=="SELECT"||c.onclick!=null||c.onmousedown!=null||c.onmouseup!=null||c.onmouseover!=null||c.hasClass("no_cpu")||c.hasClass("overlay")||c.hasClass("button")||c.id=="SAVES"||(a=="INPUT"&&(c.type=="button"||c.type=="submit")))||c.hasClass("gm-style")){return false}c=c.getParent()}return true}catch(b){ta.util.error.record(b,"isFlashEligible")}};if((typeof cpu_enabled!="undefined"&&cpu_enabled)){var cpu_paused=false;var flashObj=null;var cpu_go_impl=function(I,p){try{var j=ta.has("checkrates.add_holding_windows");var i=new Cookie("CommercePopunder").readRaw();var M=ta.popups.PopUtil.numPopundersCheck();var g=ta.popups.PopUtil.hasMTPU();if(p=="unload"){if(Browser.chrome){return"Chrome_unload"}else{if(j&&Browser.ie){return"IE_unload"}}}if(cpu_paused&&p=="unload"&&!isTakeOver){return"paused"}if(!doCookieCheck()){return"failed_cookie_check"}if(j&&(ta.popups.PopUtil.hwClosed||i.substr(0,11)=="SuppressAll")){return"user closed holding window"}if(!j||(j&&M>=ta.popups.PopUtil.maxPopunders)){if(i&&isTakeOver&&p=="click"){return"already_popped"}else{if(i&&!isTakeOver){if(i!="SuppressUnload"||p!="click"){return"already_popped"}}}}var F=typeof IS_MTPU_ENABLED!="undefined"&&IS_MTPU_ENABLED&&typeof MTPU_RULE!="undefined"&&MTPU_RULE>0&&!g;var V=F;if(window.location.protocol==="http:"&&ta.has("httpsDestination")){return"http_to_https"}if(p=="click"){try{var A=suppressPopOnClick(I);if(ta.has("checkrates.add_holding_windows")&&!F){var v=false;var l=/Hotel_Review|ShowUserReviews|Hotels|SmartDeals/;if(pageServlet&&l.test(pageServlet)){v=true;ta.store("checkrates.HWtracking","page")}var D=false;if(I.target&&I.target.href&&l.test(I.target.href)){D=true;ta.store("checkrates.HWtracking","link")}if(!v&&!D){A="add holding windows ineligible"}}if(A){return A}}catch(E){ta.util.error.record(E,"commercePopunder - suppressPopOnClick");return"error"}}if(typeof blockPU!="undefined"&&blockPU){return"block_pu"}var H="";if(typeof pageServlet!="undefined"&&pageServlet!==null){H=pageServlet}var P=new Cookie("TASession").readRaw();if(P&&/\*PD(\d+)\.(\d+)/.test(P)&&/\*CC\.(\d+)/.test(P)&&!V){return"commerce_click_happened"}if((!P||!(/\*LL\.(\d+)/.test(P)))&&!V){return"bug_28579"}var N=1;var R=1;try{if(Browser.ie7){N=250;R=100}if(Browser.safari||Browser.chrome){N=85;R=100}}catch(E){ta.util.error.record(E,"commercePopunder - access to window attributes",I,{type:p})}var q=0,n=0;try{q=(window.screenLeft||window.screenX);n=(window.screenTop||window.screenY)}catch(U){ta.util.error.record(E,"commercePopunder - setting nX and nY",I,{type:p});q=undefined;n=undefined}var L=0,K=0;try{if(typeof(q)=="undefined"){q=0;n=0;L=q+window.screen.availWidth-N;K=n+window.screen.availHeight-R}else{L=q+window.getWidth()-N;K=n+window.getHeight()-R}}catch(E){ta.util.error.record(E,"commercePopunder - setting x and y",I,{type:p});L=200;K=200}try{if(Browser.ie7){K=K-95;L=L+13}else{if(Browser.safari||Browser.chrome){K=K-16}else{L=5000;K=5000}}}catch(E){ta.util.error.record(E,"commercePopunder - access to window attributes",I,{type:p})}if(!c){c=""}try{if(window.localStorage){localStorage.setItem("CommercePopunder.timeStamp",new Date().getTime())}}catch(S){ta.util.error.record(S,"commercePopunder - localStorage after before pop",null,{},"WARN")}var C="";if(typeof overlayBackupLoc!=undefined&&overlayBackupLoc){C="&backupLoc="+overlayBackupLoc}var r="";try{if(!!ta.retrieve("popunder.similar_hotels_new_rules")){r="http://"+window.location.hostname+"/SimilarHotelsPopunder?MTPU_RULE=0"}else{var b=window.escape(window.location.href);r="http://"+window.location.hostname+"/CommercePopunderEnhanced?mainWindowReturnTo="+b+"&fromServlet="+H+C}}catch(E){ta.util.error.record(E,"commercePopunder - error accessing window.location setting cpu_uri",I,{type:p})}var a=790;var f=660;if(window.secondaryQueue){a=1040;f=768}var m=false;if(ta.retrieve("popunder.https_required")){m=true}if(!!ta.retrieve("popunder.similar_hotels")&&typeof MTPU_RULE!="undefined"&&(MTPU_RULE==286||MTPU_RULE==287||MTPU_RULE==315||MTPU_RULE==584||MTPU_RULE==586||MTPU_RULE==597||MTPU_RULE==598||MTPU_RULE==599||MTPU_RULE==600||MTPU_RULE==601||MTPU_RULE==602||MTPU_RULE==603||MTPU_RULE==604||MTPU_RULE==610||MTPU_RULE==611||MTPU_RULE==613||MTPU_RULE==629||MTPU_RULE==630||MTPU_RULE==632||MTPU_RULE==633||MTPU_RULE==634||MTPU_RULE==635||MTPU_RULE==680||MTPU_RULE==681||MTPU_RULE==682||MTPU_RULE==683||MTPU_RULE==684||MTPU_RULE==685||MTPU_RULE==689||MTPU_RULE==690||MTPU_RULE==692||MTPU_RULE==693||MTPU_RULE==694||MTPU_RULE==695||MTPU_RULE==696||MTPU_RULE==697||MTPU_RULE==698||MTPU_RULE==699||MTPU_RULE==712||MTPU_RULE==716||MTPU_RULE==717||MTPU_RULE==719||MTPU_RULE==720||MTPU_RULE==721||MTPU_RULE==722||MTPU_RULE==723||MTPU_RULE==724||MTPU_RULE==726||MTPU_RULE==727||MTPU_RULE==733||MTPU_RULE==734||MTPU_RULE==735||MTPU_RULE==736||(MTPU_RULE==771&&!!ta.retrieve("popunder.similar_hotels_new_rules")))){r="http://"+window.location.hostname+"/SimilarHotelsPopunder?MTPU_RULE="+MTPU_RULE;if(Browser.ie){f=750;a=950}else{a=960}if(ta.retrieve("similar_hotels_exit_window_chevron")){a=1040}}else{if(F){var z=m?"https":"http";if(window.geoParam){r=z+"://"+window.location.hostname+"/RuleBasedPopunder?Rule="+MTPU_RULE+"&fromServlet="+H+geoParam+C}else{r=z+"://"+window.location.hostname+"/RuleBasedPopunder?Rule="+MTPU_RULE+"&fromServlet="+H+C}if(window.popunderCommerceURL){r+="&puurl="+popunderCommerceURL}else{if(window.popunderPhotoURL){r+="&puphoto="+popunderPhotoURL}else{if(window.secondaryQueue){r+="&secondaryQueue=true"}}}}}if(p=="click"){r=r+"&onclick=1"}var T=(r.test(/RuleBasedPopunder\?Rule=286/)||r.test(/RuleBasedPopunder\?Rule=287/))?true:false;if(T){a=740;f=700;if(Browser.ie){a=a+10}}try{if(window.fireEvent){window.fireEvent("onPopunderBlur")}var k=1;var d=1;var t=ta.retrieve("ta.isIE11orHigher");if(t||(ta.browser&&ta.browser.isIE9orHigher&&ta.browser.isIE9orHigher())){k=0}else{if(Browser.chrome||Browser.firefox||(Browser.safari&&Browser.version>6)){if(Browser.chrome){d=0}N=a;R=f;L=q+(window.getWidth()-a)/2;K=n+(window.getHeight()-f)/2}}if(j){if(ta.has("checkrates.avlb_popup_win")&&!F){var o=ta.id(I.target);var s=["checkRatesType=checkRates","avlbType=popup"];var O=false;var G=false;if(o&&o.href){var u=o.href.match(/-d(\d+)/);if(u){s.push("d="+u[1]);O=true}else{var Q=o.href.match(/-g(\d+)/);if(Q){s.push("g="+Q[1]);G=true}}}else{if(typeof(modelLocId)!="undefined"&&modelLocId){s.push("d="+modelLocId);O=true}else{if(typeof(modelGeoId)!="undefined"&&modelGeoId){s.push("g="+modelGeoId);G=true}}}if(O||G){r="http://"+window.location.hostname+"/AlsoViewedLB?"+s.join("&")}else{return}}cpu_win=ta.popups.PopUtil.launchAddHoldingWindow(r)}else{if(ta.has("popunder.popunder_by_self_focus")){window.open("javascript:window.focus()","_self","")}if(Browser.chrome&&(Browser.version>29)&&!ta.has("popunder.popunder_by_flash")&&!ta.has("popunder.popunder_by_flash_v2")){return"chrome_version_too_high"}if(ta.has("popunder.popunder_by_flash")){flashObj={uri:r,name:"CommercePopunder",options:{toolbar:1,location:1,directories:1,status:1,menubar:k,resizable:1,copyhistory:1,scrollbars:d,width:N,height:R,left:L,top:K}}}else{cpu_win=window.open(r,"CommercePopunder","toolbar=1,location=1,directories=1,status=1,menubar="+k+",resizable=1,copyhistory=1,scrollbars="+d+",width="+N+",height="+R+",left="+L+",top="+K)}}var B=1;var c=window.cookieDomain;if(!c){c=""}if(ta.has("popunder.popunder_by_flash")){flashObj.cookieDuration=B;flashObj.cDomain=c;return}if(cpu_win!=null){if(Browser.chrome&&Browser.version<30){if(!ta.has("popunder.popunder_by_self_focus")||ta.has("popunder.popunder_by_self_focus_shift_ctrl")){if(ta.has("checkrates.cr_popunder_by_shift_ctrl")&&Browser.version>23){ta.popups.PopUtil.openCloseTab()}else{if(ta.has("checkrates.belligerent_hw")&&Browser.version>22){ta.store("checkrates.popunder",true)}}}}var J=M+1;if(!j){ta.popups.PopUtil.trackPopunder(r,J)}if(!j){try{try{if((Browser.firefox&&Browser.version>3.6)||((Browser.chrome&&(Browser.version<17||(Browser.version>20&&Browser.version<23)))&&p=="click")){blurPopunder()}}catch(S){ta.util.error.record(S,"commercePopunder - FF/Chrome did not blur")}cpu_win.opener=self;cpu_win.blur();window.focus();try{if(!Browser.chrome&&!Browser.firefox){cpu_win.moveTo(q+(window.getWidth()-a)/2,n+(window.getHeight()-f)/2);cpu_win.resizeTo(a,f)}}catch(S){ta.util.error.record(S,"commercePopunder - after pop, resize/move")}}catch(S){ta.util.error.record(S,"commercePopunder - after pop",null,{},"WARN")}Cookie.write("CommercePopunder","SuppressAll*"+new Date().getTime(),{domain:c,duration:B})}else{Cookie.write("CommercePopunder","HW"+J,{domain:c,duration:0})}}else{ta.util.error.record(null,"commercePopunder - past rules, no pop",null,{},"WARN");if(p=="unload"){try{if(window.localStorage){localStorage.setItem("CommercePopunder.timeStamp",new Date().getTime())}}catch(S){ta.util.error.record(S,"commercePopunder - localStorage after pop unload fail",null,{},"WARN")}Cookie.write("CommercePopunder","SuppressUnload",{domain:c,duration:B})}}}catch(E){ta.util.error.record(E,"commercePopunder - pop window",I,{type:p})}}catch(S){ta.util.error.record(S,"commercePopunder - general",I,{type:p})}};var cpu_go=function(c,a){var b=cpu_go_impl(c,a);if(false&&document.getElement("#MAIN .poolR")&&b&&!ta.has("popunder.actionrecord")&&(b<4||b>6)){ta.store("popunder.actionrecord",true);new Request({url:"/ActionRecord?action=CPU_block_"+b}).send()}};var cpu_resume=function(){window.cpu_paused=false};var cpu_pause=function(c){var b=new Event(c||window.event);var a=ta.id(b.target);if(!cpu_paused&&a&&(a.get("tag")=="a"||a.getParent("a"))){window.cpu_paused=true;cpu_resume.delay(1000)}};var cpu_run=function(){if(Browser.chrome&&(Browser.version>29)&&!ta.has("popunder.popunder_by_flash")&&!ta.has("popunder.popunder_by_flash_v2")){return}if(window.location.protocol=="https:"&&!ta.retrieve("popunder.https_required")){return}if(ta.has("popunder.popunder_by_flash")||ta.has("popunder.popunder_by_flash_v2")){document.addEventListener("mousedown",function(d){try{if(ta.has("flashPopunderReady")&&d.pageX<(document.body.getScrollWidth()-30)&&d.pageY<(document.body.getScrollHeight()-30)){var b=ta.id("FLASH_CHIP");var c=ta.id(d.target);if(!isFlashEligible(c)||d.which!=1||!b||!c){return}else{if(ta.has("popunder.popunder_by_flash_v2")){var a=setInterval(function(){if(localStorage&&localStorage.getItem("fpu")&&b){localStorage.removeItem("fpu");b.dispose();clearInterval(a)}},100)}b.style.position="fixed";b.style.width="100%";b.style.height="100%";b.style.top="0";b.style.bottom="0";b.style.left="0";b.style.right="0";cpu_go(d,"click")}}}catch(d){ta.util.error.record(d,"flash mousedown listener failed")}})}else{window.addEvent("beforeunload",function(a){cpu_go(a,"unload")});if(ta.has("checkrates.belligerent_hw")&&Browser.version>22){document.addEvent("mousedown",cpu_pause)}else{document.addEvent("click",cpu_pause)}if(ta.has("checkrates.belligerent_hw")&&Browser.version>22){document.addEvent("mousedown",function(a){cpu_go(a,"click")});document.addEvent("click",ta.popups.PopUtil.openCloseTab)}else{document.addEvent("click",function(a){cpu_go(a,"click")})}}}};function expandIframe(c,a,b){if(document.getElementById(c)){document.getElementById(c).width=a;document.getElementById(c).height=b}}function collapseAd(c){var a=ta.id(c);if(a==null){return}var b=ta.id(a.parentNode);if(b&&b.hasClass&&b.hasClass("adServer")){b.addClass("taEmpty")}else{ta.util.error.record(null,"ta.common.ads.collapseAd:fail",null,{},"WARN")}}function createAdIframe(d,b,a){var c=document.createElement("iframe");c.setAttribute("id",d);c.setAttribute("name",d);c.setAttribute("height",0);c.setAttribute("width",0);c.setAttribute("scrolling","no");c.setAttribute("border","0");c.setAttribute("marginheight","0");c.setAttribute("marginwidth","0");c.setAttribute("frameBorder","0");c.setAttribute("src","//"+document.location.host+"/"+b+"#"+a);return c}function injectAds(){var d=$$(".adServer .details");if(d.length==0){return}var b="adp/adp.html";if(adpHtml){b=adpHtml}var a=window.documentDomainChanged?"dd+":"";for(var c=0;c<d.length;c++){var e=ta.id(d[c]).getParent(".adInner");if(e&&e.hasClass("deferAd")){continue}var f=d[c].id+"_iframe";if(!ta.id(f)){d[c].getParent().appendChild(createAdIframe(f,b,a+d[c].id))}}}function injectAdsTargeted(a,b){if(!ta.has("p13n.requestAds")||ta.retrieve("p13n.requestAds")){ta.common.ads.injectAdsTargeted(a,b)}}function getIncrementedAdsAjaxCount(){return ta.common.ads.getIncrementedAdsAjaxCount()}window.addEvent("load",function(){if(ta.has("ads.gptEnabled")){window.addEvent("onPopunderBlur",function(){ta.common.ads.resetAdRefreshFlag();ta.common.ads.setLocalStorageTargeting()});if(window.pageServlet==="Hotels"){ta.on("onUpdateHACAds",function(){ta.common.ads.refreshAllAdsPolitely(true)});if(!ta.widgets.calendar.hasPageDates()){ta.common.ads.refreshAllAdsPolitely(true)}}if(window.pageServlet==="Attractions"){window.addEvent("onAttractionFilterChange",ta.common.ads.refreshAllAds)}if(window.pageServlet==="Restaurants"){window.addEvent("onRestaurantFilterChange",ta.common.ads.refreshAllAds)}if(window.pageServlet==="HotelsList"&&ta.retrieve("ta.p13n.blender_with_category_xsells.enabled")){ta.on("onHACUpdateComplete",function(){ta.common.ads.refreshAllAdsPolitely(true)})}if(!ta.has("ads.disableEventRefresh")){window.addEvent("focus",ta.common.ads.refreshAllAdsPolitely);window.addEvent("onOverlayClose",ta.common.ads.refreshAllAdsPolitely);if(ta.has("ads.calendarSelectRefresh")){window.addEvent("onCalendarSelect",function(){if(ta.common.ads.noOverlaysDisplayed()){ta.common.ads.refreshAllAdsPolitely()}})}if(window.pageServlet==="Search"){window.addEvent("onUpdateSearchResults",ta.common.ads.refreshAllAds)}}if(window.pageServlet==="Hotels"){window.addEvent("onChangeCategory",ta.common.ads.refreshAdsWithType)}if(ta.has("ads.reverseScroll")){if(window.pageServlet==="Hotel_Review"||window.pageServlet==="Attraction_Review"||window.pageServlet==="Restaurant_Review"){window.addEvent("scrollingTabs_Start",ta.common.ads.pauseOnScrollInjection);window.addEvent("scrollingTabs_End",ta.common.ads.resumeOnScrollInjection)}}}else{injectAds.delay(10)}});ta.common.ads=(function(w,o,p,m){var a=0,x=1237,f=0,C=new Date().getTime(),F=10000,q=true,v=true,k=function(){v=true;o.removeEvent("scroll",k)},z=false,g=p.util&&p.util.localstorage&&p.util.localstorage.canUseLocalStore(),n=false,c=91472856971,i="gpt-ad-4x4-locationphotoalbum",A=function(H){return typeof H=="string"||typeof H=="number"||typeof H=="boolean"},e="medium_rectangle_bottom",G=function(){var L=o.getWidth,I=o.getHeight,K=100;var H=(typeof L==="function")?Math.floor(L()/K)*K:0;var J=(typeof I==="function")?Math.floor(I()/K)*K:0;H=(H>2000)?9999:H;J=(J>1500)?9999:J;return"w"+H+"_h"+J},b=function(J){var I="WIN_SIZE";if(J&&J.win_size&&J.report){var K=J.report;for(var H=0;H<K.length;H++){if(K[H].indexOf(I)>-1){K[H]=K[H].replace(I,J.win_size);break}}}},E=function(I){var M=[],K=[];K.top="a";K.bottom="b";if(I.constructor===Array){for(var J=0,H=I.length;J<H;J++){var L=I[J];if(K[L]){M.push(L);M.push(K[L])}}}else{if(K[I]){M.push(I);M.push(K[I])}}return(M.length)?M:I},s=function(){if(!z){return}p.remove("deferAds.ads");var I=o.getScroll().y;var M=p.retrieve("ads.adStubs");if(M){try{for(var L=0,H=M.length;L<H;L++){var K=M[L];var J=p.id(K.tgt);var O=p.common.ads.getAd(K);if(J&&O&&!O.adInjected&&!O.gutterAd){if(p.has("scrollAd.enableScroll")&&K.type===e){p.common.scrollAd.resetScrollAd()}else{O.injectOnScrollUp=J.getCoordinates().bottom<I}O.injectWhenViewable(false)}}}catch(N){p.util.error.record(N,"error resetting ads after autoScroll")}z=false;if(p.has("scrollAd.enableScroll")){o.fireEvent("scroll")}}},u=function(H){var J=false;try{var L=H.adStub.tgt;if(L.match(/ref\d+/)){var I=parseInt(L.match(/ref(\d+)/)[1],10)+1;J=L.replace(/ref\d+/,"ref"+I)}else{J=L+"-ref1"}}catch(K){p.util.error.record(K,"error building refresh ad id")}return J},j=function(L){try{var M=L.adStub;var H=u(L);if(!H){var I=(L&&L.adElem&&L.adElem.id)?L.adElem.id:null;throw new Error("unable to build refresh ad id for "+I)}M.tgt=H;var P=p.id(L.adElem.cloneNode(false));P.id=M.tgt;P.removeClass("taEmpty");if(P.className.toLowerCase().indexOf("gutterad")==-1){P.set("style","")}var O=p.id(L.adId);var N=O.parentNode;N.replaceChild(P,O);var J=new p.common.ads.TripAd(M);J.addTargeting(L.slotTargeting);J.injectWhenViewable()}catch(K){p.util.error.record(K,"error cloning ad for refresh")}},r=function(I){if(!q){return false}if(I){return true}var H=new Date().getTime();if(H-C>F){C=H;return true}else{return false}},D=function(){var J=0;if(!p.has("ads.reverseScroll")){return J}if(o.location.hash){var H=w.getElement(o.location.hash);if(H&&H.isVisible()){if(p.has("scrollingTabs.scrollOnPageLoad")){J=p.retrieve("scrollingTabs.scrollOnPageLoad")}else{J=H.getCoordinates().top}if(J>0){var I=o.getScroll().y;if(I==0){v=false;o.addEvent("scroll",k)}}}}return J},t=function(H,O,J,R,M){try{if(H&&O&&O.requestStart&&J&&R){var P=50,N=J-O.requestStart,S=Math.floor(N/P)*P,K=new Date().getTime()-O.requestStart,L=Math.floor(K/P)*P,U=O.adId.replace("gpt-ad-","").replace(/-ref\d+/g,""),T=[U,((M)?"ad:y":"ad:n"),H.creativeId],I="recvd_"+S;p.trackEventOnPage("ad_latency",T.join("|"),I,L,true);O.requestStart=null}}catch(Q){}},B=function(K){if(K){try{var I=K.slot.getSlotId().getDomId();var H=p.id(I);if(I&&H){var O=p.retrieve("tripads."+I);if(O&&O.requestStart){var J=new Date().getTime();var N=!K.isEmpty&&!H.hasClass("taEmpty");var L=H.getElement("div iframe");if(N&&L){L.addEvent("load",function(){t(K,O,J,new Date().getTime(),N)})}else{t(K,O,J,J,N)}}}}catch(M){}}},l=function(I){try{if(I&&I.slot&&I.creativeId){var H=p.id(I.slot.getSlotId().getDomId());if(H){H.setAttribute("data-creative-id",I.creativeId)}}}catch(J){}},d=function(H){if(H&&!n&&p.photos&&p.photos.sponsoredVideo&&i==H.slot.getSlotId().getDomId()){n=true;if(H.creativeId&&H.creativeId!=c){p.photos.sponsoredVideo.setSponsoredContentAvailable(true)}}},h=function(H){l(H);d(H);if(p.has("ads.requestTracking")){B(H)}},y=function(I){if(p.has("scrollAd.enableScroll")){if(I&&I.type&&I.type===e){try{p.common.scrollAd.addScrollHandler()}catch(H){p.util.error.record(H,"error checking for scrolling ad")}}}};return{TripAd:new Class({adBase:null,adElem:null,adId:null,adSizes:[],adInjected:false,refreshWithNewContext:true,requestStart:null,adStub:null,adSlot:null,slotTargeting:{},id:null,type:null,options:{debug:false,collapse:true},Implements:[Options],initialize:function(I,H){try{this.setOptions(H);this.adStub=I;this.adBase=I.base;this.adSizes=I.size;this.adId=I.tgt;this.id=I.tgt;this.type=I.type;this.errorKey="ads.fail."+I.tgt;this.adElem=p.id(this.adId);this.injectOnScrollUp=false;this.reservedHeight=(this.adElem&&this.adElem.getParent(".ad"))?this.adElem.getParent(".ad").offsetHeight:0;if(!this.adElem){throw new Error("element for ad slot does not exist")}if(!p.has("tripads."+this.adId)){this.adSlot=googletag.defineSlot(I.base,I.size,I.tgt).addService(googletag.pubads()).setCollapseEmptyDiv(this.options.collapse,!this.adStub.isExpanded);if(I.custom_targeting&&I.custom_targeting.companion){this.adSlot.addService(googletag.companionAds())}}else{throw new Error("ad slot has already been created")}if(I.custom_targeting){this.addTargeting(I.custom_targeting)}this.addElementTargeting();p.store("tripads."+this.adId,this)}catch(J){throw new Error("Unable to create TripAd for target "+this.adId+": "+J.message)}},inject:function(I){if(I==false){this.refreshWithNewContext=false}try{if(this.adInjected){var H=p.id(this.adId);if(H){this.adStub.isExpanded=!H.hasClass("taEmpty")&&H.getStyle("display")!="none";H.removeClass("taEmpty");if(this.refreshWithNewContext){googletag.pubads().refresh([this.adSlot]);y(this)}else{this.refresh()}}else{throw new Error("ad refresh fail, elem does not exist: "+this.adId)}}else{googletag.display(this.adId);this.adInjected=true;if(p.has("ads.requestTracking")){this.requestStart=new Date().getTime()}y(this)}}catch(J){if(!p.has(this.errorKey)){p.util.error.record(J,"unable to inject TripAd for target: "+this.adId);p.store(this.errorKey,true)}}},refresh:function(){j(this)},injectWhenViewable:function(H){if(H==false){this.refreshWithNewContext=false}try{if(this.isInView()){this.inject(this.refreshWithNewContext)}else{this.defer()}}catch(I){p.util.error.record(I,"unable to inject/defer TripAd")}},defer:function(){var J=p.retrieve("deferAds.ads")||[];var H=J.length>0;var L=false;if(H){for(var K=0;K<J.length;K++){var I=J[K];if(this.adId==I.adId){L=true;break}}if(!L){J.push(this);p.store("deferAds.ads",J)}}else{J.push(this);p.store("deferAds.ads",J);o.ta_handleAdDefer=p.common.ads.deferAds;o.addEvent("scroll",o.ta_handleAdDefer)}},getPosY:function(){var H=this.adElem;return H.getCoordinates().top},isInView:function(){if(z){return false}if(!p.has("ads.deferEnabled")){return true}var H=o.getScroll().y;if(this.injectOnScrollUp){return v&&this.getPosY()+this.reservedHeight>H}else{return this.getPosY()<H+o.getHeight()}},isLeaderboard:function(){return this.adId.indexOf("gpt-ad-728x90")>-1},addElementTargeting:function(){if(this.adElem&&this.adElem.getAttribute("data-targeting")){var I=this.adElem.getAttribute("data-targeting");if(o.JSON&&JSON.parse){try{var H=JSON.parse(I.replace(/'/g,'"'));this.addTargeting(H)}catch(J){p.util.error.record(J,"error applying element ad targeting")}}}},addTargeting:function(I){try{I=this.mergeTargeting(I);if(I.pos){I.pos=E(I.pos)}this.slotTargeting=I;for(var H in I){this.adSlot.setTargeting(H,I[H])}}catch(J){p.util.error.record(J,"error applying ad slot targeting")}},mergeTargeting:function(N){var J=this.slotTargeting;for(var I in N){if(J[I]==N[I]){continue}if(I=="kw"){J.kw=N.kw;continue}if(I=="proptype"){J.proptype=N.proptype;continue}if(!J[I]){J[I]=N[I]}else{if(A(J[I])){J[I]=[J[I]]}if(A(N[I])){N[I]=[N[I]]}var M=J[I].concat(N[I]);var L=[];for(var H=M.length-1;H>-1;H--){var K=M.pop();if(!L.contains(K)){L.push(K)}}J[I]=L.reverse()}}return J},clearTargeting:function(){this.adSlot.clearTargeting();this.slotTargeting={}},updateHotelStyle:function(I){if(I&&this.adSlot){I=I.toLowerCase();var H={};H.triptype=I;var J=p.common.ads.SEGMENT_MAP[I];if(J){H.seg=J}this.addTargeting(H)}},updateHotelType:function(H){if(H&&this.adSlot){H=H.toLowerCase();var I={};I.proptype=H;var J=p.common.ads.SEGMENT_MAP[H];if(J){I.seg=J}this.addTargeting(I)}},isVisible:function(){return this.adElem.isVisible()}}),injectAjaxAds:function(J,H,I){if(!(o.googletag&&o.googletag.cmd)){p.util.error.record(null,"googletag not defined, unable to inject ads for servlet: "+J+","+H);return}googletag.cmd.push(function(){if(typeof J=="string"){var P="ads."+J.toLowerCase();var K=p.retrieve(P+".adStubs");var M=p.retrieve(P+".pageTargeting");var T=w.getElement(H);if(K&&K.length&&T&&T.id){var S=false;for(var O=0;O<K.length;O++){var N=K[O];if(N&&N.tgt){var L=N.tgt.split("-").slice(0,3).join("-");if(T.id.indexOf(L)>-1){N.tgt=T.id;S=N;break}}}if(S){try{var R=p.common.ads.getAd(S);if(R){if(M){R.addTargeting(M)}R.inject(I)}}catch(Q){p.util.error.record(Q,"unable to inject ajax ad for: "+S.tgt)}}}}})},getAd:function(N){var L=null;if(N){try{if(N.tgt){var O="tripads."+N.tgt;if(p.has(O)){L=p.retrieve(O);L.adElem=p.id(L.adId)}else{try{L=new p.common.ads.TripAd(N)}catch(M){return null}}}else{var H=p.retrieve("ads.adStubs");if(H){for(var K=0;K<H.length;K++){var J=H[K];if(J.tgt==N){try{L=new p.common.ads.TripAd(J);break}catch(M){return null}}}}}if(p.common.gutterAd){var P=p.id(N.tgt);if(P&&P.hasClass(p.common.gutterAd.adElemClass)&&L){L.gutterAd=true}}}catch(M){var I=(typeof N=="string")?N:N.tgt;p.util.error.record(M,"unable to get ad for id: "+I)}}return L},getIncrementedAdsAjaxCount:function(){return ++a},checkForSponsoredVideo:function(){if(p.id(i)){var H="#"+i;p.common.ads.injectAjaxAds("locationphotoalbum",H,false)}else{p.util.error.record(null,"sponsored video 4x4 ad target not found, sponsored video skipped")}},disableRefresh:function(){q=false},initDoubleClick:function(){var H=w.createElement("script");H.async=true;H.type="text/javascript";var J="https:"==w.location.protocol;H.src=(J?"https:":"http:")+"//www.googletagservices.com/tag/js/gpt.js";var I=w.getElementsByTagName("script")[0];I.parentNode.insertBefore(H,I);googletag.cmd.push(function(){p.common.ads.addPageTargeting();if(p.has("jwplayerHelper.adUrl")){googletag.pubads().enableVideoAds()}googletag.enableServices();p.common.ads.injectViewable();if(p.has("ads.peelbackEnabled")&&p.id("gpt-peelback")&&p.has("ads.gptBase")){if(w.body.offsetWidth>=x){googletag.defineOutOfPageSlot(p.retrieve("ads.gptBase"),"gpt-peelback").addService(googletag.pubads()).setCollapseEmptyDiv(true);googletag.display("gpt-peelback")}else{p.store("ads.pbSuppress",true)}}googletag.pubads().addEventListener("slotRenderEnded",h);if(p.has("ads.hotels_side_banner")){p.common.gutterAd.init()}else{if(p.has("ads.hotels_side_banner_control_tracking")){p.common.gutterAd.init_justTracking()}}})},addPageTargeting:function(){try{var I=p.retrieve("ads.pageTargeting")||{};I.win_size=G();b(I);for(var H in I){googletag.pubads().setTargeting(H,I[H])}}catch(J){p.util.error.record(J,"GPT init: unable to add page targetiing")}},injectViewable:function(){f=D();var L=p.retrieve("ads.adStubs");if(L&&L.length){for(var K=0;K<L.length;K++){var J=L[K];if(J.tgt){var I=p.id(J.tgt);if(I&&I.hasClass&&!I.hasClass("delayAd")){try{var H=new p.common.ads.TripAd(J);if(p.has("ads.reverseScroll")&&H.getPosY()<f){H.injectOnScrollUp=true}if(H.isInView()){H.inject()}else{H.defer()}}catch(M){p.util.error.record(M,"unable to create TripAd object for "+J.tgt)}}}}}},collapseAd:function(H){if(p.has("ads.gptEnabled")&&H&&H.parentNode){var I=H.parentNode;do{if(I.className&&I.className.indexOf("gptAd")>-1){I.className+=" taEmpty";break}}while(I=I.parentNode)}},injectAdsTargeted:function(K,M){if(K==null||typeof K!="object"){p.util.error.record("ad injection requires target element, element passed is "+typeof K);return}if(p.has("ads.gptEnabled")){var O=K;O.inject(this.refreshWithNewContext);return}var L=K.getElements(".adServer .details");if(L.length==0){return}var I="adp/adp.html";if(adpHtml){I=adpHtml}var H=o.documentDomainChanged?"dd+":"";for(var N=0;N<L.length;N++){var R=L[N].getParent(".adServer");var P=L[N].id+"_iframe";if(p.id(P)){var Q=L[N].cloneNode(true);R.empty().grab(Q)}var J=createAdIframe(P,I,H+L[N].id);if(M){p.id(J).addEvent("load",M)}R.appendChild(J)}},getMetaContent:function(J){var M=w.getElementsByTagName("meta");for(var I=0;I<M.length;I++){var L=M[I];var H=L.name;var K=new RegExp(J,"i");if(H.match(K)){return L.content.replace(/["<>]/g,"")}}return""},loadMonikersAdcomHelper:function(){var H=p.common.ads.getMetaContent("keywords");var J=p.common.ads.getMetaContent("description");var K=w.location.href;var M=w.referrer;var I="/uvpages/adcom.html?pageRef="+encodeURIComponent(M)+"&keywords="+encodeURIComponent(H)+"&description="+encodeURIComponent(J)+"&pageUrl="+encodeURIComponent(K);var L=w.createElement("iframe");L.setAttribute("width","1");L.setAttribute("height","1");L.setAttribute("src",I);w.body.appendChild(L)},SEGMENT_MAP:{"family-friendly":"fam",trendy:"trendy_hotel",business:"biz",on_the_beach:"beach",ski_in_out:"ski",luxury:"luxury",spa:"spa",casino:"casino"},refreshAdAjax:function(I,H,J,K){new Request({url:"/InjectAdAjax?t="+H+"&adParamKey="+J+"&adParamVal="+K,method:"get",evalScripts:true,onSuccess:function(L){var M=w.getElement(I);if(M){M.empty();M.set("html",L);injectAdsTargeted(M)}else{p.util.error.record(null,"ta.common.ads.refreshAdAjax: target not found")}},onFailure:function(){p.util.error.record(null,"ta.common.ads.refreshAdAjax: request failed")}}).send()},deferAds:function(){var P=p.retrieve("deferAds.ads"),L,M;if(!P){return}try{var O=false;for(L=0,M=P.length;L<M;L++){var K=P[L];if(K&&K.isVisible()&&K.isInView()){injectAdsTargeted(K);if(p.servlet.HotelReview){p.servlet.HotelReview.pushSEOToBottom.delay(1000)}O=true;delete P[L]}}if(O){var H=[];for(L=0,M=P.length;L<M;L++){if(typeof P[L]!="undefined"){H.push(P[L])}}if(H.length>0){p.store("deferAds.ads",H)}else{p.remove("deferAds.ads");o.removeEvent("scroll",o.ta_handleAdDefer)}}}catch(N){try{o.removeEvent("scroll",o.ta_handleAdDefer)}catch(N){}var I=(K&&K.id)?K.id:"undefined";var J="ta.common.Ads.deferAds: Error with defer. ad ID: "+I;p.util.error.record(N,J)}},queueForInjection:function(H){if(!(o.googletag&&o.googletag.cmd)){p.util.error.record(null,"googletag not defined, unable to queue ad for injection");return}if(H&&H.each){googletag.cmd.push(function(){H.each(function(I){var J=p.common.ads.getAd(I);if(J){J.injectWhenViewable(false)}})})}},refreshAdTypes:function(H){if(!(o.googletag&&o.googletag.cmd)){p.util.error.record(null,"googletag not defined, unable to refresh ad types");return}try{if(H&&H.length){if(p.has("scrollAd.enableScroll")){if(H.indexOf(e)>-1){p.common.scrollAd.resetScrollAd()}}googletag.cmd.push(function(){var M=p.retrieve("ads.adStubs");if(M){for(var L=0;L<H.length;L++){for(var J=0;J<M.length;J++){var K=M[J];if(H[L]===K.type&&K.tgt&&p.id(K.tgt)){var N=p.common.ads.getAd(K);N.injectWhenViewable(false);break}}}}})}}catch(I){p.util.error.record(I,"unable to refresh ad types")}},resetAdRefreshFlag:function(){C=new Date().getTime()},setLocalStorageTargeting:function(){if(g){if(p.has("ads.gptBase")){localStorage.setItem("ads.storage.gptBase",p.retrieve("ads.gptBase"))}if(p.has("ads.pageTargeting")){localStorage.setItem("ads.storage.pageTargeting",JSON.stringify(p.retrieve("ads.pageTargeting")))}}},detectAdBlockers:function(){if(p.trackEventOnPage&&o.Browser){var I=function(L){setTimeout(function(){var N=true;var P=p.id("ABCHK");var O=function(R,Q){if(N){if(!Q){R="none"}R+="_"+Browser.name;p.trackEventOnPage("ab_chk",R,Q,0,false);N=false}};if(P){var M=P.style.display=="none"||P.className!="adInner";if(!M&&o.getComputedStyle){M=o.getComputedStyle(P).getPropertyValue("display")=="none"}O(L,M)}},500)};var H=o.CDNHOST||"";var K=H+"/img2/x.gif?ads=1&rnd="+Math.floor(Math.random()*100000);var J=new Element("img",{id:"ABCHK","class":"adInner",height:0,width:0,src:K});J.onload=function(){I("ab")};J.onerror=function(){I("abp")};w.body.appendChild(J)}},getLocalStorageTargeting:function(){var H={};if(g){if(localStorage.getItem("ads.storage.gptBase")){H.gptBase=localStorage.getItem("ads.storage.gptBase")}if(localStorage.getItem("ads.storage.pageTargeting")){H.pageTargeting=JSON.parse(localStorage.getItem("ads.storage.pageTargeting"))}}return H},hasStoredGeo:function(){var H=false;if(g&&localStorage.getItem("ads.storage.pageTargeting")){var I=JSON.parse(localStorage.getItem("ads.storage.pageTargeting"));H=!!I.geo}return H},pauseOnScrollInjection:function(){if(p.has("deferAds.ads")){z=true}},resumeOnScrollInjection:function(){if(p.has("deferAds.ads")){s()}},noOverlaysDisplayed:function(){if(p.overlays&&p.overlays.getCurrent){return typeof p.overlays.getCurrent()==="undefined"}else{return true}},refreshAllAdsPolitely:function(H){p.common.ads.refreshAllAds.delay(1,null,[H])},refreshAllAds:function(H){if(!(r(H)&&o.googletag&&o.googletag.cmd)){return}googletag.cmd.push(function(){try{var I=o.getScroll().y;var M=p.retrieve("ads.adStubs");if(M){googletag.pubads().updateCorrelator();for(var L=0;L<M.length;L++){var K=M[L];var J=p.id(K.tgt);if(J){if(J.getParent(".ad.inactive")){continue}var O=p.common.ads.getAd(K);if(O&&O.slotTargeting&&O.slotTargeting.disable_event_refresh){continue}else{if(O.gutterAd&&p.common.gutterAd&&!p.common.gutterAd.shouldDisplay()){continue}else{if(p.has("scrollAd.enableScroll")&&K.type===e){p.common.scrollAd.resetScrollAd()}if(O.adElem.getCoordinates().bottom<I){O.injectOnScrollUp=true}else{O.injectOnScrollUp=false}if(O.gutterAd){O.inject()}else{O.injectWhenViewable(false)}}}}}}}catch(N){p.util.error.record(N,"error refreshing all ads")}})},refreshAdsWithStyle:function(H){p.common.ads.refreshAdsWithStyleOrType(H)},refreshAdsWithType:function(H){if(!H){var I=p.retrieve("sel.category");if(I){var J={cat_1:"hotels",cat_2:"bbs_inns",cat_3:"spec_lodge"};H=J[I]}}if(H){p.common.ads.refreshAdsWithStyleOrType(null,H)}},refreshAdsWithStyleOrType:function(J,I){var H=p.id("right_hand_rail")!==null||p.find(".scrollingGutterAd")!==null;if(!J&&!I){return}if(J){J=J.toLowerCase()}if(I){I=I.toLowerCase()}if(p.has("ads.gptEnabled")){if(!(o.googletag&&o.googletag.cmd)){p.util.error.record(null,"googletag not defined, unable to refresh ads for style change");return}try{if(p.has("scrollAd.enableScroll")&&H){p.common.scrollAd.resetScrollAd()}googletag.cmd.push(function(){try{var O=p.retrieve("ads.adStubs");if(O&&O.each){if(H){O.each(function(R){if(R.tgt&&p.id(R.tgt)){var Q=p.common.ads.getAd(R);if(Q&&!(Q.slotTargeting&&Q.slotTargeting.kw)){J&&Q.updateHotelStyle(J);I&&Q.updateHotelType(I);Q.injectWhenViewable(false)}}})}else{for(var N=0;N<O.length;N++){var M=O[N];if(M.type==="leaderboard_top"&&p.id(M.tgt)){var L=p.common.ads.getAd(M);if(L&&!(L.slotTargeting&&L.slotTargeting.kw)){J&&L.updateHotelStyle(J);I&&L.updateHotelType(I);L.injectWhenViewable(false);break}}}}}}catch(P){p.util.error.record(P,"unable to refresh ads for style change via googletag")}})}catch(K){p.util.error.record(K,"unable to refresh ads for style change")}return}else{p.util.error.record(null,"Non GPT call to refresh ads for style change")}},refreshSidebarAds:function(){p.common.ads.refreshAdTypes(["medium_rectangle_top","medium_rectangle_bottom"])},refreshSideBarAdsWithRefreshOrdKey:function(){if(p.retrieve("did_ad_refresh")){return}p.store("did_ad_refresh",true);if(p.has("ads.gptEnabled")){var I=p.select(".sidebar .gptAd");var H=w.getElement(".iab_leaBoa .gptAd");if(H){I.push(H)}if(I.length){I.each(function(J){var K=p.retrieve("tripads."+J.id);if(K){K.injectWhenViewable()}})}}else{p.util.error.record(null,"Non GPT call to refresh sidebar ads")}},stringifyTargeting:function(I){var J="";for(var H in I){if(J.length){J+="&"}if(A(I[H])||(typeof I[H]=="object"&&I[H].length)){J+=H+"="+I[H].toString()}}return encodeURIComponent(J)},setMinRefresh:function(H){F=H}}}(document,window,ta));var ta=ta||{};ta.common=ta.common||{};ta.common.ads=ta.common.ads||{};ta.common.ads.remarketingOptions=ta.common.ads.remarketingOptions||{};(function(){var b=function(c){return ta.common.ads.remarketingOptions[c]};var a=ta.util&&ta.util.error?ta.util.error.record:function(){};ta.common.ads.loadMonikers=function(c){try{if(!b("pixelsEnabled")){return null}c=c||{};c.isClickout="0";var d=ta.common.ads._loadMonikers(c);if(window.ta&&ta.m){if(b("clickoutPixelsEnabled")){c.isClickout="1";ta.common.ads._cacheClickoutMonikers(c)}}return d}catch(f){a(f,"ads.loadMonikers",null,{context:c})}return null};ta.common.ads.loadClickoutMonikers=function(c){try{if(!(b("pixelsEnabled")&&b("clickoutPixelsEnabled"))){return null}if(ta.common.ads._cachedClickoutMonikerText){return ta.common.ads._appendMonikersIFrameText(ta.common.ads._cachedClickoutMonikerText)}c=c||{};c.isClickout="1";return ta.common.ads._loadMonikers(c)}catch(d){a(d,"ads.loadClickoutMonikers",null,{context:c})}return null};ta.common.ads._cacheClickoutMonikers=function(e){var f=b("pixelContext");var c=ta.common.ads._mergeContexts(f,e);var d=ta.common.ads._buildPixelUrl(c);if(!d){return}var g=new XMLHttpRequest();g.open("GET",d,true);g.onreadystatechange=function(){if(this.readyState==4){ta.common.ads._cachedClickoutMonikerText=this.response}};g.send()};ta.common.ads._buildPixelUrl=function(e){if(!b("pixelServlet")){a(null,"ads._buildPixelUrl: remarketing.pixelServlet not set");return null}var f=b("pixelList");if(!f){return null}var c="/"+b("pixelServlet")+"?pixelList="+f;for(var d in e){if(e.hasOwnProperty(d)){c+="&"+d+"="+e[d]}}return c};ta.common.ads._appendMonikersIFrame=function(c){var d=document.createElement("iframe");d.setAttribute("id","Monikers");d.setAttribute("width","1");d.setAttribute("height","1");d.setAttribute("src",c);document.body.appendChild(d);return d};ta.common.ads._appendMonikersIFrameText=function(d){var c=document.createElement("iframe");c.setAttribute("id","Monikers");c.setAttribute("width","1");c.setAttribute("height","1");c.setAttribute("srcdoc",d);document.body.appendChild(c);return c};ta.common.ads._mergeContexts=function(f,e){if(!f){return e}else{if(!e){return f}}var d;var c={};for(d in f){if(f.hasOwnProperty(d)){c[d]=f[d]}}for(d in e){if(e.hasOwnProperty(d)){c[d]=e[d]}}return c};ta.common.ads._loadMonikers=function(f){var h,c;try{h=b("pixelContext");c=ta.common.ads._mergeContexts(h,f);var d=ta.common.ads._buildPixelUrl(c);if(!d){return null}return ta.common.ads._appendMonikersIFrame(d)}catch(g){a(g,"ads._loadMonikers",null,{pixelContext:h,extraContext:f})}return null}})();if(typeof ta.common=="undefined"){ta.common={}}ta.common.dmp=function(l,k,f){var d=null,h=null,e=false,c=false,i=[/^modules\.common\.CityPageRatings/,/^meta_lightbox_open_button/,/^Meta_VP_Submit_Hotels/,/^reviews_travelerphotos/i,/commerce_click_/i,/abandonedcart/i,/multi_click/i,/attractionbookbutton/i,/attractions_/i,/map_/i,/filters/i,/floatingmap/i,/greenleaders/i,/herophotoscrollright/i,/photo_lb/i,/hotel_review/i,/meta_hac/i,/meta_style/i,/meta_click/i,/mobilehotel/i,/mobilehotels/i,/mobilerestaurant/i,/mobileviewphoto/i,/mobileattraction/i,/p13n/i,/photos_traveler/i,/reserveclick/i,/restaurant_/i,/restaurant_/i,/reviews_expand/i,/reviewstab_vr/i,/cruisecritic/i,/self_tags/i,/uber/i,/war_complete/i],g=function(n){if(n){var o=true;o&=b(n,"getName");o&=b(n,"load");o&=b(n,"setUUID");o&=b(n,"setBehaviors");o&=b(n,"addBehavior");o&=b(n,"send");return o}return false},b=function(o,n){if(o){return typeof o[n]=="function"}else{return false}},j=function(n,o){if(typeof o=="undefined"){o="INFO"}if(o=="ERROR"){f.common.dmp.errorRecord(null,n,null,null,o.toUpperCase())}if(c&&console.log){console.log("[ta.common.dmp] ["+o.toUpperCase()+"] "+n)}},m=function(o,n){if(typeof n=="undefined"||n==null||typeof n=="object"){return o}var p=n.toString();if(p.length){if(o==null||o.length<1){o=p}else{o+="_"+p}}return o},a=function(n){var q=f.common.dmp.store.getValue("dmpGARecordWhitelistEnabled");if(q){try{for(var o=0;o<i.length;o++){if(i[o].test(n)){return true}}}catch(p){j("Error evaluating GARecord behavior whitelists","ERROR")}return false}else{if(f.common.dmp.behaviorTracker&&typeof f.common.dmp.behaviorTracker.isValidGABehavior=="function"){return f.common.dmp.behaviorTracker.isValidGABehavior(n)}return true}};return{isEnabled:function(){if(!h){if(f.common.dmp.store){h=f.common.dmp.store.getValue("dmpEnabled")===true}else{h=false}}return h},errorRecord:function(){if(f&&f.util&&f.util.error&&f.util.error.record){f.util.error.record.apply(this,arguments)}},isValidBehavior:function(n){if(f.common.dmp.behaviorTracker&&typeof f.common.dmp.behaviorTracker.isValidBehavior=="function"){return f.common.dmp.behaviorTracker.isValidBehavior(n)}return true},isNewBehavior:function(n){if(f.common.dmp.behaviorTracker&&typeof f.common.dmp.behaviorTracker.isNewBehavior=="function"){return f.common.dmp.behaviorTracker.isNewBehavior(n)}return true},init:function(){try{if(!f.common.dmp.isEnabled()){j("DMP disabled","INFO");return}if(f.common.dmp.behaviorTracker&&typeof f.common.dmp.behaviorTracker.init=="function"){f.common.dmp.behaviorTracker.init()}var o=f.common.dmp.store.getBehaviors();var p=f.common.dmp.store.getActiveDMP();if(p){if(g(p)){d=p;var s=f.common.dmp.store.getValue("taUUID");if(s){d.setUUID(s)}if(c){for(var r in o){for(var q=0;q<o[r].length;q++){j("setting initial behavior "+r+"="+o[r][q])}}}if(o!=null){d.setBehaviors(o)}f.common.dmp.store.clearBehaviors();d.load()}else{var n=(typeof p.getName=="function")?p.getName():"Unknown DMP";j(n+" failed interface sanity check","ERROR")}}e=true}catch(t){j("init failed. "+t,"ERROR")}},addBehavior:function(o,p){try{if(this.isEnabled()&&this.isValidBehavior(p)&&this.isNewBehavior(o+","+p)){if(e&&d){j("addBehavior "+o+"="+p,"DEBUG");d.addBehavior(o,p)}else{j("addBehavior called, but DMP not yet initialized; adding to stored behaviors: "+o+"="+p,"DEBUG");var n=f.common.dmp.store.getBehaviors();if(!n[o]){n[o]=[p]}else{n[o].push(p)}f.common.dmp.store.setBehaviors(n)}}}catch(q){j("addBehavior failed. "+q,"ERROR")}},addBehaviorBatch:function(n,r){if(this.isEnabled()){for(var q in n){if(n.hasOwnProperty(q)){var o=n[q];if(Object.prototype.toString.call(o)==="[object Array]"){for(var p=0;p<o.length;p++){this.addBehavior(q,o[p])}}else{if(typeof o=="string"||typeof o=="number"){this.addBehavior(q,o)}}}}if(r){f.common.dmp.send()}}},addGABehavior:function(q,r,p,v,u){var n=false;try{var s=f.common.dmp.behaviorTracker&&typeof f.common.dmp.behaviorTracker.addDeviceSpecificGABehaviors=="function"&&f.common.dmp.behaviorTracker.addDeviceSpecificGABehaviors(q,r,p,v);if(s){return true}var o=m(null,q);if(q=="p13n_tag"&&r!=null){o=m(o,r.split(":",1)[0])}else{o=m(o,r)}if(!(q=="Attractions"&&p&&p.match(/^\d+$/))){o=m(o,p)}if(!(((q=="Meta_HAC_Filter"&&p=="neighborhood")||q=="FlashPhotoUploader")&&v&&v.match(/^\d+$/))){o=m(o,v)}if(o!=null&&o.length&&a(o)){f.common.dmp.addBehavior("GARecord",o);n=true}}catch(t){j("addGABehavior failed. "+t,"ERROR")}return n},sendGABehavior:function(o,s,n,r,q){var p=f.common.dmp.addGABehavior(o,s,n,r,q);if(p){try{f.common.dmp.send()}catch(t){j("Calling ta.common.dmp.send failed in sendGABehavior. "+t,"ERROR")}}},sendEventBehavior:function(q,s,p,r,o){if(f.common.dmp&&typeof f.common.dmp.behaviorTracker.addEventBehavior=="function"){var n=f.common.dmp.behaviorTracker.addEventBehavior(q,s,p,r,o);if(n){f.common.dmp.send()}}},send:function(){try{if(f.common.dmp.isEnabled()&&e&&d){j("send behaviors","DEBUG");d.send()}}catch(n){j("send failed. "+n,"ERROR")}},sendAjaxBehavior:function(n,o){if(typeof n=="string"&&n.length>0&&o!=null){f.common.dmp.addBehavior(n,o);f.common.dmp.send()}},log:j}}(document,window,ta);ta.common.dmp.bluekai=(function(r,n,o){var y="Bluekai",u=n.bluekaiClientId||17576,q=20645,h=4,g={},m=false,l=null,f=false,v=0,d=false,z=("https:"==r.location.protocol?"https":"http")+"://tags.bkrtx.com/js/bk-coretag.js",j=0,k=r.domain,A=false,b="",w=function(){var D=false;b="";for(var C in g){for(var B=0;B<g[C].length;B++){if(o.common.dmp.isValidBehavior(g[C][B])){p("adding behavior "+C+" = "+g[C][B],"DEBUG");l.bk_addPageCtx(C,g[C][B]);D=true;if(A){b+=(b.length>0?"::":"")+C+"="+g[C][B]}}}}return D},t=function(){if(o.common.dmp.store&&o.common.dmp.store.isMobileDevice()){return q}return u},i=function(){try{if(e("_addSendBehaviors")){var B=w();if(B){if("https:"==r.location.protocol){l.bk_pixel_url="https://tags.bluekai.com/"}l.bk_doJSTag(t(),h);s();if(A){A=false;o.trackEventOnPage("DMPBluekai","internal_tracking",b)}}}else{p("Bluekai._addSendBehaviors couldn't send. The API isn't accessible (_hasAPILoaded returned false) even though _loaded = "+d,"WARN")}}catch(C){p("Bluekai._addSendBehaviors general exception: "+C,"ERROR")}},c=function(){return m!==false},s=function(){g={}},p=function(C,D){try{if(typeof D=="undefined"){D="DEBUG"}if(console.log&&f){console.log("[ta.common.dmp.bluekai] ["+D+"] "+C)}if(D!="DEBUG"){o.common.dmp.errorRecord(null,C,null,null,D.toUpperCase())}}catch(B){}},e=function(C){if(!l){if(r.getElementById("BK_CONTAINER")&&r.getElementById("BK_CONTAINER").contentWindow){l=r.getElementById("BK_CONTAINER").contentWindow}}var B="";if(C&&typeof C=="string"){B=C+" -> "}B=B+"Bluekai._hasAPILoaded returned false ";if(!r.getElementById("BK_CONTAINER")){p(B+"- iframe element has not created","WARN");return false}else{if(!r.getElementById("BK_CONTAINER").contentWindow){p(B+"- the iframe contentWindow returned null","WARN");return false}else{if(!l){p(B+"- BK iframe container is not yet initialised","WARN");return false}else{if(typeof l.bk_addPageCtx!="function"){p(B+"- BK API bk_addPageCtx function is not found","WARN");return false}else{if(typeof l.bk_doJSTag!="function"){p(B+"- BK API bk_doJSTag function is not found","WARN");return false}else{return true}}}}}},x=function(){try{var C=false;if(n.ta&&o.common.dmp.store){C=o.common.dmp.store.getValue("dmpPerfLoggingEnabled")===true}if(C&&v>0){p("Bluekai loaded in "+(new Date().getTime()-v)+" ms.","INFO")}}catch(B){}},a=function(){return o.common.dmp.store&&o.common.dmp.store.getValue("dmpMeasureTest")};return{getName:function(){return y},load:function(){try{f=o.common.dmp.store&&o.common.dmp.store.getValue("dmpConsoleDebugEnabled");p("loading Bluekai API","DEBUG");var B='<script type="text/javascript" src="'+z+'"><\/script>';var F='<iframe name="__bkframe" height="0" width="0" frameborder="0" src="javascript:void(0)"></iframe>';var C='<script type="text/javascript"> function hasBluekai(win) { return ( win.ta && win.ta.common &&  win.ta.common.dmp && win.ta.common.dmp.bluekai) ? true : false; } var win = window; while(win.parent && win.parent != win && !hasBluekai(win)) { win = win.parent; } if(hasBluekai(win)) {  if(win.ta.common.dmp.bluekai.shouldIframeDomainBeSet()) {    document.domain = win.ta.common.dmp.bluekai.getParentPageDomain();  }  win.ta.common.dmp.bluekai.sendAfterLoad(); }<\/script>';var D=r.createElement("iframe");D.id="BK_CONTAINER";D.src="javascript:'<html><head>"+B+"</head><body>"+F+C+"</body></html>'";D.width=0;D.height=0;D.frameBorder=0;D.title="";D.role="presentation";v=new Date().getTime();r.body.appendChild(D);l=D.contentWindow}catch(E){p("Bluekai.load general exception. Failed to load API. "+E,"ERROR")}},shouldIframeDomainBeSet:function(){try{l.document&&typeof l.bk_addPageCtx=="function"}catch(B){return true}return false},getParentPageDomain:function(){return k},setUUID:function(B){m=B},setBehaviors:function(B){g=B||{}},addBehavior:function(B,C){if(!g[B]){g[B]=[C]}else{g[B].push(C)}},sendAfterLoad:function(){try{if(e("sendAfterLoad")){x();d=true;if(j>0){p("Bluekai API successfully loaded after "+j+" retries.","WARN")}p("sending initial behaviors","DEBUG");l.bk_addPageCtx("__bk_l",r.location.href);if(c()){p("sending UUID: "+m,"DEBUG");l.bk_addPageCtx("uuid",m)}l.bk_allow_multiple_calls=true;if(o.common.dmp.store&&o.common.dmp.store.getValue("dmpBlueKaiEnableMultipleIframes")){l.bk_use_multiple_iframes=true}l.bk_ignore_meta=true;A=a();i()}else{j++;if(j<=3){n.setTimeout(o.common.dmp.bluekai.sendAfterLoad,(200*j))}else{p("Bluekai API failed to load after 3 retries. Giving up.","WARN")}}}catch(B){p("Bluekai.sendAfterLoad general exception: "+B,"ERROR")}A=false},send:function(){if(d){i()}}}}(document,window,ta));ta.common.dmp.store=(function(){var a={};var b={};var d=null;var c=false;return{setBehaviors:function(e){a=e||{}},clearBehaviors:function(){a={}},getBehaviors:function(){return a},storeValue:function(e,f){b[e]=f},hasValue:function(e){return typeof b[e]!="undefined"},getValue:function(e){return b[e]},getActiveDMP:function(){return d},setMobileDevice:function(){c=true},isMobileDevice:function(){return c},setActiveDMP:function(e){d=e}}}());ta.common.dmp.behaviorTracker=(function(s,j,k){var h=[];var x=[];var y=/^(Meta_Homepage|meta_lightbox|Meta_VP|Meta_LP_CTA|Meta_Micro|Meta_State-Optimized|meta_best_price_cross_sell)/;var a=/^(modules|geo_specific|av_above_fold|hotels_placeholder|AttractionContact|LockUp_Hero|GeoDesc|grid_|photo_photosloaded|pinLander|sampleEmail)/;var t=/^(RestaurantListing|Restaurant_Links_Menu|Restaurant_Links_Update)/;var o=[/early_roy_batty/,/^ad_latency/,/^ab_chk/,/^Footer/,/^DATEPICKER_OPEN_DATES/,/^Meta_HAC_Loading/,/single_hotel_detail/,/^(BlueChevron_LP_|Mini_meta_LP)/,/^HAC_HACComplete_/,/^postLinks_/,/^open_info_window/,/^Popup_/,/^social/,/^CommercePopunder/,/^dynamic_large_map_sidebar/,y,a,/^(HoverSave_|Saves_Hover)/,t,/^(Reviews_BLSlideshow|BL_SO|BLSlideshow)/,/(switch_to_.*)+/,/^tourism_engagement_/i,/^tourism_modules_/i,/datepicker/i,/^reviews_(?!expand$)/i,/carousel/,/^price_saver_display_/i,/close/i,/hover/i,/^map_cataloging_map_initialized_unknow_/i,/photo_lb_traveler/i,/^qc_persist_meta_open/i,/impression/i,/smart_deals2013_sd_datebar_/i,/^hotel_review_low_price_message_display/i,/^tab_bar_tabs/i,/^photos_traveler_image/i,/^sur_scrolled_control/i,/^meta_on_photoviewer_isoverlap_true$/i,/screensizerecord_/i,/resize/i,/show_0/i,/^topnav_search_focus$/i,/^meta_on_photoviewer_placementshown$/i,/stinterrupter/i,/^.*-bing$/i,/^.*gmaps3$/i,/test/i,/^non-commerce_property_loaded_non-dated_0$/i,/^attraction_review_rhs_show_0$/i,/unknown/i,/^pypt_search_/i,/^noavailability_xsell_flyout$/i,/^hotelsmetafocuspredates_/i,/^.*hacpollingcomplete/i,/undated/i,/display_0/i,/fblb/i,/^fb_foaf_/i,/^autobroadenhotels_/i,/^rac_result_lafourchette_success_predates$/i,/interrupter/i,/has_dates/i,/no_availability/i,/shown_0/i,/click_0/i,/no_dates/i,/dates_0/i,/cancel/i,/^SortChanged$/,/FILTER_BEDROOM_MAP_VRAC/,/FILTER_PRICE_MAP_VRAC/,/FILTER_AMENITIES_MAP_VRAC/,/LRSuitability_pers_VRAC/,/BookOnline_VRAC/,/VR_PRICEHAT4_SRP/,/PersistInquiryImp_VRR/,/prodp13n/,/HISTORY_INJECT/,/lowest_price/,/leavebehind/i,/leave_behind/i,/owner_reg/,/Oyster/,/PhotosLB_n_more_sites/,/dynamic_large_map/,/list_view_card/,/MAPS_V2/,/float_map/,/Filters_Map/,/Search_Near_Map/,/neighborhood_widget/,/^DMPBluekai_internal_tracking/i];var g=[/^modules\.common\.CityPageRatings/,/^meta_lightbox_open_button/,/^Meta_VP_Submit_Hotels/,/^reviews_travelerphotos/i];var u=[/casino/i,/^ski$/i,/^last_minute$/i,/^biz$/i,/^fam$/i,/^romance$/i,/^golf$/i,/^spa$/i,/^beach$/i,/^natparks$/i,/^theme_park$/i,/^trendy_hotel$/i,/^vaca$/i,/^carrent$/i,/^cruise$/i,/^culture$/i,/^xtend$/i,/^thirty_days$/i,/^budget$/i,/^midlevel$/i,/^luxury$/i,/^suplux$/i,/^review$/i,/^vrpi$/i,/^attrpi$/i,/^hotelspi$/i,/^flightspi$/i,/^bookingpi$/i,/^travelocitypi$/i,/^expediapi$/i,/^hotelscompi$/i,/^pricelinepi$/i,/^cheaptixpi$/i,/^venerepi$/i,/^splendiapi$/i,/^agodapi$/i,/^olotelspi$/i,/^hrspi$/i,/^ebookerspi$/i,/^edreamspi$/i,/^hotelclubpi$/i,/^tcookukpi$/i,/^wotifaupi$/i,/^despegarpi$/i,/^beach_b$/i,/^budget_b$/i,/^luxury_b$/i,/^natparks_b$/i,/^romance_b$/i,/^spa_b$/i];var e=false,w=false;var p=/^\/((Hotel|Restaurant|Attraction)_Review|VacationRentalReview)/i,b=/reviews/i,q=null;var v=function(z){try{for(var A=0;A<g.length;A++){if(g[A].test(z)){return true}}for(A=0;A<o.length;A++){if(o[A].test(z)){n("Blacklisted behavior: "+z,"DEBUG");return false}}}catch(B){n("Error evaluating GARecord behavior blacklists","ERROR")}return true},c=function(){try{if(j.ta&&k.widgets&&k.widgets.calendar&&k.util&&k.util.date){var z=k.widgets.calendar.getPageInDate();if(z){var B=k.util.date.getDaysInRange(new Date(),z)-1;k.common.dmp.addBehavior("Calendar","days_to_trip_"+B);var G=m(z);if(G){k.common.dmp.addBehavior("Calendar","start_"+G)}var H=r(z);if(H){k.common.dmp.addBehavior("Calendar_Month",H)}var E=k.widgets.calendar.getPageOutDate();if(E){var A=k.util.date.getDaysInRange(z,E)-1;k.common.dmp.addBehavior("Calendar","stay_duration_"+A);var C=m(E);if(C){k.common.dmp.addBehavior("Calendar","end_"+C)}var F=r(E);if(F&&F!=H){k.common.dmp.addBehavior("Calendar_Month",F)}}}}}catch(D){n("Error adding calendar behaviors","ERROR")}},r=function(z){var A=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"];try{if(z&&z.getMonth()>=0&&z.getMonth()<A.length){return A[z.getMonth()]}}catch(B){n("Error getting month from date "+z,"ERROR")}return"unknown"},m=function(z){var B=["sun","mon","tue","wed","thu","fri","sat"];try{if(z&&z.getDay()>=0&&z.getDay()<B.length){return B[z.getDay()]}}catch(A){n("Error getting day of week from date "+z,"ERROR")}return"unknown"},d=function(A,z){w=A||w;e=z||e;if(w&&e){k.common.dmp.addBehavior("Meta_Click",w+"_rank_"+e);w=false;e=false}},n=function(z,A){if(k.common.dmp&&typeof k.common.dmp.log=="function"){k.common.dmp.log(z,A)}},i=function(){var B=k.find("#REVIEWS .reviewSelector");if(B){var z=B.getCoordinates().top||0;var A=j.getScroll().y;var C=j.getHeight();if(z>0&&(A+(C/2))>=(z)){f("reviews_scrolled",true);clearInterval(q)}}},f=function(C,B){if(!C||!j.location){return}var A=p.exec(j.location.pathname);var z="";if(A&&A.length>=2){z=A[1]}if(z&&z.length>0){k.common.dmp.addBehavior(C,z)}if(B){k.common.dmp.send()}},l=function(){if(j.location){var z=j.location.pathname;var A=j.location.hash;if(z&&p.test(z)){if(A&&b.test(A)){f("reviews_viewed")}else{if(k.common.dmp.store&&k.common.dmp.store.getValue("dmpReviewReadTest")){q=i.periodical(30000)}}}}};return{init:function(){c();l();if(k.common.dmp.store&&k.common.dmp.store.getValue("dmpMetaExposedEnabled")){this.sendMetaExposedTags();j.addEvent("HRHacComplete",this.sendMetaExposedTags)}},isNewBehavior:function(z){try{if(z&&!h.contains(z)){h.push(z);return true}return false}catch(A){n("Error evaluating whether to send interval behavior to DMP","ERROR")}return true},isValidBehavior:function(z){try{for(var A=0;A<u.length;A++){if(u[A].test(z)){n("Blacklisted behavior: "+z,"DEBUG");return false}}}catch(B){n("Error evaluating behavior blacklists","ERROR")}return true},isValidGABehavior:function(z){return v(z)},addDeviceSpecificGABehaviors:function(A,C,z,B){if(C=="meta_click"){d(false,B);return true}if(A=="CheckRates"){d(z,false);return true}if(A=="DATEPICKER"&&C=="SELECT"){c();return true}return false},sendMetaExposedTags:function(){if(k.common.dmp.store&&k.common.dmp.store.getValue("dmpMetaExposedEnabled")){var A=/MainCommerce.*\\N:(\d+).*?\\PN:(BookingCom).*?\\F:(\w+)/;try{$$(".impressionTrackingTree").each(function(D){if(D){var C=D.innerHTML;var B=A.exec(C);if(B&&B.length>3){var G=B[2];var E=B[3];var F=B[1];var H=G+"_"+E+"_rank_"+F;if(!x.contains(H)){k.common.dmp.sendAjaxBehavior("Meta_Exposed",H);x.push(H)}}}})}catch(z){n("Error scraping meta exposed data for DMP. "+z,"ERROR")}}}}}(document,window,ta));ta.maps=ta.maps||{};ta.maps.trackpixel=(function(a,d,b,e){var c=[];return{storeTrackPixleSrc:function(f){if(f){c.push(f)}},loadSponsorTrackingPixel:function(f){c.each(function(g){var h=g.trim();var i=new Element("img",{"class":"tracking"});i.src=h});if(!f){c=[]}}}}(document,window,ta));linkMap.js_modifySub=function(a,b){modifySub.apply(a,[b])};rules["#NEWSLETTER_CALLOUT input.memberUpdateEmail[type=text]"]=function(a){$("memberUpdatesEmailDefault").hide();$(a.form).addEvent("submit",function(b){if(a.value==$("memberUpdatesEmailDefault").innerHTML){a.value=""}})};function alertIfEmpty(a){if(a&&a.value==""){if(msg=a.className.match(/\bmsg_([\w\d]+)\b/)){alert(window[msg[1]])}else{alert("The field can not be empty")}return false}return true}function addNonMember(c,b){if(!b){b=this}popupConfig.clickedElement=b;new Event(c).preventDefault();var a="/MemberBenefitsPopup";if(/pid(\d+)/.test(b.className)){a+="?pid="+RegExp.$1}showDHTMLPopup("MemberBenefitsPopup",a,true)}function clickNonMember(){setTimeout("window.lightbox.deactivate()",500);if(popupConfig.clickedElement==null){return}var a=popupConfig.clickedElement;popupConfig.clickedElement=null;$$("#TRAVEL_GUIDES_LANDER .clickNonMember").each(function(c,b){c.removeEvent("click",addNonMember)});$$("#TRAVEL_GUIDES_FLY .clickNonMember").each(function(c,b){c.removeEvent("click",addNonMember)});if(a.className.match(/\bclickPopDestMOGLink\b/)){processPopDestMOGLink(null,a)}else{if(a.get("tag")=="a"){window.location=a.getProperty("href")}else{a.click()}}}function processPopDestMOGLink(b,a){if(!a){a=this}if(!loggedIn){addNonMember(b,a)}else{processGuideLink(b,a)}}rules["#TRAVEL_GUIDES_LANDER .clickNonMember"]=rules["#TRAVEL_GUIDES_FLY .clickNonMember"]=function(a){if(a.get("tag")!="a"||!a.className.match(/\bskipATag\b/)){a.addEvent("click",addNonMember)}};rules["#TRAVEL_GUIDES_LANDER .clickPopDestMOGLink"]=function(a){a.addEvent("click",processPopDestMOGLink)};rules["#HELP_CENTER dl.js_toggleset"]=function(a){var c=0;var b=new ToggleSet(a.getElements("dt"),a.getElements("dd"));if(window.location.hash&&(hash=window.location.hash.match(/c(\d+)/))){b.display(parseInt(hash[1]))}};rules["#TAB_CONTAINER"]=ta.widgets.tabContainer;linkMap.js_replaceContentSet=function(c,f){var d=c.className.match(/set_([^\s"]*)?/);if(!d||d.length!=2){throw new Error("Links with behavior js_replaceContentSet must also have a style class set_??? to indicate the set of elements the contents of which should be replaced")}var a=c.className.match(/id_([^\s"]*)?/);if(!a||a.length!=2){throw new Error("Links with behavior js_replaceContentSet must also have a style class id_??? to indicate which element's contents should be replaced")}a=a[1];var b=$(a);if(!b){throw new Error("Element of id "+a+" does not exist.")}d=d[1];replaceContentSet(d,f,b.id)};var replaceContentSet=function(h,j,f){j=new Event(j);var b=$$("a.set_"+h);for(var c=0;c<b.length;c++){var k=b[c];var g=k.className.match(/id_([^\s"]*)?/);if(!g||g.length!=2){throw new Error("Links with behavior js_replaceContentSet must also have a style class id_??? to indicate which element's contents should be replaced")}g=g[1];var d=$(g);var a=k.href;if(c==b.length-1&&f){d.addEvent("onContentReplaced",function(){window.setTimeout(function(){window.location.hash=f},200)})}else{if(f){d.removeEvents("onContentReplaced")}}if(a){replaceContent(j,d,a)}}j.stop()};function vrCalculator(c,g){var f=g!=null?new Event(g):null;if(c&&/pid(\d+)/.test(c.className)){ta.util.cookie.setPIDCookie(RegExp.$1)}var b="";var a=$("homePageVRCalcPromo");if(!a){a=$("calculatorOverviewPromo")}if(!a){a=$("calculatorLanderPromo")}if(!a){a=$("expandedHomePageVRCalcPromo")}if(a&&$("vrCalculatorForm")){var d=a.getElement("#geoName");if(d.hasClass("focusClear")){d.value="";d.removeClass("focusClear")}b="&geoName="+a.getElement("#geoName").value;if(a.getElement("#adults")){b+="&adults="+a.getElement("#adults").value}if(a.getElement("#nights")){b+="&nights="+a.getElement("#nights").value}}new ta.overlays.CenteredOverlay({backdrop:ta.overlays.BACKDROP_ALWAYS,backdropClickClose:true,onReady:function(){this.inner.getElement("input").focus()}}).loadRemoteContent("/VacationRentalCalculator?restart=true"+b);if(f){f.stop()}return false}linkMap.js_submitVRCalculator=function(b,g){var d=g!=null?new Event(g):null;var h=$("vrCalculator");var c=h.getElement("form");var f=h.getElement(".serverErrorMsg");if(f){f.style.display="none"}if(c.geoName.value==""){h.getElement(".errorMsg").style.display=""}else{var a=c.action+"?"+c.toQueryString();replaceContent(g,h.getParent(),a)}if(d){d.stop()}return false};var SocialHistory=function(){var o={f:["http://www.facebook.com/","https://login.facebook.com/login.php","http://www.facebook.com/home.php"]};var l={};function m(s,r,i){if(s.currentStyle){var t=s.currentStyle[i]}else{if(window.getComputedStyle){var t=r.defaultView.getComputedStyle(s,null).getPropertyValue(i)}}return t}function j(i){i.parentNode.removeChild(i)}function p(){var i=document.createElement("iframe");i.style.position="absolute";i.style.visibility="hidden";document.body.appendChild(i);if(i.contentDocument){i.doc=i.contentDocument}else{if(i.contentWindow){i.doc=i.contentWindow.document}}i.doc.open();i.doc.write("<style>");i.doc.write("a{color: #000000; display:none;}");i.doc.write("a:visited {color: #FF0000; display:inline;}");i.doc.write("</style>");i.doc.close();return i}var g=p();function c(r,s){var i=g.doc.createElement("a");i.href=r;i.innerHTML=a;g.doc.body.appendChild(i)}for(var a in o){var n=o[a];for(var h=0;h<n.length;h++){c(n[h],a);if(n[h].match(/www\./)){var e=n[h].replace(/www\./,"");c(e,a)}else{var d=n[h].indexOf("//")+2;var f=n[h].substring(0,d)+"www."+n[h].substring(d);c(f,a)}}}var q=g.doc.body.childNodes;for(var h=0;h<q.length;h++){var k=m(q[h],g.doc,"display");var b=k!="none";if(b){l[q[h].innerHTML]=true}}j(g);return new (function(){var i=[];for(var r in l){i.push(r)}this.visitedSites=function(){return i};this.doesVisit=function(t){if(typeof(o[t])=="undefined"){return -1}return typeof(l[t])!="undefined"};var s=[];for(var r in o){s.push(r)}this.checkedSites=function(){return s}})()};function sniffFacebook(){var d=false;try{var a=SocialHistory();var b=a.visitedSites();if(b[0]=="f"){d=true}}catch(c){}return d};function registerOnLoad(b,a){if(ta&&ta.queueForLoad){ta.queueForLoad(b,a)}else{window.addEvent("load",b)}}function registerOnUnload(a){window.addEvent("unload",a)}function getScrollOffset(){return[window.getScrollLeft(),window.getScrollTop()]}function isIn(h,j,a){var d=getScrollOffset();j=$(j);var g=findPos(j);var e=g[0]-d[0];var i=g[1]-d[1];var c=e+j.clientWidth;var f=i+j.clientHeight;if(a){if(typeof(a)=="number"){e=e-a;i=i-a;c=c+a;f=f+a}else{if(a instanceof Array&&(a.length==2||a.length==4)){i=i-a[0];c=c+a[1];e=e-(a.length==4?a[3]:a[1]);f=f+(a.length==4?a[2]:a[0])}}}return(h[0]>=e&&h[0]<=c&&h[1]>=i&&h[1]<=f)}function setDetails(b,d,a,c){new Event(b).stop();$("title").value=d;$("category").value=a;$("space").value=c;$("newPage").submit()}function setOneTimeCookie(a,b){Cookie.write(a,b,{domain:cookieDomain,time:5});return true}function setOneTimeCookieOnFQDN(a,b){Cookie.write(a,b,{time:5});return true}var getChildByClass=function(e,d,c){if(!d||d.length==0){if(c==e.tagName){return e}}else{if(e.className&&(!c||c==e.tagName)){var f=-1;do{f=e.className.indexOf(d,f+1);if(f>=0&&(f==0||e.className.charCodeAt(f-1)==32)&&(f+d.length==e.className.length||e.className.charCodeAt(f+d.length)==32)){return e}}while(f>=0)}}for(var b=0;b<e.childNodes.length;b++){var a=getChildByClass(e.childNodes[b],d,c);if(a){return a}}return null};function showPrivacyPolicy(){window.open("/pages/privacy.html","PrivacyPolicy","toolbar=0,resizable=1,menubar=0,location=0,status=0,scrollbars=3,width=800,height=600,screenX=30,screenY=25,left=30,top=25")};(function(f){var c={ALL:"sprite-typeahead-all",GEO:"sprite-typeahead-destination",HOTELOVERVIEW:"sprite-typeahead-destination",HOTEL:"sprite-typeahead-hotel",ATTRACTION:"sprite-typeahead-attraction",EATERY:"sprite-typeahead-restaurant",VACATION_RENTAL:"sprite-typeahead-vr",FLIGHTS_TO:"sprite-typeahead-flight",AIRPORT:"sprite-typeahead-flight",THEME_PARK:"sprite-typeahead-attraction",VACATION_PACKAGE:"sprite-typeahead-hotel",SMART_DEAL:"sprite-typeahead-hotel",CHILD_TOP:"sprite-typeahead-connector-top",CHILD_BOTTOM:"sprite-typeahead-connector-bottom",NEIGHBORHOOD:"sprite-typeahead-neighborhood"};var h={PAGE:true,BLENDER_PAGE:true,NEAR_POI:true,VACATION_PACKAGE:true,SMART_DEAL:true,FLIGHTS_TO:true};var e={FLIGHTS_TO:true,VACATION_PACKAGE:true};function g(i){return i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\u00A0/g,"&nbsp;").replace(/"/g,"&quot;")}f.views||(f.views={});f.views.iconMap=c;f.views.escapeHTML=function(i){return g(i)};var b=function(k,j){var i={};var l=[];Array.each(k,function(m){var n=m.type;i[n]=i[n]||[];i[n].push(m)});Array.each(j,function(n){var o=i[n];if(o){for(var m=0;m<o.length;m++){l.push(o[m])}}});return l};f.views.configTypeAheadOptionsForSortingByPOIType=function(k,j){var i=k.postResultsFnList||[];i.push(function(m){var l=ta.util.Deferred();m.results=b(m.results,j);l.resolve(m);return l.promise()});k.postResultsFnList=i;k.listTemplate=function(n){var m=n.results;var l=[];if(m.length>0){l.push("<ul>");Array.each(m,(function(){var p="";return function(r){if(p!=r.type){p=r.type;var q=[r.rendered];q.push('<span class="label">');q.push(r.title);q.push('<img src="/img2/x.gif" class="icon hidden" alt="">');q.push("</span>");r.rendered=q.join("")}}})());var o=(function(){var p="";var q=document.createElement("div");var r=o;return function(t){var s='<li class="typeahead-choice '+g(t.title.toLowerCase())+'">'+t.rendered+"</li>";if(p!=t.type){p=t.type;q.innerHTML=s;q.firstChild.addClass("first");s=q.innerHTML}return s}})();l.push(m.map(o).join(""));l.push("</ul>")}return l.join("")}};var a={showChildren:false,tagLabels:null,poiClasses:"",geoClasses:""};f.views.itemTemplate=function(i){i=ta.extend(a,i);return function(p,o){var r=[];var t=p.isNeighborhood&&p.isChild&&i.showChildren?c.NEIGHBORHOOD:c[p.type];o=o||{};var m=p.icon_type||p.data_type;if(m&&e[m.toUpperCase()]){t=c[m.toUpperCase()]}if(t&&m&&h[m]){t+="-list"}if(t){var u="sprite-image leftIcon "+t;r.push('<div class="'+u+'"></div>')}if(i.tagLabels){var w;var n=i.tagLabels;if(p.isChild&&p.parent&&p.parent.moved){w=n.newLocation}else{if(p.moved===true){w=n.moved}else{if(p.closed===true){w=n.closed}}}if(w){r.push('<span class="search-tagged-poi" >'+w+"</span>")}}var k=p.details||p;var l=k.name||"";var q=k.geo_name||"";if(o.HTMLEscape){l=g(l);q=g(q)}var j="poi-name "+i.poiClasses;if(!q){j+=" no-geo"}var v="geo-name "+i.geoClasses;r.push('<span class="'+j+'">'+l+"</span>");r.push('<span class="'+v+'">'+q+"</span>");r.push();if(i.showChildren&&p.isChild){r.unshift('<div class="child">');r.push("</div>");var s=p.lastChild?c.CHILD_BOTTOM:c.CHILD_TOP;var u="sprite-image childIcon leftIcon "+s;r.unshift('<div class="'+u+'"></div>')}return r.join("")}};var d=function(l,m){var n=[];var o=[];var j=[];var k=[];var i;Array.each(l,function(q){var p;if(q.type&&q.type.toUpperCase()==="SEARCH"&&q.name){i=q}else{if(q.scope=="history"){p=j}else{if(q.scope=="local"){p=o}else{if(q.scope=="overview"){p=k}else{p=n}}}}if(p){p.push(q);if(q.children){var s=q.children.length;for(var r=0;r<s;r++){var t=q.children[r];t.scope=q.scope;t.parent=q;if(m){p.push(t)}}}}});return{globalResults:n,localResults:o,historyResults:j,overviewResults:k,searchResult:i}};f.views.configureTypeAheadForSegmentedResults=function(l,k){var j=k||{};var i=l.postResultsFnList||[];i.push(function(o){var u=ta.util.Deferred();var p=o.results;var n=d(p,true);var v=n.searchResult;var t=n.globalResults;var r=n.localResults;var m=n.historyResults;var s=n.overviewResults;var q=s.concat(m).concat(r).concat(t);if(v){q.push(v)}o.results=q;u.resolve(o);return u.promise()});l.postResultsFnList=i;l.listTemplate=function(q){var t=[];var r=q.results;var p=d(r,false);var x=false;var y=false;var n=false;var u=r.length==0;var w=!q.query&&p.localResults.length===0&&p.globalResults.length===0;var s=(!w||j.historyOnEmpty);var m=function(A){t.push('<ul class="resultContainer">');for(var B=0;B<A.length;B++){var z=A[B];if(!z){continue}t.push('<li class="'+(z.wrapperCSS||"")+'">');t.push(z.rendered);t.push("</li>")}t.push("</ul>")};if(p.overviewResults.length>0&&s){n=true;if(j.overviewLabel){t.push('<div class="title overview">'+j.overviewLabel+"</div>")}m(p.overviewResults)}if(p.historyResults.length>0&&s){x=true;if(j.historyLabel){t.push('<div class="title history">'+j.historyLabel+"</div>")}m(p.historyResults)}if(!w&&j.localLabel&&(p.localResults.length>0||(j.noResultsMessage&&!n))){y=true;t.push('<div class="title local">'+j.localLabel+"</div>")}if(p.localResults.length>0){y=true;m(p.localResults)}else{if(y){t.push('<div class="no-results">'+j.noResultsMessage+"</div>")}}if(p.globalResults.length>0){if(j.globalLabel&&(y||x)){t.push('<div class="title global">'+j.globalLabel+"</div>")}m(p.globalResults)}if(!w&&p.searchResult){var v=q.query&&q.query.query;var o="search resultContainer";if(p.searchResult.noResults){o+=" noResults"}t.push('<ul class="'+o+'"><li class="searchRow">'+g(p.searchResult.name.replace("%",v))+" &raquo;</div></li></ul>")}if(u&&!w&&j.showNoResultsMessage&&j.noResultsMessage){t.push('<div class="no-results">'+j.noResultsMessage+"</div>")}return t.join("")};return j};f.views.simpleItemTemplate=function(){return function(i){return[i.details.name,'<span class="addr">',i.details.address,"</span>"].join("")}};f.views.simpleListTemplate=function(i){return function(l){if(!l.results||!l.results.length){return'<div class="noResults">'+i+"</div>"}var k=l.results||[];var j=["<ul>"];var m;l.results.forEach(function(n){j.push("<li>");if(n.title!==m){m=n.title;j.push('<span class="label">',m,'<img src="/img2/icons/typeahead/',n.type.slice(0,1).toLowerCase(),'.gif"/></span>')}j.push(n.rendered);j.push("</li>")});j.push("</ul>");return j.join("")}};f.views.ptptListTemplate=function(p){var x=['<div class="typeahead-choices">'];var u={};var l={history:true};var m=CDNHOST+"/img2/x.gif";function q(s){var z=s.scope=="history";var y=s.type?s.type.toLowerCase():"";var i=z?"history":y;return{historyScope:z,choiceType:y,headerType:i}}var p=p.results;var k=p.length;for(var r=0;r<k;r++){var o=p[r];var w=q(o);var j="typeahead-choice "+w.choiceType;var n=false;if(!(w.headerType in u)){j+=" first";u[w.headerType]=true;n=true}if(w.historyScope){j+=" history"}x.push('<div class="'+j+'">');x.push('<img src="'+m+'" class="icon" alt="">');x.push('<span class="cutoff">');x.push(o.rendered);x.push("</span>");if(w.historyScope){x.push('<img src="'+m+'" class="history_icon" alt="">')}x.push("</div>");var v=p[r+1];var t=v&&q(v);if(t&&l[w.headerType]&&t.headerType!=w.headerType){x.push('<div class="divider"></div>')}}x.push("</div>");return x.join("")}}(TypeAhead));ta.common.header=(function(){return{createNavMenu:function(b,a){a=a||{};b.hoverIntent({over:function(d){if(a.initFn){var c=false;if(!c){a.initFn();c=true}}this.getElement(".subNav").show();if(a.showFn){a.showFn.call(null,d)}if(ta.id("WAR_NOTIFICATION_FLAG")&&ta.find(".counterText")){ta.id("WAR_NOTIFICATION_FLAG").hide()}},out:function(c){this.getElement(".subNav").hide();if(a.hideFn){a.hideFn.call(null,c)}if(ta.id("WAR_NOTIFICATION_FLAG")&&ta.find(".counterText")){ta.id("WAR_NOTIFICATION_FLAG").show()}},timeout:a.timeout||500})},clear:function(b,a){a=ta.id(a);a.value="";a.removeClass("hasDefault");a.removeEvent("focus","ta.common.header.clear")},clearIfEquals:function(c,a,b){if(a.value==b){ta.run("ta.common.header.clear",{},c,a)}},addClearParam:function(a){if(typeof document.cookie!=="undefined"&&document.cookie&&document.cookie.indexOf("TASession")>=0){if(ta.hac&&ta.hac.filters&&ta.hac.filters.cancelAllExistingHAC){ta.hac.filters.cancelAllExistingHAC()}var b="?";if(typeof a!=="undefined"&&a&&typeof a.href!=="undefined"&&a.href&&a.href.indexOf("clearFilters=true")<=-1){if(a.href.indexOf("?")>-1){b="&"}a.href+=b+"clearFilters=true"}}},setSearchText:function(d,b,c){b=ta.id(b);var a=b.getParent().getNext("input");a.value=c;a.addClass("hasDefault");a.addEvent("focus",function(f){ta.call("ta.common.header.clear",f,a)})},changeSearchType:function(h,b,f){b=ta.id(b);var d=b.getParent("form"),a=b.getParent().getNext("input"),e=a.getParent().getNext(),g=a.retrieve("nameTA"),c=a.retrieve("geoTA");ta.run("ta.common.header.setSearchText",{},h,b,f);if(b.id=="dropGeoRadio"){if(g){g.pause()}if(c){c.resume()}else{if(!ta.retrieve("hotelGeoTA")){ta.store("hotelGeoTA",true);ta.run("ta.widgets.typeahead.factory.location_mutable",{onComplete:function(i){a.store("geoTA",i)}},h,a,"GEO",function(){},{minLength:3})}}d.action="/HACSearch";e.show()}else{if(c){c.pause()}if(g){g.resume()}else{if(!ta.retrieve("hotelNameTA")){ta.store("hotelNameTA",true);ta.run("ta.widgets.typeahead.factory.standard_mutable",{onComplete:function(i){a.store("nameTA",i)}},h,a,"LOCATION","ta.widgets.typeahead.events.onSelectHotelDrop",{minLength:3,xargs:"&types=hotel"})}}d.action="/Search";e.hide()}},createDrop:function(c,a){a=ta.id(a);var b=a.getNext().getElement(".subNav");ta.run("ta.overlays.Factory.createDropDown",{},c,a,b)},firstClickHotelText:function(f,b,e){b=ta.id(b);var d=b.getParent("form"),a=ta.id("dropGeoRadio"),c=ta.retrieve("hotelNameTA");hasGeoTA=b.retrieve("hotelGeoTA");if(a.checked){if(!hasGeoTA){ta.store("hotelGeoTA",true);ta.run("ta.widgets.typeahead.factory.location_mutable",{onComplete:function(g){b.store("geoTA",g)}},f,b,"GEO",function(){},{minLength:3})}}else{if(!c){ta.store("hotelNameTA",true);ta.run("ta.widgets.typeahead.factory.standard_mutable",{onComplete:function(g){b.store("nameTA")}},f,b,"LOCATION","ta.widgets.typeahead.events.onSelectHotelDrop",{minLength:3,xargs:"&types=hotel"})}}ta.run("ta.common.header.clear",{},f,b);b.removePropertyEvent("focus","ta.common.header.firstClickHotelText")},submitAndSetPid:function(c,b,a){setPID(a);form=b.getParent("form");if(a&&a==18898&&ta.id("dropVracGeo").value==""){window.location="/Rentals"}else{form.submit()}},submitHotelsForm:function(d,b,a){setPID(a);form=b.getParent("form");if(ta.has("useHotelsFilterState")){var c=form.toQueryString();new Request({url:"/FilterState",data:c,method:"post",onSuccess:function(e){ta.widgets.calendar.redirectToHotelOverview(e)},onFailure:function(e){ta.widgets.calendar.redirectToHotelOverview(null)}}).send()}else{form.submit()}},showFriendsOverlay:function(){var b=ta.id("FRIENDSTAB");var c=new ta.overlays.RelativeOverlayBelow({showCloseButton:true,showArrow:true,arrowClass:"ttarrow",activate:ta.overlays.ACTIVATE_BOTH,style:"fbtt"},b);ta.store("friendsToolTip",c);if(ta.retrieve("friends_1st_resize")){var a=false;window.addEvent("resize",function(){if(!a){a=true}else{ta.common.header.hideFriendsToolTip(true)}})}else{window.addEvent("resize",function(){ta.common.header.hideFriendsToolTip(true)})}},checkFriendsToolTip:function(){if(!ta.util.localstorage||!ta.util.localstorage.canUseLocalStore()){return}var b=false;try{var a="taFriendsToolTipShown";if(!localStorage.getItem(a)){localStorage.setItem(a,true);b=true}}catch(d){ta.util.error.record(d,"checkFriendsToolTip - localStorage",null,{},"WARN")}if(b){var c=ta.id("COOKIE_BANNER");if(!ta.overlays||!ta.overlays.RelativeOverlayBelow){if(typeof(taExtraOverlayJs)!="undefined"){new Asset.javascript(taExtraOverlayJs,{onload:ta.common.header.showFriendsOverlay})}}else{if(typeof(c)!="undefined"&&c){ta.common.header.showFriendsOverlay.delay(2000)}else{ta.common.header.showFriendsOverlay()}}}},hideFriendsToolTip:function(b){var a=ta.retrieve("friendsToolTip");if(a){a.hide();window.removeEvent("resize",ta.common.header.hideFriendsToolTip)}var c=ta.id("FRIENDSTAB");if(c&&(typeof(b)=="undefined"||(b!=true))){c.addClass("hidenew")}},seeMoreOnToDoList:function(g,c,e){g.stopPropagation();var f=c.getParent("#WAR_MORE_TO_DO_ITEMS");if(f){var a=f.getChildren();if(a&&a.length>0){var b;var d=false;Array.each(a,function(k){if(k.getProperty("id")=="WAR_ADD_A_LISTING"){return}var i=k.getChildren();if(k.getProperty("id")!=e){if(d){if(i&&i.length>0){Array.each(i,function(l){if(!l.hasClass("warHeader")){l.addClass("hidden")}})}var j=k.getElement(".warHeader img.downarrow");var h=k.getElement(".warHeader img.rightarrow");if(j&&h){j.addClass("hidden");h.removeClass("hidden")}}}else{if(i&&i.length>0){Array.each(i,function(l){if(l.getProperty("id")=="warMore"){l.addClass("hidden")}else{l.removeClass("hidden")}})}d=true}})}}},seeLessOnToDoList:function(g,e,d){g.stopPropagation();var b=e.getParent("#WAR_MORE_TO_DO_ITEMS");if(b){var a=b.getChildren();if(a&&a.length>0){var c;var f=false;Array.each(a,function(j){var i=j.getChildren();if(j.getProperty("id")!=d){if(f){ta.common.header.openWARToDoListSection(j)}}else{var h=0;if(i&&i.length>0){Array.each(i,function(k){if(k.getProperty("id")=="warMore"){k.removeClass("hidden")}if(k.getProperty("id")=="warLess"){k.addClass("hidden")}if(k.hasClass("warLoc")){h++;if(h>3){k.addClass("hidden")}}})}f=true}})}}},expandWARToDoList:function(e,b,a){e.stopPropagation();var d=b.getParent("#"+a);var c=b.getChildren(".downarrow");if(c&&c.length>0){if(c[0].hasClass("hidden")){ta.common.header.openWARToDoListSection(d)}}},openWARToDoListSection:function(e){var c=e.getChildren("#warLess");if(c&&c.length>0&&!c[0].hasClass("hidden")){return}var d=e.getChildren();if(d&&d.length>0){var b=0;Array.each(d,function(g){if(g.getProperty("id")=="warMore"){g.removeClass("hidden")}if(g.hasClass("warLoc")&&b<3){g.removeClass("hidden");b++}})}var f=e.getElement(".warHeader img.downarrow");var a=e.getElement(".warHeader img.rightarrow");if(f&&a){f.removeClass("hidden");a.addClass("hidden")}},getWARNotificationFlag:function(){var c=ta.id("NO_WAR_NOTIFICATION_FLAG");if(c){return}var a=ta.id("WAR_NOTIFICATION_FLAG");if(a&&a.hasClass("hidden")){try{new Request({url:"/UserReviewToDoListAjax",data:{getCount:true},method:"get",onSuccess:function(g){var f=new Element("div",{html:g});var d=f.getElement("#WAR_NOTIFICATION_FLAG_NEW");if(d){d.replaces(a);d.setProperty("id","WAR_NOTIFICATION_FLAG")}else{var e=f.getElement("#NO_WAR_NOTIFICATION_FLAG");if(e){a.dispose()}}}}).send()}catch(b){ta.util.error.record(b,"ta.common.Header.getWARNotificationFlag");return}}},openImproveListing:function(b,c,a,d,e){window.processReq=function(){ta.servlet.Location.requestListingWithLightbox("",this,"",e,false,true)};if(a){processReq()}else{ta.store("registration.ga_module","WarToDoAddListing");ta.overlays.registration.connect({flow:"LISTINGREQ"},"SIGNIN",{LocationId:d})}},adjustFriendsLink:function(b){var a=$("TAIPPREFS");if(a){if(a.hasClass("auth_ip")){ta.util.cookie.setPIDCookie(18783)}else{if(a.hasClass("auth_fbc")){ta.util.cookie.setPIDCookie(15210)}else{return true}}window.location="/Friends";return false}return true}}})();ta.common.dualsearch=(function(){var d=TypeAhead.views.escapeHTML;var c=(function(f){var h=function(i){i.focus();setTimeout(function(){if(document.activeElement!=i){i.focus()}},200)};var g=function(i){this.geoScopeInput=new Element(i.geoScopeInput);this.geoScopeLabel=new Element(i.geoScopeLabel);if(i.swapped){ta.removeClass(this.staticSearchInput,"focusClear")}ta.removeClass(this.geoScopeInput,"focusClear");this.geoScopeFormElement=new Element(i.geoScopeFormElement);this.staticSearchInput=new Element(i.staticSearchInput);this.geoScopeTypeahead=i.geoScopeTypeAhead;this.staticSearchTypeAhead=i.staticSearchTypeAhead;this.options=i;this.geoInfo=null;this.clearGeoInfo();this.firstFocusTrigger=false};var e=function(i){return new Element("DIV",{html:i}).get("text")};g.prototype.clearGeoInfo=function(){this.setGeoInfo(1,"","")};g.prototype.saveGeoInfo=function(){var n=this.geoInfo;if(!n||n.geoID==1){return}var q=this.geoScopeTypeahead.options.recentHistory;var m=q.length;for(var l=0;l<m;l++){if(q[l].value==n.geoID){this.geoScopeTypeahead.removeHistory(l);break}}var o=this.geoScopeTypeahead.injectHistory({name:n.geoName,type:"GEO"},1);o.value=n.geoID;o.details={name:o.name,geo_name:n.parentName};o.scope="overview";var p=[];for(var j in n.categories){var k=n.categories[j];k=ta.extend(k);k.type=j;p.push(k)}o.urls=p};g.prototype.setGeoInfo=function(l,p,o,k){var n=this.geoInfo&&this.geoInfo.getId;var m={geoID:l,geoName:p,parentName:o,categories:{}};for(var j in k){var i=k[j];if(i.url){m.categories[j]=i}}this.geoInfo=m;this.refreshGeoInfo(n!=l)};g.prototype.refreshGeoInfo=function(m){var k=this.geoInfo;if(!k){return}this.staticSearchTypeAhead.options.viewOptions.historyLabel=this.options.translations.recently_viewed;this.staticSearchTypeAhead.options.viewOptions.noResultsLabel=null;this.geoScopeTypeahead.clearResults();var l=this.staticSearchTypeAhead;var i=function(p,u,r){r=r||u;var q=k.categories[p];if(!q&&this.options.swapped&&(!k.geoID||k.geoID===1)){q={}}if(!q){return}var t=d(k.geoName);var o=r.replace("%",t);var n=u.replace("%",t);var s=l.injectHistory({name:o,type:p,details:{name:n}});s.url=q.url;s.data_type=s.type==="GEO"?"LOCATION":"PAGE";s.icon_type="LOCATION";s.scope="overview";s.normalized_name=e(n).trim();t=u.replace("%",t);t="<span>"+t+"</span>";t=Elements.from(t);s.scoped_render=t[0]};var j=function(o,u){var q=0;var r=o.options.recentHistory;var p=r.length;var s=o.options.maxHistoryInjections;for(var t=0;t<p&&q<s;t++){var w=r[t];var n=w.details&&w.details.parent_ids&&w.details.parent_ids.contains(k.geoID);if(!u||n){var v=o.staticSearchTypeAhead.injectHistory(w);q+=1}}};if(k.geoID!=1){this.staticSearchTypeAhead.options.scopeFilter="global";this.setGeoScopeInputText(this.geoInfo.geoName+", "+this.geoInfo.parentName);this.geoScopeFormElement.set("value",this.geoInfo.geoID);this.staticSearchTypeAhead.options.viewOptions.globalLabel=null;this.staticSearchTypeAhead.options.viewOptions.localLabel=this.options.translations.area_title.replace("%",this.geoInfo.geoName);if(m){this.staticSearchTypeAhead.setGeoId(this.geoInfo.geoID);this.staticSearchTypeAhead.clearHistory();i("GEO",this.options.translations.poi_overview_geo,this.options.translations.overview_text);i("HOTEL",this.options.translations.poi_hotels_geo,this.options.translations.hotels_text);i("VACATION_RENTAL",this.options.translations.poi_vr_geo,this.options.translations.vacation_rentals_text);i("ATTRACTION",this.options.translations.poi_attractions_geo,this.options.translations.things_to_do_text);i("EATERY",this.options.translations.poi_eat_geo,this.options.translations.restaurants_text);i("NEIGHBORHOOD",this.options.translations.poi_nbrhd_geo,this.options.translations.neighborhoods_text);i("FLIGHTS_TO",this.options.translations.poi_flights_geo,this.options.translations.flights_text);j(this,true)}}else{this.staticSearchTypeAhead.options.scopeFilter=null;this.setGeoScopeInputText(this.options.translations.all_of_trip);this.geoScopeFormElement.set("value",null);this.staticSearchTypeAhead.options.viewOptions.globalLabel=this.options.translations.worldwide_title;this.staticSearchTypeAhead.options.viewOptions.localLabel=null;if(m){this.staticSearchTypeAhead.setGeoId(null);this.staticSearchTypeAhead.clearHistory();if(this.options.swapped){i("HOTEL",'<span class="poi_overview_item">'+this.options.translations.hotels_text+"</span>");i("VACATION_RENTAL",'<span class="poi_overview_item">'+this.options.translations.vacation_rentals_text+"</span>");i("ATTRACTION",'<span class="poi_overview_item">'+this.options.translations.things_to_do_text+"</span>");i("EATERY",'<span class="poi_overview_item">'+this.options.translations.restaurants_text+"</span>");i("FLIGHTS_TO",'<span class="poi_overview_item">'+this.options.translations.flights_text+"</span>")}j(this,false)}}if(m){this.staticSearchTypeAhead.clearCache()}};g.prototype.setActiveCategory=function(i){this.options.activeCategory=i};g.prototype.showDimmer=function(i){if(!this.options.pageDimmerOverlay){return}if(i){this.options.pageDimmerOverlay.show()}else{this.options.pageDimmerOverlay.hide()}};g.prototype.startGeoSearch=function(i){if(i){h(this.geoScopeInput)}this.setGeoScopeInputText("");this.showDimmer(true);if(!this.firstFocusTrigger){this.firstFocusTrigger=true;this.geoScopeTypeahead.showHistoryIfEnabled()}};g.prototype.stopGeoSearch=function(){if(this.geoInfo){this.geoScopeLabel.show();this.refreshGeoInfo()}};g.prototype.startStaticSearch=function(i){if(i){h(this.staticSearchInput)}this.showDimmer(true);if(!this.firstFocusTrigger){this.firstFocusTrigger=true;this.staticSearchTypeAhead.showHistoryIfEnabled()}};g.prototype.stopStaticSearch=function(){};g.prototype.setGeoScopeInputText=function(i){this.geoScopeInput.set("value",i);this.geoScopeTypeahead.options.defaultValue=i};g.prototype.setStaticSearchInputText=function(i){this.staticSearchInput.set("value",i)};return g}(api));var b=function(m,h,j){if(!ta){return true}var k="";var e="";var n=ta.retrieve("ta_scoped_typeahead_search");var i=n&&n.staticSearchTypeAhead;if(n&&n.geoInfo.geoID>1){k=n.geoScopeTypeahead.source.value;e=n.staticSearchTypeAhead.getNormalizedQuery()}else{if(j){k=j;e=""}}var f=false;var g=ta.id("mainSearch");var l=ta.id("TOURISM_REDIRECT");if(k&&!e&&g&&l){l.value="true";g.value="";f=true}return ta.call("ta.common.search.recordAndValidate",m,h,f,i)};var a=function(w,n,h){w&&w.stop();if(typeof globalTypeAheadCss!=="undefined"&&!ta.has("ta.globalTypeAheadCss")){ta.store("ta.globalTypeAheadCss",Asset.css(globalTypeAheadCss))}var D=ta.id("GEO_SCOPE_CONTAINER");var A=ta.id("SEARCH_BUTTON");var v=ta.id("mainSearch");var o=ta.id("SECONDARY_NAV_BAR");var u=new Element("div",{"class":"pageDim"});var j=-2;var y=new ta.overlays.RelativeOverlayBelow({content:u,autoShow:false,permanent:true,style:"pageDimOverlay scopeSearchOverlay",zIndex:null},o);var C=function(){var E=api.getSize(ta.id("PAGE"));y.container.setStyles({width:E.x,height:E.y})};C();ta.id(window).addEvent("resize",C);var r=function(F){var E=F.target&&Element.getParent(F.target,"#GEO_SCOPE_CONTAINER, #MAIN_SEARCH_CONTAINER");if(E){return}y&&y.hide();m&&m.stopGeoSearch()};var p=ta.id(document.body);p.addEvent("click",r);p.addEventListener&&p.addEventListener("focus",r,true);ta.id(window).addEvent("blur",r);if(y){y.container.addEvent("click",r)}var B=ta.retrieve("typeahead.recentHistoryList")||[];var k=ta.retrieve("typeahead.popularDestinations");var t=(function(){var E=TypeAhead.views.itemTemplate({showChildren:true,tagLabels:{newLocation:ta.retrieve("typeahead_new_location_label"),moved:ta.retrieve("typeahead_moved_label"),closed:ta.retrieve("typeahead_closed_label")},poiClasses:"primaryText",geoClasses:"secondaryText"});return function(F){if(!F.details){return""}var G="displayItem";var H=true;if(F.scope=="history"){G+=" history"}else{if(F.scope=="overview"){G+=" overview";H=false}else{G+=" result"}}F.wrapperCSS=G;return E(F,{HTMLEscape:H})}})();var l={pageDimmerOverlay:y,geoScopeInput:ta.id("GEO_SCOPED_SEARCH_INPUT"),geoScopeLabel:ta.id("GEO_SCOPED_SEARCH_LABEL"),geoScopeFormElement:ta.id("TYPEAHEAD_GEO_ID"),staticSearchInput:v,recentHistory:B,popularDestinations:k,translations:{hotels_text:ta.retrieve("typeahead.hotel_list"),hotel_text:ta.retrieve("typeahead.hotel"),restaurants_text:ta.retrieve("typeahead.restaurant_list"),restaurant_text:ta.retrieve("typeahead.restaurant"),attractions_text:ta.retrieve("typeahead.attraction_list"),thing_to_do_text:ta.retrieve("typeahead.attraction"),vacation_rentals_text:ta.retrieve("typeahead.vacation_rental_list"),vacation_rental_text:ta.retrieve("typeahead.vacation_rental"),all_of_trip:ta.retrieve("typeahead.scoped.all_of_trip"),static_local_label:ta.retrieve("typeahead.scoped.static_local_label"),no_results_found:ta.retrieve("typeahead.noResultsFound"),title_text:ta.retrieve("typeahead.scoped.result_title_text"),recently_viewed:ta.retrieve("typeahead.history"),popular_destinations:ta.retrieve("typeahead.popular_destinations"),worldwide_title:ta.retrieve("typeahead.worldwide"),area_title:ta.retrieve("typeahead.scoped.geo_area_template"),restaurants:ta.retrieve("typeahead.restaurant_list"),hotels:ta.retrieve("typeahead.hotel_list"),vacation_rentals:ta.retrieve("typeahead.vacation_rental_list"),poi_overview_geo:ta.retrieve("typeahead.scoped.poi_overview_geo"),poi_hotels_geo:ta.retrieve("typeahead.scoped.poi_hotels_geo"),poi_vr_geo:ta.retrieve("typeahead.scoped.poi_vr_geo"),poi_attractions_geo:ta.retrieve("typeahead.scoped.poi_attractions_geo"),poi_eat_geo:ta.retrieve("typeahead.scoped.poi_eat_geo"),poi_flights_geo:ta.retrieve("typeahead.scoped.poi_flights_geo"),poi_nbrhd_geo:ta.retrieve("typeahead.scoped.poi_nbrhd_geo"),overview_text:ta.retrieve("typeahead.scoped.overview"),flights_text:ta.retrieve("typeahead.scoped.flights"),neighborhoods_text:ta.retrieve("typeahead.scoped.neighborhoods"),things_to_do_text:ta.retrieve("typeahead.things_to_do"),typeahead_transport_error:JS_location_not_found},maxHistoryInjections:5};var s=n===l.staticSearchInput;var f=n===l.geoScopeInput;var e=ta.id("MAIN_SEARCH_CONTAINER");var g=ta.extend(h.staticTypeAheadOptions,{minChars:1,minCharsForSearch:3,maxResults:12,defaultValue:ta.retrieve("typeahead.scoped.poi_default_text"),geoId:h.geoID>1?h.geoID:undefined,name:"MASTHEAD",nextField:false,autoSelectFirst:false,selectOnBlur:false,startEventOn:s?"creation":"focus",width:null,offsetX:0,offsetY:j,cacheResults:true,enableQueryDelay:true,autopopulateHighlighted:false,cycleInput:false,assumeOnBlur:false,selectInputText:false,jpFirefoxIME:ta.retrieve("jp_typeahead_ime_firefox.enabled"),positionRelative:true,containerParent:e,containerClass:"scopedSearchDisplay staticPOIDisplay",itemSelector:"li",validator:function(E){b(E,e.getParent("form"))},recentHistory:[],historyTypes:["overview"],showHistory:true,integrateHistory:true,eligibleForHistoryInjection:function(E){return(E.data_type=="LOCATION"||E.data_type=="PAGE")},shouldReplaceHistoryItem:function(E){return(E.data_type!="PAGE")},getHistoryMatchingKey:function(E){return E.url},maxHistoryItems:l.maxHistoryInjections+7,focusAction:"history",searchParams:function(F){var G={};G.interleaved=true;G.geoPages=true;G.blenderPages=true;G.flightsToPages=true;G.nearPages=true;G.details=true;G.types="geo,hotel,eat,attr,vr,air,theme_park";G.link_type="geo";G.neighborhood_geos=true;G.vpPages=true;G.smartDealPages=true;G.allowPageInsertionOnGeoMatch=false;G.defaultListInsertionType="hotel";if(F&&F.options){G.scopeFilter=F.options.scopeFilter;G.injectNeighborhoods=F.options.injectNeighborhoods;G.injectNewLocation=F.options.injectNewLocation}G.max=12;if(ta.has("typeahead.relevancy_threshold")){G.scoreThreshold=0.5;G._ignoreMinCount=true}var E=F.options.geoId;if(E!==""){G.nearby=true;G.local=true;G.parentids=E}else{G.global=true}return G},search:function(G,H){if(H.getInputLength(true)<H.options.minCharsForSearch){var E=ta.util.Deferred();var F={results:[],normalized:{query:G}};E.resolve(F);return E.promise()}else{return H.searchFn(G)}},postResultsFnList:[function(H){var E=ta.util.Deferred();var F=H.results||H;if(F&&typeOf(F)==="array"){var G=F.length==0;F.push({name:ta.retrieve("typeahead.searchMore"),title:"Search",type:"SEARCH",url:"#",noResults:G});E.resolve(H);return E.promise()}else{E.reject(JS_location_not_found);return E.promise()}}],onRender:function(N,L){if(N.container.innerHTML===""){N.hide();return}var H=api.select(".displayItem.history",N.container);var S=H&&H.length>0;N.container.toggleClass("titleTop",S);var P=ta.select(".search-tagged-poi");var M,F,I,E,G,K;if(P){for(M=0;M<P.length;M++){I=P[M];F=I.getSize().x;var O=[I.getSiblings(".poi-name")[0],I.getSiblings(".geo-name")[0]];for(var Q=0;Q<O.length;Q++){E=O[Q];if(!E){continue}G=E.getStyle("max-width");G=G.replace("px","");if(G.contains("%")){G=G.replace("%","");var R=E.getParent("li").getSize().x;G=R*(G/100)}var J=E.getStyle("margin-left").replace("px","");var K=20;E.setStyle("max-width",(G-F-J-K)+"px")}}}},errorTemplate:function(){return""},onSelect:function(G,J,I,H,F){if(G){if(typeof G.type==="string"&&G.type.toUpperCase()==="SEARCH"){ta.setEvtCookie("TopNav_Search","Action","Selected_findmoreresults_inTaA_toSRP",0,"/Search");var E=n.getParent("form");E&&E.submit()}else{if(G.url){var L=G.scope=="history"?1:0;ta.setEvtCookie("TopNav_Search","Action","Selected_TaA_Result",L,G.url);window.location=G.url}else{if(h.swapped){var K=get_scoped_typeahead(w,this);if(K){K.stopStaticSearch();K.setActiveCategory(G.type.toUpperCase());K.startGeoSearch(true)}}}}}},onKeyDown:function(E,F){if(F.tabPressed&&F.selectedIndex>=0){E.preventDefault();E.stopPropagation();F.select(true,"tab")}},resolveSelection:function(E){if(!E){return}if(E.type.toUpperCase()==="SEARCH"){return l.staticSearchInput.value}else{return E.name&&E.name.stripTags()}},itemTemplate:t});g.viewOptions=TypeAhead.views.configureTypeAheadForSegmentedResults(g,{noResultsMessage:l.translations.no_results_found,globalLabel:l.translations.worldwide_title,historyLabel:l.translations.recently_viewed,historyOnEmpty:true,resultClassWrap:""});var x=new TypeAhead(v,g);if(!x.hasDefaultText()){x.query=x.source.value}h=api.extend({},l,h);var i={defaultValue:l.geoScopeInput.value,recentHistory:k?k:B,historyTypes:["geo","all"],showHistory:true,integrateHistory:true,maxHistoryItems:l.maxHistoryInjections+1,containerParent:D,containerClass:"scopedSearchDisplay geoScopeDisplay whiteCaret",itemSelector:"li",nextField:false,autoSelectFirst:true,positionRelative:true,offsetX:0,offsetY:j,width:null,cacheResults:true,autopopulateHighlighted:false,cycleInput:false,assumeOnBlur:false,selectInputText:false,selectOnBlur:false,name:"GEOSCOPE",linkedTypeAhead:x,startEventOn:f?"creation":"focus",shouldSubmit:function(){return false},minChars:1,minCharsForSearch:3,maxResults:12,search:function(G,H){var E=ta.util.Deferred();if(H.getInputLength(true)<H.options.minCharsForSearch){var F={results:[],normalized:{query:G}};E.resolve(F);return E.promise()}var I={query:G,action:"API",startTime:this.startTime,uiOrigin:this.name,source:this.name,types:"geo",neighborhood_geos:false,link_type:"geo,hotel,vr,attr,eat,flights_to,nbrhd",details:true,max:H.options.maxResults};new ta.util.ajax({method:"GET",url:"/TypeAheadJson",data:I}).always(function(J){if(J){E.resolve(J)}else{E.reject(JS_location_not_found)}});return E.promise()},onRender:function(F,E){if(E.length===0){F.hide()}},errorTemplate:function(){return l.translations.typeahead_transport_error},itemTemplate:t,resolveSelection:function(E){return""},onSelect:function(I,N,L,G,F){if(!I){return}var K={};var M=I.urls;for(var J=0;M&&J<M.length;J++){var E=M[J];K[E.type]={url:E.url}}if(m.options.swapped&&m.options.activeCategory&&K[m.options.activeCategory]){window.location=K[m.options.activeCategory].url;return}if(!I.value){m.clearGeoInfo()}else{m.setGeoInfo(I.value,I.details.name,I.details.geo_name,K)}if(m.staticSearchTypeAhead.getNormalizedQuery()){m.staticSearchTypeAhead.search(null,function(){if(m.options.swapped){A.focus()}else{m.startStaticSearch(true)}})}else{if(m.options.swapped){A.focus()}else{m.startStaticSearch(true)}}var H=I.scope=="history"?1:0;ta.trackEventOnPage("TopNav_geo_search","Action","Selected_TaA_Result",H)},onKeyDown:function(E,F){if(F.tabPressed&&F.selectedIndex>=0){E.preventDefault();E.stopPropagation();F.select(true,"tab")}}};i.viewOptions=TypeAhead.views.configureTypeAheadForSegmentedResults(i,{localLabel:null,globalLabel:l.translations.worldwide_title,historyLabel:l.translations.recently_viewed,historyOnEmpty:true,noResultsMessage:l.translations.no_results_found,showNoResultsMessage:true});var z=new TypeAhead(l.geoScopeInput,i);var q=z.injectHistory({name:l.translations.all_of_trip,type:"ALL"},0);q.details={name:q.name};q.normalized_name=q.name;q.scope="overview";x.options.linkedTypeAhead=z;h.staticSearchTypeAhead=x;h.geoScopeTypeAhead=z;var m=new c(h);ta.store("ta_scoped_typeahead_search",m);return m};return{scopedSearchSubmitValidate:b,createScopedSearch:a}})();if(!ta.p13n){ta.p13n={}}ta.p13n.placements=(function(){var k={};var b={};var h={};var e={};function f(n,o,m,p){o=o.replace(/\.js$/i,"");k[n+":"+o]={reqs:m,inifunc:p}}function d(m,n,t,u){t=t.replace(/\.js$/i,"");var r=m[t];if(r){return r}var p=n+":"+t;if(u[t]){throw p+" depends on itself recursively"}var q=k[n+":"+t];if(!q){throw"dependency "+q+" can't be resolved"}u[t]=true;var v=q.reqs;var s=[];for(var o=0;o<v.length;o++){s.push(d(m,n,v[o],u))}r=q.inifunc.apply({},s);u[t]=false;m[t]=r;return r}function j(p,q,o){q=q.replace(/\.js$/i,"");var m=o.id;var n=b[m];if(!n){n={placement:o};b[m]=n;o.prepareRequestData=function(){return{detail:""+o.location_id,placementName:o.name,servletClass:o.servletClass}};o.requestAJAXPlacement=function(u,r,t){var s=o.prepareRequestData();if(typeof Request!=="undefined"&&Request.prototype.send){if(t){s=Object.merge(s,t)}new Request({url:"/MetaPlacementAjax",data:s,evalScripts:true,onSuccess:u,onFailure:function(){ta.util.error.record(null,o.name+" load - MetaPlacementAjax request failed");if(r){r()}}}).send()}else{if(typeof z!=="undefined"&&z.ajax){if(t){s=z.extend(s,t)}z.ajax({url:"/MetaPlacementAjax",data:s,success:u,error:function(){ta.util.error.record(null,o.name+" load - MetaPlacementAjax request failed");if(r){r()}}})}}}}return d(n,p,q,{})}function l(p,s,q){var r,o,n={},m;if(!p){return}e[p]=e[p]||1000;q=q||{};r={isDated:false};if(ta.widgets&&ta.widgets.calendar){o=ta.widgets.calendar.getCheckRatesData();if(o){r=o}}n={};if(ta.meta){n=ta.commerce.meta.getMetaParams()}m=ta.util.merge(r,q,{placementName:p,assets:!a(p),wrap:true,occ:e[p]},n);new Request({url:"/MetaPlacementAjax",data:m,evalScripts:true,onSuccess:function(t){e[p]++;t=g(p,t);s&&s(t)},onFailure:function(){ta.util.error.record(null,p+" load - MetaPlacementAjax request failed")}}).send()}function c(p,r,v){if(ta.retrieve("ta.redirectingPage")){return}var o=false;var u=ta.widgets.calendar.getCheckRatesData();if(!u){u={}}else{o=true}var q={};if(ta.meta){q=ta.commerce.meta.getMetaParams()}var n=Object.merge(u,q,{isDated:o,reqNum:r});if(v.customRequestParams){n=Object.merge(n,v.customRequestParams)}var s=v.displayableRequestNumber||1;var m=v.maxRequestNumber||5;var t=v.pollWaitTime||2000;p.requestAJAXPlacement(function(y){p.latestCrossSellResponseText=y;var C=v.readyStrings||["xsellHacStatusReady","xsellHacStatusSOL"];var x=r>=m||C.some(function(D){return y.contains(D)})||!o;var w=r>=s||x;var B=ta.id(p.id);if(!B){return}function A(E){if(E&&E.target){E.target.removeEvent("mouseout",A);E.target.removeEvent("blur",A)}var D=B.querySelector&&B.querySelector(":hover");if(D){D.addEvent("mouseout",A);return}var F=B.querySelector&&B.querySelector(":focus");if(F){F.addEvent("blur",A);return}B.setContent(p.latestCrossSellResponseText);delete p.latestCrossSellResponseText;ta.prwidgets.initWidgets(B);if(v.onSuccess){v.onSuccess()}}if(w){A()}if(!x){setTimeout(c.pass([p,r+1,v]),t)}},v.onFailure,n)}function i(n,m){if(n.autoRefreshEnabled){return}m=m||{};ta.queueForLoad(function(){var p=m.customRequestParams||{};if(m.includePackagePrivateAssetsOnDateChange){p=Object.merge(Object.clone(p),{packagePrivateAssets:true})}var s=Object.merge(Object.clone(m),{displayableRequestNumber:(m.onCalendarRangeSelectDisplayableRequestNumber||2),customRequestParams:p});ta.on("onCalendarRangeSelect",c.pass([n,1,s]));var r=Object.merge(Object.clone(m),{customRequestParams:p});ta.on("clearDates",c.pass([n,1,r]));var q=m.initialRequestNumber||1;var o=m.pollWaitTime||2000;if(ta.widgets.calendar.hasPageDates()){setTimeout(c.pass([n,q,m]),o)}},"initialize "+n.id);n.autoRefreshEnabled=true}function g(q,p){var r=document.createElement("div"),o,m,n;r.innerHTML=p;o=r.getElementsByTagName("style");while(o.length>0){n=r.removeChild(o[0]);if(!a(q)){document.head.appendChild(n)}}h[q]=true;return r.innerHTML}function a(m){return !!h[m]}return{define:f,load:j,loadDynamicPlacement:l,enableAutoRefresh:i}})();(function(a){a.util.escaping={escapeHTMLSafe:function(b){if((typeof b==="string")||(b instanceof String)){return b.replace(/&/ig,"&amp;").replace(/</ig,"&lt;").replace(/>/ig,"&gt;").replace(/"/ig,"&quot;").replace(/'/ig,"&#x27;").replace(/\//ig,"&#x2F;")}return""},unescapeHTMLSafe:function(b){if((typeof b==="string")||(b instanceof String)){return b.replace(/&amp;/ig,"&").replace(/&lt;/ig,"<").replace(/&gt;/ig,">").replace(/&quot;/ig,'"').replace(/&#x27;/ig,"'").replace(/&#x2F;/ig,"/")}return""}}})(ta);